(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ;a=window.WebSharper=window.WebSharper||{};b=a.UI=a.UI||{};c=b.Next=b.Next||{};d=c.Array=c.Array||{};e=c.String=c.String||{};f=c.Abbrev=c.Abbrev||{};g=f.Fresh=f.Fresh||{};h=f.HashSet=f.HashSet||{};i=f.Dict=f.Dict||{};j=f.Slot=f.Slot||{};k=f.Async=f.Async||{};l=f.Mailbox=f.Mailbox||{};m=l.MailboxState=l.MailboxState||{};n=window.StartupCode$WebSharper_UI_Next$Abbrev=window.StartupCode$WebSharper_UI_Next$Abbrev||{};o=c.AppendList=c.AppendList||{};p=window.StartupCode$WebSharper_UI_Next$AppendList=window.StartupCode$WebSharper_UI_Next$AppendList||{};q=c.DomUtility=c.DomUtility||{};r=window.StartupCode$WebSharper_UI_Next$DomUtility=window.StartupCode$WebSharper_UI_Next$DomUtility||{};s=c.Trie=c.Trie||{};t=s.LookupResult=s.LookupResult||{};u=window.StartupCode$WebSharper_UI_Next$Trie=window.StartupCode$WebSharper_UI_Next$Trie||{};v=c.Snap=c.Snap||{};w=c.Var=c.Var||{};x=c.Updates=c.Updates||{};y=c.View=c.View||{};z=c.ViewBuilder=c.ViewBuilder||{};A=c.Submitter=c.Submitter||{};B=c.Key=c.Key||{};C=c.Model=c.Model||{};D=c.Serializer=c.Serializer||{};E=c.Storage=c.Storage||{};F=E.ArrayStorage=E.ArrayStorage||{};G=E.LocalStorageBackend=E.LocalStorageBackend||{};H=c.ListModel=c.ListModel||{};I=c.ListModels=c.ListModels||{};J=window.StartupCode$WebSharper_UI_Next$Models=window.StartupCode$WebSharper_UI_Next$Models||{};K=c.ReactiveExtensions=c.ReactiveExtensions||{};L=c.DoubleInterpolation=c.DoubleInterpolation||{};M=c.Interpolation=c.Interpolation||{};N=c.Easing=c.Easing||{};O=c.Easings=c.Easings||{};P=c.An=c.An||{};Q=c.Anims=c.Anims||{};R=c.Trans=c.Trans||{};S=window.StartupCode$WebSharper_UI_Next$Animation=window.StartupCode$WebSharper_UI_Next$Animation||{};T=c.AnimatedAttrNode=c.AnimatedAttrNode||{};U=c.DynamicAttrNode=c.DynamicAttrNode||{};V=c.AttrProxy=c.AttrProxy||{};W=c.Client=c.Client||{};X=W.Attrs=W.Attrs||{};Y=X.Dyn=X.Dyn||{};Z=c.Attrs=c.Attrs||{};_0=c.CheckedInput=c.CheckedInput||{};_1=c.AttrModule=c.AttrModule||{};_2=window.StartupCode$WebSharper_UI_Next$Attr_Client=window.StartupCode$WebSharper_UI_Next$Attr_Client||{};_3=c.DocElemNode=c.DocElemNode||{};_4=W.Docs=W.Docs||{};_5=_4.DomNodes=_4.DomNodes||{};_6=_4.NodeSet=_4.NodeSet||{};_7=_4.RunState=_4.RunState||{};_8=c.Docs=c.Docs||{};_9=c.Doc=c.Doc||{};_=c.Elt=c.Elt||{};$=W.EltUpdater=W.EltUpdater||{};ba=window.StartupCode$WebSharper_UI_Next$Doc_Client=window.StartupCode$WebSharper_UI_Next$Doc_Client||{};bb=c.Flow=c.Flow||{};bc=c.FlowBuilder=c.FlowBuilder||{};bd=c.Html=c.Html||{};be=bd.attr=bd.attr||{};bf=c.Route=c.Route||{};bg=c.Routing=c.Routing||{};bh=bg.State=bg.State||{};bi=c.RouteMap=c.RouteMap||{};bj=c.Router=c.Router||{};bk=c.Input=c.Input||{};bl=bk.MousePosSt=bk.MousePosSt||{};bm=bk.MouseBtnSt=bk.MouseBtnSt||{};bn=bk.Mouse=bk.Mouse||{};bo=bk.KeyListenerSt=bk.KeyListenerSt||{};bp=bk.Keyboard=bk.Keyboard||{};bq=window.StartupCode$WebSharper_UI_Next$Input=window.StartupCode$WebSharper_UI_Next$Input||{};br=a&&a.List;bs=a&&a.Arrays;bt=a&&a.Enumerator;bu=a&&a.Strings;bv=a&&a.Char;bw=a&&a.Collections;bx=bw&&bw.HashSet;by=a&&a.Seq;bz=window.IntelliFactory;bA=bz&&bz.Runtime;bB=a&&a.Unchecked;bC=window.console;bD=a&&a.Concurrency;bE=bw&&bw.Map;bF=bw&&bw.FSharpMap;bG=bw&&bw.List;bH=a&&a.Operators;bI=a&&a.Queue;bJ=a&&a.Lazy;bK=bw&&bw.Dictionary;bL=window.JSON;bM=a&&a.Numeric;bN=window.Node;bO=window.jQuery;bP=a&&a.Slice;bQ=window.String;d.mapInPlace=function(bR,bS){var bT,bU;for(bT=0,bU=bS.length-1;bT<=bU;bT++)bS[bT]=bR(bS[bT]);return bS;};d.ofSeqNonCopying=function(bR){var bS,bT;if(bR instanceof window.Array)return bR;else if(bR instanceof br.T)return bs.ofList(bR);else if(bR===null)return[];else{bS=[];bT=bt.Get(bR);try{while(bT.MoveNext())bS.push(bT.Current());return bS;}finally{if("Dispose"in bT)bT.Dispose();}}};d.MapTreeReduce=function(bR,bS,bT,bU){var bV;function bW(bX,bY){var bZ,b0;return bY<=0?bS:bY===1&&(bX>=0&&bX<bV&&true)?bR(bs.get(bU,bX)):(b0=bY/2>>0,bT(bW(bX,b0),bW(bX+b0,bY-b0)));}bV=bs.length(bU);return bW(0,bV);};d.TreeReduce=function(bR,bS,bT){var bU;function bV(bW,bX){var bY,bZ;return bX<=0?bR:bX===1&&(bW>=0&&bW<bU&&true)?bs.get(bT,bW):(bZ=bX/2>>0,bS(bV(bW,bZ),bV(bW+bZ,bX-bZ)));}bU=bs.length(bT);return bV(0,bU);};e.isBlank=function(bR){return bu.forall(bv.IsWhiteSpace,bR);};g.Id=function(){g.set_counter(g.counter()+1);return"uid"+window.String(g.counter());};g.Int=function(){g.set_counter(g.counter()+1);return g.counter();};g.counter=function(){n.$cctor();return n.counter;};g.set_counter=function(bR){n.$cctor();n.counter=bR;};h.Filter=function(bR,bS){return new bx.New$2(bs.filter(bR,h.ToArray(bS)));};h.Intersect=function(bR,bS){var bT;bT=new bx.New$2(h.ToArray(bR));bT.IntersectWith(h.ToArray(bS));return bT;};h.Except=function(bR,bS){var bT;bT=new bx.New$2(h.ToArray(bS));bT.ExceptWith(h.ToArray(bR));return bT;};h.ToArray=function(bR){var bS;bS=bs.create(bR.get_Count(),void 0);bR.CopyTo(bS);return bS;};i.ToValueArray=function(bR){var bS;bS=bs.create(bR.count,void 0);by.iteri(function(bT,bU){return bs.set(bS,bT,bU.V);},bR);return bS;};i.ToKeyArray=function(bR){var bS;bS=bs.create(bR.count,void 0);by.iteri(function(bT,bU){return bs.set(bS,bT,bU.K);},bR);return bS;};j=f.Slot=bA.Class({GetHashCode:function(){return bB.Hash(this.key(this.value));},Equals:function(bR){return bB.Equals(this.key(this.value),this.key(bR.get_Value()));},get_Value:function(){return this.value;}},null,j);j.New=bA.Ctor(function(bR,bS){this.key=bR;this.value=bS;},j);j.Create=function(bR,bS){return new j.New(bR,bS);};k.OnError=function(bR){return bC.log("WebSharper UI.Next: Uncaught asynchronous exception",bR);};k.StartTo=function(bR,bS){bD.StartWithContinuations(bR,bS,function(bT){k.OnError(bT);},function(bT){},null);};m=l.MailboxState=bA.Class({},null,m);l.StartProcessor=function(bR){var bS;function bT(){var bU;bU=null;return bD.Delay(function(){return bD.Bind(bR,function(){var bV;bV=bS[0];return bB.Equals(bV,1)?(bS[0]=0,bD.Zero()):bB.Equals(bV,2)?(bS[0]=1,bT()):bD.Zero();});});}bS=[0];return function(){var bU;bU=bS[0];bB.Equals(bU,0)?(bS[0]=1,bD.Start(bT(),null)):bB.Equals(bU,1)?bS[0]=2:void 0;};};n.$cctor=bA.Cctor(function(){n.counter=0;n.$cctor=window.ignore;});o.FromArray=function(bR){var bS;bS=bR.length;return bS===0?{$:0}:bS===1?{$:1,$0:bs.get(bR,0)}:{$:3,$0:bR.slice()};};o.ToArray=function(bR){var bS;function bT(bU){if(bU.$==1)bS.push(bU.$0);else if(bU.$==2){bT(bU.$0);bT(bU.$1);}else if(bU.$==3)bs.iter(function(bV){bS.push(bV);},bU.$0);}bS=[];bT(bR);return bS.slice(0);};o.Single=function(bR){return{$:1,$0:bR};};o.Concat=function(bR){var bS;bS=d.ofSeqNonCopying(bR);return d.TreeReduce(o.Empty(),o.Append,bS);};o.Append=function(bR,bS){return bR.$==0?bS:bS.$==0?bR:{$:2,$0:bR,$1:bS};};o.Empty=function(){p.$cctor();return p.Empty;};p.$cctor=bA.Cctor(function(){p.Empty={$:0};p.$cctor=window.ignore;});q.SetProperty=function(bR,bS,bT){return bR.setProperty(bS,bT);};q.IterSelector=function(bR,bS,bT){var bU,bV,bW;bU=bR.querySelectorAll(bS);for(bV=0,bW=bU.length-1;bV<=bW;bV++)bT(bU[bV]);};q.ChildrenArray=function(bR){var bS,bT,bU;bS=[];for(bT=0,bU=bR.childNodes.length-1;bT<=bU;bT++)bS.push(bR.childNodes[bT]);return bS;};q.RemoveClass=function(bR,bS){window.jQuery(bR).removeClass(bS);};q.AddClass=function(bR,bS){window.jQuery(bR).addClass(bS);};q.InsertAt=function(bR,bS,bT){var bU;if(!(bT.parentNode===bR&&bS===(bU=bT.nextSibling,bB.Equals(bU,null)?null:bU)))bR.insertBefore(bT,bS);};q.RemoveNode=function(bR,bS){if(bS.parentNode===bR)bR.removeChild(bS);};q.SetStyle=function(bR,bS,bT){q.SetProperty(bR.style,bS,bT);};q.SetAttr=function(bR,bS,bT){bR.setAttribute(bS,bT);};q.RemoveAttr=function(bR,bS){bR.removeAttribute(bS);};q.CreateAttr=function(bR,bS){var bT;bT=q.Doc().createAttribute(bR);bT.value=bS;return bT;};q.CreateText=function(bR){return q.Doc().createTextNode(bR);};q.CreateSvgElement=function(bR){return q.Doc().createElementNS("http://www.w3.org/2000/svg",bR);};q.CreateElement=function(bR){return q.Doc().createElement(bR);};q.Clear=function(bR){while(bR.hasChildNodes())bR.removeChild(bR.firstChild);};q.ClearAttrs=function(bR){while(bR.hasAttributes())bR.removeAttributeNode(bR.attributes.item(0));};q.AppendTo=function(bR,bS){bR.appendChild(bS);};q.Doc=function(){r.$cctor();return r.Doc;};r.$cctor=bA.Cctor(function(){r.Doc=window.document;r.$cctor=window.ignore;});t.NotFound={$:1};s.Empty=function(){u.$cctor();return u.Empty;};s.Lookup=function(bR,bS){return s.Look(br.ofSeq(bS),bR);};s.Look=function(bR,bS){var bT,bU;switch(bS.$==2?(bT=bS.$0,0):bS.$==0?bR.$==1?(bT=[bR.$0,bR.$1,bS.$0],1):2:2){case 0:return{$:0,$0:bT,$1:bR};break;case 1:bU=bE.TryFind(bT[0],bT[2]);return bU==null?t.NotFound:s.Look(bT[1],bU.$0);break;case 2:return t.NotFound;break;}};s.ToArray=function(bR){var bS;bS=[];s.Map(function(){return function(bT){return bS.push(bT);};},bR);return bS.slice(0);};s.Mapi=function(bR,bS){var bT,bU;bT=[0];bU=function(){var bV;bV=bT[0];bT[0]=bV+1;return bV;};return s.Map(function(bV){return bR(bU(),bV);},bS);};s.Map=function(bR,bS){return s.MapLoop(br.T.Empty,bR,bS);};s.MapLoop=function(bR,bS,bT){return bT.$==1?{$:1}:bT.$==2?{$:2,$0:(bS(bR))(bT.$0)}:s.TrieBranch(bE.Map(function(bU,bV){return s.MapLoop(br.append(bR,br.ofArray([bU])),bS,bV);},bT.$0));};s.Merge=function(bR){var bS,bT,bU;bS=d.ofSeqNonCopying(bR);bT=bs.length(bS);return bT===0?{$:1,$0:{$:1}}:bT===1?{$:1,$0:bs.get(bS,0)}:bs.exists(s.IsLeaf,bS)?null:(bU=s.MergeMaps(s.Merge,by.choose(function(bV){return bV.$==0?{$:1,$0:bV.$0}:null;},bS)),bU==null?null:{$:1,$0:s.TrieBranch(bU.$0)});};s.IsLeaf=function(bR){return bR.$==2&&true;};s.MergeMaps=function(bR,bS){var bT,bU;bT=s.AllSome((bU=function(bV,bW){var bX;bX=bR(bW);return bX==null?null:{$:1,$0:[bV,bX.$0]};},by.map(function(bV){return bU(bV[0],bV[1]);},bE.ToSeq(by.fold(function(bV,bW){return s.MultiAdd(bW[0],bW[1],bV);},new bF.New([]),by.collect(bE.ToSeq,bS))))));return bT==null?null:{$:1,$0:bE.OfArray(bs.ofSeq(bT.$0))};};s.AllSome=function(bR){var bS,bT,bU,bV;bT=bt.Get(bR);bU=new bG.New$2();bS=true;while(bS&&bT.MoveNext()){bV=bT.Current();bV!=null&&bV.$==1?bU.Add(bV.$0):bS=false;}return bS?{$:1,$0:bU.ToArray()}:null;};s.MultiAdd=function(bR,bS,bT){return bT.Add(bR,new br.T({$:1,$0:bS,$1:s.MultiFind(bR,bT)}));};s.MultiFind=function(bR,bS){var bT;bT=bE.TryFind(bR,bS);return bT==null?br.T.Empty:bT.$0;};s.Prefix=function(bR,bS){return s.TrieBranch(new bF.New(br.ofArray([[bR,bS]])));};s.Leaf=function(bR){return{$:2,$0:bR};};s.TrieBranch=function(bR){return bR.get_IsEmpty()?{$:1}:{$:0,$0:bR};};u.$cctor=bA.Cctor(function(){u.Empty={$:1};u.$cctor=window.ignore;});v.Obsolete=function(bR){var bS,bT,bU,bV,bW;bT=bR.s;if(bT==null||(bT!=null&&bT.$==2?(bS=bT.$1,false):bT!=null&&bT.$==3?(bS=bT.$1,false):true))void 0;else{bR.s=null;for(bU=0,bV=bs.length(bS)-1;bU<=bV;bU++){bW=bs.get(bS,bU);typeof bW=="object"?function(bX){v.Obsolete(bX);}(bW):bW();}}};v.New=function(bR){return{s:bR};};v.MapAsync=function(bR,bS){var bT;bT=v.New({$:3,$0:[],$1:[]});v.When(bS,function(bU){k.StartTo(bR(bU),function(bV){v.MarkDone(bT,bS,bV);});},bT);return bT;};v.SnapshotOn=function(bR,bS){var bT;function bU(bV){var bW,bX,bY;if(!(bW=bT.s,bW!=null&&bW.$==0||bW!=null&&bW.$==2&&true)){bX=v.ValueAndForever(bR);bY=v.ValueAndForever(bS);bX!=null&&bX.$==1?bY!=null&&bY.$==1?bX.$0[1]||bY.$0[1]?v.MarkForever(bT,bY.$0[0]):v.MarkReady(bT,bY.$0[0]):void 0:void 0;}}bT=v.New({$:3,$0:[],$1:[]});v.When(bR,bU,bT);v.WhenReady(bS,bU);return bT;};v.Map3=function(bR,bS,bT,bU){var bV,bW,bX,bY;function bZ(b0){var b1,b2,b3,b4;if(!(b1=bY.s,b1!=null&&b1.$==0||b1!=null&&b1.$==2&&true)){b2=v.ValueAndForever(bS);b3=v.ValueAndForever(bT);b4=v.ValueAndForever(bU);b2!=null&&b2.$==1?b3!=null&&b3.$==1?b4!=null&&b4.$==1?b2.$0[1]&&b3.$0[1]&&b4.$0[1]?v.MarkForever(bY,bR(b2.$0[0],b3.$0[0],b4.$0[0])):v.MarkReady(bY,bR(b2.$0[0],b3.$0[0],b4.$0[0])):void 0:void 0:void 0;}}bV=bS.s;bW=bT.s;bX=bU.s;return bV!=null&&bV.$==0?bW!=null&&bW.$==0?bX!=null&&bX.$==0?v.New({$:0,$0:bR(bV.$0,bW.$0,bX.$0)}):v.Map3Opt1(bR,bV.$0,bW.$0,bU):bX!=null&&bX.$==0?v.Map3Opt2(bR,bV.$0,bX.$0,bT):v.Map3Opt3(bR,bV.$0,bT,bU):bW!=null&&bW.$==0?bX!=null&&bX.$==0?v.Map3Opt4(bR,bW.$0,bX.$0,bS):v.Map3Opt5(bR,bW.$0,bS,bU):bX!=null&&bX.$==0?v.Map3Opt6(bR,bX.$0,bS,bT):(bY=v.New({$:3,$0:[],$1:[]}),(v.When(bS,bZ,bY),v.When(bT,bZ,bY),v.When(bU,bZ,bY),bY));};v.Map3Opt6=function(bR,bS,bT,bU){return v.Map2(function(bV,bW){return bR(bV,bW,bS);},bT,bU);};v.Map3Opt5=function(bR,bS,bT,bU){return v.Map2(function(bV,bW){return bR(bV,bS,bW);},bT,bU);};v.Map3Opt4=function(bR,bS,bT,bU){return v.Map(function(bV){return bR(bV,bS,bT);},bU);};v.Map3Opt3=function(bR,bS,bT,bU){return v.Map2(function(bV,bW){return bR(bS,bV,bW);},bT,bU);};v.Map3Opt2=function(bR,bS,bT,bU){return v.Map(function(bV){return bR(bS,bV,bT);},bU);};v.Map3Opt1=function(bR,bS,bT,bU){return v.Map(function(bV){return bR(bS,bT,bV);},bU);};v.Map2Unit=function(bR,bS){var bT,bU,bV;function bW(){var bX,bY,bZ;if(!(bX=bV.s,bX!=null&&bX.$==0||bX!=null&&bX.$==2&&true)){bY=v.ValueAndForever(bR);bZ=v.ValueAndForever(bS);bY!=null&&bY.$==1?bZ!=null&&bZ.$==1?bY.$0[1]&&bZ.$0[1]?v.MarkForever(bV,null):v.MarkReady(bV,null):void 0:void 0;}}bT=bR.s;bU=bS.s;return bT!=null&&bT.$==0?bU!=null&&bU.$==0?v.New({$:0,$0:null}):bS:bU!=null&&bU.$==0?bR:(bV=v.New({$:3,$0:[],$1:[]}),(v.When(bR,bW,bV),v.When(bS,bW,bV),bV));};v.Map2=function(bR,bS,bT){var bU,bV,bW;function bX(bY){var bZ,b0,b1;if(!(bZ=bW.s,bZ!=null&&bZ.$==0||bZ!=null&&bZ.$==2&&true)){b0=v.ValueAndForever(bS);b1=v.ValueAndForever(bT);b0!=null&&b0.$==1?b1!=null&&b1.$==1?b0.$0[1]&&b1.$0[1]?v.MarkForever(bW,bR(b0.$0[0],b1.$0[0])):v.MarkReady(bW,bR(b0.$0[0],b1.$0[0])):void 0:void 0;}}bU=bS.s;bV=bT.s;return bU!=null&&bU.$==0?bV!=null&&bV.$==0?v.New({$:0,$0:bR(bU.$0,bV.$0)}):v.Map2Opt1(bR,bU.$0,bT):bV!=null&&bV.$==0?v.Map2Opt2(bR,bV.$0,bS):(bW=v.New({$:3,$0:[],$1:[]}),(v.When(bS,bX,bW),v.When(bT,bX,bW),bW));};v.Map2Opt2=function(bR,bS,bT){return v.Map(function(bU){return bR(bU,bS);},bT);};v.Map2Opt1=function(bR,bS,bT){return v.Map(function(bU){return bR(bS,bU);},bT);};v.MapCachedBy=function(bR,bS,bT,bU){return v.Map(function(bV){var bW,bX,bY;bW=bS[0];return bW!=null&&bW.$==1&&(bR(bV,bW.$0[0])&&(bX=[bW.$0[0],bW.$0[1]],true))?bX[1]:(bY=bT(bV),(bS[0]={$:1,$0:[bV,bY]},bY));},bU);};v.Copy=function(bR){var bS,bT,bU;bS=bR.s;return bS==null?bR:bS!=null&&bS.$==2?(bT=v.New({$:2,$0:bS.$0,$1:[]}),(v.WhenObsolete(bR,bT),bT)):bS!=null&&bS.$==3?(bU=v.New({$:3,$0:[],$1:[]}),(v.When(bR,function(bV){v.MarkDone(bU,bR,bV);},bU),bU)):bR;};v.Map=function(bR,bS){var bT,bU;bT=bS.s;return bT!=null&&bT.$==0?v.New({$:0,$0:bR(bT.$0)}):(bU=v.New({$:3,$0:[],$1:[]}),(v.When(bS,function(bV){v.MarkDone(bU,bS,bR(bV));},bU),bU));};v.Sequence=function(bR){var bS,bT,bU,bV;bS=bs.ofSeq(bR);return bS.length==0?v.New({$:0,$0:[]}):(bT=v.New({$:3,$0:[],$1:[]}),(bU=[bs.length(bS)-1],(bV=function(){var bW;if(bU[0]===0){bW=bs.map(function(bX){var bY;bY=bX.s;return bY!=null&&bY.$==0?bY.$0:bY!=null&&bY.$==2?bY.$0:bH.FailWith("value not found by View.Sequence");},bS);bs.forall(function(bX){var bY;return(bY=bX.s,bY!=null&&bY.$==0)&&true;},bS)?v.MarkForever(bT,bW):v.MarkReady(bT,bW);}else bU[0]--;},(bs.iter(function(bW){v.When(bW,bV,bT);},bS),bT))));};v.CreateForeverAsync=function(bR){var bS;bS=v.New({$:3,$0:[],$1:[]});k.StartTo(bR,function(bT){v.MarkForever(bS,bT);});return bS;};v.JoinInner=function(bR){var bS;bS=v.New({$:3,$0:[],$1:[]});v.When(bR,function(bT){var bU;bU=bT();v.When(bU,function(bV){var bW,bX;if((bW=bU.s,bW!=null&&bW.$==0)&&true&&((bX=bR.s,bX!=null&&bX.$==0)&&true))v.MarkForever(bS,bV);else v.MarkReady(bS,bV);},bS);v.WhenObsolete(bR,bU);},bS);return bS;};v.Join=function(bR){var bS;bS=v.New({$:3,$0:[],$1:[]});v.When(bR,function(bT){var bU;bU=bT();v.When(bU,function(bV){var bW,bX;if((bW=bU.s,bW!=null&&bW.$==0)&&true&&((bX=bR.s,bX!=null&&bX.$==0)&&true))v.MarkForever(bS,bV);else v.MarkReady(bS,bV);},bS);},bS);return bS;};v.ValueAndForever=function(bR){var bS;bS=bR.s;return bS!=null&&bS.$==0?{$:1,$0:[bS.$0,true]}:bS!=null&&bS.$==2?{$:1,$0:[bS.$0,false]}:null;};v.WhenObsoleteRun=function(bR,bS){var bT;bT=bR.s;bT==null?bS():bT!=null&&bT.$==2?bT.$1.push(bS):bT!=null&&bT.$==3?bT.$1.push(bS):void 0;};v.WhenObsolete=function(bR,bS){var bT;bT=bR.s;bT==null?v.Obsolete(bS):bT!=null&&bT.$==2?v.EnqueueSafe(bT.$1,bS):bT!=null&&bT.$==3?v.EnqueueSafe(bT.$1,bS):void 0;};v.WhenReady=function(bR,bS){var bT,bU;bU=bR.s;switch(bU!=null&&bU.$==2?(bT=bU.$0,0):bU==null?1:bU!=null&&bU.$==3?2:(bT=bU.$0,0)){case 0:bS(bT);break;case 1:null;break;case 2:bU.$0.push(bS);break;}};v.WhenRun=function(bR,bS,bT){var bU;bU=bR.s;bU==null?bT():bU!=null&&bU.$==2?(bU.$1.push(bT),bS(bU.$0)):bU!=null&&bU.$==3?(bU.$0.push(bS),bU.$1.push(bT)):bS(bU.$0);};v.When=function(bR,bS,bT){var bU;bU=bR.s;bU==null?v.Obsolete(bT):bU!=null&&bU.$==2?(v.EnqueueSafe(bU.$1,bT),bS(bU.$0)):bU!=null&&bU.$==3?(bU.$0.push(bS),v.EnqueueSafe(bU.$1,bT)):bS(bU.$0);};v.EnqueueSafe=function(bR,bS){var bT,bU,bV,bW;bR.push(bS);if(bR.length%20===0){bT=bR.slice(0);bI.Clear(bR);for(bU=0,bV=bs.length(bT)-1;bU<=bV;bU++){bW=bs.get(bT,bU);typeof bW=="object"?function(bX){if(bX.s)bR.push(bX);}(bW):function(bX){bR.push(bX);}(bW);}}else void 0;};v.MarkDone=function(bR,bS,bT){var bU;if((bU=bS.s,bU!=null&&bU.$==0)&&true)v.MarkForever(bR,bT);else v.MarkReady(bR,bT);};v.MarkReady=function(bR,bS){var bT,bU,bV,bW;bT=bR.s;if(bT!=null&&bT.$==3){bR.s={$:2,$0:bS,$1:bT.$1};bU=bT.$0;for(bV=0,bW=bs.length(bU)-1;bV<=bW;bV++)(bs.get(bU,bV))(bS);}else void 0;};v.MarkForever=function(bR,bS){var bT,bU,bV,bW;bT=bR.s;if(bT!=null&&bT.$==3){bR.s={$:0,$0:bS};bU=bT.$0;for(bV=0,bW=bs.length(bU)-1;bV<=bW;bV++)(bs.get(bU,bV))(bS);}else void 0;};w=c.Var=bA.Class({RId:function(){return"uinref"+window.String(this.i);},RView:function(){return this.v;},RUpdM:function(bR){var bS;bS=bR(this.c);bS!=null&&bS.$==1?w.Set(this,bS.$0):void 0;},RUpd:function(bR){w.Update(this,bR);},set_RVal:function(bR){w.Set(this,bR);},RVal:function(){return this.c;},RSet:function(bR){w.Set(this,bR);},RGet:function(){return this.c;}},null,w);w.New=function(bR,bS,bT,bU,bV){return new w({o:bR,c:bS,s:bT,i:bU,v:bV});};w.Lens=function(bR,bS,bT){var bU,bV;bU=g.Id();bV=y.Map(bS,bR.RView());return{RGet:function(){return bS(bR.RGet());},RSet:function(bW){return bR.RUpd(function(bX){return bT(bX,bW);});},RVal:function(){return bS(bR.RGet());},set_RVal:function(bW){return bR.RUpd(function(bX){return bT(bX,bW);});},RUpd:function(bW){return bR.RUpd(function(bX){return bT(bX,bW(bS(bX)));});},RUpdM:function(bW){return bR.RUpdM(function(bX){var bY;bY=bW(bS(bX));return bY==null?null:{$:1,$0:bT(bX,bY.$0)};});},RView:function(){return bV;},RId:function(){return bU;}};};w.Update=function(bR,bS){w.Set(bR,bS(bR.c));};w.SetFinal=function(bR,bS){if(bR.o)(function(bT){return bT("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bT){bC.log(bT);}));else{v.Obsolete(bR.s);bR.o=true;bR.c=bS;bR.s=v.New({$:0,$0:bS});}};w.Set=function(bR,bS){if(bR.o)(function(bT){return bT("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bT){bC.log(bT);}));else{v.Obsolete(bR.s);bR.c=bS;bR.s=v.New({$:2,$0:bS,$1:[]});}};w.Create=function(){var bR;bR=null;bR=w.New(false,null,v.New({$:2,$0:null,$1:[]}),g.Int(),function(){return bR.s;});return bR;};w.CreateLogged=function(bR,bS){var bT;!window.UINVars?window.UINVars=[]:void 0;bT=w.Create$1(bS);window.UINVars.push([bR,bT]);return bT;};w.Create$1=function(bR){var bS;bS=null;bS=w.New(false,bR,v.New({$:2,$0:bR,$1:[]}),g.Int(),function(){return bS.s;});return bS;};x=c.Updates=bA.Class({set_Value:function(bR){var bS;bS=this.s;!(bS===null)?v.Obsolete(bS):void 0;this.c=bR;}},null,x);x.Create=function(bR){var bS;bS=null;bS=x.New(bR,null,function(){var bT;bT=bS.s;return bT===null?(bT=v.Copy(bS.c()),bS.s=bT,v.WhenObsoleteRun(bT,function(){bS.s=null;}),bT):bT;});return bS;};x.New=function(bR,bS,bT){return new x({c:bR,s:bS,v:bT});};y.get_Do=function(){return z.B;};y.Apply=function(bR,bS){return y.Map2(function(bT,bU){return bT(bU);},bR,bS);};y.AsyncAwait=function(bR,bS){var bT;bT=function(bU){var bV,bW;function bX(){return y.RemovableSink(function(bY){if(bR(bY)){(bJ.Force(bV))();bU(bY);}},bS);}bV=bJ.Create(bX);bW=bJ.Force(bV);};return bD.FromContinuations(function(bU,bV,bW){return bT.apply(null,[bU,bV,bW]);});};y.RemovableSink=function(bR,bS){var bT;function bU(){v.WhenRun(bS(),function(bV){if(bT[0])bR(bV);},function(){if(bT[0])bD.scheduler().Fork(bU);});}bT=[true];bD.scheduler().Fork(bU);return function(){bT[0]=false;};};y.Sink=function(bR,bS){function bT(){v.WhenRun(bS(),bR,function(){bD.scheduler().Fork(bT);});}bD.scheduler().Fork(bT);};y.TryFinally=function(bR,bS){return y.CreateLazy(function(){try{return bS();}finally{bR();}});};y.TryWith=function(bR,bS){return y.CreateLazy(function(){try{return bS();}catch(bT){return(bR(bT))();}});};y.ConstAsync=function(bR){var bS;bS=v.CreateForeverAsync(bR);return function(){return bS;};};y.Const=function(bR){var bS;bS=v.New({$:0,$0:bR});return function(){return bS;};};y.Sequence=function(bR){return y.CreateLazy(function(){return v.Sequence(by.map(function(bS){return bS();},bR));});};y.UpdateWhile=function(bR,bS,bT){var bU;bU=[bR];return y.BindInner(function(bV){return bV?y.Map(function(bW){bU[0]=bW;return bW;},bT):y.Const(bU[0]);},bS);};y.BindInner=function(bR,bS){return y.JoinInner(y.Map(bR,bS));};y.JoinInner=function(bR){return y.CreateLazy(function(){return v.JoinInner(bR());});};y.Bind=function(bR,bS){return y.Join(y.Map(bR,bS));};y.Join=function(bR){return y.CreateLazy(function(){return v.Join(bR());});};y.MapSeqCachedView=function(bR,bS){var bT;bT=function(){return bR;};return y.MapSeqCachedViewBy(window.id,function(bU,bV){return(bT(bU))(bV);},bS);};y.MapSeqCachedViewBy=function(bR,bS,bT){var bU;bU=[new bK.New$5()];return y.Map(function(bV){var bW,bX,bY;bW=bU[0];bX=new bK.New$5();bY=d.mapInPlace(function(bZ){var b0,b1,b2;b0=bR(bZ);b1=bW.ContainsKey(b0)?(b2=bW.get_Item(b0),(w.Set(b2.r,bZ),b2)):y.ConvertSeqNode(function(b3){return bS(b0,b3);},bZ);bX.set_Item(b0,b1);return b1.e;},bs.ofSeq(bV));bU[0]=bX;return bY;},bT);};y.ConvertSeqNode=function(bR,bS){var bT,bU;bT=w.Create$1(bS);bU=bT.v;return{e:bR(bU),r:bT,w:bU};};y.MapSeqCached=function(bR,bS){return y.MapSeqCachedBy(window.id,bR,bS);};y.MapSeqCachedBy=function(bR,bS,bT){var bU;bU=[new bK.New$5()];return y.Map(function(bV){var bW,bX,bY;bW=bU[0];bX=new bK.New$5();bY=d.mapInPlace(function(bZ){var b0,b1;b0=bR(bZ);b1=bW.ContainsKey(b0)?bW.get_Item(b0):bS(bZ);bX.set_Item(b0,b1);return b1;},bs.ofSeq(bV));bU[0]=bX;return bY;},bT);};y.SnapshotOn=function(bR,bS,bT){var bU;bU=v.New({$:2,$0:bR,$1:[]});return y.CreateLazy(function(){return bU.s==null&&true?v.SnapshotOn(bS(),bT()):(v.WhenObsolete(bS(),bU),bU);});};y.GetAsync=function(bR){return bD.FromContinuations(function(bS){return y.Get(bS,bR);});};y.Get=function(bR,bS){var bT;function bU(){v.WhenRun(bS(),function(bV){if(!bT[0]){bT[0]=true;bR(bV);}},function(){if(!bT[0])bU();});}bT=[false];bU();};y.MapAsync2=function(bR,bS,bT){return y.MapAsync(window.id,y.Map2(bR,bS,bT));};y.MapAsync=function(bR,bS){return y.CreateLazy(function(){return v.MapAsync(bR,bS());});};y.Map3=function(bR,bS,bT,bU){return y.CreateLazy(function(){return v.Map3(bR,bS(),bT(),bU());});};y.Map2Unit=function(bR,bS){return y.CreateLazy(function(){return v.Map2Unit(bR(),bS());});};y.Map2=function(bR,bS,bT){return y.CreateLazy(function(){return v.Map2(bR,bS(),bT());});};y.MapCached=function(bR,bS){return y.MapCachedBy(bB.Equals,bR,bS);};y.MapCachedBy=function(bR,bS,bT){var bU;bU=[null];return y.CreateLazy(function(){return v.MapCachedBy(bR,bU,bS,bT());});};y.Map=function(bR,bS){return y.CreateLazy(function(){return v.Map(bR,bS());});};y.CreateLazy=function(bR){var bS;bS={c:null,o:bR};return function(){var bT,bU;bT=bS.c;return bT===null?(bT=bS.o(),bS.c=bT,(bU=bT.s,bU!=null&&bU.$==0)&&true?bS.o=null:v.WhenObsoleteRun(bT,function(){bS.c=null;}),bT):bT;};};z.B={$:0};A=c.Submitter=bA.Class({Trigger:function(){w.Set(this["var"],null);}},null,A);A.New=bA.Ctor(function(bR,bS){this.input=bR;this["var"]=w.Create();this.view=y.SnapshotOn(bS,this["var"].v,this.input);},A);A.CreateOption=function(bR){return new A.New(y.Map(function(bS){return{$:1,$0:bS};},bR),null);};B.Fresh=function(){return{$:0,$0:g.Int()};};C=c.Model=bA.Class({},null,C);C.New=bA.Ctor(function(bR,bS){var bT;bT=w.Create$1(bS);C.New$1.call(this,bT,y.Map(bR,bT.v));},C);C.New$1=bA.Ctor(function(bR,bS){this["var"]=bR;this.view=bS;},C);C.Update=function(bR,bS){w.Update(bS["var"],function(bT){bR(bT);return bT;});};C.Create=function(bR,bS){return new C.New(bR,bS);};D.Default=function(){J.$cctor();return J.Default;};F=E.ArrayStorage=bA.Class({SSet:function(bR){return bs.ofSeq(bR);},SSetAt:function(bR,bS,bT){bs.set(bT,bR,bS);return bT;},SRemoveIf:function(bR,bS){return bs.filter(function(bT){return!bR(bT);},bS);},SInit:function(){return this.init;},SPrependMany:function(bR,bS){var bT;bT=d.ofSeqNonCopying(bR);bS.unshift.apply(bS,bT);return bS;},SPrepend:function(bR,bS){bS.unshift(bR);return bS;},SAppendMany:function(bR,bS){var bT;bT=d.ofSeqNonCopying(bR);bS.push.apply(bS,bT);return bS;},SAppend:function(bR,bS){bS.push(bR);return bS;}},null,F);F.New=bA.Ctor(function(bR){this.init=bR;},F);G=E.LocalStorageBackend=bA.Class({clear:function(){this.storage.removeItem(this.id);},set:function(bR){this.storage.setItem(this.id,bL.stringify(bs.map(this.serializer.Encode,bR)));return bR;},SSet:function(bR){return this.set(bs.ofSeq(bR));},SSetAt:function(bR,bS,bT){bs.set(bT,bR,bS);return this.set(bT);},SRemoveIf:function(bR,bS){return this.set(bs.filter(function(bT){return!bR(bT);},bS));},SInit:function(){var bR;bR=this.storage.getItem(this.id);if(bR===null)return[];else try{return bs.map(this.serializer.Decode,bL.parse(bR));}catch(bS){return[];}},SPrependMany:function(bR,bS){var bT;bT=d.ofSeqNonCopying(bR);bS.unshift.apply(bS,bT);return this.set(bS);},SPrepend:function(bR,bS){bS.unshift(bR);return this.set(bS);},SAppendMany:function(bR,bS){var bT;bT=d.ofSeqNonCopying(bR);bS.push.apply(bS,bT);return this.set(bS);},SAppend:function(bR,bS){bS.push(bR);return this.set(bS);}},null,G);G.New=bA.Ctor(function(bR,bS){this.id=bR;this.serializer=bS;this.storage=window.localStorage;},G);E.LocalStorage=function(bR,bS){return new G.New(bR,bS);};E.InMemory=function(bR){return new F.New(bR);};H=c.ListModel=bA.Class({Wrap:function(bR,bS,bT){return H.Wrap(this,bR,bS,bT);},Lens:function(bR){return this.LensInto(window.id,function(bS,bT){return bT;},bR);},LensInto:function(bR,bS,bT){var bU,bV,bW;bU=this;bV=g.Id();bW=y.Map(bR,this.FindByKeyAsView(bT));return{RGet:function(){return bR(bU.FindByKey(bT));},RSet:function(bX){return bU.UpdateBy(function(bY){return{$:1,$0:bS(bY,bX)};},bT);},RVal:function(){return this.RGet();},set_RVal:function(bX){return this.RSet(bX);},RUpd:function(bX){return bU.UpdateBy(function(bY){return{$:1,$0:bS(bY,bX(bR(bY)))};},bT);},RUpdM:function(bX){return bU.UpdateBy(function(bY){var bZ;bZ=bX(bR(bY));return bZ==null?null:{$:1,$0:bS(bY,bZ.$0)};},bT);},RView:function(){return bW;},RId:function(){return bV;}};},get_LengthAsView:function(){return y.Map(bs.length,this["var"].RView());},get_Length:function(){return bs.length(this["var"].RVal());},Clear:function(){this["var"].set_RVal(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(bR,bS){var bT,bU,bV,bW,bX;bT=this;bU=this["var"].RVal();bV=bs.tryFindIndex(function(bY){return bB.Equals(bT.key(bY),bS);},bU);bV!=null&&bV.$==1?(bW=bV.$0,bX=bR(bs.get(bU,bW)),bX!=null&&bX.$==1?(this["var"].set_RVal(this.storage.SSetAt(bW,bX.$0,bU)),this.ObsoleteKey(bS)):void 0):void 0;},UpdateAll:function(bR){var bS;bS=this;this["var"].RUpd(function(bT){bs.iteri(function(bU,bV){var bW;bW=bR(bV);return bW==null?null:bs.set(bT,bU,bW.$0);},bT);return bS.storage.SSet(bT);});this.ObsoleteAll();},FindByKeyAsView:function(bR){return y.Map(function(bS){return bS.$0;},this.TryFindByKeyAsView(bR));},TryFindByKeyAsView:function(bR){var bS;bS=this;return function(){var bT,bU,bV;bT=(bU=null,[bS.it.TryGetValue(bR,{get:function(){return bU;},set:function(bW){bU=bW;}}),bU]);return bT[0]?bT[1]:(bV=v.New({$:2,$0:bS.TryFindByKey(bR),$1:[]}),(bS.it.Add(bR,bV),bV));};},TryFindByKey:function(bR){var bS;bS=this;return bs.tryFind(function(bT){return bB.Equals(bS.key(bT),bR);},this["var"].RVal());},FindByKey:function(bR){var bS;bS=this;return bs.find(function(bT){return bB.Equals(bS.key(bT),bR);},this["var"].RVal());},TryFindAsView:function(bR){return y.Map(function(bS){return bs.tryFind(bR,bS);},this["var"].RView());},FindAsView:function(bR){return y.Map(function(bS){return bs.find(bR,bS);},this["var"].RView());},TryFind:function(bR){return bs.tryFind(bR,this["var"].RVal());},Find:function(bR){return bs.find(bR,this["var"].RVal());},ContainsKeyAsView:function(bR){var bS,bT;bS=this;return y.Map((bT=function(bU){return bB.Equals(bS.key(bU),bR);},function(bU){return bs.exists(bT,bU);}),this["var"].RView());},ContainsKey:function(bR){var bS;bS=this;return bs.exists(function(bT){return bB.Equals(bS.key(bT),bR);},this["var"].RVal());},Set:function(bR){this["var"].set_RVal(this.storage.SSet(bR));this.ObsoleteAll();},Iter:function(bR){bs.iter(bR,this["var"].RVal());},RemoveByKey:function(bR){var bS;bS=this;this["var"].set_RVal(this.storage.SRemoveIf(function(bT){return bB.Equals(bS.key(bT),bR);},this["var"].RVal()));this.ObsoleteKey(bR);},RemoveBy:function(bR){var bS,bT,bU,bV;bS=this["var"].RVal();for(bT=0,bU=bS.length-1;bT<=bU;bT++){bV=bs.get(bS,bT);bR(bV)?this.ObsoleteKey(this.key(bV)):void 0;}this["var"].set_RVal(this.storage.SRemoveIf(bR,this["var"].RVal()));},Remove:function(bR){var bS,bT,bU,bV;bS=this;bT=this["var"].RVal();I.Contains(bS.key,bR,bT)?(bU=bS.key,bV=bU(bR),this["var"].set_RVal(this.storage.SRemoveIf(function(bW){return bB.Equals(bU(bW),bV);},bT)),this.ObsoleteKey(bV)):void 0;},PrependMany:function(bR){var bS,bT,bU;bS=this;bT=new bG.New$2();this["var"].set_RVal(this.storage.SPrependMany(bT,((bU=function(bV,bW){var bX,bY;bX=bS.key(bW);bS.ObsoleteKey(bX);bY=bs.tryFindIndex(function(bZ){return bB.Equals(bS.key(bZ),bX);},bV);return bY==null?(bT.Add(bW),bV):bS.storage.SSetAt(bY.$0,bW,bV);},(bA.Curried3(by.fold))(bU))(this["var"].RVal()))(bR)));},Prepend:function(bR){var bS,bT,bU,bV;bS=this;bT=this["var"].RVal();bU=this.key(bR);bV=bs.tryFindIndex(function(bW){return bB.Equals(bS.key(bW),bU);},bT);bV!=null&&bV.$==1?this["var"].set_RVal(this.storage.SSetAt(bV.$0,bR,bT)):this["var"].set_RVal(this.storage.SPrepend(bR,bT));this.ObsoleteKey(bU);},AppendMany:function(bR){var bS,bT,bU;bS=this;bT=new bG.New$2();this["var"].set_RVal(this.storage.SAppendMany(bT,((bU=function(bV,bW){var bX,bY;bX=bS.key(bW);bS.ObsoleteKey(bX);bY=bs.tryFindIndex(function(bZ){return bB.Equals(bS.key(bZ),bX);},bV);return bY==null?(bT.Add(bW),bV):bS.storage.SSetAt(bY.$0,bW,bV);},(bA.Curried3(by.fold))(bU))(this["var"].RVal()))(bR)));},Append:function(bR){var bS,bT,bU,bV;bS=this;bT=this["var"].RVal();bU=this.key(bR);bV=bs.tryFindIndex(function(bW){return bB.Equals(bS.key(bW),bU);},bT);bV!=null&&bV.$==1?this["var"].set_RVal(this.storage.SSetAt(bV.$0,bR,bT)):this["var"].set_RVal(this.storage.SAppend(bR,bT));this.ObsoleteKey(bU);},ObsoleteAll:function(){by.iter(function(bR){v.Obsolete(bR.V);},this.it);this.it.Clear();},ObsoleteKey:function(bR){var bS,bT;bS=(bT=null,[this.it.TryGetValue(bR,{get:function(){return bT;},set:function(bU){bT=bU;}}),bT]);bS[0]?(v.Obsolete(bS[1]),this.it.Remove(bR)):void 0;},GetEnumerator0:function(){return bt.Get0(this["var"].RVal());},GetEnumerator:function(){return bt.Get(this["var"].RVal());}},null,H);H.New=bA.Ctor(function(bR,bS){H.New$3.call(this,bR,w.Create$1(bs.ofSeq(by.distinctBy(bR,bS.SInit()))),bS);},H);H.New$1=bA.Ctor(function(bR){H.New$2.call(this,bR,[]);},H);H.New$2=bA.Ctor(function(bR,bS){var bT;bT=bs.ofSeq(bS);H.New$3.call(this,bR,w.Create$1(bT),E.InMemory(bT));},H);H.New$3=bA.Ctor(function(bR,bS,bT){this.key=bR;this["var"]=bS;this.storage=bT;this.v=y.Map(function(bU){return bU.slice();},this["var"].RView());this.it=new bK.New$5();},H);I.Contains=function(bR,bS,bT){var bU;bU=bR(bS);return bs.exists(function(bV){return bB.Equals(bR(bV),bU);},bT);};H.Wrap=function(bR,bS,bT,bU){var bV,bW;bV=[new bK.New$5()];bW=bs.map(function(bX){var bY;bY=bT(bX);bV[0].set_Item(bR.key(bX),bY);return bY;},bR["var"].RVal());return new H.New$3(function(bX){return bR.key(bS(bX));},w.Lens(bR["var"],function(bX){var bY,bZ;bY=new bK.New$5();bZ=bs.map(function(b0){var b1,b2;b1=bR.key(b0);b2=bV[0].ContainsKey(b1)?bU(bV[0].get_Item(b1),b0):bT(b0);bY.set_Item(b1,b2);return b2;},bX);bV[0]=bY;return bZ;},function(bX,bY){var bZ,b0;bZ=new bK.New$5();b0=bs.map(function(b1){var b2;b2=bS(b1);bZ.set_Item(bR.key(b2),b1);return b2;},bY);bV[0]=bZ;return b0;}),E.InMemory(bW));};H.FromSeq=function(bR){return H.Create(window.id,bR);};H.Create=function(bR,bS){return H.CreateWithStorage(bR,E.InMemory(bs.ofSeq(bS)));};H.CreateWithStorage=function(bR,bS){return new H.New(bR,bS);};J.$cctor=bA.Cctor(function(){J.Default={Encode:window.id,Decode:window.id};J.$cctor=window.ignore;});K=c.ReactiveExtensions=bA.Class({},null,K);K.New=bA.Ctor(function(){},K);L=c.DoubleInterpolation=bA.Class({Interpolate:function(bR,bS,bT){return bS+bR*(bT-bS);}},null,L);L.DoubleInterpolation=new L({$:0});M.get_Double=function(){return L.DoubleInterpolation;};N=c.Easing=bA.Class({TransformTime:function(bR){return this.transformTime(bR);}},null,N);N.get_CubicInOut=function(){return O.CubicInOut();};N.Custom=function(bR){return new N.New(bR);};N.New=bA.Ctor(function(bR){this.transformTime=bR;},N);O.CubicInOut=function(){S.$cctor();return S.CubicInOut;};P.get_Empty=function(){return{$:0,$0:o.Empty()};};P.WhenDone=function(bR,bS){return P.Append({$:0,$0:o.Single({$:0,$0:bR})},bS);};P.Run=function(bR,bS){var bT,bU;bT=bS.Duration;return bT===0?bD.Zero():(bU=function(bV){function bW(bX,bY){var bZ;bZ=bY-bX;bS.Compute(bZ);bR();return bZ<=bT?void window.requestAnimationFrame(function(b0){bW(bX,b0);}):bV();}window.requestAnimationFrame(function(bX){bW(bX,bX);});},bD.FromContinuations(function(bV,bW,bX){return bU.apply(null,[bV,bW,bX]);}));};P.Play=function(bR){var bS;bS=null;return bD.Delay(function(){return bD.Bind(P.Run(function(){},Q.Actions(bR)),function(){Q.Finalize(bR);return bD.Return(null);});});};P.Pack=function(bR){return{$:0,$0:o.Single({$:1,$0:bR})};};P.Map=function(bR,bS){var bT;return Q.Def(bS.Duration,(bT=bS.Compute,function(bU){return bR(bT(bU));}));};P.Delayed=function(bR,bS,bT,bU,bV,bW){return{Compute:function(bX){return bX<=bU?bV:bR.Interpolate(bS.TransformTime((bX-bU)/bT),bV,bW);},Duration:bT+bU};};P.Simple=function(bR,bS,bT,bU,bV){return{Compute:function(bW){return bR.Interpolate(bS.TransformTime(bW/bT),bU,bV);},Duration:bT};};P.Const=function(bR){return Q.Const(bR);};P.Concat=function(bR){return{$:0,$0:o.Concat(by.map(Q.List,bR))};};P.Append=function(bR,bS){return{$:0,$0:o.Append(bR.$0,bS.$0)};};P.set_UseAnimations=function(bR){Q.set_UseAnimations(bR);};P.get_UseAnimations=function(){return Q.UseAnimations();};Q.UseAnimations=function(){S.$cctor();return S.UseAnimations;};Q.set_UseAnimations=function(bR){S.$cctor();S.UseAnimations=bR;};Q.Actions=function(bR){return Q.ConcatActions(bs.choose(function(bS){return bS.$==1?{$:1,$0:bS.$0}:null;},o.ToArray(bR.$0)));};Q.ConcatActions=function(bR){var bS,bT,bU,bV;bS=d.ofSeqNonCopying(bR);bT=bs.length(bS);return bT===0?Q.Const():bT===1?bs.get(bS,0):(bU=by.max(by.map(function(bW){return bW.Duration;},bS)),(bV=bs.map(function(bW){return Q.Prolong(bU,bW);},bS),Q.Def(bU,function(bW){bs.iter(function(bX){bX.Compute(bW);},bV);})));};Q.Prolong=function(bR,bS){var bT,bU,bV;bT=bS.Compute;bU=bS.Duration;bV=bJ.Create(function(){return bS.Compute(bS.Duration);});return{Compute:function(bW){return bW>=bU?bV.f():bT(bW);},Duration:bR};};Q.Const=function(bR){return Q.Def(0,function(){return bR;});};Q.Def=function(bR,bS){return{Compute:bS,Duration:bR};};Q.Finalize=function(bR){bs.iter(function(bS){if(bS.$==0)bS.$0();},o.ToArray(bR.$0));};Q.List=function(bR){return bR.$0;};R=c.Trans=bA.Class({Copy:function(bR,bS,bT,bU){var bV,bW,bX,bY,bZ,b0;bV=this;bW=(bX=function(b1,b2){return bV.TChange(b1,b2);},bR==null?function(b1){return function(b2){return bX(b1,b2);};}:bR.$0);return new R.New$3(function(b1,b2){return(bW(b1))(b2);},(bY=this.get_TEnter(),bS==null?bY:bS.$0),(bZ=this.get_TExit(),bT==null?bZ:bT.$0),(b0=this.get_TFlags(),bU==null?b0:bU.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(bR,bS){return this.change(bR,bS);}},null,R);R.New=bA.Ctor(function(bR,bS,bT){R.New$3.call(this,bR,bB.Equals(bS,null)?P.Const:bS,bB.Equals(bT,null)?P.Const:bT,1|(bB.Equals(bS,null)?0:2)|(bB.Equals(bT,null)?0:4));},R);R.New$1=bA.Ctor(function(bR){R.New$3.call(this,bR,P.Const,P.Const,1);},R);R.New$2=bA.Ctor(function(){R.New$3.call(this,function(bR,bS){return P.Const(bS);},P.Const,P.Const,0);},R);R.New$3=bA.Ctor(function(bR,bS,bT,bU){this.change=bR;this.enter=bS;this.exit=bT;this.flags=bU;},R);R.Exit=function(bR,bS){return bS.Copy(null,null,{$:1,$0:bR},{$:1,$0:bS.get_TFlags()|4});};R.Enter=function(bR,bS){return bS.Copy(null,{$:1,$0:bR},null,{$:1,$0:bS.get_TFlags()|2});};R.Change=function(bR,bS){return bS.Copy({$:1,$0:bR},null,null,{$:1,$0:bS.get_TFlags()|1});};R.Create=function(bR){return new R.New$1(bR);};R.Trivial=function(){return new R.New$2();};R.CanAnimateExit=function(bR){var bS,bT;bS=bR.get_TFlags();bT=4;return(bS&bT)===bT;};R.CanAnimateEnter=function(bR){var bS,bT;bS=bR.get_TFlags();bT=2;return(bS&bT)===bT;};R.CanAnimateChange=function(bR){var bS,bT;bS=bR.get_TFlags();bT=1;return(bS&bT)===bT;};R.AnimateExit=function(bR,bS){return(bR.get_TExit())(bS);};R.AnimateEnter=function(bR,bS){return(bR.get_TEnter())(bS);};R.AnimateChange=function(bR,bS,bT){return bR.TChange(bS,bT);};S.$cctor=bA.Cctor(function(){S.CubicInOut=N.Custom(function(bR){var bS;bS=bR*bR;return 3*bS-2*(bS*bR);});S.UseAnimations=true;S.$cctor=window.ignore;});T=c.AnimatedAttrNode=bA.Class({sync:function(bR){var bS;if(this.dirty){bS=this.logical;bS==null?void 0:(this.push(bR))(bS.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(bR,bS){this.visible={$:1,$0:bS};this.dirty=true;(this.push(bR))(bS);},NChanged:function(){return this.updates;},NSync:function(bR){},NGetExitAnim:function(bR){var bS,bT;bS=this;return P.WhenDone(function(){bS.dirty=true;bS.visible=null;},(bT=this.visible,bT!=null&&bT.$==1?P.Pack(P.Map(function(bU){bS.pushVisible(bR,bU);},R.AnimateExit(this.tr,bT.$0))):P.get_Empty()));},NGetEnterAnim:function(bR){var bS,bT,bU,bV,bW;bS=this;return P.WhenDone(function(){bS.sync(bR);},(bT=this.visible,(bU=this.logical,bT!=null&&bT.$==1&&(bU!=null&&bU.$==1&&(this.dirty&&(bV=[bU.$0,bT.$0],true)))?P.Pack(P.Map(function(bX){bS.pushVisible(bR,bX);},R.AnimateChange(this.tr,bV[1],bV[0]))):bT==null&&(bU!=null&&bU.$==1&&true)?P.Pack(P.Map(function(bX){bS.pushVisible(bR,bX);},R.AnimateEnter(this.tr,bU.$0))):P.get_Empty())));},NGetChangeAnim:function(bR){var bS,bT,bU,bV;bS=this;return P.WhenDone(function(){bS.sync(bR);},(bT=this.visible,(bU=this.logical,bT!=null&&bT.$==1&&(bU!=null&&bU.$==1&&(this.dirty&&(bV=[bU.$0,bT.$0],true)))?P.Pack(P.Map(function(bW){bS.pushVisible(bR,bW);},R.AnimateChange(this.tr,bV[1],bV[0]))):P.get_Empty())));}},null,T);T.New=bA.Ctor(function(bR,bS,bT){var bU;bU=this;this.tr=bR;this.push=bT;this.logical=null;this.visible=null;this.dirty=true;this.updates=y.Map(function(bV){bU.logical={$:1,$0:bV};bU.dirty=true;},bS);},T);U=c.DynamicAttrNode=bA.Class({NChanged:function(){return this.updates;},NSync:function(bR){if(this.dirty){(this.push(bR))(this.value);this.dirty=false;}},NGetExitAnim:function(bR){return P.get_Empty();},NGetEnterAnim:function(bR){return P.get_Empty();},NGetChangeAnim:function(bR){return P.get_Empty();}},null,U);U.New=bA.Ctor(function(bR,bS){var bT;bT=this;this.push=bS;this.value=void 0;this.dirty=false;this.updates=y.Map(function(bU){bT.value=bU;bT.dirty=true;},bR);},U);V=c.AttrProxy=bA.Class({},null,V);V.Handler=function(bR,bS){return Z.Static(function(bT){bT.addEventListener(bR,function(bU){return(bS(bT))(bU);},false);});};V.Concat=function(bR){var bS;bS=d.ofSeqNonCopying(bR);return d.TreeReduce(Z.EmptyAttr(),V.Append,bS);};V.Append=function(bR,bS){return Z.AppendTree(bR,bS);};V.Create=function(bR,bS){return Z.Static(function(bT){q.SetAttr(bT,bR,bS);});};Y.New=function(bR,bS,bT,bU){var bV;bV={DynElem:bR,DynFlags:bS,DynNodes:bT};bA.SetOptional(bV,"OnAfterRender",bU);return bV;};Z.Static=function(bR){return new V({$:3,$0:bR});};Z.Dynamic=function(bR,bS){return new V({$:1,$0:new U.New(bR,bS)});};Z.Animated=function(bR,bS,bT){var bU,bV,bW;bU=new T.New(bR,bS,bT);bV=4;R.CanAnimateEnter(bR)?bV=bV|1:void 0;R.CanAnimateExit(bR)?bV=bV|2:void 0;bW=new V({$:1,$0:bU});Z.SetFlags(bW,bV);return bW;};Z.EmptyAttr=function(){_2.$cctor();return _2.EmptyAttr;};Z.AppendTree=function(bR,bS){var bT;return bR===null?bS:bS===null?bR:(bT=new V({$:2,$0:bR,$1:bS}),(Z.SetFlags(bT,Z.Flags(bR)|Z.Flags(bS)),bT));};Z.GetChangeAnim=function(bR){return Z.GetAnim(bR,function(bS,bT){return bS.NGetChangeAnim(bT);});};Z.GetExitAnim=function(bR){return Z.GetAnim(bR,function(bS,bT){return bS.NGetExitAnim(bT);});};Z.GetEnterAnim=function(bR){return Z.GetAnim(bR,function(bS,bT){return bS.NGetEnterAnim(bT);});};Z.GetAnim=function(bR,bS){return P.Concat(bs.map(function(bT){return bS(bT,bR.DynElem);},bR.DynNodes));};Z.Updates=function(bR){return d.MapTreeReduce(function(bS){return bS.NChanged();},y.Const(),y.Map2Unit,bR.DynNodes);};Z.Empty=function(bR){return Y.New(bR,0,[],null);};Z.Insert=function(bR,bS){var bT,bU,bV;function bW(bX){if(!(bX===null))if(bX!=null&&bX.$==1)bT.push(bX.$0);else if(bX!=null&&bX.$==2){bW(bX.$0);bW(bX.$1);}else if(bX!=null&&bX.$==3)bX.$0(bR);else if(bX!=null&&bX.$==4)bU.push(bX.$0);}bT=[];bU=[];bW(bS);bV=bT.slice(0);return Y.New(bR,Z.Flags(bS),bV,bU.length===0?null:{$:1,$0:function(bX){by.iter(function(bY){bY(bX);},bU);}});};Z.Sync=function(bR,bS){bs.iter(function(bT){bT.NSync(bR);},bS.DynNodes);};Z.SetFlags=function(bR,bS){bR.flags=bS;};Z.Flags=function(bR){return bR!==null&&bR.hasOwnProperty("flags")?bR.flags:0;};Z.HasExitAnim=function(bR){var bS;bS=2;return(bR.DynFlags&bS)===bS;};Z.HasEnterAnim=function(bR){var bS;bS=1;return(bR.DynFlags&bS)===bS;};Z.HasChangeAnim=function(bR){var bS;bS=4;return(bR.DynFlags&bS)===bS;};_0=c.CheckedInput=bA.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_0);_0.Make=function(bR){return new _0({$:0,$0:bR,$1:window.String(bR)});};_1.ValidateForm=function(){return _1.OnAfterRender(function(bR){if(window.H5F)window.H5F.setup(bR);});};_1.Checked=function(bR){var bS;bS=function(bT){return!bB.Equals(bR.RVal(),bT.checked)?bR.set_RVal(bT.checked):null;};return V.Concat([_1.DynamicProp("checked",bR.RView()),_1.Handler("change",function(bT){return function(bU){return bS(bT,bU);};}),_1.Handler("click",function(bT){return function(bU){return bS(bT,bU);};})]);};_1.FloatValue=function(bR){return _1.CustomVar(bR,function(bS,bT){var bU;bU=bT.get_Input();return bS.value!==bU?void(bS.value=bU):null;},function(bS){var bT,bU;bT=bS.value;return{$:1,$0:e.isBlank(bT)?(bS.checkValidity?bS.checkValidity():true)?new _0({$:2,$0:bT}):new _0({$:1,$0:bT}):(bU=+bT,window.isNaN(bU)?new _0({$:1,$0:bT}):new _0({$:0,$0:bU,$1:bT}))};});};_1.FloatValueUnchecked=function(bR){return _1.CustomValue(bR,window.String,function(bS){var bT;return e.isBlank(bS)?{$:1,$0:0}:(bT=+bS,window.isNaN(bT)?null:{$:1,$0:bT});});};_1.IntValue=function(bR){return _1.CustomVar(bR,function(bS,bT){var bU;bU=bT.get_Input();return bS.value!==bU?void(bS.value=bU):null;},function(bS){var bT,bU,bV;bT=bS.value;return{$:1,$0:e.isBlank(bT)?(bS.checkValidity?bS.checkValidity():true)?new _0({$:2,$0:bT}):new _0({$:1,$0:bT}):(bU=(bV=0,[bM.TryParseInt32(bT,{get:function(){return bV;},set:function(bW){bV=bW;}}),bV]),bU[0]?new _0({$:0,$0:bU[1],$1:bT}):new _0({$:1,$0:bT}))};});};_1.IntValueUnchecked=function(bR){return _1.CustomValue(bR,window.String,function(bS){var bT;return e.isBlank(bS)?{$:1,$0:0}:(bT=+bS,bT!==bT>>0?null:{$:1,$0:bT});});};_1.Value=function(bR){var bS,bT;return _1.CustomValue(bR,window.id,(bS=window.id,(bT=function(bU){return{$:1,$0:bU};},function(bU){return bT(bS(bU));})));};_1.ContentEditableHtml=function(bR){var bS;bS=_1.CustomVar(bR,function(bT,bU){bT.innerHTML=bU;},function(bT){return{$:1,$0:bT.innerHTML};});return V.Append(V.Create("contenteditable","true"),bS);};_1.ContentEditableText=function(bR){var bS;bS=_1.CustomVar(bR,function(bT,bU){bT.textContent=bU;},function(bT){return{$:1,$0:bT.textContent};});return V.Append(V.Create("contenteditable","true"),bS);};_1.CustomValue=function(bR,bS,bT){return _1.CustomVar(bR,function(bU,bV){bU.value=bS(bV);},function(bU){return bT(bU.value);});};_1.CustomVar=function(bR,bS,bT){var bU,bV;bU=function(bW){return bR.RUpdM(function(bX){var bY,bZ;bY=bT(bW);return bY!=null&&bY.$==1&&(!bB.Equals(bY.$0,bX)&&(bZ=[bY,bY.$0],true))?bZ[0]:null;});};bV=function(bW,bX){var bY,bZ;bY=bT(bW);return bY!=null&&bY.$==1&&(bB.Equals(bY.$0,bX)&&(bZ=bY.$0,true))?null:bS(bW,bX);};return V.Concat([_1.Handler("change",function(bW){return function(bX){return bU(bW,bX);};}),_1.Handler("input",function(bW){return function(bX){return bU(bW,bX);};}),_1.Handler("keypress",function(bW){return function(bX){return bU(bW,bX);};}),_1.DynamicCustom(function(bW){return function(bX){return bV(bW,bX);};},bR.RView())]);};_1.DynamicProp=function(bR,bS){return Z.Dynamic(bS,function(bT){return function(bU){bT[bR]=bU;};});};_1.DynamicPred=function(bR,bS,bT){var bU;bU=function(bV,bW){return bW[0]?q.SetAttr(bV,bR,bW[1]):q.RemoveAttr(bV,bR);};return Z.Dynamic(y.Map2(function(bV,bW){return[bV,bW];},bS,bT),function(bV){return function(bW){return bU(bV,bW);};});};_1.DynamicClass=function(bR,bS,bT){return Z.Dynamic(bS,function(bU){return function(bV){return bT(bV)?q.AddClass(bU,bR):q.RemoveClass(bU,bR);};});};_1.OnAfterRenderView=function(bR,bS){var bT;bT=g.Id();return V.Append(_1.OnAfterRender(function(bU){bS(bU,bU[bT]);}),_1.DynamicCustom(function(bU){return function(bV){bU[bT]=bV;};},bR));};_1.OnAfterRender=function(bR){return new V({$:4,$0:bR});};_1.HandlerView=function(bR,bS,bT){return Z.Static(function(bU){var bV;bV=bT(bU);bU.addEventListener(bR,function(bW){return y.Get(bV(bW),bS);},false);});};_1.Handler=function(bR,bS){return Z.Static(function(bT){bT.addEventListener(bR,function(bU){return(bS(bT))(bU);},false);});};_1.DynamicStyle=function(bR,bS){return Z.Dynamic(bS,function(bT){return function(bU){return q.SetStyle(bT,bR,bU);};});};_1.DynamicCustom=function(bR,bS){return Z.Dynamic(bS,bR);};_1.Dynamic=function(bR,bS){return Z.Dynamic(bS,function(bT){return function(bU){return q.SetAttr(bT,bR,bU);};});};_1.AnimatedStyle=function(bR,bS,bT,bU){return Z.Animated(bS,bT,function(bV){return function(bW){return q.SetStyle(bV,bR,bU(bW));};});};_1.Animated=function(bR,bS,bT,bU){return Z.Animated(bS,bT,function(bV){return function(bW){return q.SetAttr(bV,bR,bU(bW));};});};_1.Class=function(bR){return Z.Static(function(bS){q.AddClass(bS,bR);});};_1.Style=function(bR,bS){return Z.Static(function(bT){q.SetStyle(bT,bR,bS);});};_2.$cctor=bA.Cctor(function(){_2.EmptyAttr=null;_2.$cctor=window.ignore;});_3=c.DocElemNode=bA.Class({GetHashCode:function(){return this.ElKey;},Equals:function(bR){return this.ElKey===bR.ElKey;}},null,_3);_3.New=function(bR,bS,bT,bU,bV,bW){var bX;return new _3((bX={Attr:bR,Children:bS,El:bU,ElKey:bV},(bA.SetOptional(bX,"Delimiters",bT),bA.SetOptional(bX,"Render",bW),bX)));};_5.FoldBack=function(bR,bS,bT){return bs.foldBack(bR,bS.$0,bT);};_5.Iter=function(bR,bS){bs.iter(bR,bS.$0);};_5.Except=function(bR,bS){var bT;bT=bR.$0;return{$:0,$0:bs.filter(function(bU){return bs.forall(function(bV){return!(bU===bV);},bT);},bS.$0)};};_5.DocChildren=function(bR){var bS;function bT(bU){if(bU!=null&&bU.$==2)bT(bU.$0.Current);else if(bU!=null&&bU.$==1)bS.push(bU.$0.El);else if(bU==null);else if(bU!=null&&bU.$==5)bS.push(bU.$0);else if(bU!=null&&bU.$==4)bS.push(bU.$0.Text);else if(bU!=null&&bU.$==6)bs.iter(function(bV){if(bV.constructor===window.Object)bT(bV);else bS.push(bV);},bU.$0.Els);else{bT(bU.$0);bT(bU.$1);}}bS=[];bT(bR.Children);return{$:0,$0:d.ofSeqNonCopying(bS)};};_5.Children=function(bR,bS){var bT,bU,bV;if(bS!=null&&bS.$==1){bV=[];bT=bS.$0[0].nextSibling;while(bT!==bS.$0[1]){bV.push(bT);bT=bT.nextSibling;}return{$:0,$0:bV};}else return{$:0,$0:bs.init(bR.childNodes.length,(bU=bR.childNodes,function(bW){return bU[bW];}))};};_6.ToArray=function(bR){return h.ToArray(bR.$0);};_6.get_Empty=function(){return{$:0,$0:new bx.New$3()};};_6.IsEmpty=function(bR){return bR.$0.get_Count()===0;};_6.Intersect=function(bR,bS){return{$:0,$0:h.Intersect(bR.$0,bS.$0)};};_6.Except=function(bR,bS){return{$:0,$0:h.Except(bR.$0,bS.$0)};};_6.FindAll=function(bR){var bS;function bT(bV){if(bV!=null&&bV.$==0){bT(bV.$0);bT(bV.$1);}else if(bV!=null&&bV.$==1)bU(bV.$0);else if(bV!=null&&bV.$==2)bT(bV.$0.Current);else if(bV!=null&&bV.$==6)bs.iter(bU,bV.$0.Holes);}function bU(bV){bS.push(bV);bT(bV.Children);}bS=[];bT(bR);return{$:0,$0:new bx.New$2(bS)};};_6.Filter=function(bR,bS){return{$:0,$0:h.Filter(bR,bS.$0)};};_7.New=function(bR,bS){return{PreviousNodes:bR,Top:bS};};_8.TextHoleRE=function(){ba.$cctor();return ba.TextHoleRE;};_8.LoadedTemplates=function(){ba.$cctor();return ba.LoadedTemplates;};_8.UpdateTextNode=function(bR,bS){bR.Value=bS;bR.Dirty=true;};_8.CreateTextNode=function(){return{Text:q.CreateText(""),Dirty:false,Value:""};};_8.UpdateEmbedNode=function(bR,bS){bR.Current=bS;bR.Dirty=true;};_8.CreateEmbedNode=function(){return{Current:null,Dirty:false};};_8.PerformAnimatedUpdate=function(bR,bS){var bT;return P.get_UseAnimations()?(bT=null,bD.Delay(function(){var bU,bV,bW;bU=_6.FindAll(bS);bV=_8.ComputeChangeAnim(bR,bU);bW=_8.ComputeEnterAnim(bR,bU);return bD.Bind(P.Play(P.Append(bV,_8.ComputeExitAnim(bR,bU))),function(){return bD.Bind(_8.SyncElemNodesNextFrame(bR),function(){return bD.Bind(P.Play(bW),function(){bR.PreviousNodes=bU;return bD.Return(null);});});});})):_8.SyncElemNodesNextFrame(bR);};_8.SyncElemNodesNextFrame=function(bR){var bS;bS=function(bT){window.requestAnimationFrame(function(){_8.SyncElemNode(bR.Top);bT();});};return bD.FromContinuations(function(bT,bU,bV){return bS.apply(null,[bT,bU,bV]);});};_8.ComputeEnterAnim=function(bR,bS){return P.Concat(bs.map(function(bT){return Z.GetEnterAnim(bT.Attr);},_6.ToArray(_6.Except(bR.PreviousNodes,_6.Filter(function(bT){return Z.HasEnterAnim(bT.Attr);},bS)))));};_8.ComputeChangeAnim=function(bR,bS){var bT,bU;bT=(bU=function(bV){return Z.HasChangeAnim(bV.Attr);},function(bV){return _6.Filter(bU,bV);});return P.Concat(bs.map(function(bV){return Z.GetChangeAnim(bV.Attr);},_6.ToArray(_6.Intersect(bT(bR.PreviousNodes),bT(bS)))));};_8.ComputeExitAnim=function(bR,bS){return P.Concat(bs.map(function(bT){return Z.GetExitAnim(bT.Attr);},_6.ToArray(_6.Except(bS,_6.Filter(function(bT){return Z.HasExitAnim(bT.Attr);},bR.PreviousNodes)))));};_8.CreateDelimitedRunState=function(bR,bS,bT){return _7.New(_6.get_Empty(),_8.CreateDelimitedElemNode(bR,bS,Z.EmptyAttr(),bT));};_8.CreateRunState=function(bR,bS){return _7.New(_6.get_Empty(),_8.CreateElemNode(bR,Z.EmptyAttr(),bS));};_8.CreateDelimitedElemNode=function(bR,bS,bT,bU){var bV,bW;bV=bR.parentNode;_8.LinkPrevElement(bS,bU);bW=Z.Insert(bV,bT);return _3.New(bW,bU,{$:1,$0:[bR,bS]},bV,g.Int(),bA.GetOptional(bW.OnAfterRender));};_8.CreateElemNode=function(bR,bS,bT){var bU;_8.LinkElement(bR,bT);bU=Z.Insert(bR,bS);return _3.New(bU,bT,null,bR,g.Int(),bA.GetOptional(bU.OnAfterRender));};_8.SyncElemNode=function(bR){_8.SyncElement(bR);_8.Sync(bR.Children);_8.AfterRender(bR);};_8.Sync=function(bR){var bS,bT;if(bR!=null&&bR.$==1)_8.SyncElemNode(bR.$0);else if(bR!=null&&bR.$==2)_8.Sync(bR.$0.Current);else if(bR==null);else if(bR!=null&&bR.$==5);else if(bR!=null&&bR.$==4){bS=bR.$0;bS.Dirty?(bS.Text.nodeValue=bS.Value,bS.Dirty=false):void 0;}else if(bR!=null&&bR.$==6){bT=bR.$0;bs.iter(function(bU){_8.SyncElemNode(bU);},bT.Holes);bs.iter(function(bU){Z.Sync(bU[0],bU[1]);},bT.Attrs);_8.AfterRender(bT);}else{_8.Sync(bR.$0);_8.Sync(bR.$1);}};_8.AfterRender=function(bR){var bS;bS=bA.GetOptional(bR.Render);bS!=null&&bS.$==1?(bS.$0(bR.El),bA.SetOptional(bR,"Render",null)):void 0;};_8.InsertBeforeDelim=function(bR,bS){var bT,bU;bT=bR.parentNode;bU=window.document.createTextNode("");bT.insertBefore(bU,bR);_8.LinkPrevElement(bR,bS);return bU;};_8.LinkPrevElement=function(bR,bS){_8.InsertDoc(bR.parentNode,bS,bR);};_8.LinkElement=function(bR,bS){_8.InsertDoc(bR,bS,null);};_8.SyncElement=function(bR){function bS(bT){function bU(bV){var bW,bX;return bV!=null&&bV.$==0?bU(bV.$0)||bU(bV.$1):bV!=null&&bV.$==2?(bW=bV.$0,bW.Dirty||bU(bW.Current)):bV!=null&&bV.$==6&&(bX=bV.$0,bX.Dirty||bs.exists(bS,bX.Holes));}return bU(bT.Children);}Z.Sync(bR.El,bR.Attr);bS(bR)?_8.DoSyncElement(bR):void 0;};_8.DoSyncElement=function(bR){var bS,bT,bU;function bV(bW,bX){var bY,bZ;return bW!=null&&bW.$==1?bW.$0.El:bW!=null&&bW.$==2?(bY=bW.$0,bY.Dirty?(bY.Dirty=false,_8.InsertDoc(bS,bY.Current,bX)):bV(bY.Current,bX)):bW==null?bX:bW!=null&&bW.$==4?bW.$0.Text:bW!=null&&bW.$==5?bW.$0:bW!=null&&bW.$==6?(bZ=bW.$0,(bZ.Dirty?bZ.Dirty=false:void 0,bs.foldBack(function(b0,b1){return b0.constructor===window.Object?bV(b0,b1):b0;},bZ.Els,bX))):bV(bW.$0,bV(bW.$1,bX));}bS=bR.El;_5.Iter((bT=bR.El,function(bW){q.RemoveNode(bT,bW);}),_5.Except(_5.DocChildren(bR),_5.Children(bR.El,bA.GetOptional(bR.Delimiters))));bV(bR.Children,(bU=bA.GetOptional(bR.Delimiters),bU!=null&&bU.$==1?bU.$0[1]:null));};_8.InsertDoc=function(bR,bS,bT){var bU;return bS!=null&&bS.$==1?_8.InsertNode(bR,bS.$0.El,bT):bS!=null&&bS.$==2?(bU=bS.$0,(bU.Dirty=false,_8.InsertDoc(bR,bU.Current,bT))):bS==null?bT:bS!=null&&bS.$==4?_8.InsertNode(bR,bS.$0.Text,bT):bS!=null&&bS.$==5?_8.InsertNode(bR,bS.$0,bT):bS!=null&&bS.$==6?bs.foldBack(function(bV,bW){return bV.constructor===window.Object?_8.InsertDoc(bR,bV,bW):_8.InsertNode(bR,bV,bW);},bS.$0.Els,bT):_8.InsertDoc(bR,bS.$0,_8.InsertDoc(bR,bS.$1,bT));};_8.InsertNode=function(bR,bS,bT){q.InsertAt(bR,bT,bS);return bS;};_9=c.Doc=bA.Class({ReplaceInDom:function(bR){var bS;bS=window.document.createTextNode("");bR.parentNode.replaceChild(bS,bR);_9.RunBefore(bS,this);}},null,_9);_9.Append=function(bR,bS){return _9.Mk({$:0,$0:bR.docNode,$1:bS.docNode},y.Map2Unit(bR.updates,bS.updates));};_9.Concat=function(bR){var bS;bS=d.ofSeqNonCopying(bR);return d.TreeReduce(_9.Empty(),_9.Append,bS);};_9.Empty=function(){return _9.Mk(null,y.Const());};_9.TextNode=function(bR){return _9.Mk({$:5,$0:q.CreateText(bR)},y.Const());};_9.Verbatim=function(bR){var bS;return _9.Mk(d.MapTreeReduce(function(bT){return bB.Equals(bT.nodeType,bN.TEXT_NODE)?{$:5,$0:bT}:{$:1,$0:_8.CreateElemNode(bT,Z.EmptyAttr(),null)};},null,function(bT,bU){return{$:0,$0:bT,$1:bU};},(bS=bO.parseHTML(bR),bB.Equals(bS,null)?[]:bS)),y.Const());};_9.SvgElementMixed=function(bR,bS){var bT;bT=_9.MixedNodes(bS);return _9.SvgElement(bR,bT[0],bT[1]);};_9.SvgElement=function(bR,bS,bT){var bU,bV;bU=V.Concat(bS);bV=_9.Concat(bT);return _.New(q.CreateSvgElement(bR),bU,bV);};_9.ElementMixed=function(bR,bS){var bT;bT=_9.MixedNodes(bS);return _9.Element(bR,bT[0],bT[1]);};_9.ConcatMixed=function(bR){return _9.Concat(by.map(_9.ToMixedDoc,bR));};_9.MixedNodes=function(bR){var bS,bT,bU,bV;bS=new bG.New$2();bT=new bG.New$2();bU=bt.Get(bR);try{while(bU.MoveNext()){bV=bU.Current();bV instanceof V?bS.Add(bV):bT.Add(_9.ToMixedDoc(bV));}}finally{if("Dispose"in bU)bU.Dispose();}return[bS,bT];};_9.ToMixedDoc=function(bR){return bR instanceof _9?bR:typeof bR=="string"?_9.TextNode(bR):bR instanceof window.Element?_9.Static(bR):typeof bR=="function"?_9.EmbedView(y.Map(_9.ToMixedDoc,bR)):bR instanceof w?_9.EmbedView(y.Map(_9.ToMixedDoc,bR.v)):bB.Equals(bR,null)?_9.Empty():_9.TextNode(window.String(bR));};_9.Element=function(bR,bS,bT){var bU,bV;bU=V.Concat(bS);bV=_9.Concat(bT);return _.New(q.CreateElement(bR),bU,bV);};_9.Radio=function(bR,bS,bT){var bU,bV;bU=q.CreateElement("input");bU.addEventListener("click",function(){return bT.RSet(bS);},false);bV=_1.DynamicProp("checked",y.Map(function(bW){return bB.Equals(bW,bS);},bT.RView()));return _.New(bU,V.Concat(br.append(br.ofArray([V.Create("type","radio"),V.Create("name",bT.RId()),bV]),br.ofSeq(bR))),_9.Empty());};_9.LinkView=function(bR,bS,bT,bU){var bV;bV=V.Concat(by.append([_1.HandlerView("click",bT,function(){return function(){return bU;};}),V.Create("href","#")],bS));return _.New(q.CreateElement("a"),bV,_9.TextNode(bR));};_9.Link=function(bR,bS,bT){var bU,bV;bU=(bV=V.Concat(bS),V.Append(V.Create("href","#"),bV));return _.New(_9.Clickable("a",bT),bU,_9.TextNode(bR));};_9.ButtonView=function(bR,bS,bT,bU){var bV;bV=V.Concat(by.append([_1.HandlerView("click",bT,function(){return function(){return bU;};})],bS));return _.New(q.CreateElement("button"),bV,_9.TextNode(bR));};_9.Button=function(bR,bS,bT){var bU;bU=V.Concat(bS);return _.New(_9.Clickable("button",bT),bU,_9.TextNode(bR));};_9.Clickable=function(bR,bS){var bT;bT=q.CreateElement(bR);bT.addEventListener("click",function(bU){bU.preventDefault();return bS();},false);return bT;};_9.CheckBoxGroup=function(bR,bS,bT){var bU;return _9.CheckBox(bR,w.Lens(bT,(bU=function(bV){return bB.Equals(bS,bV);},function(bV){return br.exists(bU,bV);}),function(bV,bW){return bW?br.exists(function(bX){return bB.Equals(bS,bX);},bV)?bV:new br.T({$:1,$0:bS,$1:bV}):br.filter(function(bX){return!bB.Equals(bS,bX);},bV);}));};_9.CheckBox=function(bR,bS){return _9.InputInternal("input",function(){return by.append(bR,[V.Create("type","checkbox"),_1.Checked(bS)]);});};_9.SelectDynOptional=function(bR,bS,bT,bU,bV){return _9.SelectDyn(bR,function(bW){return bW!=null&&bW.$==1?bT(bW.$0):bS;},y.Map(function(bW){return new br.T({$:1,$0:null,$1:br.map(function(bX){return{$:1,$0:bX};},bW)});},bU),bV);};_9.SelectOptional=function(bR,bS,bT,bU,bV){return _9.Select(bR,function(bW){return bW!=null&&bW.$==1?bT(bW.$0):bS;},new br.T({$:1,$0:null,$1:br.map(function(bW){return{$:1,$0:bW};},bU)}),bV);};_9.Select=function(bR,bS,bT,bU){return _9.SelectImpl(bR,bS,function(bV){bV[0]=bT;return _9.Concat(br.mapi(function(bW,bX){return _9.Element("option",br.ofArray([V.Create("value",window.String(bW))]),br.ofArray([_9.TextNode(bS(bX))]));},bT));},bU);};_9.SelectDyn=function(bR,bS,bT,bU){return _9.SelectImpl(bR,bS,function(bV){var bW;bW=function(bX,bY){return _9.Element("option",br.ofArray([V.Create("value",window.String(bX))]),br.ofArray([_9.TextNode(bS(bY))]));};return _9.Convert(function(bX){return bW(bX[0],bX[1]);},y.Map(function(bX){bV[0]=bX;return by.mapi(function(bY,bZ){return[bY,bZ];},bX);},bT));},bU);};_9.SelectImpl=function(bR,bS,bT,bU){var bV,bW,bX,bY,bZ,b0,b1,b2,b3;bV=[br.T.Empty];bW=function(b4){return b4.selectedIndex;};bX=function(b4,b5){b4.selectedIndex=b5;};bY=function(b4){var b5;b5=bW(b4);return bV[0].get_Item(b5);};bZ=function(b4){return by.findIndex(function(b5){return bB.Equals(b4,b5);},bV[0]);};b0=function(b4,b5){return bX(b4,bZ(b5));};b1=q.CreateElement("select");b2=_1.DynamicCustom(function(b4){return function(b5){return b0(b4,b5);};},bU.RView());b1.addEventListener("change",function(){bU.RUpdM(function(b4){var b5;b5=bY(b1);return bB.Equals(b4,b5)?null:{$:1,$0:b5};});},false);return _.New(b1,(b3=V.Append(b2,V.Concat(bR)),V.Append(_1.OnAfterRender(function(b4){b0(b4,bU.RGet());}),b3)),bT(bV));};_9.InputArea=function(bR,bS){return _9.InputInternal("textarea",function(){return by.append(bR,[_1.Value(bS)]);});};_9.FloatInput=function(bR,bS){return _9.InputInternal("input",function(){return by.append(bR,[_1.FloatValue(bS),V.Create("type","number")]);});};_9.FloatInputUnchecked=function(bR,bS){return _9.InputInternal("input",function(){return by.append(bR,[bS.RGet()===0?V.Create("value","0"):Z.EmptyAttr(),_1.FloatValueUnchecked(bS),V.Create("type","number")]);});};_9.IntInput=function(bR,bS){return _9.InputInternal("input",function(){return by.append(bR,[_1.IntValue(bS),V.Create("type","number")]);});};_9.IntInputUnchecked=function(bR,bS){return _9.InputInternal("input",function(){return by.append(bR,[bS.RGet()===0?V.Create("value","0"):Z.EmptyAttr(),_1.IntValueUnchecked(bS),V.Create("type","number")]);});};_9.PasswordBox=function(bR,bS){return _9.InputInternal("input",function(){return by.append(bR,[_1.Value(bS),V.Create("type","password")]);});};_9.Input=function(bR,bS){return _9.InputInternal("input",function(){return by.append(bR,[_1.Value(bS)]);});};_9.InputInternal=function(bR,bS){var bT;bT=q.CreateElement(bR);return _.New(bT,V.Concat(bS(bT)),_9.Empty());};_9.ConvertSeqBy=function(bR,bS,bT){return _9.Flatten(y.MapSeqCachedViewBy(bR,function(bU,bV){return(bS(bU))(bV);},bT));};_9.ConvertSeq=function(bR,bS){return _9.Flatten(y.MapSeqCachedView(bR,bS));};_9.ConvertBy=function(bR,bS,bT){return _9.Flatten(y.MapSeqCachedBy(bR,bS,bT));};_9.Convert=function(bR,bS){return _9.Flatten(y.MapSeqCached(bR,bS));};_9.Flatten=function(bR){return _9.EmbedView(y.Map(_9.Concat,bR));};_9.GetOrLoadTemplate=function(bR,bS,bT,bU){_9.PrepareTemplate(bR,bS,bT);return _9.NamedTemplate(bR,bS,bU);};_9.NamedTemplate=function(bR,bS,bT){var bU,bV,bW;bU=_9.ComposeName(bR,bS);bV=(bW=null,[_8.LoadedTemplates().TryGetValue(bU,{get:function(){return bW;},set:function(bX){bW=bX;}}),bW]);return bV[0]?_9.ChildrenTemplate(bV[1].cloneNode(true),bT):(bC.warn("Local template doesn't exist",bU),_9.Empty());};_9.LoadLocalTemplates=function(bR){(function(){var bS,bT,bU,bV;while(true){bS=window.document.querySelector("[ws-template]");if(bB.Equals(bS,null)){bT=window.document.querySelector("[ws-children-template]");if(bB.Equals(bT,null))return null;else{bU=bT.getAttribute("ws-children-template");bT.removeAttribute("ws-children-template");_9.PrepareTemplate(bR,{$:1,$0:bU},function(bW){return function(){return q.ChildrenArray(bW);};}(bT));}}else{bV=bS.getAttribute("ws-template");_9.PrepareSingleTemplate(bR,{$:1,$0:bV},bS);}}}());};_9.PrepareTemplate=function(bR,bS,bT){var bU,bV,bW,bX,bY;if(!_8.LoadedTemplates().ContainsKey(_9.ComposeName(bR,bS))){bU=bT();for(bV=0,bW=bU.length-1;bV<=bW;bV++){bX=bs.get(bU,bV);bY=bX.parentNode;bB.Equals(bY,null)?void 0:bY.removeChild(bX);}_9.PrepareTemplateStrict(bR,bS,bU);}};_9.PrepareTemplateStrict=function(bR,bS,bT){var bU,bV,bW,bX,bY,bZ,b0,b1;function b2(b7,b8,b9){var b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu;while(true)switch(b7){case 0:cc=bP.string(b8.nodeName,{$:1,$0:3},null).toLowerCase();cd=cc.indexOf(bQ.fromCharCode(46))===-1?bR+"/"+cc:bu.Replace(cc,".","/");if(!_8.LoadedTemplates().ContainsKey(cd))return bC.warn("Instantiating non-loaded template",cd);else{ce=_8.LoadedTemplates().get_Item(cd);cf=ce.cloneNode(true);cg=new bx.New$3();ch=new bK.New$5();ci=b8.attributes;for(cj=0,ck=ci.length-1;cj<=ck;cj++){cl=ci.item(cj).name.toLowerCase();ch.set_Item(cl,(cm=ci.item(cj).nodeValue,cm===""?cl:cm.toLowerCase()));!cg.Add(cl)?bC.warn("Hole mapped twice",cl):void 0;}for(cn=0,co=b8.childNodes.length-1;cn<=co;cn++){cp=b8.childNodes[cn];bB.Equals(cp.nodeType,bN.ELEMENT_NODE)?!cg.Add(cp.nodeName.toLowerCase())?bC.warn("Hole filled twice",cd):void 0:void 0;}cq=b8.childNodes.length===1&&bB.Equals(b8.firstChild.nodeType,bN.TEXT_NODE);if(cq){b$=bZ(cf,b8.firstChild.textContent);((function(cv){return function(cw){if(cw!=null)cv(cw.$0);};}((ca=function(cv){return function(cw){return cv.Add(cw);};}(cg),cb=function(){},function(cv){return cb(ca(cv));})))(b$));}bY(cf,cg);if(!cq){for(cr=0,cs=b8.childNodes.length-1;cr<=cs;cr++){ct=b8.childNodes[cr];bB.Equals(ct.nodeType,bN.ELEMENT_NODE)?ct.hasAttributes()?bX(cf,ct):b3(cf,ct):void 0;}}bW(cf,ch);(((function(cv){var cw;cw=function(cx,cy){return b0(cv,cx,cy);};return function(cx){return function(cy){return cw(cx,cy);};};}(cf))(b8.parentNode))(b8));b8.parentNode.removeChild(b8);}case 1:if(b9!==null){cu=b9.nextSibling;if(bB.Equals(b9.nodeType,bN.TEXT_NODE))bV(b9);else if(bB.Equals(b9.nodeType,bN.ELEMENT_NODE))b5(b9);b7=1;b8=b8;b9=cu;}else return null;}}function b3(b7,b8){var b9,b$,ca;function b_(cb,cc){var cd,ce,cf;if(b$==="title"&&b8.hasChildNodes()){cd=bO.parseHTML(b8.textContent);b8.removeChild(b8.firstChild);for(ce=0,cf=cd.length-1;ce<=cf;ce++)b8.appendChild(bs.get(cd,ce));}else null;b5(b8);return b0(b8,cb,cc);}b$=b8.nodeName.toLowerCase();q.IterSelector(b7,"[ws-attr-holes]",function(cb){var cc,cd,ce,cf,cg;cc=bu.SplitChars(cb.getAttribute("ws-attr-holes"),[32],1);for(cd=0,ce=cc.length-1;cd<=ce;cd++){cf=bs.get(cc,cd);cb.setAttribute(cf,(cg=new window.RegExp("\\${"+b$+"}","ig"),cb.getAttribute(cf).replace(cg,b8.textContent)));}});ca=b7.querySelector("[ws-hole="+b$+"]");if(bB.Equals(ca,null)){b9=b7.querySelector("[ws-replace="+b$+"]");return bB.Equals(b9,null)?null:(b_(b9.parentNode,b9),void b9.parentNode.removeChild(b9));}else{while(ca.hasChildNodes())ca.removeChild(ca.lastChild);ca.removeAttribute("ws-hole");return b_(ca,null);}}function b4(b7){return b2(0,b7);}function b5(b7){var b8,b9;if(bu.StartsWith(b7.nodeName.toLowerCase(),"ws-")&&!b7.hasAttribute("ws-template"))b4(b7);else{bU(b7);b8=b7.getAttribute("ws-template");if(b8===null){b9=b7.getAttribute("ws-children-template");if(b9===null)b6(b7,b7.firstChild);else{b7.removeAttribute("ws-children-template");_9.PrepareTemplate(bR,{$:1,$0:b9},function(){return q.ChildrenArray(b7);});while(b7.hasChildNodes())b7.removeChild(b7.lastChild);}}else _9.PrepareSingleTemplate(bR,{$:1,$0:b8},b7);}}function b6(b7,b8){return b2(1,b7,b8);}bU=function(b7){var b9,b_,b$,ca,cb,cc,cd,ce;function b8(cf){var cg;cg=b7.getAttribute(cf);cg===null?void 0:b7.setAttribute(cf,cg.toLowerCase());}b9=b7.attributes;b_=[];b$=[];ca=[];for(cb=0,cc=b9.length-1;cb<=cc;cb++){cd=b9.item(cb);bu.StartsWith(cd.nodeName,"ws-on")&&cd.nodeName!=="ws-onafterrender"&&cd.nodeName!=="ws-on"?(b_.push(cd.nodeName),b$.push(bP.string(cd.nodeName,{$:1,$0:"ws-on".length},null)+":"+cd.nodeValue.toLowerCase())):!bu.StartsWith(cd.nodeName,"ws-")&&(new window.RegExp(_8.TextHoleRE())).test(cd.nodeValue)?(cd.nodeValue=(ce=new window.RegExp(_8.TextHoleRE(),"g"),cd.nodeValue.replace(ce,function(cf,cg){return"${"+cg.toLowerCase()+"}";})),ca.push(cd.nodeName)):void 0;}!(b$.length==0)?b7.setAttribute("ws-on",bu.concat(" ",b$)):void 0;!(ca.length==0)?b7.setAttribute("ws-attr-holes",bu.concat(" ",ca)):void 0;b8("ws-hole");b8("ws-replace");b8("ws-attr");b8("ws-onafterrender");b8("ws-var");bs.iter(function(cf){b7.removeAttribute(cf);},b_);};bV=function(b7){var b8,b9,b_,b$,ca,cb;b8=null;b9=0;b$=b7.textContent;ca=new window.RegExp(_8.TextHoleRE(),"g");while(b8=ca.exec(b$),b8!==null){b7.parentNode.insertBefore(window.document.createTextNode(bP.string(b$,{$:1,$0:b9},{$:1,$0:ca.lastIndex-bs.get(b8,0).length-1})),b7);b9=ca.lastIndex;cb=window.document.createElement("span");cb.setAttribute("ws-replace",bs.get(b8,1).toLowerCase());b7.parentNode.insertBefore(cb,b7);}ca.lastIndex=0;b7.textContent=bP.string(b$,{$:1,$0:b9},null);};bW=function(b7,b8){function b9(b_){q.IterSelector(b7,"["+b_+"]",function(b$){var ca,cb;ca=(cb=null,[b8.TryGetValue(b$.getAttribute(b_).toLowerCase(),{get:function(){return cb;},set:function(cc){cb=cc;}}),cb]);ca[0]?b$.setAttribute(b_,ca[1]):void 0;});}b9("ws-hole");b9("ws-replace");b9("ws-attr");b9("ws-onafterrender");b9("ws-var");q.IterSelector(b7,"[ws-on]",function(b_){b_.setAttribute("ws-on",bu.concat(" ",bs.map(function(b$){var ca,cb,cc;ca=bu.SplitChars(b$,[58],1);cb=(cc=null,[b8.TryGetValue(bs.get(ca,1),{get:function(){return cc;},set:function(cd){cc=cd;}}),cc]);return cb[0]?bs.get(ca,0)+":"+cb[1]:b$;},bu.SplitChars(b_.getAttribute("ws-on"),[32],1))));});return q.IterSelector(b7,"[ws-attr-holes]",function(b_){var b$,ca,cb;b$=bu.SplitChars(b_.getAttribute("ws-attr-holes"),[32],1);for(ca=0,cb=b$.length-1;ca<=cb;ca++)(function(){var cc,cd;cc=bs.get(b$,ca);return b_.setAttribute(cc,((cd=function(ce,cf){var cg;cg=bH.KeyValue(cf);return ce.replace(new window.RegExp("\\${"+cg[0]+"}","ig"),"${"+cg[1]+"}");},(bA.Curried3(by.fold))(cd))(b_.getAttribute(cc)))(b8));}());});};bX=function(b7,b8){var b9,b_,b$,ca,cb;bU(b8);b9=b8.nodeName.toLowerCase();b_=b7.querySelector("[ws-attr="+b9+"]");if(bB.Equals(b_,null))return bC.warn("Filling non-existent attr hole",b9);else{b_.removeAttribute("ws-attr");for(b$=0,ca=b8.attributes.length-1;b$<=ca;b$++){cb=b8.attributes.item(b$);cb.name==="class"&&b_.hasAttribute("class")?b_.setAttribute("class",b_.getAttribute("class")+" "+cb.nodeValue):b_.setAttribute(cb.name,cb.nodeValue);}return;}};bY=function(b7,b8){function b9(b_){q.IterSelector(b7,"["+b_+"]",function(b$){if(!b8.Contains(b$.getAttribute(b_)))b$.removeAttribute(b_);});}b9("ws-attr");b9("ws-onafterrender");b9("ws-var");q.IterSelector(b7,"[ws-hole]",function(b_){if(!b8.Contains(b_.getAttribute("ws-hole"))){b_.removeAttribute("ws-hole");while(b_.hasChildNodes())b_.removeChild(b_.lastChild);}});q.IterSelector(b7,"[ws-replace]",function(b_){if(!b8.Contains(b_.getAttribute("ws-replace")))b_.parentNode.removeChild(b_);});q.IterSelector(b7,"[ws-on]",function(b_){b_.setAttribute("ws-on",bu.concat(" ",bs.filter(function(b$){return b8.Contains(bs.get(bu.SplitChars(b$,[58],1),1));},bu.SplitChars(b_.getAttribute("ws-on"),[32],1))));});return q.IterSelector(b7,"[ws-attr-holes]",function(b_){var b$,ca,cb,cc,cd;b$=bu.SplitChars(b_.getAttribute("ws-attr-holes"),[32],1);for(ca=0,cb=b$.length-1;ca<=cb;ca++){cc=bs.get(b$,ca);b_.setAttribute(cc,(cd=new window.RegExp(_8.TextHoleRE(),"g"),b_.getAttribute(cc).replace(cd,function(ce,cf){return b8.Contains(cf)?ce:"";})));}});};bZ=function(b7,b8){var b9;b9=b7.querySelector("[ws-replace]");return bB.Equals(b9,null)?(bC.warn("Filling non-existent text hole",bS),null):(b9.parentNode.replaceChild(new window.Text(b8),b9),{$:1,$0:b9.getAttribute("ws-replace")});};b0=function(b7,b8,b9){while(true)if(b7.hasChildNodes())b9=b8.insertBefore(b7.lastChild,b9);else return null;};b1=_9.FakeRoot(bT);_8.LoadedTemplates().set_Item(_9.ComposeName(bR,bS),b1);bs.length(bT)>0?b6(b1,bs.get(bT,0)):void 0;};_9.ComposeName=function(bR,bS){return(bR+"/"+(bS==null?"":bS.$0)).toLowerCase();};_9.PrepareSingleTemplate=function(bR,bS,bT){var bU,bV,bW;bT.removeAttribute("ws-template");bU=bT.getAttribute("ws-replace");bU===null?void 0:(bT.removeAttribute("ws-replace"),bV=bT.parentNode,bB.Equals(bV,null)?void 0:(bW=window.document.createElement(bT.tagName),bW.setAttribute("ws-replace",bU),bV.replaceChild(bW,bT)));_9.PrepareTemplateStrict(bR,bS,[bT]);};_9.FakeRoot=function(bR){var bS,bT,bU;bS=window.document.createElement("div");for(bT=0,bU=bR.length-1;bT<=bU;bT++)bS.appendChild(bs.get(bR,bT));return bS;};_9.ChildrenTemplate=function(bR,bS){var bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6;b0=[];b1=[];b2=[];b3=[];b4=new bK.New$5();b5=bt.Get(bS);try{while(b5.MoveNext()){b6=b5.Current();b4.set_Item(b6.$0,b6);}}finally{if("Dispose"in b5)b5.Dispose();}bT=q.ChildrenArray(bR);bU=function(b7,b8){var b9,b_,b$;b9=Z.Insert(b7,b8);b1.push(Z.Updates(b9));b2.push([b7,b9]);b_=bA.GetOptional(b9.OnAfterRender);return b_==null?null:(b$=b_.$0,void b3.push(function(){b$(b7);}));};bV=function(b7){var b8,b9;b8=(b9=null,[b4.TryGetValue(b7,{get:function(){return b9;},set:function(b_){b9=b_;}}),b9]);return b8[0]?b8[1].$==0?{$:1,$0:b8[1].$1}:b8[1].$==1?{$:1,$0:_9.TextNode(b8[1].$1)}:b8[1].$==2?{$:1,$0:_9.TextView(b8[1].$1)}:b8[1].$==6?{$:1,$0:_9.TextView(b8[1].$1.RView())}:b8[1].$==7?{$:1,$0:_9.TextView(y.Map(bQ,b8[1].$1.RView()))}:b8[1].$==8?{$:1,$0:_9.TextView(y.Map(function(b_){return b_.get_Input();},b8[1].$1.RView()))}:b8[1].$==9?{$:1,$0:_9.TextView(y.Map(bQ,b8[1].$1.RView()))}:b8[1].$==10?{$:1,$0:_9.TextView(y.Map(function(b_){return b_.get_Input();},b8[1].$1.RView()))}:b8[1].$==11?{$:1,$0:_9.TextView(y.Map(bQ,b8[1].$1.RView()))}:(bC.warn("Content hole filled with attribute data",b7),null):null;};q.IterSelector(bR,"[ws-hole]",function(b7){var b8,b9,b_;b_=b7.getAttribute("ws-hole");b7.removeAttribute("ws-hole");while(b7.hasChildNodes())b7.removeChild(b7.lastChild);b8=bV(b_);b8!=null&&b8.$==1?(b9=b8.$0,_8.LinkElement(b7,b9.docNode),b0.push(_3.New(Z.Empty(b7),b9.docNode,null,b7,g.Int(),null)),b1.push(b9.updates)):void 0;});q.IterSelector(bR,"[ws-replace]",function(b7){var b8,b9,b_,b$,ca,cb;b8=bV(b7.getAttribute("ws-replace"));b8!=null&&b8.$==1?(b9=b8.$0,b_=b7.parentNode,b$=window.document.createTextNode(""),b_.replaceChild(b$,b7),ca=_8.InsertBeforeDelim(b$,b9.docNode),cb=bs.tryFindIndex(function(cc){return b7===cc;},bT),cb==null?void 0:bs.set(bT,cb.$0,b9.docNode),b0.push(_3.New(Z.Empty(b_),b9.docNode,{$:1,$0:[ca,b$]},b_,g.Int(),null)),b1.push(b9.updates)):void 0;});q.IterSelector(bR,"[ws-attr]",function(b7){var b8,b9,b_;b8=b7.getAttribute("ws-attr");b7.removeAttribute("ws-attr");b9=(b_=null,[b4.TryGetValue(b8,{get:function(){return b_;},set:function(b$){b_=b$;}}),b_]);b9[0]?b9[1].$==3?bU(b7,b9[1].$1):bC.warn("Attribute hole filled with non-attribute data",b8):void 0;});q.IterSelector(bR,"[ws-on]",function(b7){bU(b7,V.Concat(bs.choose(function(b8){var b9,b_,b$;b9=bu.SplitChars(b8,[58],1);b_=(b$=null,[b4.TryGetValue(bs.get(b9,1),{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);return b_[0]?b_[1].$==4?{$:1,$0:_1.Handler(bs.get(b9,0),b_[1].$1)}:(bC.warn("Event hole on"+bs.get(b9,0)+" filled with non-event data",bs.get(b9,1)),null):null;},bu.SplitChars(b7.getAttribute("ws-on"),[32],1))));b7.removeAttribute("ws-on");});q.IterSelector(bR,"[ws-onafterrender]",function(b7){var b8,b9,b_;b8=b7.getAttribute("ws-onafterrender");b9=(b_=null,[b4.TryGetValue(b8,{get:function(){return b_;},set:function(b$){b_=b$;}}),b_]);b9[0]?b9[1].$==5?(b7.removeAttribute("ws-onafterrender"),bU(b7,_1.OnAfterRender(b9[1].$1))):bC.warn("onafterrender hole filled with non-onafterrender data",b8):void 0;});q.IterSelector(bR,"[ws-var]",function(b7){var b8,b9,b_;b8=b7.getAttribute("ws-var");b7.removeAttribute("ws-var");b9=(b_=null,[b4.TryGetValue(b8,{get:function(){return b_;},set:function(b$){b_=b$;}}),b_]);b9[0]?b9[1].$==6?bU(b7,_1.Value(b9[1].$1)):b9[1].$==7?bU(b7,_1.Checked(b9[1].$1)):b9[1].$==8?bU(b7,_1.IntValue(b9[1].$1)):b9[1].$==9?bU(b7,_1.IntValueUnchecked(b9[1].$1)):b9[1].$==10?bU(b7,_1.FloatValue(b9[1].$1)):b9[1].$==11?bU(b7,_1.FloatValueUnchecked(b9[1].$1)):bC.warn("Var hole filled with non-Var data",b8):void 0;});q.IterSelector(bR,"[ws-attr-holes]",function(b7){var b8,b9,b_,b$;b8=new window.RegExp(_8.TextHoleRE(),"g");b9=bu.SplitChars(b7.getAttribute("ws-attr-holes"),[32],1);b7.removeAttribute("ws-attr-holes");for(b_=0,b$=b9.length-1;b_<=b$;b_++)(function(){var ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm;cj=bs.get(b9,b_);ck=b7.getAttribute(cj);ca=null;cb=0;cl=[];while(ca=b8.exec(ck),ca!==null){cm=bP.string(ck,{$:1,$0:cb},{$:1,$0:b8.lastIndex-bs.get(ca,0).length-1});cb=b8.lastIndex;cl.push([cm,bs.get(ca,1)]);}cd=bP.string(ck,{$:1,$0:cb},null);b8.lastIndex=0;ce=bs.foldBack(function(cn,co){return(function(cp){var cq,cr;cq=cp[0];cr=cp[1];return function(cs){var ct,cu,cv,cw,cx;ct=cs[0];cu=cs[1];cv=(cw=(cx=null,[b4.TryGetValue(cr,{get:function(){return cx;},set:function(cy){cx=cy;}}),cx]),cw[0]?cw[1].$==1?{$:0,$0:cw[1].$1}:cw[1].$==2?{$:1,$0:cw[1].$1}:cw[1].$==6?{$:1,$0:cw[1].$1.RView()}:cw[1].$==7?{$:1,$0:y.Map(bQ,cw[1].$1.RView())}:cw[1].$==8?{$:1,$0:y.Map(function(cy){return cy.get_Input();},cw[1].$1.RView())}:cw[1].$==9?{$:1,$0:y.Map(bQ,cw[1].$1.RView())}:cw[1].$==10?{$:1,$0:y.Map(function(cy){return cy.get_Input();},cw[1].$1.RView())}:cw[1].$==11?{$:1,$0:y.Map(bQ,cw[1].$1.RView())}:(bC.warn("Attribute value hole filled with non-text data",cr),{$:0,$0:""}):{$:0,$0:""});return cv.$==1?[cq,new br.T({$:1,$0:ct===""?cv.$0:y.Map(function(cy){return cy+ct;},cv.$0),$1:cu})]:[cq+cv.$0+ct,cu];};}(cn))(co);},cl,[cd,br.T.Empty]);return bU(b7,ce[1].$==1?ce[1].$1.$==1?ce[1].$1.$1.$==1?ce[1].$1.$1.$1.$==0?(cf=ce[0],_1.Dynamic(cj,y.Map3(function(cn,co,cp){return cf+cn+co+cp;},ce[1].$0,ce[1].$1.$0,ce[1].$1.$1.$0))):(cg=ce[0],_1.Dynamic(cj,y.Map(function(cn){return cg+bu.concat("",cn);},y.Sequence(ce[1])))):(ch=ce[0],_1.Dynamic(cj,y.Map2(function(cn,co){return ch+cn+co;},ce[1].$0,ce[1].$1.$0))):ce[0]===""?_1.Dynamic(cj,ce[1].$0):(ci=ce[0],_1.Dynamic(cj,y.Map(function(cn){return ci+cn;},ce[1].$0))):V.Create(cj,ce[0]));}());});bW=bA.DeleteEmptyFields({Els:bT,Dirty:true,Holes:b0,Attrs:b2,Render:(bX=b3.length==0?null:{$:1,$0:function(b7){bs.iter(function(b8){b8(b7);},b3);}},bX?bX.$0:void 0)},["Render"]);bY=d.TreeReduce(y.Const(),y.Map2Unit,b1);return bT&&bs.length(bT)===1&&(bs.get(bT,0)instanceof bN&&(bB.Equals(bs.get(bT,0).nodeType,bN.ELEMENT_NODE)&&(bZ=bs.get(bT,0),true)))?_.TreeNode(bW,bY):_9.Mk({$:6,$0:bW},bY);};_9.Template=function(bR,bS){return _9.ChildrenTemplate(_9.FakeRoot(bR),bS);};_9.TextView=function(bR){var bS;bS=_8.CreateTextNode();return _9.Mk({$:4,$0:bS},y.Map(function(bT){_8.UpdateTextNode(bS,bT);},bR));};_9.RunReplaceById=function(bR,bS){var bT;bT=q.Doc().getElementById(bR);bB.Equals(bT,null)?bH.FailWith("invalid id: "+bR):bS.ReplaceInDom(bT);};_9.RunById=function(bR,bS){var bT;bT=q.Doc().getElementById(bR);bB.Equals(bT,null)?bH.FailWith("invalid id: "+bR):_9.Run(bT,bS);};_9.Run=function(bR,bS){var bT;bT=bS.docNode;_8.LinkElement(bR,bT);y.Sink(l.StartProcessor(_8.PerformAnimatedUpdate(_8.CreateRunState(bR,bT),bT)),bS.updates);};_9.RunPrependById=function(bR,bS){var bT;bT=q.Doc().getElementById(bR);bB.Equals(bT,null)?bH.FailWith("invalid id: "+bR):_9.RunPrepend(bT,bS);};_9.RunPrepend=function(bR,bS){var bT;bT=window.document.createTextNode("");bR.insertBefore(bT,bR.firstChild);_9.RunBefore(bT,bS);};_9.RunAppendById=function(bR,bS){var bT;bT=q.Doc().getElementById(bR);bB.Equals(bT,null)?bH.FailWith("invalid id: "+bR):_9.RunAppend(bT,bS);};_9.RunAppend=function(bR,bS){var bT;bT=window.document.createTextNode("");bR.appendChild(bT);_9.RunBefore(bT,bS);};_9.RunAfterById=function(bR,bS){var bT;bT=q.Doc().getElementById(bR);bB.Equals(bT,null)?bH.FailWith("invalid id: "+bR):_9.RunAfter(bT,bS);};_9.RunAfter=function(bR,bS){var bT;bT=window.document.createTextNode("");bR.parentNode.insertBefore(bT,bR.nextSibling);_9.RunBetween(bR,bT,bS);};_9.RunBeforeById=function(bR,bS){var bT;bT=q.Doc().getElementById(bR);bB.Equals(bT,null)?bH.FailWith("invalid id: "+bR):_9.RunBefore(bT,bS);};_9.RunBefore=function(bR,bS){var bT;bT=window.document.createTextNode("");bR.parentNode.insertBefore(bT,bR);_9.RunBetween(bT,bR,bS);};_9.RunBetween=function(bR,bS,bT){_8.LinkPrevElement(bS,bT.docNode);y.Sink(l.StartProcessor(_8.PerformAnimatedUpdate(_8.CreateDelimitedRunState(bR,bS,bT.docNode),bT.docNode)),bT.updates);};_9.Async=function(bR){return _9.EmbedView(y.MapAsync(window.id,y.Const(bR)));};_9.BindView=function(bR,bS){return _9.EmbedView(y.Map(bR,bS));};_9.EmbedView=function(bR){var bS;bS=_8.CreateEmbedNode();return _9.Mk({$:2,$0:bS},y.Map(function(){},y.Bind(function(bT){_8.UpdateEmbedNode(bS,bT.docNode);return bT.updates;},bR)));};_9.Static=function(bR){return _.New(bR,Z.EmptyAttr(),_9.Empty());};_9.Mk=function(bR,bS){return new _9.New(bR,bS);};_9.New=bA.Ctor(function(bR,bS){this.docNode=bR;this.updates=bS;},_9);_=c.Elt=bA.Class({AddClass:function(bR){return this.elt.className+=" "+bR;},ClearHoles:function(){var bR;bR=this.docNode$1;bR!=null&&bR.$==6?bR.$0.Holes=[]:void 0;},AddHole:function(bR){var bS;bS=this.docNode$1;bS!=null&&bS.$==6?bS.$0.Holes.push(bR):void 0;},SetStyle:function(bR,bS){this.elt.style[bR]=bS;},HasClass:function(bR){return(new window.RegExp("(\\s|^)"+bR+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(bR){this.elt.className=this.elt.className.replace(new window.RegExp("(?:(\\s|^)"+bR+")+(\\s|$)","g"),"$1");},GetProperty:function(bR){return this.elt[bR];},SetProperty:function(bR,bS){this.elt[bR]=bS;},RemoveAttribute:function(bR){this.elt.removeAttribute(bR);},HasAttribute:function(bR){return this.elt.hasAttribute(bR);},GetAttribute:function(bR){return this.elt.getAttribute(bR);},SetAttribute:function(bR,bS){this.elt.setAttribute(bR,bS);},SetText:function(bR){var bS;bS=this.docNode$1;bS!=null&&bS.$==1?bS.$0.Children=null:bS!=null&&bS.$==6?(bS.$0.Els=[],this.ClearHoles()):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());this.elt.textContent=bR;},GetText:function(){return this.elt.textContent;},SetValue:function(bR){this.elt.value=bR;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var bR;bR=this.docNode$1;bR!=null&&bR.$==1?bR.$0.Children=null:bR!=null&&bR.$==6?(bR.$0.Els=[],this.ClearHoles()):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(bR){var bS,bT,bU,bV,bW;bS=this.docNode$1;bS!=null&&bS.$==1?(bT=bS.$0,bT.Children={$:0,$0:bR.docNode,$1:bT.Children},_8.InsertDoc(this.elt,bR.docNode,(bU=this.elt.firstChild,bB.Equals(bU,null)?null:bU))):bS!=null&&bS.$==6?(bV=this.elt.insertBefore(window.document.createTextNode(""),this.elt.firstChild),bW=_8.InsertBeforeDelim(bV,bR.docNode),this.AddHole(_3.New(Z.Empty(this.elt),bR.docNode,{$:1,$0:[bW,bV]},this.elt,g.Int(),null))):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,bR.updates));},Append:function(bR){var bS,bT,bU,bV;bS=this.docNode$1;bS!=null&&bS.$==1?(bT=bS.$0,bT.Children={$:0,$0:bT.Children,$1:bR.docNode},_8.InsertDoc(this.elt,bR.docNode,null)):bS!=null&&bS.$==6?(bU=this.elt.appendChild(window.document.createTextNode("")),bV=_8.InsertBeforeDelim(bU,bR.docNode),this.AddHole(_3.New(Z.Empty(this.elt),bR.docNode,{$:1,$0:[bV,bU]},this.elt,g.Int(),null))):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,bR.updates));},ToUpdater:function(){var bR,bS;return new $.New((bR=this.docNode$1,bR!=null&&bR.$==1?bA.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,bR.$0.Attr]],Render:(bS=null,bS?bS.$0:void 0)},["Render"]):bR!=null&&bR.$==6?bR.$0:bH.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,w.Create$1([]));},OnAfterRenderView:function(bR,bS){var bT,bU;bT=this;bU=g.Id();this.Append(_9.BindView(function(bV){bT.elt[bU]=bV;return _9.Empty();},bR));return this.OnAfterRender(function(bV){bS(bV,bV[bU]);});},OnAfterRender:function(bR){var bS,bT,bU,bV,bW,bX,bY;bS=this.docNode$1;bS!=null&&bS.$==1?(bT=bS.$0,bA.SetOptional(bT,"Render",(bU=bA.GetOptional(bT.Render),bU!=null&&bU.$==1?(bV=bU.$0,{$:1,$0:function(bZ){bV(bZ);bR(bZ);}}):{$:1,$0:bR}))):bS!=null&&bS.$==6?(bW=bS.$0,bA.SetOptional(bW,"Render",(bX=bA.GetOptional(bW.Render),bX!=null&&bX.$==1?(bY=bX.$0,{$:1,$0:function(bZ){bY(bZ);bR(bZ);}}):{$:1,$0:bR}))):bH.FailWith("Invalid docNode in Elt");return this;},onView:function(bR,bS,bT){var bU;bU=bT(this.elt);this.elt.addEventListener(bR,function(bV){return y.Get(bU(bV),bS);},false);return this;},on:function(bR,bS){this.elt.addEventListener(bR,function(bT){return bS(bT.target,bT);},false);return this;}},_9,_);_.TreeNode=function(bR,bS){var bT,bU,bV;bT=x.Create(bS);return new _.New$1({$:6,$0:bR},y.Map2Unit((bU=bs.map((bV=function(bW){return bW[1];},function(bW){return Z.Updates(bV(bW));}),bR.Attrs),d.TreeReduce(y.Const(),y.Map2Unit,bU)),bT.v),bs.get(bR.Els,0),bT);};_.New=function(bR,bS,bT){var bU,bV;bU=_8.CreateElemNode(bR,bS,bT.docNode);bV=x.Create(bT.updates);return new _.New$1({$:1,$0:bU},y.Map2Unit(Z.Updates(bU.Attr),bV.v),bR,bV);};_.New$1=bA.Ctor(function(bR,bS,bT,bU){_9.New.call(this,bR,bS);this.docNode$1=bR;this.updates$1=bS;this.elt=bT;this.rvUpdates=bU;},_);$=W.EltUpdater=bA.Class({RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;w.Set(this.holeUpdates,[]);},RemoveUpdated:function(bR){var bS,bT,bU;bS=bR.docNode;bS!=null&&bS.$==1?(bT=bS.$0.ElKey,this.treeNode.Holes=bs.filter(function(bV){return bV.ElKey!==bT;},this.treeNode.Holes),w.Set(this.holeUpdates,(bU=function(bV){return bV===bT?false:true;},bs.filter(function(bV){return bU(bV[0]);},this.holeUpdates.c)))):bH.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(bR){var bS,bT,bU;bS=bR.docNode;bS!=null&&bS.$==1?(bT=bS.$0,this.treeNode.Holes=this.treeNode.Holes.concat([bT]),bU=this.holeUpdates.c,bU.push([bT.ElKey,bR.updates]),w.Set(this.holeUpdates,bU)):bH.FailWith("DocUpdater.AddUpdated expects a single element node");},ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];w.Set(this.holeUpdates,[]);},AddHole:function(bR){this.origHoles.push(bR);this.treeNode.Holes=this.treeNode.Holes.concat([bR]);}},_,$);$.New=bA.Ctor(function(bR,bS,bT,bU,bV){var bW,bX,bY,bZ;_.New$1.call(this,{$:6,$0:bR},y.Map2Unit(bS,y.BindInner((bW=(bX=function(b0){return b0[1];},function(b0){return bs.map(bX,b0);}),(bY=(bZ=y.Const(),function(b0){return d.TreeReduce(bZ,y.Map2Unit,b0);}),function(b0){return bY(bW(b0));})),bV.v)),bT,bU);this.treeNode=bR;this.holeUpdates=bV;this.origHoles=this.treeNode.Holes;},$);ba.$cctor=bA.Cctor(function(){ba.LoadedTemplates=new bK.New$5();ba.TextHoleRE="\\${([^}]+)}";ba.$cctor=window.ignore;});bb=c.Flow=bA.Class({get_Render:function(){return this.render;}},null,bb);bb.New=bA.Ctor(function(bR){bb.New$1.call(this,function(bS){return function(bT){return w.Set(bS,bR(bT));};});},bb);bb.New$1=bA.Ctor(function(bR){this.render=bR;},bb);bb.get_Do=function(){return new bc.New();};bb.Static=function(bR){return new bb.New$1(function(bS){return function(bT){w.Set(bS,bR);return bT();};});};bb.Define=function(bR){return new bb.New(function(bS){return bR(function(bT){bS(bT);});});};bb.Embed=function(bR){var bS;bS=w.Create$1(_9.Empty());((bR.get_Render())(bS))(function(bT){});return _9.EmbedView(bS.v);};bb.Return=function(bR){return new bb.New$1(function(){return function(bS){return bS(bR);};});};bb.Bind=function(bR,bS){return new bb.New$1(function(bT){return function(bU){return((bR.get_Render())(bT))(function(bV){((bS(bV).get_Render())(bT))(bU);});};});};bb.Map=function(bR,bS){return new bb.New$1(function(bT){return function(bU){return((bS.get_Render())(bT))(function(bV){bU(bR(bV));});};});};bc=c.FlowBuilder=bA.Class({ReturnFrom:window.id,Return:function(bR){return bb.Return(bR);},Bind:function(bR,bS){return bb.Bind(bR,bS);}},null,bc);bc.New=bA.Ctor(function(){},bc);be=bd.attr=bA.Class({},null,be);be.New=bA.Ctor(function(){},be);bf.Append=function(bR,bS){return{$:0,$0:o.Append(bR.$0,bS.$0),$1:bE.FoldBack(function(bT,bU,bV){return bV.Add(bT,bU);},bR.$1,bS.$1)};};bf.FromList=function(bR,bS){return{$:0,$0:o.FromArray(bs.ofList(bR)),$1:bS};};bf.ToList=function(bR){return[br.ofArray(o.ToArray(bR.$0)),bR.$1];};bf.SameHash=function(bR,bS){return bf.NoHash(bR)===bf.NoHash(bS);};bf.MakeHash=function(bR){var bS,bT;bS=bR.$1;bT=bu.concat("/",bs.map(function(bU){return window.encodeURIComponent(bU);},o.ToArray(bR.$0)));return bS.get_IsEmpty()?bT:bT+"?"+bu.concat("&",by.map(function(bU){var bV;bV=bH.KeyValue(bU);return window.encodeURIComponent(bV[0])+"="+window.encodeURIComponent(bV[1]);},bS));};bf.ParseHash=function(bR){var bS,bT,bU,bV;bS=bf.NoHash(bR);bT=(bU=bS.indexOf(bQ.fromCharCode(63)),bU===-1?[bS,""]:[bP.string(bS,null,{$:1,$0:bU-1}),bP.string(bS,{$:1,$0:bU+1},null)]);bV=bT[0];return{$:0,$0:o.FromArray(bV===""?[]:bs.map(function(bW){return window.decodeURIComponent(bW);},bu.SplitChars(bV,[47],0))),$1:bE.OfArray(bs.map(function(bW){var bX;bX=bW.indexOf(bQ.fromCharCode(61));return bX===-1?[window.decodeURIComponent(bW),""]:[window.decodeURIComponent(bP.string(bW,null,{$:1,$0:bX-1})),window.decodeURIComponent(bP.string(bW,{$:1,$0:bX+1},null))];},bu.SplitChars(bT[1],[38],0)))};};bf.NoHash=function(bR){return bu.StartsWith(bR,"#")?bR.substring(1):bR;};bh.New=function(bR,bS,bT,bU){return{Bodies:bR,CurrentRoute:bS,CurrentSite:bT,Selection:bU};};bg.Install=function(bR,bS){var bT,bU,bV,bW,bX,bY,bZ,b0,b1;function b2(b3){var b4;b4=bY(b3);b4.$==1?void 0:bg.OnGlobalRouteChange(bV,b4.$0,bf.FromList(b4.$1,new bF.New([])));}bT=bS.$0;bU=bg.InstallMap({Des:function(b3){return bf.FromList(b3[0],b3[1]);},Ser:bf.ToList});bV=bh.New(void 0,bU,0,void 0);bW=(bX=function(b3,b4){var b5;b5=b4.$0;return b4.$1({UpdateRoute:function(b6){bg.OnInternalSiteUpdate(bV,b5,b3,b6);}});},s.Map(function(b3){return function(b4){return bX(b3,b4);};},bS.$1));bV.Bodies=bg.ComputeBodies(bW);bY=function(b3){return s.Lookup(bW,(bf.ToList(b3))[0]);};bZ=(b0=bY(bU.c),b0.$==0?(b1=b0.$0,(bV.CurrentSite=b1.RouteId,w.Create$1(b1.RouteValue))):w.Create$1(bT!=null&&bT.$==1?bT.$0:bH.FailWith("Site.Install fails on empty site")));bV.Selection=bZ;y.Sink(function(b3){bg.OnSelectSite(bV,bR(b3));},bZ.v);b2(bU.c);y.Sink(b2,bU.v);return bZ;};bg.OnSelectSite=function(bR,bS){var bT;bT=bS.$0;bR.CurrentSite!==bT?(bR.CurrentSite=bT,bR.Bodies.get_Item(bT).OnSelect()):void 0;};bg.OnInternalSiteUpdate=function(bR,bS,bT,bU){if(bR.CurrentSite===bS)bg.SetCurrentRoute(bR,bf.Append(bf.FromList(bT,new bF.New([])),bU));};bg.OnGlobalRouteChange=function(bR,bS,bT){bR.CurrentSite!==bS.RouteId?(bR.CurrentSite=bS.RouteId,w.Set(bR.Selection,bS.RouteValue)):void 0;bS.OnRouteChanged(bT);};bg.SetCurrentRoute=function(bR,bS){if(!bB.Equals(bR.CurrentRoute.c,bS))w.Set(bR.CurrentRoute,bS);};bg.ComputeBodies=function(bR){var bS;bS=new bK.New$5();bs.iter(function(bT){bS.set_Item(bT.RouteId,bT);},s.ToArray(bR));return bS;};bg.MergeRouters=function(bR){var bS,bT,bU;bS=d.ofSeqNonCopying(bR);bT=s.Merge(by.map(function(bV){return bV.$1;},bS));bU=by.tryPick(function(bV){return bV.$0;},bS);return bT!=null&&bT.$==1?{$:0,$0:bU,$1:bT.$0}:bH.FailWith("Invalid Site.Merge: need more prefix disambiguation");};bg.DefineRoute=function(bR,bS,bT){var bU,bV,bW;bU=w.Create$1(bS);bV=g.Int();bW=bT({$:0,$0:bV},bU);return{$:0,$0:{$:1,$0:bW},$1:s.Leaf({$:0,$0:bV,$1:function(bX){y.Sink(function(bY){bX.UpdateRoute(bg.DoLink(bR,bY));},bU.v);return{OnRouteChanged:function(bY){w.Set(bU,bg.DoRoute(bR,bY));},OnSelect:function(){bX.UpdateRoute(bg.DoLink(bR,bU.c));},RouteId:bV,RouteValue:bW};}})};};bg.DoLink=function(bR,bS){var bT;bT=bR.Ser(bS);return bf.FromList(bT[0],bT[1]);};bg.DoRoute=function(bR,bS){return bR.Des(bf.ToList(bS));};bg.InstallMap=function(bR){var bS,bT,bU,bV;function bW(bX){return bV(bT());}bS=function(bX,bY){return bB.Equals(bR.Ser(bX),bR.Ser(bY));};bT=function(){return bR.Des(bf.ToList(bf.ParseHash(window.location.hash)));};bU=w.Create$1(bT());bV=function(bX){if(!bS(bU.c,bX))w.Set(bU,bX);};window.onpopstate=bW;window.onhashchange=bW;y.Sink(function(bX){var bY,bZ;bY=bf.MakeHash((bZ=bR.Ser(bX),bf.FromList(bZ[0],bZ[1])));!bf.SameHash(window.location.hash,bY)?window.location.replace("#"+bY):void 0;},bU.v);return bU;};bi.Install=function(bR){return bg.InstallMap(bR);};bi.Create=function(bR,bS){var bT;return{Des:(bT=function(bU){return bU[0];},function(bU){return bS(bT(bU));}),Ser:function(bU){return[bR(bU),new bF.New([])];}};};bi.CreateWithQuery=function(bR,bS){return{Des:bS,Ser:bR};};bj.Route=function(bR,bS,bT){return bg.DefineRoute(bR,bS,bT);};bj.Prefix=function(bR,bS){return{$:0,$0:bS.$0,$1:s.Prefix(bR,bS.$1)};};bj.Merge=function(bR){return bg.MergeRouters(bR);};bj.Install=function(bR,bS){return bg.Install(bR,bS);};bj.Dir=function(bR,bS){return bj.Prefix(bR,bj.Merge(bS));};bl.New=function(bR,bS){return{Active:bR,PosV:bS};};bm.New=function(bR,bS,bT,bU){return{Active:bR,Left:bS,Middle:bT,Right:bU};};bn.get_MousePressed=function(){bk.ActivateButtonListener();return y.Apply(y.Apply(y.Apply(y.Const(bA.Curried3(function(bR,bS,bT){return bR||bS||bT;})),bk.MouseBtnSt$1().Left.v),bk.MouseBtnSt$1().Middle.v),bk.MouseBtnSt$1().Right.v);};bn.get_RightPressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Right.v;};bn.get_MiddlePressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Middle.v;};bn.get_LeftPressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Left.v;};bn.get_Position=function(){!bk.MousePosSt$1().Active?(window.document.addEventListener("mousemove",function(bR){w.Set(bk.MousePosSt$1().PosV,[bR.clientX,bR.clientY]);},false),bk.MousePosSt$1().Active=true):void 0;return bk.MousePosSt$1().PosV.v;};bo.New=function(bR,bS,bT){return{KeysPressed:bR,KeyListenerActive:bS,LastPressed:bT};};bp.IsPressed=function(bR){var bS;bk.ActivateKeyListener();return y.Map((bS=function(bT){return bT===bR;},function(bT){return br.exists(bS,bT);}),bk.KeyListenerState().KeysPressed.v);};bp.get_LastPressed=function(){bk.ActivateKeyListener();return bk.KeyListenerState().LastPressed.v;};bp.get_KeysPressed=function(){bk.ActivateKeyListener();return bk.KeyListenerState().KeysPressed.v;};bk.ActivateKeyListener=function(){bq.$cctor();return bq.ActivateKeyListener;};bk.KeyListenerState=function(){bq.$cctor();return bq.KeyListenerState;};bk.ActivateButtonListener=function(){bq.$cctor();return bq.ActivateButtonListener;};bk.MouseBtnSt$1=function(){bq.$cctor();return bq.MouseBtnSt;};bk.MousePosSt$1=function(){bq.$cctor();return bq.MousePosSt;};bq.$cctor=bA.Cctor(function(){var bR;bq.MousePosSt=bl.New(false,w.Create$1([0,0]));bq.MouseBtnSt=bm.New(false,w.Create$1(false),w.Create$1(false),w.Create$1(false));bq.ActivateButtonListener=(bR=function(bS,bT){var bU;bU=bS.button;return bU===0?w.Set(bk.MouseBtnSt$1().Left,bT):bU===1?w.Set(bk.MouseBtnSt$1().Middle,bT):bU===2?w.Set(bk.MouseBtnSt$1().Right,bT):null;},!bk.MouseBtnSt$1().Active?(bk.MouseBtnSt$1().Active=true,window.document.addEventListener("mousedown",function(bS){return bR(bS,true);},false),window.document.addEventListener("mouseup",function(bS){return bR(bS,false);},false)):null);bq.KeyListenerState=bo.New(w.Create$1(br.T.Empty),false,w.Create$1(-1));bq.ActivateKeyListener=!bk.KeyListenerState().KeyListenerActive?(bO(window.document).keydown(function(bS){var bT,bU;bT=bS.which;w.Set(bk.KeyListenerState().LastPressed,bT);bU=bk.KeyListenerState().KeysPressed.c;return!br.exists(function(bV){return bV===bT;},bU)?w.Set(bk.KeyListenerState().KeysPressed,br.append(bU,br.ofArray([bT]))):null;}),void bO(window.document).keyup(function(bS){var bT,bU;bT=bS.which;return w.Update(bk.KeyListenerState().KeysPressed,(bU=function(bV){return bV!==bT;},function(bV){return br.filter(bU,bV);}));})):null;bq.$cctor=window.ignore;});}());
