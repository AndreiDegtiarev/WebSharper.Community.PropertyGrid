(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR;a=window;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Next=c.Next||{};e=d.Array=d.Array||{};f=d.String=d.String||{};g=d.Abbrev=d.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=g.Slot=g.Slot||{};l=g.Async=g.Async||{};m=g.Mailbox=g.Mailbox||{};n=m.MailboxState=m.MailboxState||{};o=a.StartupCode$WebSharper_UI_Next$Abbrev=a.StartupCode$WebSharper_UI_Next$Abbrev||{};p=d.AppendList=d.AppendList||{};q=a.StartupCode$WebSharper_UI_Next$AppendList=a.StartupCode$WebSharper_UI_Next$AppendList||{};r=d.DomUtility=d.DomUtility||{};s=a.StartupCode$WebSharper_UI_Next$DomUtility=a.StartupCode$WebSharper_UI_Next$DomUtility||{};t=d.Trie=d.Trie||{};u=t.LookupResult=t.LookupResult||{};v=a.StartupCode$WebSharper_UI_Next$Trie=a.StartupCode$WebSharper_UI_Next$Trie||{};w=d.Snap=d.Snap||{};x=d.Var=d.Var||{};y=d.Updates=d.Updates||{};z=d.View=d.View||{};A=d.ViewBuilder=d.ViewBuilder||{};B=d.Submitter=d.Submitter||{};C=d.Key=d.Key||{};D=d.Model=d.Model||{};E=d.Serializer=d.Serializer||{};F=d.Storage=d.Storage||{};G=F.ArrayStorage=F.ArrayStorage||{};H=F.LocalStorageBackend=F.LocalStorageBackend||{};I=d.ListModel=d.ListModel||{};J=d.ListModels=d.ListModels||{};K=a.StartupCode$WebSharper_UI_Next$Models=a.StartupCode$WebSharper_UI_Next$Models||{};L=d.ReactiveExtensions=d.ReactiveExtensions||{};M=d.DoubleInterpolation=d.DoubleInterpolation||{};N=d.Interpolation=d.Interpolation||{};O=d.Easing=d.Easing||{};P=d.Easings=d.Easings||{};Q=d.An=d.An||{};R=d.Anims=d.Anims||{};S=d.Trans=d.Trans||{};T=a.StartupCode$WebSharper_UI_Next$Animation=a.StartupCode$WebSharper_UI_Next$Animation||{};U=d.AnimatedAttrNode=d.AnimatedAttrNode||{};V=d.DynamicAttrNode=d.DynamicAttrNode||{};W=d.AttrProxy=d.AttrProxy||{};X=d.Client=d.Client||{};Y=X.Attrs=X.Attrs||{};Z=Y.Dyn=Y.Dyn||{};_0=d.Attrs=d.Attrs||{};_1=d.CheckedInput=d.CheckedInput||{};_2=d.AttrModule=d.AttrModule||{};_3=a.StartupCode$WebSharper_UI_Next$Attr_Client=a.StartupCode$WebSharper_UI_Next$Attr_Client||{};_4=d.DocElemNode=d.DocElemNode||{};_5=X.Docs=X.Docs||{};_6=_5.DomNodes=_5.DomNodes||{};_7=_5.NodeSet=_5.NodeSet||{};_8=_5.RunState=_5.RunState||{};_9=d.Docs=d.Docs||{};_=d.Doc=d.Doc||{};$=d.Elt=d.Elt||{};ba=X.EltUpdater=X.EltUpdater||{};bb=a.StartupCode$WebSharper_UI_Next$Doc_Client=a.StartupCode$WebSharper_UI_Next$Doc_Client||{};bc=d.Flow=d.Flow||{};bd=d.FlowBuilder=d.FlowBuilder||{};be=d.Html=d.Html||{};bf=be.attr=be.attr||{};bg=d.Route=d.Route||{};bh=d.Routing=d.Routing||{};bi=bh.State=bh.State||{};bj=d.RouteMap=d.RouteMap||{};bk=d.Router=d.Router||{};bl=d.Input=d.Input||{};bm=bl.MousePosSt=bl.MousePosSt||{};bn=bl.MouseBtnSt=bl.MouseBtnSt||{};bo=bl.Mouse=bl.Mouse||{};bp=bl.KeyListenerSt=bl.KeyListenerSt||{};bq=bl.Keyboard=bl.Keyboard||{};br=a.StartupCode$WebSharper_UI_Next$Input=a.StartupCode$WebSharper_UI_Next$Input||{};bs=b&&b.List;bt=b&&b.Arrays;bu=b&&b.Enumerator;bv=b&&b.Strings;bw=b&&b.Char;bx=b&&b.Collections;by=bx&&bx.HashSet;bz=b&&b.Seq;bA=a.IntelliFactory;bB=bA&&bA.Runtime;bC=b&&b.Unchecked;bD=a.console;bE=b&&b.Concurrency;bF=bx&&bx.Map;bG=bx&&bx.FSharpMap;bH=bx&&bx.List;bI=b&&b.Operators;bJ=b&&b.Queue;bK=b&&b.Lazy;bL=bx&&bx.Dictionary;bM=a.JSON;bN=b&&b.Numeric;bO=a.Node;bP=a.jQuery;bQ=b&&b.Slice;bR=a.String;e.mapInPlace=function(bS,bT){var bU,bV;for(bU=0,bV=bT.length-1;bU<=bV;bU++)bT[bU]=bS(bT[bU]);return bT;};e.ofSeqNonCopying=function(bS){var bT,bU;if(bS instanceof a.Array)return bS;else if(bS instanceof bs.T)return bt.ofList(bS);else if(bS===null)return[];else{bT=[];bU=bu.Get(bS);try{while(bU.MoveNext())bT.push(bU.Current());return bT;}finally{if("Dispose"in bU)bU.Dispose();}}};e.MapTreeReduce=function(bS,bT,bU,bV){var bW;function bX(bY,bZ){var b0,b1;return bZ<=0?bT:bZ===1&&(bY>=0&&bY<bW&&true)?bS(bt.get(bV,bY)):(b1=bZ/2>>0,bU(bX(bY,b1),bX(bY+b1,bZ-b1)));}bW=bt.length(bV);return bX(0,bW);};e.TreeReduce=function(bS,bT,bU){var bV;function bW(bX,bY){var bZ,b0;return bY<=0?bS:bY===1&&(bX>=0&&bX<bV&&true)?bt.get(bU,bX):(b0=bY/2>>0,bT(bW(bX,b0),bW(bX+b0,bY-b0)));}bV=bt.length(bU);return bW(0,bV);};f.isBlank=function(bS){return bv.forall(bw.IsWhiteSpace,bS);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){o.$cctor();return o.counter;};h.set_counter=function(bS){o.$cctor();o.counter=bS;};i.Filter=function(bS,bT){return new by.New$2(bt.filter(bS,i.ToArray(bT)));};i.Intersect=function(bS,bT){var bU;bU=new by.New$2(i.ToArray(bS));bU.IntersectWith(i.ToArray(bT));return bU;};i.Except=function(bS,bT){var bU;bU=new by.New$2(i.ToArray(bT));bU.ExceptWith(i.ToArray(bS));return bU;};i.ToArray=function(bS){var bT;bT=bt.create(bS.get_Count(),void 0);bS.CopyTo(bT);return bT;};j.ToValueArray=function(bS){var bT;bT=bt.create(bS.count,void 0);bz.iteri(function(bU,bV){return bt.set(bT,bU,bV.V);},bS);return bT;};j.ToKeyArray=function(bS){var bT;bT=bt.create(bS.count,void 0);bz.iteri(function(bU,bV){return bt.set(bT,bU,bV.K);},bS);return bT;};k=g.Slot=bB.Class({GetHashCode:function(){return bC.Hash(this.key(this.value));},Equals:function(bS){return bC.Equals(this.key(this.value),this.key(bS.get_Value()));},get_Value:function(){return this.value;}},null,k);k.New=bB.Ctor(function(bS,bT){this.key=bS;this.value=bT;},k);k.Create=function(bS,bT){return new k.New(bS,bT);};l.OnError=function(bS){return bD.log("WebSharper UI.Next: Uncaught asynchronous exception",bS);};l.StartTo=function(bS,bT){bE.StartWithContinuations(bS,bT,function(bU){l.OnError(bU);},a.ignore,null);};n=m.MailboxState=bB.Class({},null,n);m.StartProcessor=function(bS){var bT;function bU(){var bV;bV=null;return bE.Delay(function(){return bE.Bind(bS,function(){var bW;bW=bT[0];return bC.Equals(bW,1)?(bT[0]=0,bE.Zero()):bC.Equals(bW,2)?(bT[0]=1,bU()):bE.Zero();});});}bT=[0];return function(){var bV;bV=bT[0];bC.Equals(bV,0)?(bT[0]=1,bE.Start(bU(),null)):bC.Equals(bV,1)?bT[0]=2:void 0;};};o.$cctor=bB.Cctor(function(){o.counter=0;o.$cctor=a.ignore;});p.FromArray=function(bS){var bT;bT=bS.length;return bT===0?{$:0}:bT===1?{$:1,$0:bt.get(bS,0)}:{$:3,$0:bS.slice()};};p.ToArray=function(bS){var bT;function bU(bV){if(bV.$==1)bT.push(bV.$0);else if(bV.$==2){bU(bV.$0);bU(bV.$1);}else if(bV.$==3)bt.iter(function(bW){bT.push(bW);},bV.$0);}bT=[];bU(bS);return bT.slice(0);};p.Single=function(bS){return{$:1,$0:bS};};p.Concat=function(bS){var bT;bT=e.ofSeqNonCopying(bS);return e.TreeReduce(p.Empty(),p.Append,bT);};p.Append=function(bS,bT){return bS.$==0?bT:bT.$==0?bS:{$:2,$0:bS,$1:bT};};p.Empty=function(){q.$cctor();return q.Empty;};q.$cctor=bB.Cctor(function(){q.Empty={$:0};q.$cctor=a.ignore;});r.SetProperty=function(bS,bT,bU){return bS.setProperty(bT,bU);};r.IterSelector=function(bS,bT,bU){var bV,bW,bX;bV=bS.querySelectorAll(bT);for(bW=0,bX=bV.length-1;bW<=bX;bW++)bU(bV[bW]);};r.ChildrenArray=function(bS){var bT,bU,bV;bT=[];for(bU=0,bV=bS.childNodes.length-1;bU<=bV;bU++)bT.push(bS.childNodes[bU]);return bT;};r.RemoveClass=function(bS,bT){a.jQuery(bS).removeClass(bT);};r.AddClass=function(bS,bT){a.jQuery(bS).addClass(bT);};r.InsertAt=function(bS,bT,bU){var bV;if(!(bU.parentNode===bS&&bT===(bV=bU.nextSibling,bC.Equals(bV,null)?null:bV)))bS.insertBefore(bU,bT);};r.RemoveNode=function(bS,bT){if(bT.parentNode===bS)bS.removeChild(bT);};r.SetStyle=function(bS,bT,bU){r.SetProperty(bS.style,bT,bU);};r.SetAttr=function(bS,bT,bU){bS.setAttribute(bT,bU);};r.RemoveAttr=function(bS,bT){bS.removeAttribute(bT);};r.CreateAttr=function(bS,bT){var bU;bU=r.Doc().createAttribute(bS);bU.value=bT;return bU;};r.CreateText=function(bS){return r.Doc().createTextNode(bS);};r.CreateSvgElement=function(bS){return r.Doc().createElementNS("http://www.w3.org/2000/svg",bS);};r.CreateElement=function(bS){return r.Doc().createElement(bS);};r.Clear=function(bS){while(bS.hasChildNodes())bS.removeChild(bS.firstChild);};r.ClearAttrs=function(bS){while(bS.hasAttributes())bS.removeAttributeNode(bS.attributes.item(0));};r.AppendTo=function(bS,bT){bS.appendChild(bT);};r.Doc=function(){s.$cctor();return s.Doc;};s.$cctor=bB.Cctor(function(){s.Doc=a.document;s.$cctor=a.ignore;});u.NotFound={$:1};t.Empty=function(){v.$cctor();return v.Empty;};t.Lookup=function(bS,bT){return t.Look(bs.ofSeq(bT),bS);};t.Look=function(bS,bT){var bU,bV;switch(bT.$==2?(bU=bT.$0,0):bT.$==0?bS.$==1?(bU=[bS.$0,bS.$1,bT.$0],1):2:2){case 0:return{$:0,$0:bU,$1:bS};break;case 1:bV=bF.TryFind(bU[0],bU[2]);return bV==null?u.NotFound:t.Look(bU[1],bV.$0);break;case 2:return u.NotFound;break;}};t.ToArray=function(bS){var bT;bT=[];t.Map(function(){return function(bU){return bT.push(bU);};},bS);return bT.slice(0);};t.Mapi=function(bS,bT){var bU;function bV(){var bW;bW=bU[0];bU[0]=bW+1;return bW;}bU=[0];return t.Map(function(bW){return bS(bV(),bW);},bT);};t.Map=function(bS,bT){return t.MapLoop(bs.T.Empty,bS,bT);};t.MapLoop=function(bS,bT,bU){return bU.$==1?{$:1}:bU.$==2?{$:2,$0:(bT(bS))(bU.$0)}:t.TrieBranch(bF.Map(function(bV,bW){return t.MapLoop(bs.append(bS,bs.ofArray([bV])),bT,bW);},bU.$0));};t.Merge=function(bS){var bT,bU,bV;bT=e.ofSeqNonCopying(bS);bU=bt.length(bT);return bU===0?{$:1,$0:{$:1}}:bU===1?{$:1,$0:bt.get(bT,0)}:bt.exists(t.IsLeaf,bT)?null:(bV=t.MergeMaps(t.Merge,bz.choose(function(bW){return bW.$==0?{$:1,$0:bW.$0}:null;},bT)),bV==null?null:{$:1,$0:t.TrieBranch(bV.$0)});};t.IsLeaf=function(bS){return bS.$==2&&true;};t.MergeMaps=function(bS,bT){var bU;function bV(bW,bX){var bY;bY=bS(bX);return bY==null?null:{$:1,$0:[bW,bY.$0]};}bU=t.AllSome(bz.map(function(bW){return bV(bW[0],bW[1]);},bF.ToSeq(bz.fold(function(bW,bX){return t.MultiAdd(bX[0],bX[1],bW);},new bG.New([]),bz.collect(bF.ToSeq,bT)))));return bU==null?null:{$:1,$0:bF.OfArray(bt.ofSeq(bU.$0))};};t.AllSome=function(bS){var bT,bU,bV,bW;bU=bu.Get(bS);bV=new bH.New$2();bT=true;while(bT&&bU.MoveNext()){bW=bU.Current();bW!=null&&bW.$==1?bV.Add(bW.$0):bT=false;}return bT?{$:1,$0:bV.ToArray()}:null;};t.MultiAdd=function(bS,bT,bU){return bU.Add(bS,new bs.T({$:1,$0:bT,$1:t.MultiFind(bS,bU)}));};t.MultiFind=function(bS,bT){var bU;bU=bF.TryFind(bS,bT);return bU==null?bs.T.Empty:bU.$0;};t.Prefix=function(bS,bT){return t.TrieBranch(new bG.New(bs.ofArray([[bS,bT]])));};t.Leaf=function(bS){return{$:2,$0:bS};};t.TrieBranch=function(bS){return bS.get_IsEmpty()?{$:1}:{$:0,$0:bS};};v.$cctor=bB.Cctor(function(){v.Empty={$:1};v.$cctor=a.ignore;});w.Obsolete=function(bS){var bT,bU,bV,bW,bX;bU=bS.s;if(bU==null||(bU!=null&&bU.$==2?(bT=bU.$1,false):bU!=null&&bU.$==3?(bT=bU.$1,false):true))void 0;else{bS.s=null;for(bV=0,bW=bt.length(bT)-1;bV<=bW;bV++){bX=bt.get(bT,bV);typeof bX=="object"?function(bY){w.Obsolete(bY);}(bX):bX();}}};w.New=function(bS){return{s:bS};};w.MapAsync=function(bS,bT){var bU;bU=w.New({$:3,$0:[],$1:[]});w.When(bT,function(bV){l.StartTo(bS(bV),function(bW){w.MarkDone(bU,bT,bW);});},bU);return bU;};w.SnapshotOn=function(bS,bT){var bU;function bV(bW){var bX,bY,bZ;if(!(bX=bU.s,bX!=null&&bX.$==0||bX!=null&&bX.$==2&&true)){bY=w.ValueAndForever(bS);bZ=w.ValueAndForever(bT);bY!=null&&bY.$==1?bZ!=null&&bZ.$==1?bY.$0[1]||bZ.$0[1]?w.MarkForever(bU,bZ.$0[0]):w.MarkReady(bU,bZ.$0[0]):void 0:void 0;}}bU=w.New({$:3,$0:[],$1:[]});w.When(bS,bV,bU);w.WhenReady(bT,bV);return bU;};w.Map3=function(bS,bT,bU,bV){var bW,bX,bY,bZ;function b0(b1){var b2,b3,b4,b5;if(!(b2=bZ.s,b2!=null&&b2.$==0||b2!=null&&b2.$==2&&true)){b3=w.ValueAndForever(bT);b4=w.ValueAndForever(bU);b5=w.ValueAndForever(bV);b3!=null&&b3.$==1?b4!=null&&b4.$==1?b5!=null&&b5.$==1?b3.$0[1]&&b4.$0[1]&&b5.$0[1]?w.MarkForever(bZ,bS(b3.$0[0],b4.$0[0],b5.$0[0])):w.MarkReady(bZ,bS(b3.$0[0],b4.$0[0],b5.$0[0])):void 0:void 0:void 0;}}bW=bT.s;bX=bU.s;bY=bV.s;return bW!=null&&bW.$==0?bX!=null&&bX.$==0?bY!=null&&bY.$==0?w.New({$:0,$0:bS(bW.$0,bX.$0,bY.$0)}):w.Map3Opt1(bS,bW.$0,bX.$0,bV):bY!=null&&bY.$==0?w.Map3Opt2(bS,bW.$0,bY.$0,bU):w.Map3Opt3(bS,bW.$0,bU,bV):bX!=null&&bX.$==0?bY!=null&&bY.$==0?w.Map3Opt4(bS,bX.$0,bY.$0,bT):w.Map3Opt5(bS,bX.$0,bT,bV):bY!=null&&bY.$==0?w.Map3Opt6(bS,bY.$0,bT,bU):(bZ=w.New({$:3,$0:[],$1:[]}),(w.When(bT,b0,bZ),w.When(bU,b0,bZ),w.When(bV,b0,bZ),bZ));};w.Map3Opt6=function(bS,bT,bU,bV){return w.Map2(function(bW,bX){return bS(bW,bX,bT);},bU,bV);};w.Map3Opt5=function(bS,bT,bU,bV){return w.Map2(function(bW,bX){return bS(bW,bT,bX);},bU,bV);};w.Map3Opt4=function(bS,bT,bU,bV){return w.Map(function(bW){return bS(bW,bT,bU);},bV);};w.Map3Opt3=function(bS,bT,bU,bV){return w.Map2(function(bW,bX){return bS(bT,bW,bX);},bU,bV);};w.Map3Opt2=function(bS,bT,bU,bV){return w.Map(function(bW){return bS(bT,bW,bU);},bV);};w.Map3Opt1=function(bS,bT,bU,bV){return w.Map(function(bW){return bS(bT,bU,bW);},bV);};w.Map2Unit=function(bS,bT){var bU,bV,bW;function bX(){var bY,bZ,b0;if(!(bY=bW.s,bY!=null&&bY.$==0||bY!=null&&bY.$==2&&true)){bZ=w.ValueAndForever(bS);b0=w.ValueAndForever(bT);bZ!=null&&bZ.$==1?b0!=null&&b0.$==1?bZ.$0[1]&&b0.$0[1]?w.MarkForever(bW,null):w.MarkReady(bW,null):void 0:void 0;}}bU=bS.s;bV=bT.s;return bU!=null&&bU.$==0?bV!=null&&bV.$==0?w.New({$:0,$0:null}):bT:bV!=null&&bV.$==0?bS:(bW=w.New({$:3,$0:[],$1:[]}),(w.When(bS,bX,bW),w.When(bT,bX,bW),bW));};w.Map2=function(bS,bT,bU){var bV,bW,bX;function bY(bZ){var b0,b1,b2;if(!(b0=bX.s,b0!=null&&b0.$==0||b0!=null&&b0.$==2&&true)){b1=w.ValueAndForever(bT);b2=w.ValueAndForever(bU);b1!=null&&b1.$==1?b2!=null&&b2.$==1?b1.$0[1]&&b2.$0[1]?w.MarkForever(bX,bS(b1.$0[0],b2.$0[0])):w.MarkReady(bX,bS(b1.$0[0],b2.$0[0])):void 0:void 0;}}bV=bT.s;bW=bU.s;return bV!=null&&bV.$==0?bW!=null&&bW.$==0?w.New({$:0,$0:bS(bV.$0,bW.$0)}):w.Map2Opt1(bS,bV.$0,bU):bW!=null&&bW.$==0?w.Map2Opt2(bS,bW.$0,bT):(bX=w.New({$:3,$0:[],$1:[]}),(w.When(bT,bY,bX),w.When(bU,bY,bX),bX));};w.Map2Opt2=function(bS,bT,bU){return w.Map(function(bV){return bS(bV,bT);},bU);};w.Map2Opt1=function(bS,bT,bU){return w.Map(function(bV){return bS(bT,bV);},bU);};w.MapCachedBy=function(bS,bT,bU,bV){return w.Map(function(bW){var bX,bY,bZ;bX=bT[0];return bX!=null&&bX.$==1&&(bS(bW,bX.$0[0])&&(bY=[bX.$0[0],bX.$0[1]],true))?bY[1]:(bZ=bU(bW),(bT[0]={$:1,$0:[bW,bZ]},bZ));},bV);};w.Copy=function(bS){var bT,bU,bV;bT=bS.s;return bT==null?bS:bT!=null&&bT.$==2?(bU=w.New({$:2,$0:bT.$0,$1:[]}),(w.WhenObsolete(bS,bU),bU)):bT!=null&&bT.$==3?(bV=w.New({$:3,$0:[],$1:[]}),(w.When(bS,function(bW){w.MarkDone(bV,bS,bW);},bV),bV)):bS;};w.Map=function(bS,bT){var bU,bV;bU=bT.s;return bU!=null&&bU.$==0?w.New({$:0,$0:bS(bU.$0)}):(bV=w.New({$:3,$0:[],$1:[]}),(w.When(bT,function(bW){w.MarkDone(bV,bT,bS(bW));},bV),bV));};w.Sequence=function(bS){var bT,bU,bV;function bW(bX){var bY;if(bV[0]===0){bY=bt.map(function(bZ){var b0;b0=bZ.s;return b0!=null&&b0.$==0?b0.$0:b0!=null&&b0.$==2?b0.$0:bI.FailWith("value not found by View.Sequence");},bT);bt.forall(function(bZ){var b0;return(b0=bZ.s,b0!=null&&b0.$==0)&&true;},bT)?w.MarkForever(bU,bY):w.MarkReady(bU,bY);}else bV[0]--;}bT=bt.ofSeq(bS);return bT.length==0?w.New({$:0,$0:[]}):(bU=w.New({$:3,$0:[],$1:[]}),(bV=[bt.length(bT)-1],(bt.iter(function(bX){w.When(bX,bW,bU);},bT),bU)));};w.CreateForeverAsync=function(bS){var bT;bT=w.New({$:3,$0:[],$1:[]});l.StartTo(bS,function(bU){w.MarkForever(bT,bU);});return bT;};w.JoinInner=function(bS){var bT;bT=w.New({$:3,$0:[],$1:[]});w.When(bS,function(bU){var bV;bV=bU();w.When(bV,function(bW){var bX,bY;if((bX=bV.s,bX!=null&&bX.$==0)&&true&&((bY=bS.s,bY!=null&&bY.$==0)&&true))w.MarkForever(bT,bW);else w.MarkReady(bT,bW);},bT);w.WhenObsolete(bS,bV);},bT);return bT;};w.Join=function(bS){var bT;bT=w.New({$:3,$0:[],$1:[]});w.When(bS,function(bU){var bV;bV=bU();w.When(bV,function(bW){var bX,bY;if((bX=bV.s,bX!=null&&bX.$==0)&&true&&((bY=bS.s,bY!=null&&bY.$==0)&&true))w.MarkForever(bT,bW);else w.MarkReady(bT,bW);},bT);},bT);return bT;};w.ValueAndForever=function(bS){var bT;bT=bS.s;return bT!=null&&bT.$==0?{$:1,$0:[bT.$0,true]}:bT!=null&&bT.$==2?{$:1,$0:[bT.$0,false]}:null;};w.WhenObsoleteRun=function(bS,bT){var bU;bU=bS.s;bU==null?bT():bU!=null&&bU.$==2?bU.$1.push(bT):bU!=null&&bU.$==3?bU.$1.push(bT):void 0;};w.WhenObsolete=function(bS,bT){var bU;bU=bS.s;bU==null?w.Obsolete(bT):bU!=null&&bU.$==2?w.EnqueueSafe(bU.$1,bT):bU!=null&&bU.$==3?w.EnqueueSafe(bU.$1,bT):void 0;};w.WhenReady=function(bS,bT){var bU,bV;bV=bS.s;switch(bV!=null&&bV.$==2?(bU=bV.$0,0):bV==null?1:bV!=null&&bV.$==3?2:(bU=bV.$0,0)){case 0:bT(bU);break;case 1:null;break;case 2:bV.$0.push(bT);break;}};w.WhenRun=function(bS,bT,bU){var bV;bV=bS.s;bV==null?bU():bV!=null&&bV.$==2?(bV.$1.push(bU),bT(bV.$0)):bV!=null&&bV.$==3?(bV.$0.push(bT),bV.$1.push(bU)):bT(bV.$0);};w.When=function(bS,bT,bU){var bV;bV=bS.s;bV==null?w.Obsolete(bU):bV!=null&&bV.$==2?(w.EnqueueSafe(bV.$1,bU),bT(bV.$0)):bV!=null&&bV.$==3?(bV.$0.push(bT),w.EnqueueSafe(bV.$1,bU)):bT(bV.$0);};w.EnqueueSafe=function(bS,bT){var bU,bV,bW,bX;bS.push(bT);if(bS.length%20===0){bU=bS.slice(0);bJ.Clear(bS);for(bV=0,bW=bt.length(bU)-1;bV<=bW;bV++){bX=bt.get(bU,bV);typeof bX=="object"?function(bY){if(bY.s)bS.push(bY);}(bX):function(bY){bS.push(bY);}(bX);}}else void 0;};w.MarkDone=function(bS,bT,bU){var bV;if((bV=bT.s,bV!=null&&bV.$==0)&&true)w.MarkForever(bS,bU);else w.MarkReady(bS,bU);};w.MarkReady=function(bS,bT){var bU,bV,bW,bX;bU=bS.s;if(bU!=null&&bU.$==3){bS.s={$:2,$0:bT,$1:bU.$1};bV=bU.$0;for(bW=0,bX=bt.length(bV)-1;bW<=bX;bW++)(bt.get(bV,bW))(bT);}else void 0;};w.MarkForever=function(bS,bT){var bU,bV,bW,bX;bU=bS.s;if(bU!=null&&bU.$==3){bS.s={$:0,$0:bT};bV=bU.$0;for(bW=0,bX=bt.length(bV)-1;bW<=bX;bW++)(bt.get(bV,bW))(bT);}else void 0;};x=d.Var=bB.Class({RId:function(){return"uinref"+a.String(this.i);},RView:function(){return this.v;},RUpdM:function(bS){var bT;bT=bS(this.c);bT!=null&&bT.$==1?x.Set(this,bT.$0):void 0;},RUpd:function(bS){x.Update(this,bS);},set_RVal:function(bS){x.Set(this,bS);},RVal:function(){return this.c;},RSet:function(bS){x.Set(this,bS);},RGet:function(){return this.c;}},null,x);x.New=function(bS,bT,bU,bV,bW){return new x({o:bS,c:bT,s:bU,i:bV,v:bW});};x.Lens=function(bS,bT,bU){var bV,bW;bV=h.Id();bW=z.Map(bT,bS.RView());return{RGet:function(){return bT(bS.RGet());},RSet:function(bX){return bS.RUpd(function(bY){return bU(bY,bX);});},RVal:function(){return bT(bS.RGet());},set_RVal:function(bX){return bS.RUpd(function(bY){return bU(bY,bX);});},RUpd:function(bX){return bS.RUpd(function(bY){return bU(bY,bX(bT(bY)));});},RUpdM:function(bX){return bS.RUpdM(function(bY){var bZ;bZ=bX(bT(bY));return bZ==null?null:{$:1,$0:bU(bY,bZ.$0)};});},RView:function(){return bW;},RId:function(){return bV;}};};x.Update=function(bS,bT){x.Set(bS,bT(bS.c));};x.SetFinal=function(bS,bT){if(bS.o)(function(bU){return bU("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bU){bD.log(bU);}));else{w.Obsolete(bS.s);bS.o=true;bS.c=bT;bS.s=w.New({$:0,$0:bT});}};x.Set=function(bS,bT){if(bS.o)(function(bU){return bU("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bU){bD.log(bU);}));else{w.Obsolete(bS.s);bS.c=bT;bS.s=w.New({$:2,$0:bT,$1:[]});}};x.Create=function(){var bS;bS=null;bS=x.New(false,null,w.New({$:2,$0:null,$1:[]}),h.Int(),function(){return bS.s;});return bS;};x.CreateLogged=function(bS,bT){var bU;!window.UINVars?window.UINVars=[]:void 0;bU=x.Create$1(bT);window.UINVars.push([bS,bU]);return bU;};x.Create$1=function(bS){var bT;bT=null;bT=x.New(false,bS,w.New({$:2,$0:bS,$1:[]}),h.Int(),function(){return bT.s;});return bT;};y=d.Updates=bB.Class({set_Value:function(bS){var bT;bT=this.s;!(bT===null)?w.Obsolete(bT):void 0;this.c=bS;}},null,y);y.Create=function(bS){var bT;bT=null;bT=y.New(bS,null,function(){var bU;bU=bT.s;return bU===null?(bU=w.Copy(bT.c()),bT.s=bU,w.WhenObsoleteRun(bU,function(){bT.s=null;}),bU):bU;});return bT;};y.New=function(bS,bT,bU){return new y({c:bS,s:bT,v:bU});};z.get_Do=function(){return A.B;};z.Apply=function(bS,bT){return z.Map2(function(bU,bV){return bU(bV);},bS,bT);};z.AsyncAwait=function(bS,bT){function bU(bV){var bW,bX;function bY(){return z.RemovableSink(function(bZ){if(bS(bZ)){(bK.Force(bW))();bV(bZ);}},bT);}bW=bK.Create(bY);bX=bK.Force(bW);}return bE.FromContinuations(function(bV,bW,bX){return bU.apply(null,[bV,bW,bX]);});};z.RemovableSink=function(bS,bT){var bU;function bV(){w.WhenRun(bT(),function(bW){if(bU[0])bS(bW);},function(){if(bU[0])bE.scheduler().Fork(bV);});}bU=[true];bE.scheduler().Fork(bV);return function(){bU[0]=false;};};z.Sink=function(bS,bT){function bU(){w.WhenRun(bT(),bS,function(){bE.scheduler().Fork(bU);});}bE.scheduler().Fork(bU);};z.TryFinally=function(bS,bT){return z.CreateLazy(function(){try{return bT();}finally{bS();}});};z.TryWith=function(bS,bT){return z.CreateLazy(function(){try{return bT();}catch(bU){return(bS(bU))();}});};z.ConstAsync=function(bS){var bT;bT=w.CreateForeverAsync(bS);return function(){return bT;};};z.Const=function(bS){var bT;bT=w.New({$:0,$0:bS});return function(){return bT;};};z.Sequence=function(bS){return z.CreateLazy(function(){return w.Sequence(bz.map(function(bT){return bT();},bS));});};z.UpdateWhile=function(bS,bT,bU){var bV;bV=[bS];return z.BindInner(function(bW){return bW?z.Map(function(bX){bV[0]=bX;return bX;},bU):z.Const(bV[0]);},bT);};z.BindInner=function(bS,bT){return z.JoinInner(z.Map(bS,bT));};z.JoinInner=function(bS){return z.CreateLazy(function(){return w.JoinInner(bS());});};z.Bind=function(bS,bT){return z.Join(z.Map(bS,bT));};z.Join=function(bS){return z.CreateLazy(function(){return w.Join(bS());});};z.MapSeqCachedView=function(bS,bT){function bU(bV){return bS;}return z.MapSeqCachedViewBy(a.id,function(bV,bW){return(bU(bV))(bW);},bT);};z.MapSeqCachedViewBy=function(bS,bT,bU){var bV;bV=[new bL.New$5()];return z.Map(function(bW){var bX,bY,bZ;bX=bV[0];bY=new bL.New$5();bZ=e.mapInPlace(function(b0){var b1,b2,b3;b1=bS(b0);b2=bX.ContainsKey(b1)?(b3=bX.get_Item(b1),(x.Set(b3.r,b0),b3)):z.ConvertSeqNode(function(b4){return bT(b1,b4);},b0);bY.set_Item(b1,b2);return b2.e;},bt.ofSeq(bW));bV[0]=bY;return bZ;},bU);};z.ConvertSeqNode=function(bS,bT){var bU,bV;bU=x.Create$1(bT);bV=bU.v;return{e:bS(bV),r:bU,w:bV};};z.MapSeqCached=function(bS,bT){return z.MapSeqCachedBy(a.id,bS,bT);};z.MapSeqCachedBy=function(bS,bT,bU){var bV;bV=[new bL.New$5()];return z.Map(function(bW){var bX,bY,bZ;bX=bV[0];bY=new bL.New$5();bZ=e.mapInPlace(function(b0){var b1,b2;b1=bS(b0);b2=bX.ContainsKey(b1)?bX.get_Item(b1):bT(b0);bY.set_Item(b1,b2);return b2;},bt.ofSeq(bW));bV[0]=bY;return bZ;},bU);};z.SnapshotOn=function(bS,bT,bU){var bV;bV=w.New({$:2,$0:bS,$1:[]});return z.CreateLazy(function(){return bV.s==null&&true?w.SnapshotOn(bT(),bU()):(w.WhenObsolete(bT(),bV),bV);});};z.GetAsync=function(bS){return bE.FromContinuations(function(bT){return z.Get(bT,bS);});};z.Get=function(bS,bT){var bU;function bV(){w.WhenRun(bT(),function(bW){if(!bU[0]){bU[0]=true;bS(bW);}},function(){if(!bU[0])bV();});}bU=[false];bV();};z.MapAsync2=function(bS,bT,bU){return z.MapAsync(a.id,z.Map2(bS,bT,bU));};z.MapAsync=function(bS,bT){return z.CreateLazy(function(){return w.MapAsync(bS,bT());});};z.Map3=function(bS,bT,bU,bV){return z.CreateLazy(function(){return w.Map3(bS,bT(),bU(),bV());});};z.Map2Unit=function(bS,bT){return z.CreateLazy(function(){return w.Map2Unit(bS(),bT());});};z.Map2=function(bS,bT,bU){return z.CreateLazy(function(){return w.Map2(bS,bT(),bU());});};z.MapCached=function(bS,bT){return z.MapCachedBy(bC.Equals,bS,bT);};z.MapCachedBy=function(bS,bT,bU){var bV;bV=[null];return z.CreateLazy(function(){return w.MapCachedBy(bS,bV,bT,bU());});};z.Map=function(bS,bT){return z.CreateLazy(function(){return w.Map(bS,bT());});};z.CreateLazy=function(bS){var bT;bT={c:null,o:bS};return function(){var bU,bV;bU=bT.c;return bU===null?(bU=bT.o(),bT.c=bU,(bV=bU.s,bV!=null&&bV.$==0)&&true?bT.o=null:w.WhenObsoleteRun(bU,function(){bT.c=null;}),bU):bU;};};A.B={$:0};B=d.Submitter=bB.Class({Trigger:function(){x.Set(this["var"],null);}},null,B);B.New=bB.Ctor(function(bS,bT){this.input=bS;this["var"]=x.Create();this.view=z.SnapshotOn(bT,this["var"].v,this.input);},B);B.CreateOption=function(bS){return new B.New(z.Map(function(bT){return{$:1,$0:bT};},bS),null);};C.Fresh=function(){return{$:0,$0:h.Int()};};D=d.Model=bB.Class({},null,D);D.New=bB.Ctor(function(bS,bT){var bU;bU=x.Create$1(bT);D.New$1.call(this,bU,z.Map(bS,bU.v));},D);D.New$1=bB.Ctor(function(bS,bT){this["var"]=bS;this.view=bT;},D);D.Update=function(bS,bT){x.Update(bT["var"],function(bU){bS(bU);return bU;});};D.Create=function(bS,bT){return new D.New(bS,bT);};E.Default=function(){K.$cctor();return K.Default;};G=F.ArrayStorage=bB.Class({SSet:function(bS){return bt.ofSeq(bS);},SSetAt:function(bS,bT,bU){bt.set(bU,bS,bT);return bU;},SRemoveIf:function(bS,bT){return bt.filter(function(bU){return!bS(bU);},bT);},SInit:function(){return this.init;},SPrependMany:function(bS,bT){var bU;bU=e.ofSeqNonCopying(bS);bT.unshift.apply(bT,bU);return bT;},SPrepend:function(bS,bT){bT.unshift(bS);return bT;},SAppendMany:function(bS,bT){var bU;bU=e.ofSeqNonCopying(bS);bT.push.apply(bT,bU);return bT;},SAppend:function(bS,bT){bT.push(bS);return bT;}},null,G);G.New=bB.Ctor(function(bS){this.init=bS;},G);H=F.LocalStorageBackend=bB.Class({clear:function(){this.storage.removeItem(this.id);},set:function(bS){this.storage.setItem(this.id,bM.stringify(bt.map(this.serializer.Encode,bS)));return bS;},SSet:function(bS){return this.set(bt.ofSeq(bS));},SSetAt:function(bS,bT,bU){bt.set(bU,bS,bT);return this.set(bU);},SRemoveIf:function(bS,bT){return this.set(bt.filter(function(bU){return!bS(bU);},bT));},SInit:function(){var bS;bS=this.storage.getItem(this.id);if(bS===null)return[];else try{return bt.map(this.serializer.Decode,bM.parse(bS));}catch(bT){return[];}},SPrependMany:function(bS,bT){var bU;bU=e.ofSeqNonCopying(bS);bT.unshift.apply(bT,bU);return this.set(bT);},SPrepend:function(bS,bT){bT.unshift(bS);return this.set(bT);},SAppendMany:function(bS,bT){var bU;bU=e.ofSeqNonCopying(bS);bT.push.apply(bT,bU);return this.set(bT);},SAppend:function(bS,bT){bT.push(bS);return this.set(bT);}},null,H);H.New=bB.Ctor(function(bS,bT){this.id=bS;this.serializer=bT;this.storage=a.localStorage;},H);F.LocalStorage=function(bS,bT){return new H.New(bS,bT);};F.InMemory=function(bS){return new G.New(bS);};I=d.ListModel=bB.Class({Wrap:function(bS,bT,bU){return I.Wrap(this,bS,bT,bU);},Lens:function(bS){return this.LensInto(a.id,function(bT,bU){return bU;},bS);},LensInto:function(bS,bT,bU){var bV,bW,bX;bV=this;bW=h.Id();bX=z.Map(bS,this.FindByKeyAsView(bU));return{RGet:function(){return bS(bV.FindByKey(bU));},RSet:function(bY){return bV.UpdateBy(function(bZ){return{$:1,$0:bT(bZ,bY)};},bU);},RVal:function(){return this.RGet();},set_RVal:function(bY){return this.RSet(bY);},RUpd:function(bY){return bV.UpdateBy(function(bZ){return{$:1,$0:bT(bZ,bY(bS(bZ)))};},bU);},RUpdM:function(bY){return bV.UpdateBy(function(bZ){var b0;b0=bY(bS(bZ));return b0==null?null:{$:1,$0:bT(bZ,b0.$0)};},bU);},RView:function(){return bX;},RId:function(){return bW;}};},get_LengthAsView:function(){return z.Map(bt.length,this["var"].RView());},get_Length:function(){return bt.length(this["var"].RVal());},Clear:function(){this["var"].set_RVal(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(bS,bT){var bU,bV,bW,bX,bY;bU=this;bV=this["var"].RVal();bW=bt.tryFindIndex(function(bZ){return bC.Equals(bU.key(bZ),bT);},bV);bW!=null&&bW.$==1?(bX=bW.$0,bY=bS(bt.get(bV,bX)),bY!=null&&bY.$==1?(this["var"].set_RVal(this.storage.SSetAt(bX,bY.$0,bV)),this.ObsoleteKey(bT)):void 0):void 0;},UpdateAll:function(bS){var bT;bT=this;this["var"].RUpd(function(bU){bt.iteri(function(bV,bW){var bX;bX=bS(bW);return bX==null?null:bt.set(bU,bV,bX.$0);},bU);return bT.storage.SSet(bU);});this.ObsoleteAll();},FindByKeyAsView:function(bS){return z.Map(function(bT){return bT.$0;},this.TryFindByKeyAsView(bS));},TryFindByKeyAsView:function(bS){var bT;bT=this;return function(){var bU,bV,bW;bU=(bV=null,[bT.it.TryGetValue(bS,{get:function(){return bV;},set:function(bX){bV=bX;}}),bV]);return bU[0]?bU[1]:(bW=w.New({$:2,$0:bT.TryFindByKey(bS),$1:[]}),(bT.it.Add(bS,bW),bW));};},TryFindByKey:function(bS){var bT;bT=this;return bt.tryFind(function(bU){return bC.Equals(bT.key(bU),bS);},this["var"].RVal());},FindByKey:function(bS){var bT;bT=this;return bt.find(function(bU){return bC.Equals(bT.key(bU),bS);},this["var"].RVal());},TryFindAsView:function(bS){return z.Map(function(bT){return bt.tryFind(bS,bT);},this["var"].RView());},FindAsView:function(bS){return z.Map(function(bT){return bt.find(bS,bT);},this["var"].RView());},TryFind:function(bS){return bt.tryFind(bS,this["var"].RVal());},Find:function(bS){return bt.find(bS,this["var"].RVal());},ContainsKeyAsView:function(bS){var bT;function bU(bV){return bC.Equals(bT.key(bV),bS);}bT=this;return z.Map(function(bV){return bt.exists(bU,bV);},this["var"].RView());},ContainsKey:function(bS){var bT;bT=this;return bt.exists(function(bU){return bC.Equals(bT.key(bU),bS);},this["var"].RVal());},Set:function(bS){this["var"].set_RVal(this.storage.SSet(bS));this.ObsoleteAll();},Iter:function(bS){bt.iter(bS,this["var"].RVal());},RemoveByKey:function(bS){var bT;bT=this;this["var"].set_RVal(this.storage.SRemoveIf(function(bU){return bC.Equals(bT.key(bU),bS);},this["var"].RVal()));this.ObsoleteKey(bS);},RemoveBy:function(bS){var bT,bU,bV,bW;bT=this["var"].RVal();for(bU=0,bV=bT.length-1;bU<=bV;bU++){bW=bt.get(bT,bU);bS(bW)?this.ObsoleteKey(this.key(bW)):void 0;}this["var"].set_RVal(this.storage.SRemoveIf(bS,this["var"].RVal()));},Remove:function(bS){var bT,bU,bV,bW;bT=this;bU=this["var"].RVal();J.Contains(bT.key,bS,bU)?(bV=bT.key,bW=bV(bS),this["var"].set_RVal(this.storage.SRemoveIf(function(bX){return bC.Equals(bV(bX),bW);},bU)),this.ObsoleteKey(bW)):void 0;},PrependMany:function(bS){var bT,bU;function bV(bW,bX){var bY,bZ;bY=bT.key(bX);bT.ObsoleteKey(bY);bZ=bt.tryFindIndex(function(b0){return bC.Equals(bT.key(b0),bY);},bW);return bZ==null?(bU.Add(bX),bW):bT.storage.SSetAt(bZ.$0,bX,bW);}bT=this;bU=new bH.New$2();this["var"].set_RVal(this.storage.SPrependMany(bU,(((bB.Curried3(bz.fold))(bV))(this["var"].RVal()))(bS)));},Prepend:function(bS){var bT,bU,bV,bW;bT=this;bU=this["var"].RVal();bV=this.key(bS);bW=bt.tryFindIndex(function(bX){return bC.Equals(bT.key(bX),bV);},bU);bW!=null&&bW.$==1?this["var"].set_RVal(this.storage.SSetAt(bW.$0,bS,bU)):this["var"].set_RVal(this.storage.SPrepend(bS,bU));this.ObsoleteKey(bV);},AppendMany:function(bS){var bT,bU;function bV(bW,bX){var bY,bZ;bY=bT.key(bX);bT.ObsoleteKey(bY);bZ=bt.tryFindIndex(function(b0){return bC.Equals(bT.key(b0),bY);},bW);return bZ==null?(bU.Add(bX),bW):bT.storage.SSetAt(bZ.$0,bX,bW);}bT=this;bU=new bH.New$2();this["var"].set_RVal(this.storage.SAppendMany(bU,(((bB.Curried3(bz.fold))(bV))(this["var"].RVal()))(bS)));},Append:function(bS){var bT,bU,bV,bW;bT=this;bU=this["var"].RVal();bV=this.key(bS);bW=bt.tryFindIndex(function(bX){return bC.Equals(bT.key(bX),bV);},bU);bW!=null&&bW.$==1?this["var"].set_RVal(this.storage.SSetAt(bW.$0,bS,bU)):this["var"].set_RVal(this.storage.SAppend(bS,bU));this.ObsoleteKey(bV);},ObsoleteAll:function(){bz.iter(function(bS){w.Obsolete(bS.V);},this.it);this.it.Clear();},ObsoleteKey:function(bS){var bT,bU;bT=(bU=null,[this.it.TryGetValue(bS,{get:function(){return bU;},set:function(bV){bU=bV;}}),bU]);bT[0]?(w.Obsolete(bT[1]),this.it.Remove(bS)):void 0;},GetEnumerator0:function(){return bu.Get0(this["var"].RVal());},GetEnumerator:function(){return bu.Get(this["var"].RVal());}},null,I);I.New=bB.Ctor(function(bS,bT){I.New$3.call(this,bS,x.Create$1(bt.ofSeq(bz.distinctBy(bS,bT.SInit()))),bT);},I);I.New$1=bB.Ctor(function(bS){I.New$2.call(this,bS,[]);},I);I.New$2=bB.Ctor(function(bS,bT){var bU;bU=bt.ofSeq(bT);I.New$3.call(this,bS,x.Create$1(bU),F.InMemory(bU));},I);I.New$3=bB.Ctor(function(bS,bT,bU){this.key=bS;this["var"]=bT;this.storage=bU;this.v=z.Map(function(bV){return bV.slice();},this["var"].RView());this.it=new bL.New$5();},I);J.Contains=function(bS,bT,bU){var bV;bV=bS(bT);return bt.exists(function(bW){return bC.Equals(bS(bW),bV);},bU);};I.Wrap=function(bS,bT,bU,bV){var bW,bX;bW=[new bL.New$5()];bX=bt.map(function(bY){var bZ;bZ=bU(bY);bW[0].set_Item(bS.key(bY),bZ);return bZ;},bS["var"].RVal());return new I.New$3(function(bY){return bS.key(bT(bY));},x.Lens(bS["var"],function(bY){var bZ,b0;bZ=new bL.New$5();b0=bt.map(function(b1){var b2,b3;b2=bS.key(b1);b3=bW[0].ContainsKey(b2)?bV(bW[0].get_Item(b2),b1):bU(b1);bZ.set_Item(b2,b3);return b3;},bY);bW[0]=bZ;return b0;},function(bY,bZ){var b0,b1;b0=new bL.New$5();b1=bt.map(function(b2){var b3;b3=bT(b2);b0.set_Item(bS.key(b3),b2);return b3;},bZ);bW[0]=b0;return b1;}),F.InMemory(bX));};I.FromSeq=function(bS){return I.Create(a.id,bS);};I.Create=function(bS,bT){return I.CreateWithStorage(bS,F.InMemory(bt.ofSeq(bT)));};I.CreateWithStorage=function(bS,bT){return new I.New(bS,bT);};K.$cctor=bB.Cctor(function(){K.Default={Encode:a.id,Decode:a.id};K.$cctor=a.ignore;});L=d.ReactiveExtensions=bB.Class({},null,L);L.New=bB.Ctor(function(){},L);M=d.DoubleInterpolation=bB.Class({Interpolate:function(bS,bT,bU){return bT+bS*(bU-bT);}},null,M);M.DoubleInterpolation=new M({$:0});N.get_Double=function(){return M.DoubleInterpolation;};O=d.Easing=bB.Class({TransformTime:function(bS){return this.transformTime(bS);}},null,O);O.get_CubicInOut=function(){return P.CubicInOut();};O.Custom=function(bS){return new O.New(bS);};O.New=bB.Ctor(function(bS){this.transformTime=bS;},O);P.CubicInOut=function(){T.$cctor();return T.CubicInOut;};Q.get_Empty=function(){return{$:0,$0:p.Empty()};};Q.WhenDone=function(bS,bT){return Q.Append({$:0,$0:p.Single({$:0,$0:bS})},bT);};Q.Run=function(bS,bT){var bU;function bV(bW){function bX(bY,bZ){var b0;b0=bZ-bY;bT.Compute(b0);bS();return b0<=bU?void a.requestAnimationFrame(function(b1){bX(bY,b1);}):bW();}a.requestAnimationFrame(function(bY){bX(bY,bY);});}bU=bT.Duration;return bU===0?bE.Zero():bE.FromContinuations(function(bW,bX,bY){return bV.apply(null,[bW,bX,bY]);});};Q.Play=function(bS){var bT;bT=null;return bE.Delay(function(){return bE.Bind(Q.Run(a.ignore,R.Actions(bS)),function(){R.Finalize(bS);return bE.Return(null);});});};Q.Pack=function(bS){return{$:0,$0:p.Single({$:1,$0:bS})};};Q.Map=function(bS,bT){var bU;return R.Def(bT.Duration,(bU=bT.Compute,function(bV){return bS(bU(bV));}));};Q.Delayed=function(bS,bT,bU,bV,bW,bX){return{Compute:function(bY){return bY<=bV?bW:bS.Interpolate(bT.TransformTime((bY-bV)/bU),bW,bX);},Duration:bU+bV};};Q.Simple=function(bS,bT,bU,bV,bW){return{Compute:function(bX){return bS.Interpolate(bT.TransformTime(bX/bU),bV,bW);},Duration:bU};};Q.Const=function(bS){return R.Const(bS);};Q.Concat=function(bS){return{$:0,$0:p.Concat(bz.map(R.List,bS))};};Q.Append=function(bS,bT){return{$:0,$0:p.Append(bS.$0,bT.$0)};};Q.set_UseAnimations=function(bS){R.set_UseAnimations(bS);};Q.get_UseAnimations=function(){return R.UseAnimations();};R.UseAnimations=function(){T.$cctor();return T.UseAnimations;};R.set_UseAnimations=function(bS){T.$cctor();T.UseAnimations=bS;};R.Actions=function(bS){return R.ConcatActions(bt.choose(function(bT){return bT.$==1?{$:1,$0:bT.$0}:null;},p.ToArray(bS.$0)));};R.ConcatActions=function(bS){var bT,bU,bV,bW;bT=e.ofSeqNonCopying(bS);bU=bt.length(bT);return bU===0?R.Const():bU===1?bt.get(bT,0):(bV=bz.max(bz.map(function(bX){return bX.Duration;},bT)),(bW=bt.map(function(bX){return R.Prolong(bV,bX);},bT),R.Def(bV,function(bX){bt.iter(function(bY){bY.Compute(bX);},bW);})));};R.Prolong=function(bS,bT){var bU,bV,bW;bU=bT.Compute;bV=bT.Duration;bW=bK.Create(function(){return bT.Compute(bT.Duration);});return{Compute:function(bX){return bX>=bV?bW.f():bU(bX);},Duration:bS};};R.Const=function(bS){return R.Def(0,function(){return bS;});};R.Def=function(bS,bT){return{Compute:bT,Duration:bS};};R.Finalize=function(bS){bt.iter(function(bT){if(bT.$==0)bT.$0();},p.ToArray(bS.$0));};R.List=function(bS){return bS.$0;};S=d.Trans=bB.Class({Copy:function(bS,bT,bU,bV){var bW,bX,bY,bZ,b0;function b1(b2,b3){return bW.TChange(b2,b3);}bW=this;bX=bS==null?function(b2){return function(b3){return b1(b2,b3);};}:bS.$0;return new S.New$3(function(b2,b3){return(bX(b2))(b3);},(bY=this.get_TEnter(),bT==null?bY:bT.$0),(bZ=this.get_TExit(),bU==null?bZ:bU.$0),(b0=this.get_TFlags(),bV==null?b0:bV.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(bS,bT){return this.change(bS,bT);}},null,S);S.New=bB.Ctor(function(bS,bT,bU){S.New$3.call(this,bS,bC.Equals(bT,null)?Q.Const:bT,bC.Equals(bU,null)?Q.Const:bU,1|(bC.Equals(bT,null)?0:2)|(bC.Equals(bU,null)?0:4));},S);S.New$1=bB.Ctor(function(bS){S.New$3.call(this,bS,Q.Const,Q.Const,1);},S);S.New$2=bB.Ctor(function(){S.New$3.call(this,function(bS,bT){return Q.Const(bT);},Q.Const,Q.Const,0);},S);S.New$3=bB.Ctor(function(bS,bT,bU,bV){this.change=bS;this.enter=bT;this.exit=bU;this.flags=bV;},S);S.Exit=function(bS,bT){return bT.Copy(null,null,{$:1,$0:bS},{$:1,$0:bT.get_TFlags()|4});};S.Enter=function(bS,bT){return bT.Copy(null,{$:1,$0:bS},null,{$:1,$0:bT.get_TFlags()|2});};S.Change=function(bS,bT){return bT.Copy({$:1,$0:bS},null,null,{$:1,$0:bT.get_TFlags()|1});};S.Create=function(bS){return new S.New$1(bS);};S.Trivial=function(){return new S.New$2();};S.CanAnimateExit=function(bS){var bT,bU;bT=bS.get_TFlags();bU=4;return(bT&bU)===bU;};S.CanAnimateEnter=function(bS){var bT,bU;bT=bS.get_TFlags();bU=2;return(bT&bU)===bU;};S.CanAnimateChange=function(bS){var bT,bU;bT=bS.get_TFlags();bU=1;return(bT&bU)===bU;};S.AnimateExit=function(bS,bT){return(bS.get_TExit())(bT);};S.AnimateEnter=function(bS,bT){return(bS.get_TEnter())(bT);};S.AnimateChange=function(bS,bT,bU){return bS.TChange(bT,bU);};T.$cctor=bB.Cctor(function(){T.CubicInOut=O.Custom(function(bS){var bT;bT=bS*bS;return 3*bT-2*(bT*bS);});T.UseAnimations=true;T.$cctor=a.ignore;});U=d.AnimatedAttrNode=bB.Class({sync:function(bS){var bT;if(this.dirty){bT=this.logical;bT==null?void 0:(this.push(bS))(bT.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(bS,bT){this.visible={$:1,$0:bT};this.dirty=true;(this.push(bS))(bT);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(bS){var bT,bU;bT=this;return Q.WhenDone(function(){bT.dirty=true;bT.visible=null;},(bU=this.visible,bU!=null&&bU.$==1?Q.Pack(Q.Map(function(bV){bT.pushVisible(bS,bV);},S.AnimateExit(this.tr,bU.$0))):Q.get_Empty()));},NGetEnterAnim:function(bS){var bT,bU,bV,bW,bX;bT=this;return Q.WhenDone(function(){bT.sync(bS);},(bU=this.visible,(bV=this.logical,bU!=null&&bU.$==1&&(bV!=null&&bV.$==1&&(this.dirty&&(bW=[bV.$0,bU.$0],true)))?Q.Pack(Q.Map(function(bY){bT.pushVisible(bS,bY);},S.AnimateChange(this.tr,bW[1],bW[0]))):bU==null&&(bV!=null&&bV.$==1&&true)?Q.Pack(Q.Map(function(bY){bT.pushVisible(bS,bY);},S.AnimateEnter(this.tr,bV.$0))):Q.get_Empty())));},NGetChangeAnim:function(bS){var bT,bU,bV,bW;bT=this;return Q.WhenDone(function(){bT.sync(bS);},(bU=this.visible,(bV=this.logical,bU!=null&&bU.$==1&&(bV!=null&&bV.$==1&&(this.dirty&&(bW=[bV.$0,bU.$0],true)))?Q.Pack(Q.Map(function(bX){bT.pushVisible(bS,bX);},S.AnimateChange(this.tr,bW[1],bW[0]))):Q.get_Empty())));}},null,U);U.New=bB.Ctor(function(bS,bT,bU){var bV;bV=this;this.tr=bS;this.push=bU;this.logical=null;this.visible=null;this.dirty=true;this.updates=z.Map(function(bW){bV.logical={$:1,$0:bW};bV.dirty=true;},bT);},U);V=d.DynamicAttrNode=bB.Class({NChanged:function(){return this.updates;},NSync:function(bS){if(this.dirty){(this.push(bS))(this.value);this.dirty=false;}},NGetExitAnim:function(bS){return Q.get_Empty();},NGetEnterAnim:function(bS){return Q.get_Empty();},NGetChangeAnim:function(bS){return Q.get_Empty();}},null,V);V.New=bB.Ctor(function(bS,bT){var bU;bU=this;this.push=bT;this.value=void 0;this.dirty=false;this.updates=z.Map(function(bV){bU.value=bV;bU.dirty=true;},bS);},V);W=d.AttrProxy=bB.Class({},null,W);W.Handler=function(bS,bT){return _0.Static(function(bU){bU.addEventListener(bS,function(bV){return(bT(bU))(bV);},false);});};W.Concat=function(bS){var bT;bT=e.ofSeqNonCopying(bS);return e.TreeReduce(_0.EmptyAttr(),W.Append,bT);};W.Append=function(bS,bT){return _0.AppendTree(bS,bT);};W.Create=function(bS,bT){return _0.Static(function(bU){r.SetAttr(bU,bS,bT);});};Z.New=function(bS,bT,bU,bV){var bW;bW={DynElem:bS,DynFlags:bT,DynNodes:bU};bB.SetOptional(bW,"OnAfterRender",bV);return bW;};_0.Static=function(bS){return new W({$:3,$0:bS});};_0.Dynamic=function(bS,bT){return new W({$:1,$0:new V.New(bS,bT)});};_0.Animated=function(bS,bT,bU){var bV,bW,bX;bV=new U.New(bS,bT,bU);bW=4;S.CanAnimateEnter(bS)?bW=bW|1:void 0;S.CanAnimateExit(bS)?bW=bW|2:void 0;bX=new W({$:1,$0:bV});_0.SetFlags(bX,bW);return bX;};_0.EmptyAttr=function(){_3.$cctor();return _3.EmptyAttr;};_0.AppendTree=function(bS,bT){var bU;return bS===null?bT:bT===null?bS:(bU=new W({$:2,$0:bS,$1:bT}),(_0.SetFlags(bU,_0.Flags(bS)|_0.Flags(bT)),bU));};_0.GetChangeAnim=function(bS){return _0.GetAnim(bS,function(bT,bU){return bT.NGetChangeAnim(bU);});};_0.GetExitAnim=function(bS){return _0.GetAnim(bS,function(bT,bU){return bT.NGetExitAnim(bU);});};_0.GetEnterAnim=function(bS){return _0.GetAnim(bS,function(bT,bU){return bT.NGetEnterAnim(bU);});};_0.GetAnim=function(bS,bT){return Q.Concat(bt.map(function(bU){return bT(bU,bS.DynElem);},bS.DynNodes));};_0.Updates=function(bS){return e.MapTreeReduce(function(bT){return bT.NChanged();},z.Const(),z.Map2Unit,bS.DynNodes);};_0.Empty=function(bS){return Z.New(bS,0,[],null);};_0.Insert=function(bS,bT){var bU,bV,bW;function bX(bY){if(!(bY===null))if(bY!=null&&bY.$==1)bU.push(bY.$0);else if(bY!=null&&bY.$==2){bX(bY.$0);bX(bY.$1);}else if(bY!=null&&bY.$==3)bY.$0(bS);else if(bY!=null&&bY.$==4)bV.push(bY.$0);}bU=[];bV=[];bX(bT);bW=bU.slice(0);return Z.New(bS,_0.Flags(bT),bW,bV.length===0?null:{$:1,$0:function(bY){bz.iter(function(bZ){bZ(bY);},bV);}});};_0.Sync=function(bS,bT){bt.iter(function(bU){bU.NSync(bS);},bT.DynNodes);};_0.SetFlags=function(bS,bT){bS.flags=bT;};_0.Flags=function(bS){return bS!==null&&bS.hasOwnProperty("flags")?bS.flags:0;};_0.HasExitAnim=function(bS){var bT;bT=2;return(bS.DynFlags&bT)===bT;};_0.HasEnterAnim=function(bS){var bT;bT=1;return(bS.DynFlags&bT)===bT;};_0.HasChangeAnim=function(bS){var bT;bT=4;return(bS.DynFlags&bT)===bT;};_1=d.CheckedInput=bB.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_1);_1.Make=function(bS){return new _1({$:0,$0:bS,$1:a.String(bS)});};_2.ValidateForm=function(){return _2.OnAfterRender(function(bS){if(window.H5F)window.H5F.setup(bS);});};_2.Checked=function(bS){function bT(bU,bV){return!bC.Equals(bS.RVal(),bU.checked)?bS.set_RVal(bU.checked):null;}return W.Concat([_2.DynamicProp("checked",bS.RView()),_2.Handler("change",function(bU){return function(bV){return bT(bU,bV);};}),_2.Handler("click",function(bU){return function(bV){return bT(bU,bV);};})]);};_2.FloatValue=function(bS){return _2.CustomVar(bS,function(bT,bU){var bV;bV=bU.get_Input();return bT.value!==bV?void(bT.value=bV):null;},function(bT){var bU,bV;bU=bT.value;return{$:1,$0:f.isBlank(bU)?(bT.checkValidity?bT.checkValidity():true)?new _1({$:2,$0:bU}):new _1({$:1,$0:bU}):(bV=+bU,a.isNaN(bV)?new _1({$:1,$0:bU}):new _1({$:0,$0:bV,$1:bU}))};});};_2.FloatValueUnchecked=function(bS){return _2.CustomValue(bS,a.String,function(bT){var bU;return f.isBlank(bT)?{$:1,$0:0}:(bU=+bT,a.isNaN(bU)?null:{$:1,$0:bU});});};_2.IntValue=function(bS){return _2.CustomVar(bS,function(bT,bU){var bV;bV=bU.get_Input();return bT.value!==bV?void(bT.value=bV):null;},function(bT){var bU,bV,bW;bU=bT.value;return{$:1,$0:f.isBlank(bU)?(bT.checkValidity?bT.checkValidity():true)?new _1({$:2,$0:bU}):new _1({$:1,$0:bU}):(bV=(bW=0,[bN.TryParseInt32(bU,{get:function(){return bW;},set:function(bX){bW=bX;}}),bW]),bV[0]?new _1({$:0,$0:bV[1],$1:bU}):new _1({$:1,$0:bU}))};});};_2.IntValueUnchecked=function(bS){return _2.CustomValue(bS,a.String,function(bT){var bU;return f.isBlank(bT)?{$:1,$0:0}:(bU=+bT,bU!==bU>>0?null:{$:1,$0:bU});});};_2.Value=function(bS){function bT(bU){return{$:1,$0:bU};}return _2.CustomValue(bS,a.id,function(bU){return bT(a.id(bU));});};_2.ContentEditableHtml=function(bS){var bT;bT=_2.CustomVar(bS,function(bU,bV){bU.innerHTML=bV;},function(bU){return{$:1,$0:bU.innerHTML};});return W.Append(W.Create("contenteditable","true"),bT);};_2.ContentEditableText=function(bS){var bT;bT=_2.CustomVar(bS,function(bU,bV){bU.textContent=bV;},function(bU){return{$:1,$0:bU.textContent};});return W.Append(W.Create("contenteditable","true"),bT);};_2.CustomValue=function(bS,bT,bU){return _2.CustomVar(bS,function(bV,bW){bV.value=bT(bW);},function(bV){return bU(bV.value);});};_2.CustomVar=function(bS,bT,bU){function bV(bX,bY){return bS.RUpdM(function(bZ){var b0,b1;b0=bU(bX);return b0!=null&&b0.$==1&&(!bC.Equals(b0.$0,bZ)&&(b1=[b0,b0.$0],true))?b1[0]:null;});}function bW(bX,bY){var bZ,b0;bZ=bU(bX);return bZ!=null&&bZ.$==1&&(bC.Equals(bZ.$0,bY)&&(b0=bZ.$0,true))?null:bT(bX,bY);}return W.Concat([_2.Handler("change",function(bX){return function(bY){return bV(bX,bY);};}),_2.Handler("input",function(bX){return function(bY){return bV(bX,bY);};}),_2.Handler("keypress",function(bX){return function(bY){return bV(bX,bY);};}),_2.DynamicCustom(function(bX){return function(bY){return bW(bX,bY);};},bS.RView())]);};_2.DynamicProp=function(bS,bT){return _0.Dynamic(bT,function(bU){return function(bV){bU[bS]=bV;};});};_2.DynamicPred=function(bS,bT,bU){function bV(bW,bX){return bX[0]?r.SetAttr(bW,bS,bX[1]):r.RemoveAttr(bW,bS);}return _0.Dynamic(z.Map2(function(bW,bX){return[bW,bX];},bT,bU),function(bW){return function(bX){return bV(bW,bX);};});};_2.DynamicClass=function(bS,bT,bU){return _0.Dynamic(bT,function(bV){return function(bW){return bU(bW)?r.AddClass(bV,bS):r.RemoveClass(bV,bS);};});};_2.OnAfterRenderView=function(bS,bT){var bU;bU=h.Id();return W.Append(_2.OnAfterRender(function(bV){bT(bV,bV[bU]);}),_2.DynamicCustom(function(bV){return function(bW){bV[bU]=bW;};},bS));};_2.OnAfterRender=function(bS){return new W({$:4,$0:bS});};_2.HandlerView=function(bS,bT,bU){return _0.Static(function(bV){var bW;bW=bU(bV);bV.addEventListener(bS,function(bX){return z.Get(bW(bX),bT);},false);});};_2.Handler=function(bS,bT){return _0.Static(function(bU){bU.addEventListener(bS,function(bV){return(bT(bU))(bV);},false);});};_2.DynamicStyle=function(bS,bT){return _0.Dynamic(bT,function(bU){return function(bV){return r.SetStyle(bU,bS,bV);};});};_2.DynamicCustom=function(bS,bT){return _0.Dynamic(bT,bS);};_2.Dynamic=function(bS,bT){return _0.Dynamic(bT,function(bU){return function(bV){return r.SetAttr(bU,bS,bV);};});};_2.AnimatedStyle=function(bS,bT,bU,bV){return _0.Animated(bT,bU,function(bW){return function(bX){return r.SetStyle(bW,bS,bV(bX));};});};_2.Animated=function(bS,bT,bU,bV){return _0.Animated(bT,bU,function(bW){return function(bX){return r.SetAttr(bW,bS,bV(bX));};});};_2.Class=function(bS){return _0.Static(function(bT){r.AddClass(bT,bS);});};_2.Style=function(bS,bT){return _0.Static(function(bU){r.SetStyle(bU,bS,bT);});};_3.$cctor=bB.Cctor(function(){_3.EmptyAttr=null;_3.$cctor=a.ignore;});_4=d.DocElemNode=bB.Class({GetHashCode:function(){return this.ElKey;},Equals:function(bS){return this.ElKey===bS.ElKey;}},null,_4);_4.New=function(bS,bT,bU,bV,bW,bX){var bY;return new _4((bY={Attr:bS,Children:bT,El:bV,ElKey:bW},(bB.SetOptional(bY,"Delimiters",bU),bB.SetOptional(bY,"Render",bX),bY)));};_6.FoldBack=function(bS,bT,bU){return bt.foldBack(bS,bT.$0,bU);};_6.Iter=function(bS,bT){bt.iter(bS,bT.$0);};_6.Except=function(bS,bT){var bU;bU=bS.$0;return{$:0,$0:bt.filter(function(bV){return bt.forall(function(bW){return!(bV===bW);},bU);},bT.$0)};};_6.DocChildren=function(bS){var bT;function bU(bV){if(bV!=null&&bV.$==2)bU(bV.$0.Current);else if(bV!=null&&bV.$==1)bT.push(bV.$0.El);else if(bV==null);else if(bV!=null&&bV.$==5)bT.push(bV.$0);else if(bV!=null&&bV.$==4)bT.push(bV.$0.Text);else if(bV!=null&&bV.$==6)bt.iter(function(bW){if(bW.constructor===a.Object)bU(bW);else bT.push(bW);},bV.$0.Els);else{bU(bV.$0);bU(bV.$1);}}bT=[];bU(bS.Children);return{$:0,$0:e.ofSeqNonCopying(bT)};};_6.Children=function(bS,bT){var bU,bV,bW;if(bT!=null&&bT.$==1){bW=[];bU=bT.$0[0].nextSibling;while(bU!==bT.$0[1]){bW.push(bU);bU=bU.nextSibling;}return{$:0,$0:bW};}else return{$:0,$0:bt.init(bS.childNodes.length,(bV=bS.childNodes,function(bX){return bV[bX];}))};};_7.ToArray=function(bS){return i.ToArray(bS.$0);};_7.get_Empty=function(){return{$:0,$0:new by.New$3()};};_7.IsEmpty=function(bS){return bS.$0.get_Count()===0;};_7.Intersect=function(bS,bT){return{$:0,$0:i.Intersect(bS.$0,bT.$0)};};_7.Except=function(bS,bT){return{$:0,$0:i.Except(bS.$0,bT.$0)};};_7.FindAll=function(bS){var bT;function bU(bW){if(bW!=null&&bW.$==0){bU(bW.$0);bU(bW.$1);}else if(bW!=null&&bW.$==1)bV(bW.$0);else if(bW!=null&&bW.$==2)bU(bW.$0.Current);else if(bW!=null&&bW.$==6)bt.iter(bV,bW.$0.Holes);}function bV(bW){bT.push(bW);bU(bW.Children);}bT=[];bU(bS);return{$:0,$0:new by.New$2(bT)};};_7.Filter=function(bS,bT){return{$:0,$0:i.Filter(bS,bT.$0)};};_8.New=function(bS,bT){return{PreviousNodes:bS,Top:bT};};_9.TextHoleRE=function(){bb.$cctor();return bb.TextHoleRE;};_9.LoadedTemplates=function(){bb.$cctor();return bb.LoadedTemplates;};_9.UpdateTextNode=function(bS,bT){bS.Value=bT;bS.Dirty=true;};_9.CreateTextNode=function(){return{Text:r.CreateText(""),Dirty:false,Value:""};};_9.UpdateEmbedNode=function(bS,bT){bS.Current=bT;bS.Dirty=true;};_9.CreateEmbedNode=function(){return{Current:null,Dirty:false};};_9.PerformAnimatedUpdate=function(bS,bT){var bU;return Q.get_UseAnimations()?(bU=null,bE.Delay(function(){var bV,bW,bX;bV=_7.FindAll(bT);bW=_9.ComputeChangeAnim(bS,bV);bX=_9.ComputeEnterAnim(bS,bV);return bE.Bind(Q.Play(Q.Append(bW,_9.ComputeExitAnim(bS,bV))),function(){return bE.Bind(_9.SyncElemNodesNextFrame(bS),function(){return bE.Bind(Q.Play(bX),function(){bS.PreviousNodes=bV;return bE.Return(null);});});});})):_9.SyncElemNodesNextFrame(bS);};_9.SyncElemNodesNextFrame=function(bS){function bT(bU){a.requestAnimationFrame(function(){_9.SyncElemNode(bS.Top);bU();});}return bE.FromContinuations(function(bU,bV,bW){return bT.apply(null,[bU,bV,bW]);});};_9.ComputeEnterAnim=function(bS,bT){return Q.Concat(bt.map(function(bU){return _0.GetEnterAnim(bU.Attr);},_7.ToArray(_7.Except(bS.PreviousNodes,_7.Filter(function(bU){return _0.HasEnterAnim(bU.Attr);},bT)))));};_9.ComputeChangeAnim=function(bS,bT){var bU;function bV(bW){return _0.HasChangeAnim(bW.Attr);}bU=function(bW){return _7.Filter(bV,bW);};return Q.Concat(bt.map(function(bW){return _0.GetChangeAnim(bW.Attr);},_7.ToArray(_7.Intersect(bU(bS.PreviousNodes),bU(bT)))));};_9.ComputeExitAnim=function(bS,bT){return Q.Concat(bt.map(function(bU){return _0.GetExitAnim(bU.Attr);},_7.ToArray(_7.Except(bT,_7.Filter(function(bU){return _0.HasExitAnim(bU.Attr);},bS.PreviousNodes)))));};_9.CreateDelimitedRunState=function(bS,bT,bU){return _8.New(_7.get_Empty(),_9.CreateDelimitedElemNode(bS,bT,_0.EmptyAttr(),bU));};_9.CreateRunState=function(bS,bT){return _8.New(_7.get_Empty(),_9.CreateElemNode(bS,_0.EmptyAttr(),bT));};_9.CreateDelimitedElemNode=function(bS,bT,bU,bV){var bW,bX;bW=bS.parentNode;_9.LinkPrevElement(bT,bV);bX=_0.Insert(bW,bU);return _4.New(bX,bV,{$:1,$0:[bS,bT]},bW,h.Int(),bB.GetOptional(bX.OnAfterRender));};_9.CreateElemNode=function(bS,bT,bU){var bV;_9.LinkElement(bS,bU);bV=_0.Insert(bS,bT);return _4.New(bV,bU,null,bS,h.Int(),bB.GetOptional(bV.OnAfterRender));};_9.SyncElemNode=function(bS){_9.SyncElement(bS);_9.Sync(bS.Children);_9.AfterRender(bS);};_9.Sync=function(bS){var bT,bU;if(bS!=null&&bS.$==1)_9.SyncElemNode(bS.$0);else if(bS!=null&&bS.$==2)_9.Sync(bS.$0.Current);else if(bS==null);else if(bS!=null&&bS.$==5);else if(bS!=null&&bS.$==4){bT=bS.$0;bT.Dirty?(bT.Text.nodeValue=bT.Value,bT.Dirty=false):void 0;}else if(bS!=null&&bS.$==6){bU=bS.$0;bt.iter(function(bV){_9.SyncElemNode(bV);},bU.Holes);bt.iter(function(bV){_0.Sync(bV[0],bV[1]);},bU.Attrs);_9.AfterRender(bU);}else{_9.Sync(bS.$0);_9.Sync(bS.$1);}};_9.AfterRender=function(bS){var bT;bT=bB.GetOptional(bS.Render);bT!=null&&bT.$==1?(bT.$0(bS.El),bB.SetOptional(bS,"Render",null)):void 0;};_9.InsertBeforeDelim=function(bS,bT){var bU,bV;bU=bS.parentNode;bV=a.document.createTextNode("");bU.insertBefore(bV,bS);_9.LinkPrevElement(bS,bT);return bV;};_9.LinkPrevElement=function(bS,bT){_9.InsertDoc(bS.parentNode,bT,bS);};_9.LinkElement=function(bS,bT){_9.InsertDoc(bS,bT,null);};_9.SyncElement=function(bS){function bT(bU){function bV(bW){var bX,bY;return bW!=null&&bW.$==0?bV(bW.$0)||bV(bW.$1):bW!=null&&bW.$==2?(bX=bW.$0,bX.Dirty||bV(bX.Current)):bW!=null&&bW.$==6&&(bY=bW.$0,bY.Dirty||bt.exists(bT,bY.Holes));}return bV(bU.Children);}_0.Sync(bS.El,bS.Attr);bT(bS)?_9.DoSyncElement(bS):void 0;};_9.DoSyncElement=function(bS){var bT,bU,bV;function bW(bX,bY){var bZ,b0;return bX!=null&&bX.$==1?bX.$0.El:bX!=null&&bX.$==2?(bZ=bX.$0,bZ.Dirty?(bZ.Dirty=false,_9.InsertDoc(bT,bZ.Current,bY)):bW(bZ.Current,bY)):bX==null?bY:bX!=null&&bX.$==4?bX.$0.Text:bX!=null&&bX.$==5?bX.$0:bX!=null&&bX.$==6?(b0=bX.$0,(b0.Dirty?b0.Dirty=false:void 0,bt.foldBack(function(b1,b2){return b1.constructor===a.Object?bW(b1,b2):b1;},b0.Els,bY))):bW(bX.$0,bW(bX.$1,bY));}bT=bS.El;_6.Iter((bU=bS.El,function(bX){r.RemoveNode(bU,bX);}),_6.Except(_6.DocChildren(bS),_6.Children(bS.El,bB.GetOptional(bS.Delimiters))));bW(bS.Children,(bV=bB.GetOptional(bS.Delimiters),bV!=null&&bV.$==1?bV.$0[1]:null));};_9.InsertDoc=function(bS,bT,bU){var bV;return bT!=null&&bT.$==1?_9.InsertNode(bS,bT.$0.El,bU):bT!=null&&bT.$==2?(bV=bT.$0,(bV.Dirty=false,_9.InsertDoc(bS,bV.Current,bU))):bT==null?bU:bT!=null&&bT.$==4?_9.InsertNode(bS,bT.$0.Text,bU):bT!=null&&bT.$==5?_9.InsertNode(bS,bT.$0,bU):bT!=null&&bT.$==6?bt.foldBack(function(bW,bX){return bW.constructor===a.Object?_9.InsertDoc(bS,bW,bX):_9.InsertNode(bS,bW,bX);},bT.$0.Els,bU):_9.InsertDoc(bS,bT.$0,_9.InsertDoc(bS,bT.$1,bU));};_9.InsertNode=function(bS,bT,bU){r.InsertAt(bS,bU,bT);return bT;};_=d.Doc=bB.Class({ReplaceInDom:function(bS){var bT;bT=a.document.createTextNode("");bS.parentNode.replaceChild(bT,bS);_.RunBefore(bT,this);}},null,_);_.Append=function(bS,bT){return _.Mk({$:0,$0:bS.docNode,$1:bT.docNode},z.Map2Unit(bS.updates,bT.updates));};_.Concat=function(bS){var bT;bT=e.ofSeqNonCopying(bS);return e.TreeReduce(_.Empty(),_.Append,bT);};_.Empty=function(){return _.Mk(null,z.Const());};_.TextNode=function(bS){return _.Mk({$:5,$0:r.CreateText(bS)},z.Const());};_.Verbatim=function(bS){var bT;return _.Mk(e.MapTreeReduce(function(bU){return bC.Equals(bU.nodeType,bO.TEXT_NODE)?{$:5,$0:bU}:{$:1,$0:_9.CreateElemNode(bU,_0.EmptyAttr(),null)};},null,function(bU,bV){return{$:0,$0:bU,$1:bV};},(bT=bP.parseHTML(bS),bC.Equals(bT,null)?[]:bT)),z.Const());};_.SvgElementMixed=function(bS,bT){var bU;bU=_.MixedNodes(bT);return _.SvgElement(bS,bU[0],bU[1]);};_.SvgElement=function(bS,bT,bU){var bV,bW;bV=W.Concat(bT);bW=_.Concat(bU);return $.New(r.CreateSvgElement(bS),bV,bW);};_.ElementMixed=function(bS,bT){var bU;bU=_.MixedNodes(bT);return _.Element(bS,bU[0],bU[1]);};_.ConcatMixed=function(bS){return _.Concat(bz.map(_.ToMixedDoc,bS));};_.MixedNodes=function(bS){var bT,bU,bV,bW;bT=new bH.New$2();bU=new bH.New$2();bV=bu.Get(bS);try{while(bV.MoveNext()){bW=bV.Current();bW instanceof W?bT.Add(bW):bU.Add(_.ToMixedDoc(bW));}}finally{if("Dispose"in bV)bV.Dispose();}return[bT,bU];};_.ToMixedDoc=function(bS){return bS instanceof _?bS:typeof bS=="string"?_.TextNode(bS):bS instanceof a.Element?_.Static(bS):typeof bS=="function"?_.EmbedView(z.Map(_.ToMixedDoc,bS)):bS instanceof x?_.EmbedView(z.Map(_.ToMixedDoc,bS.v)):bC.Equals(bS,null)?_.Empty():_.TextNode(a.String(bS));};_.Element=function(bS,bT,bU){var bV,bW;bV=W.Concat(bT);bW=_.Concat(bU);return $.New(r.CreateElement(bS),bV,bW);};_.Radio=function(bS,bT,bU){var bV,bW;bV=r.CreateElement("input");bV.addEventListener("click",function(){return bU.RSet(bT);},false);bW=_2.DynamicProp("checked",z.Map(function(bX){return bC.Equals(bX,bT);},bU.RView()));return $.New(bV,W.Concat(bs.append(bs.ofArray([W.Create("type","radio"),W.Create("name",bU.RId()),bW]),bs.ofSeq(bS))),_.Empty());};_.LinkView=function(bS,bT,bU,bV){var bW;bW=W.Concat(bz.append([_2.HandlerView("click",bU,function(){return function(){return bV;};}),W.Create("href","#")],bT));return $.New(r.CreateElement("a"),bW,_.TextNode(bS));};_.Link=function(bS,bT,bU){var bV,bW;bV=(bW=W.Concat(bT),W.Append(W.Create("href","#"),bW));return $.New(_.Clickable("a",bU),bV,_.TextNode(bS));};_.ButtonView=function(bS,bT,bU,bV){var bW;bW=W.Concat(bz.append([_2.HandlerView("click",bU,function(){return function(){return bV;};})],bT));return $.New(r.CreateElement("button"),bW,_.TextNode(bS));};_.Button=function(bS,bT,bU){var bV;bV=W.Concat(bT);return $.New(_.Clickable("button",bU),bV,_.TextNode(bS));};_.Clickable=function(bS,bT){var bU;bU=r.CreateElement(bS);bU.addEventListener("click",function(bV){bV.preventDefault();return bT();},false);return bU;};_.CheckBoxGroup=function(bS,bT,bU){function bV(bW){return bC.Equals(bT,bW);}return _.CheckBox(bS,x.Lens(bU,function(bW){return bs.exists(bV,bW);},function(bW,bX){return bX?bs.exists(function(bY){return bC.Equals(bT,bY);},bW)?bW:new bs.T({$:1,$0:bT,$1:bW}):bs.filter(function(bY){return!bC.Equals(bT,bY);},bW);}));};_.CheckBox=function(bS,bT){return _.InputInternal("input",function(){return bz.append(bS,[W.Create("type","checkbox"),_2.Checked(bT)]);});};_.SelectDynOptional=function(bS,bT,bU,bV,bW){return _.SelectDyn(bS,function(bX){return bX!=null&&bX.$==1?bU(bX.$0):bT;},z.Map(function(bX){return new bs.T({$:1,$0:null,$1:bs.map(function(bY){return{$:1,$0:bY};},bX)});},bV),bW);};_.SelectOptional=function(bS,bT,bU,bV,bW){return _.Select(bS,function(bX){return bX!=null&&bX.$==1?bU(bX.$0):bT;},new bs.T({$:1,$0:null,$1:bs.map(function(bX){return{$:1,$0:bX};},bV)}),bW);};_.Select=function(bS,bT,bU,bV){return _.SelectImpl(bS,bT,function(bW){bW[0]=bU;return _.Concat(bs.mapi(function(bX,bY){return _.Element("option",bs.ofArray([W.Create("value",a.String(bX))]),bs.ofArray([_.TextNode(bT(bY))]));},bU));},bV);};_.SelectDyn=function(bS,bT,bU,bV){return _.SelectImpl(bS,bT,function(bW){function bX(bY,bZ){return _.Element("option",bs.ofArray([W.Create("value",a.String(bY))]),bs.ofArray([_.TextNode(bT(bZ))]));}return _.Convert(function(bY){return bX(bY[0],bY[1]);},z.Map(function(bY){bW[0]=bY;return bz.mapi(function(bZ,b0){return[bZ,b0];},bY);},bU));},bV);};_.SelectImpl=function(bS,bT,bU,bV){var bW,bX,bY,bZ;function b0(b5){return b5.selectedIndex;}function b1(b5,b6){b5.selectedIndex=b6;}function b2(b5){var b6;b6=b0(b5);return bW[0].get_Item(b6);}function b3(b5){return bz.findIndex(function(b6){return bC.Equals(b5,b6);},bW[0]);}function b4(b5,b6){return b1(b5,b3(b6));}bW=[bs.T.Empty];bX=r.CreateElement("select");bY=_2.DynamicCustom(function(b5){return function(b6){return b4(b5,b6);};},bV.RView());bX.addEventListener("change",function(){bV.RUpdM(function(b5){var b6;b6=b2(bX);return bC.Equals(b5,b6)?null:{$:1,$0:b6};});},false);return $.New(bX,(bZ=W.Append(bY,W.Concat(bS)),W.Append(_2.OnAfterRender(function(b5){b4(b5,bV.RGet());}),bZ)),bU(bW));};_.InputArea=function(bS,bT){return _.InputInternal("textarea",function(){return bz.append(bS,[_2.Value(bT)]);});};_.FloatInput=function(bS,bT){return _.InputInternal("input",function(){return bz.append(bS,[_2.FloatValue(bT),W.Create("type","number")]);});};_.FloatInputUnchecked=function(bS,bT){return _.InputInternal("input",function(){return bz.append(bS,[bT.RGet()===0?W.Create("value","0"):_0.EmptyAttr(),_2.FloatValueUnchecked(bT),W.Create("type","number")]);});};_.IntInput=function(bS,bT){return _.InputInternal("input",function(){return bz.append(bS,[_2.IntValue(bT),W.Create("type","number")]);});};_.IntInputUnchecked=function(bS,bT){return _.InputInternal("input",function(){return bz.append(bS,[bT.RGet()===0?W.Create("value","0"):_0.EmptyAttr(),_2.IntValueUnchecked(bT),W.Create("type","number")]);});};_.PasswordBox=function(bS,bT){return _.InputInternal("input",function(){return bz.append(bS,[_2.Value(bT),W.Create("type","password")]);});};_.Input=function(bS,bT){return _.InputInternal("input",function(){return bz.append(bS,[_2.Value(bT)]);});};_.InputInternal=function(bS,bT){var bU;bU=r.CreateElement(bS);return $.New(bU,W.Concat(bT(bU)),_.Empty());};_.ConvertSeqBy=function(bS,bT,bU){return _.Flatten(z.MapSeqCachedViewBy(bS,function(bV,bW){return(bT(bV))(bW);},bU));};_.ConvertSeq=function(bS,bT){return _.Flatten(z.MapSeqCachedView(bS,bT));};_.ConvertBy=function(bS,bT,bU){return _.Flatten(z.MapSeqCachedBy(bS,bT,bU));};_.Convert=function(bS,bT){return _.Flatten(z.MapSeqCached(bS,bT));};_.Flatten=function(bS){return _.EmbedView(z.Map(_.Concat,bS));};_.GetOrLoadTemplate=function(bS,bT,bU,bV){_.PrepareTemplate(bS,bT,bU);return _.NamedTemplate(bS,bT,bV);};_.NamedTemplate=function(bS,bT,bU){var bV,bW,bX;bV=_.ComposeName(bS,bT);bW=(bX=null,[_9.LoadedTemplates().TryGetValue(bV,{get:function(){return bX;},set:function(bY){bX=bY;}}),bX]);return bW[0]?_.ChildrenTemplate(bW[1].cloneNode(true),bU):(bD.warn("Local template doesn't exist",bV),_.Empty());};_.LoadLocalTemplates=function(bS){(function(){var bT,bU,bV,bW;while(true){bT=a.document.querySelector("[ws-template]");if(bC.Equals(bT,null)){bU=a.document.querySelector("[ws-children-template]");if(bC.Equals(bU,null))return null;else{bV=bU.getAttribute("ws-children-template");bU.removeAttribute("ws-children-template");_.PrepareTemplate(bS,{$:1,$0:bV},function(bX){return function(){return r.ChildrenArray(bX);};}(bU));}}else{bW=bT.getAttribute("ws-template");_.PrepareSingleTemplate(bS,{$:1,$0:bW},bT);}}}());};_.PrepareTemplate=function(bS,bT,bU){var bV,bW,bX,bY,bZ;if(!_9.LoadedTemplates().ContainsKey(_.ComposeName(bS,bT))){bV=bU();for(bW=0,bX=bV.length-1;bW<=bX;bW++){bY=bt.get(bV,bW);bZ=bY.parentNode;bC.Equals(bZ,null)?void 0:bZ.removeChild(bY);}_.PrepareTemplateStrict(bS,bT,bV);}};_.PrepareTemplateStrict=function(bS,bT,bU){var bV;function bW(b8){var b_,b$,ca,cb,cc,cd,ce,cf;function b9(cg){var ch;ch=b8.getAttribute(cg);ch===null?void 0:b8.setAttribute(cg,ch.toLowerCase());}b_=b8.attributes;b$=[];ca=[];cb=[];for(cc=0,cd=b_.length-1;cc<=cd;cc++){ce=b_.item(cc);bv.StartsWith(ce.nodeName,"ws-on")&&ce.nodeName!=="ws-onafterrender"&&ce.nodeName!=="ws-on"?(b$.push(ce.nodeName),ca.push(bQ.string(ce.nodeName,{$:1,$0:"ws-on".length},null)+":"+ce.nodeValue.toLowerCase())):!bv.StartsWith(ce.nodeName,"ws-")&&(new a.RegExp(_9.TextHoleRE())).test(ce.nodeValue)?(ce.nodeValue=(cf=new a.RegExp(_9.TextHoleRE(),"g"),ce.nodeValue.replace(cf,function(cg,ch){return"${"+ch.toLowerCase()+"}";})),cb.push(ce.nodeName)):void 0;}!(ca.length==0)?b8.setAttribute("ws-on",bv.concat(" ",ca)):void 0;!(cb.length==0)?b8.setAttribute("ws-attr-holes",bv.concat(" ",cb)):void 0;b9("ws-hole");b9("ws-replace");b9("ws-attr");b9("ws-onafterrender");b9("ws-var");bt.iter(function(cg){b8.removeAttribute(cg);},b$);}function bX(b8){var b9,b_,b$,ca,cb,cc;b9=null;b_=0;ca=b8.textContent;cb=new a.RegExp(_9.TextHoleRE(),"g");while(b9=cb.exec(ca),b9!==null){b8.parentNode.insertBefore(a.document.createTextNode(bQ.string(ca,{$:1,$0:b_},{$:1,$0:cb.lastIndex-bt.get(b9,0).length-1})),b8);b_=cb.lastIndex;cc=a.document.createElement("span");cc.setAttribute("ws-replace",bt.get(b9,1).toLowerCase());b8.parentNode.insertBefore(cc,b8);}cb.lastIndex=0;b8.textContent=bQ.string(ca,{$:1,$0:b_},null);}function bY(b8,b9){function b_(b$){r.IterSelector(b8,"["+b$+"]",function(ca){var cb,cc;cb=(cc=null,[b9.TryGetValue(ca.getAttribute(b$).toLowerCase(),{get:function(){return cc;},set:function(cd){cc=cd;}}),cc]);cb[0]?ca.setAttribute(b$,cb[1]):void 0;});}b_("ws-hole");b_("ws-replace");b_("ws-attr");b_("ws-onafterrender");b_("ws-var");r.IterSelector(b8,"[ws-on]",function(b$){b$.setAttribute("ws-on",bv.concat(" ",bt.map(function(ca){var cb,cc,cd;cb=bv.SplitChars(ca,[58],1);cc=(cd=null,[b9.TryGetValue(bt.get(cb,1),{get:function(){return cd;},set:function(ce){cd=ce;}}),cd]);return cc[0]?bt.get(cb,0)+":"+cc[1]:ca;},bv.SplitChars(b$.getAttribute("ws-on"),[32],1))));});return r.IterSelector(b8,"[ws-attr-holes]",function(b$){var ca,cb,cc;ca=bv.SplitChars(b$.getAttribute("ws-attr-holes"),[32],1);for(cb=0,cc=ca.length-1;cb<=cc;cb++)(function(){var cd;function ce(cf,cg){var ch;ch=bI.KeyValue(cg);return cf.replace(new a.RegExp("\\${"+ch[0]+"}","ig"),"${"+ch[1]+"}");}cd=bt.get(ca,cb);return b$.setAttribute(cd,(((bB.Curried3(bz.fold))(ce))(b$.getAttribute(cd)))(b9));}());});}function bZ(b8,b9){var b_,b$,ca,cb,cc;bW(b9);b_=b9.nodeName.toLowerCase();b$=b8.querySelector("[ws-attr="+b_+"]");if(bC.Equals(b$,null))return bD.warn("Filling non-existent attr hole",b_);else{b$.removeAttribute("ws-attr");for(ca=0,cb=b9.attributes.length-1;ca<=cb;ca++){cc=b9.attributes.item(ca);cc.name==="class"&&b$.hasAttribute("class")?b$.setAttribute("class",b$.getAttribute("class")+" "+cc.nodeValue):b$.setAttribute(cc.name,cc.nodeValue);}return;}}function b0(b8,b9){function b_(b$){r.IterSelector(b8,"["+b$+"]",function(ca){if(!b9.Contains(ca.getAttribute(b$)))ca.removeAttribute(b$);});}b_("ws-attr");b_("ws-onafterrender");b_("ws-var");r.IterSelector(b8,"[ws-hole]",function(b$){if(!b9.Contains(b$.getAttribute("ws-hole"))){b$.removeAttribute("ws-hole");while(b$.hasChildNodes())b$.removeChild(b$.lastChild);}});r.IterSelector(b8,"[ws-replace]",function(b$){if(!b9.Contains(b$.getAttribute("ws-replace")))b$.parentNode.removeChild(b$);});r.IterSelector(b8,"[ws-on]",function(b$){b$.setAttribute("ws-on",bv.concat(" ",bt.filter(function(ca){return b9.Contains(bt.get(bv.SplitChars(ca,[58],1),1));},bv.SplitChars(b$.getAttribute("ws-on"),[32],1))));});return r.IterSelector(b8,"[ws-attr-holes]",function(b$){var ca,cb,cc,cd,ce;ca=bv.SplitChars(b$.getAttribute("ws-attr-holes"),[32],1);for(cb=0,cc=ca.length-1;cb<=cc;cb++){cd=bt.get(ca,cb);b$.setAttribute(cd,(ce=new a.RegExp(_9.TextHoleRE(),"g"),b$.getAttribute(cd).replace(ce,function(cf,cg){return b9.Contains(cg)?cf:"";})));}});}function b1(b8,b9){var b_;b_=b8.querySelector("[ws-replace]");return bC.Equals(b_,null)?(bD.warn("Filling non-existent text hole",bT),null):(b_.parentNode.replaceChild(new a.Text(b9),b_),{$:1,$0:b_.getAttribute("ws-replace")});}function b2(b8,b9,b_){while(true)if(b8.hasChildNodes())b_=b9.insertBefore(b8.lastChild,b_);else return null;}function b3(b8,b9,b_){var b$,ca,cb,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv;while(true)switch(b8){case 0:function cc(cw){}cd=bQ.string(b9.nodeName,{$:1,$0:3},null).toLowerCase();ce=cd.indexOf(bR.fromCharCode(46))===-1?bS+"/"+cd:bv.Replace(cd,".","/");if(!_9.LoadedTemplates().ContainsKey(ce))return bD.warn("Instantiating non-loaded template",ce);else{cf=_9.LoadedTemplates().get_Item(ce);cg=cf.cloneNode(true);ch=new by.New$3();ci=new bL.New$5();cj=b9.attributes;for(ck=0,cl=cj.length-1;ck<=cl;ck++){cm=cj.item(ck).name.toLowerCase();ci.set_Item(cm,(cn=cj.item(ck).nodeValue,cn===""?cm:cn.toLowerCase()));!ch.Add(cm)?bD.warn("Hole mapped twice",cm):void 0;}for(co=0,cp=b9.childNodes.length-1;co<=cp;co++){cq=b9.childNodes[co];bC.Equals(cq.nodeType,bO.ELEMENT_NODE)?!ch.Add(cq.nodeName.toLowerCase())?bD.warn("Hole filled twice",ce):void 0:void 0;}cr=b9.childNodes.length===1&&bC.Equals(b9.firstChild.nodeType,bO.TEXT_NODE);if(cr){ca=b1(cg,b9.firstChild.textContent);((function(cw){return function(cx){if(cx!=null)cw(cx.$0);};}((cb=function(cw){return function(cx){return cw.Add(cx);};}(ch),function(cw){return cc(cb(cw));})))(ca));}b0(cg,ch);if(!cr){for(cs=0,ct=b9.childNodes.length-1;cs<=ct;cs++){cu=b9.childNodes[cs];bC.Equals(cu.nodeType,bO.ELEMENT_NODE)?cu.hasAttributes()?bZ(cg,cu):b4(cg,cu):void 0;}}bY(cg,ci);(((function(cw){function cx(cy,cz){return b2(cw,cy,cz);}return function(cy){return function(cz){return cx(cy,cz);};};}(cg))(b9.parentNode))(b9));{b9.parentNode.removeChild(b9);return;}}break;case 1:if(b_!==null){cv=b_.nextSibling;if(bC.Equals(b_.nodeType,bO.TEXT_NODE))bX(b_);else if(bC.Equals(b_.nodeType,bO.ELEMENT_NODE))b6(b_);b_=cv;}else return null;break;}}function b4(b8,b9){var b_,ca,cb;function b$(cc,cd){var ce,cf,cg;if(ca==="title"&&b9.hasChildNodes()){ce=bP.parseHTML(b9.textContent);b9.removeChild(b9.firstChild);for(cf=0,cg=ce.length-1;cf<=cg;cf++)b9.appendChild(bt.get(ce,cf));}else null;b6(b9);return b2(b9,cc,cd);}ca=b9.nodeName.toLowerCase();r.IterSelector(b8,"[ws-attr-holes]",function(cc){var cd,ce,cf,cg,ch;cd=bv.SplitChars(cc.getAttribute("ws-attr-holes"),[32],1);for(ce=0,cf=cd.length-1;ce<=cf;ce++){cg=bt.get(cd,ce);cc.setAttribute(cg,(ch=new a.RegExp("\\${"+ca+"}","ig"),cc.getAttribute(cg).replace(ch,b9.textContent)));}});cb=b8.querySelector("[ws-hole="+ca+"]");if(bC.Equals(cb,null)){b_=b8.querySelector("[ws-replace="+ca+"]");return bC.Equals(b_,null)?null:(b$(b_.parentNode,b_),void b_.parentNode.removeChild(b_));}else{while(cb.hasChildNodes())cb.removeChild(cb.lastChild);cb.removeAttribute("ws-hole");return b$(cb,null);}}function b5(b8){return b3(0,b8);}function b6(b8){var b9,b_;if(bv.StartsWith(b8.nodeName.toLowerCase(),"ws-")&&!b8.hasAttribute("ws-template"))b5(b8);else{bW(b8);b9=b8.getAttribute("ws-template");if(b9===null){b_=b8.getAttribute("ws-children-template");if(b_===null)b7(b8,b8.firstChild);else{b8.removeAttribute("ws-children-template");_.PrepareTemplate(bS,{$:1,$0:b_},function(){return r.ChildrenArray(b8);});while(b8.hasChildNodes())b8.removeChild(b8.lastChild);}}else _.PrepareSingleTemplate(bS,{$:1,$0:b9},b8);}}function b7(b8,b9){return b3(1,b8,b9);}bV=_.FakeRoot(bU);_9.LoadedTemplates().set_Item(_.ComposeName(bS,bT),bV);bt.length(bU)>0?b7(bV,bt.get(bU,0)):void 0;};_.ComposeName=function(bS,bT){return(bS+"/"+(bT==null?"":bT.$0)).toLowerCase();};_.PrepareSingleTemplate=function(bS,bT,bU){var bV,bW,bX;bU.removeAttribute("ws-template");bV=bU.getAttribute("ws-replace");bV===null?void 0:(bU.removeAttribute("ws-replace"),bW=bU.parentNode,bC.Equals(bW,null)?void 0:(bX=a.document.createElement(bU.tagName),bX.setAttribute("ws-replace",bV),bW.replaceChild(bX,bU)));_.PrepareTemplateStrict(bS,bT,[bU]);};_.FakeRoot=function(bS){var bT,bU,bV;bT=a.document.createElement("div");for(bU=0,bV=bS.length-1;bU<=bV;bU++)bT.appendChild(bt.get(bS,bU));return bT;};_.ChildrenTemplate=function(bS,bT){var bU,bV,bW,bX,bY,b1,b2,b3,b4,b5,b6,b7;function bZ(b8,b9){var b_,b$,ca;b_=_0.Insert(b8,b9);b2.push(_0.Updates(b_));b3.push([b8,b_]);b$=bB.GetOptional(b_.OnAfterRender);return b$==null?null:(ca=b$.$0,void b4.push(function(){ca(b8);}));}function b0(b8){var b9,b_;b9=(b_=null,[b5.TryGetValue(b8,{get:function(){return b_;},set:function(b$){b_=b$;}}),b_]);return b9[0]?b9[1].$==0?{$:1,$0:b9[1].$1}:b9[1].$==1?{$:1,$0:_.TextNode(b9[1].$1)}:b9[1].$==2?{$:1,$0:_.TextView(b9[1].$1)}:b9[1].$==6?{$:1,$0:_.TextView(b9[1].$1.RView())}:b9[1].$==7?{$:1,$0:_.TextView(z.Map(bR,b9[1].$1.RView()))}:b9[1].$==8?{$:1,$0:_.TextView(z.Map(function(b$){return b$.get_Input();},b9[1].$1.RView()))}:b9[1].$==9?{$:1,$0:_.TextView(z.Map(bR,b9[1].$1.RView()))}:b9[1].$==10?{$:1,$0:_.TextView(z.Map(function(b$){return b$.get_Input();},b9[1].$1.RView()))}:b9[1].$==11?{$:1,$0:_.TextView(z.Map(bR,b9[1].$1.RView()))}:(bD.warn("Content hole filled with attribute data",b8),null):null;}b1=[];b2=[];b3=[];b4=[];b5=new bL.New$5();b6=bu.Get(bT);try{while(b6.MoveNext()){b7=b6.Current();b5.set_Item(b7.$0,b7);}}finally{if("Dispose"in b6)b6.Dispose();}bU=r.ChildrenArray(bS);r.IterSelector(bS,"[ws-hole]",function(b8){var b9,b_,b$;b$=b8.getAttribute("ws-hole");b8.removeAttribute("ws-hole");while(b8.hasChildNodes())b8.removeChild(b8.lastChild);b9=b0(b$);b9!=null&&b9.$==1?(b_=b9.$0,_9.LinkElement(b8,b_.docNode),b1.push(_4.New(_0.Empty(b8),b_.docNode,null,b8,h.Int(),null)),b2.push(b_.updates)):void 0;});r.IterSelector(bS,"[ws-replace]",function(b8){var b9,b_,b$,ca,cb,cc;b9=b0(b8.getAttribute("ws-replace"));b9!=null&&b9.$==1?(b_=b9.$0,b$=b8.parentNode,ca=a.document.createTextNode(""),b$.replaceChild(ca,b8),cb=_9.InsertBeforeDelim(ca,b_.docNode),cc=bt.tryFindIndex(function(cd){return b8===cd;},bU),cc==null?void 0:bt.set(bU,cc.$0,b_.docNode),b1.push(_4.New(_0.Empty(b$),b_.docNode,{$:1,$0:[cb,ca]},b$,h.Int(),null)),b2.push(b_.updates)):void 0;});r.IterSelector(bS,"[ws-attr]",function(b8){var b9,b_,b$;b9=b8.getAttribute("ws-attr");b8.removeAttribute("ws-attr");b_=(b$=null,[b5.TryGetValue(b9,{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);b_[0]?b_[1].$==3?bZ(b8,b_[1].$1):bD.warn("Attribute hole filled with non-attribute data",b9):void 0;});r.IterSelector(bS,"[ws-on]",function(b8){bZ(b8,W.Concat(bt.choose(function(b9){var b_,b$,ca;b_=bv.SplitChars(b9,[58],1);b$=(ca=null,[b5.TryGetValue(bt.get(b_,1),{get:function(){return ca;},set:function(cb){ca=cb;}}),ca]);return b$[0]?b$[1].$==4?{$:1,$0:_2.Handler(bt.get(b_,0),b$[1].$1)}:(bD.warn("Event hole on"+bt.get(b_,0)+" filled with non-event data",bt.get(b_,1)),null):null;},bv.SplitChars(b8.getAttribute("ws-on"),[32],1))));b8.removeAttribute("ws-on");});r.IterSelector(bS,"[ws-onafterrender]",function(b8){var b9,b_,b$;b9=b8.getAttribute("ws-onafterrender");b_=(b$=null,[b5.TryGetValue(b9,{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);b_[0]?b_[1].$==5?(b8.removeAttribute("ws-onafterrender"),bZ(b8,_2.OnAfterRender(b_[1].$1))):bD.warn("onafterrender hole filled with non-onafterrender data",b9):void 0;});r.IterSelector(bS,"[ws-var]",function(b8){var b9,b_,b$;b9=b8.getAttribute("ws-var");b8.removeAttribute("ws-var");b_=(b$=null,[b5.TryGetValue(b9,{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);b_[0]?b_[1].$==6?bZ(b8,_2.Value(b_[1].$1)):b_[1].$==7?bZ(b8,_2.Checked(b_[1].$1)):b_[1].$==8?bZ(b8,_2.IntValue(b_[1].$1)):b_[1].$==9?bZ(b8,_2.IntValueUnchecked(b_[1].$1)):b_[1].$==10?bZ(b8,_2.FloatValue(b_[1].$1)):b_[1].$==11?bZ(b8,_2.FloatValueUnchecked(b_[1].$1)):bD.warn("Var hole filled with non-Var data",b9):void 0;});r.IterSelector(bS,"[ws-attr-holes]",function(b8){var b9,b_,b$,ca;b9=new a.RegExp(_9.TextHoleRE(),"g");b_=bv.SplitChars(b8.getAttribute("ws-attr-holes"),[32],1);b8.removeAttribute("ws-attr-holes");for(b$=0,ca=b_.length-1;b$<=ca;b$++)(function(){var cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn;ck=bt.get(b_,b$);cl=b8.getAttribute(ck);cb=null;cc=0;cm=[];while(cb=b9.exec(cl),cb!==null){cn=bQ.string(cl,{$:1,$0:cc},{$:1,$0:b9.lastIndex-bt.get(cb,0).length-1});cc=b9.lastIndex;cm.push([cn,bt.get(cb,1)]);}ce=bQ.string(cl,{$:1,$0:cc},null);b9.lastIndex=0;cf=bt.foldBack(function(co,cp){return(function(cq){var cr,cs;cr=cq[0];cs=cq[1];return function(ct){var cu,cv,cw,cx,cy;cu=ct[0];cv=ct[1];cw=(cx=(cy=null,[b5.TryGetValue(cs,{get:function(){return cy;},set:function(cz){cy=cz;}}),cy]),cx[0]?cx[1].$==1?{$:0,$0:cx[1].$1}:cx[1].$==2?{$:1,$0:cx[1].$1}:cx[1].$==6?{$:1,$0:cx[1].$1.RView()}:cx[1].$==7?{$:1,$0:z.Map(bR,cx[1].$1.RView())}:cx[1].$==8?{$:1,$0:z.Map(function(cz){return cz.get_Input();},cx[1].$1.RView())}:cx[1].$==9?{$:1,$0:z.Map(bR,cx[1].$1.RView())}:cx[1].$==10?{$:1,$0:z.Map(function(cz){return cz.get_Input();},cx[1].$1.RView())}:cx[1].$==11?{$:1,$0:z.Map(bR,cx[1].$1.RView())}:(bD.warn("Attribute value hole filled with non-text data",cs),{$:0,$0:""}):{$:0,$0:""});return cw.$==1?[cr,new bs.T({$:1,$0:cu===""?cw.$0:z.Map(function(cz){return cz+cu;},cw.$0),$1:cv})]:[cr+cw.$0+cu,cv];};}(co))(cp);},cm,[ce,bs.T.Empty]);return bZ(b8,cf[1].$==1?cf[1].$1.$==1?cf[1].$1.$1.$==1?cf[1].$1.$1.$1.$==0?(cg=cf[0],_2.Dynamic(ck,z.Map3(function(co,cp,cq){return cg+co+cp+cq;},cf[1].$0,cf[1].$1.$0,cf[1].$1.$1.$0))):(ch=cf[0],_2.Dynamic(ck,z.Map(function(co){return ch+bv.concat("",co);},z.Sequence(cf[1])))):(ci=cf[0],_2.Dynamic(ck,z.Map2(function(co,cp){return ci+co+cp;},cf[1].$0,cf[1].$1.$0))):cf[0]===""?_2.Dynamic(ck,cf[1].$0):(cj=cf[0],_2.Dynamic(ck,z.Map(function(co){return cj+co;},cf[1].$0))):W.Create(ck,cf[0]));}());});bV=bB.DeleteEmptyFields({Els:bU,Dirty:true,Holes:b1,Attrs:b3,Render:(bW=b4.length==0?null:{$:1,$0:function(b8){bt.iter(function(b9){b9(b8);},b4);}},bW?bW.$0:void 0)},["Render"]);bX=e.TreeReduce(z.Const(),z.Map2Unit,b2);return bU&&bt.length(bU)===1&&(bt.get(bU,0)instanceof bO&&(bC.Equals(bt.get(bU,0).nodeType,bO.ELEMENT_NODE)&&(bY=bt.get(bU,0),true)))?$.TreeNode(bV,bX):_.Mk({$:6,$0:bV},bX);};_.Template=function(bS,bT){return _.ChildrenTemplate(_.FakeRoot(bS),bT);};_.TextView=function(bS){var bT;bT=_9.CreateTextNode();return _.Mk({$:4,$0:bT},z.Map(function(bU){_9.UpdateTextNode(bT,bU);},bS));};_.RunReplaceById=function(bS,bT){var bU;bU=r.Doc().getElementById(bS);bC.Equals(bU,null)?bI.FailWith("invalid id: "+bS):bT.ReplaceInDom(bU);};_.RunById=function(bS,bT){var bU;bU=r.Doc().getElementById(bS);bC.Equals(bU,null)?bI.FailWith("invalid id: "+bS):_.Run(bU,bT);};_.Run=function(bS,bT){var bU;bU=bT.docNode;_9.LinkElement(bS,bU);z.Sink(m.StartProcessor(_9.PerformAnimatedUpdate(_9.CreateRunState(bS,bU),bU)),bT.updates);};_.RunPrependById=function(bS,bT){var bU;bU=r.Doc().getElementById(bS);bC.Equals(bU,null)?bI.FailWith("invalid id: "+bS):_.RunPrepend(bU,bT);};_.RunPrepend=function(bS,bT){var bU;bU=a.document.createTextNode("");bS.insertBefore(bU,bS.firstChild);_.RunBefore(bU,bT);};_.RunAppendById=function(bS,bT){var bU;bU=r.Doc().getElementById(bS);bC.Equals(bU,null)?bI.FailWith("invalid id: "+bS):_.RunAppend(bU,bT);};_.RunAppend=function(bS,bT){var bU;bU=a.document.createTextNode("");bS.appendChild(bU);_.RunBefore(bU,bT);};_.RunAfterById=function(bS,bT){var bU;bU=r.Doc().getElementById(bS);bC.Equals(bU,null)?bI.FailWith("invalid id: "+bS):_.RunAfter(bU,bT);};_.RunAfter=function(bS,bT){var bU;bU=a.document.createTextNode("");bS.parentNode.insertBefore(bU,bS.nextSibling);_.RunBetween(bS,bU,bT);};_.RunBeforeById=function(bS,bT){var bU;bU=r.Doc().getElementById(bS);bC.Equals(bU,null)?bI.FailWith("invalid id: "+bS):_.RunBefore(bU,bT);};_.RunBefore=function(bS,bT){var bU;bU=a.document.createTextNode("");bS.parentNode.insertBefore(bU,bS);_.RunBetween(bU,bS,bT);};_.RunBetween=function(bS,bT,bU){_9.LinkPrevElement(bT,bU.docNode);z.Sink(m.StartProcessor(_9.PerformAnimatedUpdate(_9.CreateDelimitedRunState(bS,bT,bU.docNode),bU.docNode)),bU.updates);};_.Async=function(bS){return _.EmbedView(z.MapAsync(a.id,z.Const(bS)));};_.BindView=function(bS,bT){return _.EmbedView(z.Map(bS,bT));};_.EmbedView=function(bS){var bT;bT=_9.CreateEmbedNode();return _.Mk({$:2,$0:bT},z.Map(a.ignore,z.Bind(function(bU){_9.UpdateEmbedNode(bT,bU.docNode);return bU.updates;},bS)));};_.Static=function(bS){return $.New(bS,_0.EmptyAttr(),_.Empty());};_.Mk=function(bS,bT){return new _.New(bS,bT);};_.New=bB.Ctor(function(bS,bT){this.docNode=bS;this.updates=bT;},_);$=d.Elt=bB.Class({AddClass:function(bS){return this.elt.className+=" "+bS;},ClearHoles:function(){var bS;bS=this.docNode$1;bS!=null&&bS.$==6?bS.$0.Holes=[]:void 0;},AddHole:function(bS){var bT;bT=this.docNode$1;bT!=null&&bT.$==6?bT.$0.Holes.push(bS):void 0;},SetStyle:function(bS,bT){this.elt.style[bS]=bT;},HasClass:function(bS){return(new a.RegExp("(\\s|^)"+bS+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(bS){this.elt.className=this.elt.className.replace(new a.RegExp("(?:(\\s|^)"+bS+")+(\\s|$)","g"),"$1");},GetProperty:function(bS){return this.elt[bS];},SetProperty:function(bS,bT){this.elt[bS]=bT;},RemoveAttribute:function(bS){this.elt.removeAttribute(bS);},HasAttribute:function(bS){return this.elt.hasAttribute(bS);},GetAttribute:function(bS){return this.elt.getAttribute(bS);},SetAttribute:function(bS,bT){this.elt.setAttribute(bS,bT);},SetText:function(bS){var bT;bT=this.docNode$1;bT!=null&&bT.$==1?bT.$0.Children=null:bT!=null&&bT.$==6?(bT.$0.Els=[],this.ClearHoles()):bI.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(z.Const());this.elt.textContent=bS;},GetText:function(){return this.elt.textContent;},SetValue:function(bS){this.elt.value=bS;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var bS;bS=this.docNode$1;bS!=null&&bS.$==1?bS.$0.Children=null:bS!=null&&bS.$==6?(bS.$0.Els=[],this.ClearHoles()):bI.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(z.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(bS){var bT,bU,bV,bW,bX;bT=this.docNode$1;bT!=null&&bT.$==1?(bU=bT.$0,bU.Children={$:0,$0:bS.docNode,$1:bU.Children},_9.InsertDoc(this.elt,bS.docNode,(bV=this.elt.firstChild,bC.Equals(bV,null)?null:bV))):bT!=null&&bT.$==6?(bW=this.elt.insertBefore(a.document.createTextNode(""),this.elt.firstChild),bX=_9.InsertBeforeDelim(bW,bS.docNode),this.AddHole(_4.New(_0.Empty(this.elt),bS.docNode,{$:1,$0:[bX,bW]},this.elt,h.Int(),null))):bI.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(z.Map2Unit(this.rvUpdates.c,bS.updates));},Append:function(bS){var bT,bU,bV,bW;bT=this.docNode$1;bT!=null&&bT.$==1?(bU=bT.$0,bU.Children={$:0,$0:bU.Children,$1:bS.docNode},_9.InsertDoc(this.elt,bS.docNode,null)):bT!=null&&bT.$==6?(bV=this.elt.appendChild(a.document.createTextNode("")),bW=_9.InsertBeforeDelim(bV,bS.docNode),this.AddHole(_4.New(_0.Empty(this.elt),bS.docNode,{$:1,$0:[bW,bV]},this.elt,h.Int(),null))):bI.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(z.Map2Unit(this.rvUpdates.c,bS.updates));},ToUpdater:function(){var bS,bT;return new ba.New((bS=this.docNode$1,bS!=null&&bS.$==1?bB.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,bS.$0.Attr]],Render:(bT=null,bT?bT.$0:void 0)},["Render"]):bS!=null&&bS.$==6?bS.$0:bI.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,x.Create$1([]));},OnAfterRenderView:function(bS,bT){var bU,bV;bU=this;bV=h.Id();this.Append(_.BindView(function(bW){bU.elt[bV]=bW;return _.Empty();},bS));return this.OnAfterRender(function(bW){bT(bW,bW[bV]);});},OnAfterRender:function(bS){var bT,bU,bV,bW,bX,bY,bZ;bT=this.docNode$1;bT!=null&&bT.$==1?(bU=bT.$0,bB.SetOptional(bU,"Render",(bV=bB.GetOptional(bU.Render),bV!=null&&bV.$==1?(bW=bV.$0,{$:1,$0:function(b0){bW(b0);bS(b0);}}):{$:1,$0:bS}))):bT!=null&&bT.$==6?(bX=bT.$0,bB.SetOptional(bX,"Render",(bY=bB.GetOptional(bX.Render),bY!=null&&bY.$==1?(bZ=bY.$0,{$:1,$0:function(b0){bZ(b0);bS(b0);}}):{$:1,$0:bS}))):bI.FailWith("Invalid docNode in Elt");return this;},onView:function(bS,bT,bU){var bV;bV=bU(this.elt);this.elt.addEventListener(bS,function(bW){return z.Get(bV(bW),bT);},false);return this;},on:function(bS,bT){this.elt.addEventListener(bS,function(bU){return bT(bU.target,bU);},false);return this;}},_,$);$.TreeNode=function(bS,bT){var bU,bV;function bW(bX){return bX[1];}bU=y.Create(bT);return new $.New$1({$:6,$0:bS},z.Map2Unit((bV=bt.map(function(bX){return _0.Updates(bW(bX));},bS.Attrs),e.TreeReduce(z.Const(),z.Map2Unit,bV)),bU.v),bt.get(bS.Els,0),bU);};$.New=function(bS,bT,bU){var bV,bW;bV=_9.CreateElemNode(bS,bT,bU.docNode);bW=y.Create(bU.updates);return new $.New$1({$:1,$0:bV},z.Map2Unit(_0.Updates(bV.Attr),bW.v),bS,bW);};$.New$1=bB.Ctor(function(bS,bT,bU,bV){_.New.call(this,bS,bT);this.docNode$1=bS;this.updates$1=bT;this.elt=bU;this.rvUpdates=bV;},$);ba=X.EltUpdater=bB.Class({RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;x.Set(this.holeUpdates,[]);},RemoveUpdated:function(bS){var bT,bU;function bV(bW){return bW===bU?false:true;}bT=bS.docNode;bT!=null&&bT.$==1?(bU=bT.$0.ElKey,this.treeNode.Holes=bt.filter(function(bW){return bW.ElKey!==bU;},this.treeNode.Holes),x.Set(this.holeUpdates,bt.filter(function(bW){return bV(bW[0]);},this.holeUpdates.c))):bI.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(bS){var bT,bU,bV;bT=bS.docNode;bT!=null&&bT.$==1?(bU=bT.$0,this.treeNode.Holes=this.treeNode.Holes.concat([bU]),bV=this.holeUpdates.c,bV.push([bU.ElKey,bS.updates]),x.Set(this.holeUpdates,bV)):bI.FailWith("DocUpdater.AddUpdated expects a single element node");},ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];x.Set(this.holeUpdates,[]);},AddHole:function(bS){this.origHoles.push(bS);this.treeNode.Holes=this.treeNode.Holes.concat([bS]);}},$,ba);ba.New=bB.Ctor(function(bS,bT,bU,bV,bW){var bX,bY,bZ;function b0(b1){return b1[1];}$.New$1.call(this,{$:6,$0:bS},z.Map2Unit(bT,z.BindInner((bX=function(b1){return bt.map(b0,b1);},(bY=(bZ=z.Const(),function(b1){return e.TreeReduce(bZ,z.Map2Unit,b1);}),function(b1){return bY(bX(b1));})),bW.v)),bU,bV);this.treeNode=bS;this.holeUpdates=bW;this.origHoles=this.treeNode.Holes;},ba);bb.$cctor=bB.Cctor(function(){bb.LoadedTemplates=new bL.New$5();bb.TextHoleRE="\\${([^}]+)}";bb.$cctor=a.ignore;});bc=d.Flow=bB.Class({get_Render:function(){return this.render;}},null,bc);bc.New=bB.Ctor(function(bS){bc.New$1.call(this,function(bT){return function(bU){return x.Set(bT,bS(bU));};});},bc);bc.New$1=bB.Ctor(function(bS){this.render=bS;},bc);bc.get_Do=function(){return new bd.New();};bc.Static=function(bS){return new bc.New$1(function(bT){return function(bU){x.Set(bT,bS);return bU();};});};bc.Define=function(bS){return new bc.New(function(bT){return bS(function(bU){bT(bU);});});};bc.Embed=function(bS){var bT;bT=x.Create$1(_.Empty());((bS.get_Render())(bT))(a.ignore);return _.EmbedView(bT.v);};bc.Return=function(bS){return new bc.New$1(function(){return function(bT){return bT(bS);};});};bc.Bind=function(bS,bT){return new bc.New$1(function(bU){return function(bV){return((bS.get_Render())(bU))(function(bW){((bT(bW).get_Render())(bU))(bV);});};});};bc.Map=function(bS,bT){return new bc.New$1(function(bU){return function(bV){return((bT.get_Render())(bU))(function(bW){bV(bS(bW));});};});};bd=d.FlowBuilder=bB.Class({ReturnFrom:a.id,Return:function(bS){return bc.Return(bS);},Bind:function(bS,bT){return bc.Bind(bS,bT);}},null,bd);bd.New=bB.Ctor(function(){},bd);bf=be.attr=bB.Class({},null,bf);bf.New=bB.Ctor(function(){},bf);bg.Append=function(bS,bT){return{$:0,$0:p.Append(bS.$0,bT.$0),$1:bF.FoldBack(function(bU,bV,bW){return bW.Add(bU,bV);},bS.$1,bT.$1)};};bg.FromList=function(bS,bT){return{$:0,$0:p.FromArray(bt.ofList(bS)),$1:bT};};bg.ToList=function(bS){return[bs.ofArray(p.ToArray(bS.$0)),bS.$1];};bg.SameHash=function(bS,bT){return bg.NoHash(bS)===bg.NoHash(bT);};bg.MakeHash=function(bS){var bT,bU;bT=bS.$1;bU=bv.concat("/",bt.map(function(bV){return a.encodeURIComponent(bV);},p.ToArray(bS.$0)));return bT.get_IsEmpty()?bU:bU+"?"+bv.concat("&",bz.map(function(bV){var bW;bW=bI.KeyValue(bV);return a.encodeURIComponent(bW[0])+"="+a.encodeURIComponent(bW[1]);},bT));};bg.ParseHash=function(bS){var bT,bU,bV,bW;bT=bg.NoHash(bS);bU=(bV=bT.indexOf(bR.fromCharCode(63)),bV===-1?[bT,""]:[bQ.string(bT,null,{$:1,$0:bV-1}),bQ.string(bT,{$:1,$0:bV+1},null)]);bW=bU[0];return{$:0,$0:p.FromArray(bW===""?[]:bt.map(function(bX){return a.decodeURIComponent(bX);},bv.SplitChars(bW,[47],0))),$1:bF.OfArray(bt.map(function(bX){var bY;bY=bX.indexOf(bR.fromCharCode(61));return bY===-1?[a.decodeURIComponent(bX),""]:[a.decodeURIComponent(bQ.string(bX,null,{$:1,$0:bY-1})),a.decodeURIComponent(bQ.string(bX,{$:1,$0:bY+1},null))];},bv.SplitChars(bU[1],[38],0)))};};bg.NoHash=function(bS){return bv.StartsWith(bS,"#")?bS.substring(1):bS;};bi.New=function(bS,bT,bU,bV){return{Bodies:bS,CurrentRoute:bT,CurrentSite:bU,Selection:bV};};bh.Install=function(bS,bT){var bU,bV,bW,bX,bY,bZ,b0;function b1(b4,b5){var b6;b6=b5.$0;return b5.$1({UpdateRoute:function(b7){bh.OnInternalSiteUpdate(bW,b6,b4,b7);}});}function b2(b4){return t.Lookup(bX,(bg.ToList(b4))[0]);}function b3(b4){var b5;b5=b2(b4);b5.$==1?void 0:bh.OnGlobalRouteChange(bW,b5.$0,bg.FromList(b5.$1,new bG.New([])));}bU=bT.$0;bV=bh.InstallMap({Des:function(b4){return bg.FromList(b4[0],b4[1]);},Ser:bg.ToList});bW=bi.New(void 0,bV,0,void 0);bX=t.Map(function(b4){return function(b5){return b1(b4,b5);};},bT.$1);bW.Bodies=bh.ComputeBodies(bX);bY=(bZ=b2(bV.c),bZ.$==0?(b0=bZ.$0,(bW.CurrentSite=b0.RouteId,x.Create$1(b0.RouteValue))):x.Create$1(bU!=null&&bU.$==1?bU.$0:bI.FailWith("Site.Install fails on empty site")));bW.Selection=bY;z.Sink(function(b4){bh.OnSelectSite(bW,bS(b4));},bY.v);b3(bV.c);z.Sink(b3,bV.v);return bY;};bh.OnSelectSite=function(bS,bT){var bU;bU=bT.$0;bS.CurrentSite!==bU?(bS.CurrentSite=bU,bS.Bodies.get_Item(bU).OnSelect()):void 0;};bh.OnInternalSiteUpdate=function(bS,bT,bU,bV){if(bS.CurrentSite===bT)bh.SetCurrentRoute(bS,bg.Append(bg.FromList(bU,new bG.New([])),bV));};bh.OnGlobalRouteChange=function(bS,bT,bU){bS.CurrentSite!==bT.RouteId?(bS.CurrentSite=bT.RouteId,x.Set(bS.Selection,bT.RouteValue)):void 0;bT.OnRouteChanged(bU);};bh.SetCurrentRoute=function(bS,bT){if(!bC.Equals(bS.CurrentRoute.c,bT))x.Set(bS.CurrentRoute,bT);};bh.ComputeBodies=function(bS){var bT;bT=new bL.New$5();bt.iter(function(bU){bT.set_Item(bU.RouteId,bU);},t.ToArray(bS));return bT;};bh.MergeRouters=function(bS){var bT,bU,bV;bT=e.ofSeqNonCopying(bS);bU=t.Merge(bz.map(function(bW){return bW.$1;},bT));bV=bz.tryPick(function(bW){return bW.$0;},bT);return bU!=null&&bU.$==1?{$:0,$0:bV,$1:bU.$0}:bI.FailWith("Invalid Site.Merge: need more prefix disambiguation");};bh.DefineRoute=function(bS,bT,bU){var bV,bW,bX;bV=x.Create$1(bT);bW=h.Int();bX=bU({$:0,$0:bW},bV);return{$:0,$0:{$:1,$0:bX},$1:t.Leaf({$:0,$0:bW,$1:function(bY){z.Sink(function(bZ){bY.UpdateRoute(bh.DoLink(bS,bZ));},bV.v);return{OnRouteChanged:function(bZ){x.Set(bV,bh.DoRoute(bS,bZ));},OnSelect:function(){bY.UpdateRoute(bh.DoLink(bS,bV.c));},RouteId:bW,RouteValue:bX};}})};};bh.DoLink=function(bS,bT){var bU;bU=bS.Ser(bT);return bg.FromList(bU[0],bU[1]);};bh.DoRoute=function(bS,bT){return bS.Des(bg.ToList(bT));};bh.InstallMap=function(bS){var bT;function bU(bY,bZ){return bC.Equals(bS.Ser(bY),bS.Ser(bZ));}function bV(){return bS.Des(bg.ToList(bg.ParseHash(a.location.hash)));}function bW(bY){if(!bU(bT.c,bY))x.Set(bT,bY);}function bX(bY){return bW(bV());}bT=x.Create$1(bV());a.onpopstate=bX;a.onhashchange=bX;z.Sink(function(bY){var bZ,b0;bZ=bg.MakeHash((b0=bS.Ser(bY),bg.FromList(b0[0],b0[1])));!bg.SameHash(a.location.hash,bZ)?a.location.replace("#"+bZ):void 0;},bT.v);return bT;};bj.Install=function(bS){return bh.InstallMap(bS);};bj.Create=function(bS,bT){function bU(bV){return bV[0];}return{Des:function(bV){return bT(bU(bV));},Ser:function(bV){return[bS(bV),new bG.New([])];}};};bj.CreateWithQuery=function(bS,bT){return{Des:bT,Ser:bS};};bk.Route=function(bS,bT,bU){return bh.DefineRoute(bS,bT,bU);};bk.Prefix=function(bS,bT){return{$:0,$0:bT.$0,$1:t.Prefix(bS,bT.$1)};};bk.Merge=function(bS){return bh.MergeRouters(bS);};bk.Install=function(bS,bT){return bh.Install(bS,bT);};bk.Dir=function(bS,bT){return bk.Prefix(bS,bk.Merge(bT));};bm.New=function(bS,bT){return{Active:bS,PosV:bT};};bn.New=function(bS,bT,bU,bV){return{Active:bS,Left:bT,Middle:bU,Right:bV};};bo.get_MousePressed=function(){bl.ActivateButtonListener();return z.Apply(z.Apply(z.Apply(z.Const(bB.Curried3(function(bS,bT,bU){return bS||bT||bU;})),bl.MouseBtnSt$1().Left.v),bl.MouseBtnSt$1().Middle.v),bl.MouseBtnSt$1().Right.v);};bo.get_RightPressed=function(){bl.ActivateButtonListener();return bl.MouseBtnSt$1().Right.v;};bo.get_MiddlePressed=function(){bl.ActivateButtonListener();return bl.MouseBtnSt$1().Middle.v;};bo.get_LeftPressed=function(){bl.ActivateButtonListener();return bl.MouseBtnSt$1().Left.v;};bo.get_Position=function(){!bl.MousePosSt$1().Active?(a.document.addEventListener("mousemove",function(bS){x.Set(bl.MousePosSt$1().PosV,[bS.clientX,bS.clientY]);},false),bl.MousePosSt$1().Active=true):void 0;return bl.MousePosSt$1().PosV.v;};bp.New=function(bS,bT,bU){return{KeysPressed:bS,KeyListenerActive:bT,LastPressed:bU};};bq.IsPressed=function(bS){function bT(bU){return bU===bS;}bl.ActivateKeyListener();return z.Map(function(bU){return bs.exists(bT,bU);},bl.KeyListenerState().KeysPressed.v);};bq.get_LastPressed=function(){bl.ActivateKeyListener();return bl.KeyListenerState().LastPressed.v;};bq.get_KeysPressed=function(){bl.ActivateKeyListener();return bl.KeyListenerState().KeysPressed.v;};bl.ActivateKeyListener=function(){br.$cctor();return br.ActivateKeyListener;};bl.KeyListenerState=function(){br.$cctor();return br.KeyListenerState;};bl.ActivateButtonListener=function(){br.$cctor();return br.ActivateButtonListener;};bl.MouseBtnSt$1=function(){br.$cctor();return br.MouseBtnSt;};bl.MousePosSt$1=function(){br.$cctor();return br.MousePosSt;};br.$cctor=bB.Cctor(function(){function bS(bT,bU){var bV;bV=bT.button;return bV===0?x.Set(bl.MouseBtnSt$1().Left,bU):bV===1?x.Set(bl.MouseBtnSt$1().Middle,bU):bV===2?x.Set(bl.MouseBtnSt$1().Right,bU):null;}br.MousePosSt=bm.New(false,x.Create$1([0,0]));br.MouseBtnSt=bn.New(false,x.Create$1(false),x.Create$1(false),x.Create$1(false));br.ActivateButtonListener=!bl.MouseBtnSt$1().Active?(bl.MouseBtnSt$1().Active=true,a.document.addEventListener("mousedown",function(bT){return bS(bT,true);},false),a.document.addEventListener("mouseup",function(bT){return bS(bT,false);},false)):null;br.KeyListenerState=bp.New(x.Create$1(bs.T.Empty),false,x.Create$1(-1));br.ActivateKeyListener=!bl.KeyListenerState().KeyListenerActive?(bP(a.document).keydown(function(bT){var bU,bV;bU=bT.which;x.Set(bl.KeyListenerState().LastPressed,bU);bV=bl.KeyListenerState().KeysPressed.c;return!bs.exists(function(bW){return bW===bU;},bV)?x.Set(bl.KeyListenerState().KeysPressed,bs.append(bV,bs.ofArray([bU]))):null;}),void bP(a.document).keyup(function(bT){var bU;function bV(bW){return bW!==bU;}bU=bT.which;return x.Update(bl.KeyListenerState().KeysPressed,function(bW){return bs.filter(bV,bW);});})):null;br.$cctor=a.ignore;});}());
