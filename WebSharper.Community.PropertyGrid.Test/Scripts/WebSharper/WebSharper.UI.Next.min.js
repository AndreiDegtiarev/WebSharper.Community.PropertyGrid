(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR;a=window.WebSharper=window.WebSharper||{};b=a.UI=a.UI||{};c=b.Next=b.Next||{};d=c.Array=c.Array||{};e=c.String=c.String||{};f=c.Abbrev=c.Abbrev||{};g=f.Fresh=f.Fresh||{};h=f.HashSet=f.HashSet||{};i=f.Dict=f.Dict||{};j=f.Slot=f.Slot||{};k=f.Async=f.Async||{};l=f.Mailbox=f.Mailbox||{};m=l.MailboxState=l.MailboxState||{};n=window.StartupCode$WebSharper_UI_Next$Abbrev=window.StartupCode$WebSharper_UI_Next$Abbrev||{};o=c.AppendList=c.AppendList||{};p=window.StartupCode$WebSharper_UI_Next$AppendList=window.StartupCode$WebSharper_UI_Next$AppendList||{};q=c.DomUtility=c.DomUtility||{};r=window.StartupCode$WebSharper_UI_Next$DomUtility=window.StartupCode$WebSharper_UI_Next$DomUtility||{};s=c.Trie=c.Trie||{};t=s.LookupResult=s.LookupResult||{};u=window.StartupCode$WebSharper_UI_Next$Trie=window.StartupCode$WebSharper_UI_Next$Trie||{};v=c.Snap=c.Snap||{};w=c.Var=c.Var||{};x=c.Updates=c.Updates||{};y=c.View=c.View||{};z=c.ViewBuilder=c.ViewBuilder||{};A=c.Submitter=c.Submitter||{};B=c.Key=c.Key||{};C=c.Model=c.Model||{};D=c.Serializer=c.Serializer||{};E=c.Storage=c.Storage||{};F=E.ArrayStorage=E.ArrayStorage||{};G=E.LocalStorageBackend=E.LocalStorageBackend||{};H=c.ListModel=c.ListModel||{};I=c.ListModels=c.ListModels||{};J=window.StartupCode$WebSharper_UI_Next$Models=window.StartupCode$WebSharper_UI_Next$Models||{};K=c.ReactiveExtensions=c.ReactiveExtensions||{};L=c.DoubleInterpolation=c.DoubleInterpolation||{};M=c.Interpolation=c.Interpolation||{};N=c.Easing=c.Easing||{};O=c.Easings=c.Easings||{};P=c.An=c.An||{};Q=c.Anims=c.Anims||{};R=c.Trans=c.Trans||{};S=window.StartupCode$WebSharper_UI_Next$Animation=window.StartupCode$WebSharper_UI_Next$Animation||{};T=c.AnimatedAttrNode=c.AnimatedAttrNode||{};U=c.DynamicAttrNode=c.DynamicAttrNode||{};V=c.AttrProxy=c.AttrProxy||{};W=c.Client=c.Client||{};X=W.Attrs=W.Attrs||{};Y=X.Dyn=X.Dyn||{};Z=c.Attrs=c.Attrs||{};_0=c.CheckedInput=c.CheckedInput||{};_1=c.AttrModule=c.AttrModule||{};_2=window.StartupCode$WebSharper_UI_Next$Attr_Client=window.StartupCode$WebSharper_UI_Next$Attr_Client||{};_3=c.DocElemNode=c.DocElemNode||{};_4=W.Docs=W.Docs||{};_5=_4.DomNodes=_4.DomNodes||{};_6=_4.NodeSet=_4.NodeSet||{};_7=_4.RunState=_4.RunState||{};_8=c.Docs=c.Docs||{};_9=c.Doc=c.Doc||{};_=c.Elt=c.Elt||{};$=W.EltUpdater=W.EltUpdater||{};ba=window.StartupCode$WebSharper_UI_Next$Doc_Client=window.StartupCode$WebSharper_UI_Next$Doc_Client||{};bb=c.Flow=c.Flow||{};bc=c.FlowBuilder=c.FlowBuilder||{};bd=c.Html=c.Html||{};be=bd.attr=bd.attr||{};bf=c.Route=c.Route||{};bg=c.Routing=c.Routing||{};bh=bg.State=bg.State||{};bi=c.RouteMap=c.RouteMap||{};bj=c.Router=c.Router||{};bk=c.Input=c.Input||{};bl=bk.MousePosSt=bk.MousePosSt||{};bm=bk.MouseBtnSt=bk.MouseBtnSt||{};bn=bk.Mouse=bk.Mouse||{};bo=bk.KeyListenerSt=bk.KeyListenerSt||{};bp=bk.Keyboard=bk.Keyboard||{};bq=window.StartupCode$WebSharper_UI_Next$Input=window.StartupCode$WebSharper_UI_Next$Input||{};br=a&&a.List;bs=a&&a.Arrays;bt=a&&a.Enumerator;bu=a&&a.Strings;bv=a&&a.Char;bw=a&&a.Collections;bx=bw&&bw.HashSet;by=a&&a.Seq;bz=window.IntelliFactory;bA=bz&&bz.Runtime;bB=a&&a.Unchecked;bC=window.console;bD=a&&a.Concurrency;bE=bw&&bw.Map;bF=bw&&bw.FSharpMap;bG=bw&&bw.List;bH=a&&a.Operators;bI=a&&a.Queue;bJ=a&&a.Lazy;bK=bw&&bw.Dictionary;bL=window.JSON;bM=a&&a.Numeric;bN=window.Node;bO=window.jQuery;bP=a&&a.Slice;bQ=window.String;bR=window.Symbol;d.mapInPlace=function(bS,bT){var bU,bV;for(bU=0,bV=bT.length-1;bU<=bV;bU++)bT[bU]=bS(bT[bU]);return bT;};d.ofSeqNonCopying=function(bS){var bT,bU;if(bS instanceof window.Array)return bS;else if(bS instanceof br.T)return bs.ofList(bS);else if(bS===null)return[];else{bT=[];bU=bt.Get(bS);try{while(bU.MoveNext())bT.push(bU.Current());return bT;}finally{if("Dispose"in bU)bU.Dispose();}}};d.MapTreeReduce=function(bS,bT,bU,bV){var bW;function bX(bY,bZ){var b0,b1;return bZ<=0?bT:bZ===1&&(bY>=0&&bY<bW&&true)?bS(bs.get(bV,bY)):(b1=bZ/2>>0,bU(bX(bY,b1),bX(bY+b1,bZ-b1)));}bW=bs.length(bV);return bX(0,bW);};d.TreeReduce=function(bS,bT,bU){var bV;function bW(bX,bY){var bZ,b0;return bY<=0?bS:bY===1&&(bX>=0&&bX<bV&&true)?bs.get(bU,bX):(b0=bY/2>>0,bT(bW(bX,b0),bW(bX+b0,bY-b0)));}bV=bs.length(bU);return bW(0,bV);};e.isBlank=function(bS){return bu.forall(bv.IsWhiteSpace,bS);};g.Id=function(){g.set_counter(g.counter()+1);return"uid"+window.String(g.counter());};g.Int=function(){g.set_counter(g.counter()+1);return g.counter();};g.counter=function(){n.$cctor();return n.counter;};g.set_counter=function(bS){n.$cctor();n.counter=bS;};h.Filter=function(bS,bT){return new bx.New$2(bs.filter(bS,h.ToArray(bT)));};h.Intersect=function(bS,bT){var bU;bU=new bx.New$2(h.ToArray(bS));bU.IntersectWith(h.ToArray(bT));return bU;};h.Except=function(bS,bT){var bU;bU=new bx.New$2(h.ToArray(bT));bU.ExceptWith(h.ToArray(bS));return bU;};h.ToArray=function(bS){var bT;bT=bs.create(bS.get_Count(),void 0);bS.CopyTo(bT);return bT;};i.ToValueArray=function(bS){var bT;bT=bs.create(bS.count,void 0);by.iteri(function(bU,bV){return bs.set(bT,bU,bV.V);},bS);return bT;};i.ToKeyArray=function(bS){var bT;bT=bs.create(bS.count,void 0);by.iteri(function(bU,bV){return bs.set(bT,bU,bV.K);},bS);return bT;};j=f.Slot=bA.Class({GetHashCode:function(){return bB.Hash(this.key(this.value));},Equals:function(bS){return bB.Equals(this.key(this.value),this.key(bS.get_Value()));},get_Value:function(){return this.value;}},null,j);j.New=bA.Ctor(function(bS,bT){this.key=bS;this.value=bT;},j);j.Create=function(bS,bT){return new j.New(bS,bT);};k.OnError=function(bS){return bC.log("WebSharper UI.Next: Uncaught asynchronous exception",bS);};k.StartTo=function(bS,bT){bD.StartWithContinuations(bS,bT,function(bU){k.OnError(bU);},function(bU){},null);};m=l.MailboxState=bA.Class({},null,m);l.StartProcessor=function(bS){var bT;function bU(){var bV;bV=null;return bD.Delay(function(){return bD.Bind(bS,function(){var bW;bW=bT[0];return bB.Equals(bW,1)?(bT[0]=0,bD.Zero()):bB.Equals(bW,2)?(bT[0]=1,bU()):bD.Zero();});});}bT=[0];return function(){var bV;bV=bT[0];bB.Equals(bV,0)?(bT[0]=1,bD.Start(bU(),null)):bB.Equals(bV,1)?bT[0]=2:void 0;};};n.$cctor=bA.Cctor(function(){n.counter=0;n.$cctor=window.ignore;});o.FromArray=function(bS){var bT;bT=bS.length;return bT===0?{$:0}:bT===1?{$:1,$0:bs.get(bS,0)}:{$:3,$0:bS.slice()};};o.ToArray=function(bS){var bT;function bU(bV){if(bV.$==1)bT.push(bV.$0);else if(bV.$==2){bU(bV.$0);bU(bV.$1);}else if(bV.$==3)bs.iter(function(bW){bT.push(bW);},bV.$0);}bT=[];bU(bS);return bT.slice(0);};o.Single=function(bS){return{$:1,$0:bS};};o.Concat=function(bS){var bT;bT=d.ofSeqNonCopying(bS);return d.TreeReduce(o.Empty(),o.Append,bT);};o.Append=function(bS,bT){return bS.$==0?bT:bT.$==0?bS:{$:2,$0:bS,$1:bT};};o.Empty=function(){p.$cctor();return p.Empty;};p.$cctor=bA.Cctor(function(){p.Empty={$:0};p.$cctor=window.ignore;});q.SetProperty=function(bS,bT,bU){return bS.setProperty(bT,bU);};q.IterSelector=function(bS,bT,bU){var bV,bW,bX;bV=bS.querySelectorAll(bT);for(bW=0,bX=bV.length-1;bW<=bX;bW++)bU(bV[bW]);};q.ChildrenArray=function(bS){var bT,bU,bV;bT=[];for(bU=0,bV=bS.childNodes.length-1;bU<=bV;bU++)bT.push(bS.childNodes[bU]);return bT;};q.RemoveClass=function(bS,bT){window.jQuery(bS).removeClass(bT);};q.AddClass=function(bS,bT){window.jQuery(bS).addClass(bT);};q.InsertAt=function(bS,bT,bU){var bV;if(!(bU.parentNode===bS&&bT===(bV=bU.nextSibling,bB.Equals(bV,null)?null:bV)))bS.insertBefore(bU,bT);};q.RemoveNode=function(bS,bT){if(bT.parentNode===bS)bS.removeChild(bT);};q.SetStyle=function(bS,bT,bU){q.SetProperty(bS.style,bT,bU);};q.SetAttr=function(bS,bT,bU){bS.setAttribute(bT,bU);};q.RemoveAttr=function(bS,bT){bS.removeAttribute(bT);};q.CreateAttr=function(bS,bT){var bU;bU=q.Doc().createAttribute(bS);bU.value=bT;return bU;};q.CreateText=function(bS){return q.Doc().createTextNode(bS);};q.CreateSvgElement=function(bS){return q.Doc().createElementNS("http://www.w3.org/2000/svg",bS);};q.CreateElement=function(bS){return q.Doc().createElement(bS);};q.Clear=function(bS){while(bS.hasChildNodes())bS.removeChild(bS.firstChild);};q.ClearAttrs=function(bS){while(bS.hasAttributes())bS.removeAttributeNode(bS.attributes.item(0));};q.AppendTo=function(bS,bT){bS.appendChild(bT);};q.Doc=function(){r.$cctor();return r.Doc;};r.$cctor=bA.Cctor(function(){r.Doc=window.document;r.$cctor=window.ignore;});t.NotFound={$:1};s.Empty=function(){u.$cctor();return u.Empty;};s.Lookup=function(bS,bT){return s.Look(br.ofSeq(bT),bS);};s.Look=function(bS,bT){var bU,bV;switch(bT.$==2?(bU=bT.$0,0):bT.$==0?bS.$==1?(bU=[bS.$0,bS.$1,bT.$0],1):2:2){case 0:return{$:0,$0:bU,$1:bS};break;case 1:bV=bE.TryFind(bU[0],bU[2]);return bV==null?t.NotFound:s.Look(bU[1],bV.$0);break;case 2:return t.NotFound;break;}};s.ToArray=function(bS){var bT;bT=[];s.Map(function(){return function(bU){return bT.push(bU);};},bS);return bT.slice(0);};s.Mapi=function(bS,bT){var bU,bV;bU=[0];bV=function(){var bW;bW=bU[0];bU[0]=bW+1;return bW;};return s.Map(function(bW){return bS(bV(),bW);},bT);};s.Map=function(bS,bT){return s.MapLoop(br.T.Empty,bS,bT);};s.MapLoop=function(bS,bT,bU){return bU.$==1?{$:1}:bU.$==2?{$:2,$0:(bT(bS))(bU.$0)}:s.TrieBranch(bE.Map(function(bV,bW){return s.MapLoop(br.append(bS,br.ofArray([bV])),bT,bW);},bU.$0));};s.Merge=function(bS){var bT,bU,bV;bT=d.ofSeqNonCopying(bS);bU=bs.length(bT);return bU===0?{$:1,$0:{$:1}}:bU===1?{$:1,$0:bs.get(bT,0)}:bs.exists(s.IsLeaf,bT)?null:(bV=s.MergeMaps(s.Merge,by.choose(function(bW){return bW.$==0?{$:1,$0:bW.$0}:null;},bT)),bV==null?null:{$:1,$0:s.TrieBranch(bV.$0)});};s.IsLeaf=function(bS){return bS.$==2&&true;};s.MergeMaps=function(bS,bT){var bU,bV;bU=s.AllSome((bV=function(bW,bX){var bY;bY=bS(bX);return bY==null?null:{$:1,$0:[bW,bY.$0]};},by.map(function(bW){return bV(bW[0],bW[1]);},bE.ToSeq(by.fold(function(bW,bX){return s.MultiAdd(bX[0],bX[1],bW);},new bF.New([]),by.collect(bE.ToSeq,bT))))));return bU==null?null:{$:1,$0:bE.OfArray(bs.ofSeq(bU.$0))};};s.AllSome=function(bS){var bT,bU,bV,bW;bU=bt.Get(bS);bV=new bG.New$2();bT=true;while(bT&&bU.MoveNext()){bW=bU.Current();bW!=null&&bW.$==1?bV.Add(bW.$0):bT=false;}return bT?{$:1,$0:bV.ToArray()}:null;};s.MultiAdd=function(bS,bT,bU){return bU.Add(bS,new br.T({$:1,$0:bT,$1:s.MultiFind(bS,bU)}));};s.MultiFind=function(bS,bT){var bU;bU=bE.TryFind(bS,bT);return bU==null?br.T.Empty:bU.$0;};s.Prefix=function(bS,bT){return s.TrieBranch(new bF.New(br.ofArray([[bS,bT]])));};s.Leaf=function(bS){return{$:2,$0:bS};};s.TrieBranch=function(bS){return bS.get_IsEmpty()?{$:1}:{$:0,$0:bS};};u.$cctor=bA.Cctor(function(){u.Empty={$:1};u.$cctor=window.ignore;});v.Obsolete=function(bS){var bT,bU,bV,bW,bX;bU=bS.s;if(bU==null||(bU!=null&&bU.$==2?(bT=bU.$1,false):bU!=null&&bU.$==3?(bT=bU.$1,false):true))void 0;else{bS.s=null;for(bV=0,bW=bs.length(bT)-1;bV<=bW;bV++){bX=bs.get(bT,bV);typeof bX=="object"?function(bY){v.Obsolete(bY);}(bX):bX();}}};v.New=function(bS){return{s:bS};};v.MapAsync=function(bS,bT){var bU;bU=v.New({$:3,$0:[],$1:[]});v.When(bT,function(bV){k.StartTo(bS(bV),function(bW){v.MarkDone(bU,bT,bW);});},bU);return bU;};v.SnapshotOn=function(bS,bT){var bU;function bV(bW){var bX,bY,bZ;if(!(bX=bU.s,bX!=null&&bX.$==0||bX!=null&&bX.$==2&&true)){bY=v.ValueAndForever(bS);bZ=v.ValueAndForever(bT);bY!=null&&bY.$==1?bZ!=null&&bZ.$==1?bY.$0[1]||bZ.$0[1]?v.MarkForever(bU,bZ.$0[0]):v.MarkReady(bU,bZ.$0[0]):void 0:void 0;}}bU=v.New({$:3,$0:[],$1:[]});v.When(bS,bV,bU);v.WhenReady(bT,bV);return bU;};v.Map3=function(bS,bT,bU,bV){var bW,bX,bY,bZ;function b0(b1){var b2,b3,b4,b5;if(!(b2=bZ.s,b2!=null&&b2.$==0||b2!=null&&b2.$==2&&true)){b3=v.ValueAndForever(bT);b4=v.ValueAndForever(bU);b5=v.ValueAndForever(bV);b3!=null&&b3.$==1?b4!=null&&b4.$==1?b5!=null&&b5.$==1?b3.$0[1]&&b4.$0[1]&&b5.$0[1]?v.MarkForever(bZ,bS(b3.$0[0],b4.$0[0],b5.$0[0])):v.MarkReady(bZ,bS(b3.$0[0],b4.$0[0],b5.$0[0])):void 0:void 0:void 0;}}bW=bT.s;bX=bU.s;bY=bV.s;return bW!=null&&bW.$==0?bX!=null&&bX.$==0?bY!=null&&bY.$==0?v.New({$:0,$0:bS(bW.$0,bX.$0,bY.$0)}):v.Map3Opt1(bS,bW.$0,bX.$0,bV):bY!=null&&bY.$==0?v.Map3Opt2(bS,bW.$0,bY.$0,bU):v.Map3Opt3(bS,bW.$0,bU,bV):bX!=null&&bX.$==0?bY!=null&&bY.$==0?v.Map3Opt4(bS,bX.$0,bY.$0,bT):v.Map3Opt5(bS,bX.$0,bT,bV):bY!=null&&bY.$==0?v.Map3Opt6(bS,bY.$0,bT,bU):(bZ=v.New({$:3,$0:[],$1:[]}),(v.When(bT,b0,bZ),v.When(bU,b0,bZ),v.When(bV,b0,bZ),bZ));};v.Map3Opt6=function(bS,bT,bU,bV){return v.Map2(function(bW,bX){return bS(bW,bX,bT);},bU,bV);};v.Map3Opt5=function(bS,bT,bU,bV){return v.Map2(function(bW,bX){return bS(bW,bT,bX);},bU,bV);};v.Map3Opt4=function(bS,bT,bU,bV){return v.Map(function(bW){return bS(bW,bT,bU);},bV);};v.Map3Opt3=function(bS,bT,bU,bV){return v.Map2(function(bW,bX){return bS(bT,bW,bX);},bU,bV);};v.Map3Opt2=function(bS,bT,bU,bV){return v.Map(function(bW){return bS(bT,bW,bU);},bV);};v.Map3Opt1=function(bS,bT,bU,bV){return v.Map(function(bW){return bS(bT,bU,bW);},bV);};v.Map2Unit=function(bS,bT){var bU,bV,bW;function bX(){var bY,bZ,b0;if(!(bY=bW.s,bY!=null&&bY.$==0||bY!=null&&bY.$==2&&true)){bZ=v.ValueAndForever(bS);b0=v.ValueAndForever(bT);bZ!=null&&bZ.$==1?b0!=null&&b0.$==1?bZ.$0[1]&&b0.$0[1]?v.MarkForever(bW,null):v.MarkReady(bW,null):void 0:void 0;}}bU=bS.s;bV=bT.s;return bU!=null&&bU.$==0?bV!=null&&bV.$==0?v.New({$:0,$0:null}):bT:bV!=null&&bV.$==0?bS:(bW=v.New({$:3,$0:[],$1:[]}),(v.When(bS,bX,bW),v.When(bT,bX,bW),bW));};v.Map2=function(bS,bT,bU){var bV,bW,bX;function bY(bZ){var b0,b1,b2;if(!(b0=bX.s,b0!=null&&b0.$==0||b0!=null&&b0.$==2&&true)){b1=v.ValueAndForever(bT);b2=v.ValueAndForever(bU);b1!=null&&b1.$==1?b2!=null&&b2.$==1?b1.$0[1]&&b2.$0[1]?v.MarkForever(bX,bS(b1.$0[0],b2.$0[0])):v.MarkReady(bX,bS(b1.$0[0],b2.$0[0])):void 0:void 0;}}bV=bT.s;bW=bU.s;return bV!=null&&bV.$==0?bW!=null&&bW.$==0?v.New({$:0,$0:bS(bV.$0,bW.$0)}):v.Map2Opt1(bS,bV.$0,bU):bW!=null&&bW.$==0?v.Map2Opt2(bS,bW.$0,bT):(bX=v.New({$:3,$0:[],$1:[]}),(v.When(bT,bY,bX),v.When(bU,bY,bX),bX));};v.Map2Opt2=function(bS,bT,bU){return v.Map(function(bV){return bS(bV,bT);},bU);};v.Map2Opt1=function(bS,bT,bU){return v.Map(function(bV){return bS(bT,bV);},bU);};v.MapCachedBy=function(bS,bT,bU,bV){return v.Map(function(bW){var bX,bY,bZ;bX=bT[0];return bX!=null&&bX.$==1&&(bS(bW,bX.$0[0])&&(bY=[bX.$0[0],bX.$0[1]],true))?bY[1]:(bZ=bU(bW),(bT[0]={$:1,$0:[bW,bZ]},bZ));},bV);};v.Copy=function(bS){var bT,bU,bV;bT=bS.s;return bT==null?bS:bT!=null&&bT.$==2?(bU=v.New({$:2,$0:bT.$0,$1:[]}),(v.WhenObsolete(bS,bU),bU)):bT!=null&&bT.$==3?(bV=v.New({$:3,$0:[],$1:[]}),(v.When(bS,function(bW){v.MarkDone(bV,bS,bW);},bV),bV)):bS;};v.Map=function(bS,bT){var bU,bV;bU=bT.s;return bU!=null&&bU.$==0?v.New({$:0,$0:bS(bU.$0)}):(bV=v.New({$:3,$0:[],$1:[]}),(v.When(bT,function(bW){v.MarkDone(bV,bT,bS(bW));},bV),bV));};v.Sequence=function(bS){var bT,bU,bV,bW;bT=bs.ofSeq(bS);return bT.length==0?v.New({$:0,$0:[]}):(bU=v.New({$:3,$0:[],$1:[]}),(bV=[bs.length(bT)-1],(bW=function(){var bX;if(bV[0]===0){bX=bs.map(function(bY){var bZ;bZ=bY.s;return bZ!=null&&bZ.$==0?bZ.$0:bZ!=null&&bZ.$==2?bZ.$0:bH.FailWith("value not found by View.Sequence");},bT);bs.forall(function(bY){var bZ;return(bZ=bY.s,bZ!=null&&bZ.$==0)&&true;},bT)?v.MarkForever(bU,bX):v.MarkReady(bU,bX);}else bV[0]--;},(bs.iter(function(bX){v.When(bX,bW,bU);},bT),bU))));};v.CreateForeverAsync=function(bS){var bT;bT=v.New({$:3,$0:[],$1:[]});k.StartTo(bS,function(bU){v.MarkForever(bT,bU);});return bT;};v.JoinInner=function(bS){var bT;bT=v.New({$:3,$0:[],$1:[]});v.When(bS,function(bU){var bV;bV=bU();v.When(bV,function(bW){var bX,bY;if((bX=bV.s,bX!=null&&bX.$==0)&&true&&((bY=bS.s,bY!=null&&bY.$==0)&&true))v.MarkForever(bT,bW);else v.MarkReady(bT,bW);},bT);v.WhenObsolete(bS,bV);},bT);return bT;};v.Join=function(bS){var bT;bT=v.New({$:3,$0:[],$1:[]});v.When(bS,function(bU){var bV;bV=bU();v.When(bV,function(bW){var bX,bY;if((bX=bV.s,bX!=null&&bX.$==0)&&true&&((bY=bS.s,bY!=null&&bY.$==0)&&true))v.MarkForever(bT,bW);else v.MarkReady(bT,bW);},bT);},bT);return bT;};v.ValueAndForever=function(bS){var bT;bT=bS.s;return bT!=null&&bT.$==0?{$:1,$0:[bT.$0,true]}:bT!=null&&bT.$==2?{$:1,$0:[bT.$0,false]}:null;};v.WhenObsoleteRun=function(bS,bT){var bU;bU=bS.s;bU==null?bT():bU!=null&&bU.$==2?bU.$1.push(bT):bU!=null&&bU.$==3?bU.$1.push(bT):void 0;};v.WhenObsolete=function(bS,bT){var bU;bU=bS.s;bU==null?v.Obsolete(bT):bU!=null&&bU.$==2?v.EnqueueSafe(bU.$1,bT):bU!=null&&bU.$==3?v.EnqueueSafe(bU.$1,bT):void 0;};v.WhenReady=function(bS,bT){var bU,bV;bV=bS.s;switch(bV!=null&&bV.$==2?(bU=bV.$0,0):bV==null?1:bV!=null&&bV.$==3?2:(bU=bV.$0,0)){case 0:bT(bU);break;case 1:null;break;case 2:bV.$0.push(bT);break;}};v.WhenRun=function(bS,bT,bU){var bV;bV=bS.s;bV==null?bU():bV!=null&&bV.$==2?(bV.$1.push(bU),bT(bV.$0)):bV!=null&&bV.$==3?(bV.$0.push(bT),bV.$1.push(bU)):bT(bV.$0);};v.When=function(bS,bT,bU){var bV;bV=bS.s;bV==null?v.Obsolete(bU):bV!=null&&bV.$==2?(v.EnqueueSafe(bV.$1,bU),bT(bV.$0)):bV!=null&&bV.$==3?(bV.$0.push(bT),v.EnqueueSafe(bV.$1,bU)):bT(bV.$0);};v.EnqueueSafe=function(bS,bT){var bU,bV,bW,bX;bS.push(bT);if(bS.length%20===0){bU=bS.slice(0);bI.Clear(bS);for(bV=0,bW=bs.length(bU)-1;bV<=bW;bV++){bX=bs.get(bU,bV);typeof bX=="object"?function(bY){if(bY.s)bS.push(bY);}(bX):function(bY){bS.push(bY);}(bX);}}else void 0;};v.MarkDone=function(bS,bT,bU){var bV;if((bV=bT.s,bV!=null&&bV.$==0)&&true)v.MarkForever(bS,bU);else v.MarkReady(bS,bU);};v.MarkReady=function(bS,bT){var bU,bV,bW,bX;bU=bS.s;if(bU!=null&&bU.$==3){bS.s={$:2,$0:bT,$1:bU.$1};bV=bU.$0;for(bW=0,bX=bs.length(bV)-1;bW<=bX;bW++)(bs.get(bV,bW))(bT);}else void 0;};v.MarkForever=function(bS,bT){var bU,bV,bW,bX;bU=bS.s;if(bU!=null&&bU.$==3){bS.s={$:0,$0:bT};bV=bU.$0;for(bW=0,bX=bs.length(bV)-1;bW<=bX;bW++)(bs.get(bV,bW))(bT);}else void 0;};w=c.Var=bA.Class({RId:function(){return"uinref"+window.String(this.i);},RView:function(){return this.v;},RUpdM:function(bS){var bT;bT=bS(this.c);bT!=null&&bT.$==1?w.Set(this,bT.$0):void 0;},RUpd:function(bS){w.Update(this,bS);},set_RVal:function(bS){w.Set(this,bS);},RVal:function(){return this.c;},RSet:function(bS){w.Set(this,bS);},RGet:function(){return this.c;}},null,w);w.New=function(bS,bT,bU,bV,bW){return new w({o:bS,c:bT,s:bU,i:bV,v:bW});};w.Lens=function(bS,bT,bU){var bV,bW;bV=g.Id();bW=y.Map(bT,bS.RView());return{RGet:function(){return bT(bS.RGet());},RSet:function(bX){return bS.RUpd(function(bY){return bU(bY,bX);});},RVal:function(){return bT(bS.RGet());},set_RVal:function(bX){return bS.RUpd(function(bY){return bU(bY,bX);});},RUpd:function(bX){return bS.RUpd(function(bY){return bU(bY,bX(bT(bY)));});},RUpdM:function(bX){return bS.RUpdM(function(bY){var bZ;bZ=bX(bT(bY));return bZ==null?null:{$:1,$0:bU(bY,bZ.$0)};});},RView:function(){return bW;},RId:function(){return bV;}};};w.Update=function(bS,bT){w.Set(bS,bT(bS.c));};w.SetFinal=function(bS,bT){if(bS.o)(function(bU){return bU("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bU){bC.log(bU);}));else{v.Obsolete(bS.s);bS.o=true;bS.c=bT;bS.s=v.New({$:0,$0:bT});}};w.Set=function(bS,bT){if(bS.o)(function(bU){return bU("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bU){bC.log(bU);}));else{v.Obsolete(bS.s);bS.c=bT;bS.s=v.New({$:2,$0:bT,$1:[]});}};w.Create=function(){var bS;bS=null;bS=w.New(false,null,v.New({$:2,$0:null,$1:[]}),g.Int(),function(){return bS.s;});return bS;};w.CreateLogged=function(bS,bT){var bU;!window.UINVars?window.UINVars=[]:void 0;bU=w.Create$1(bT);window.UINVars.push([bS,bU]);return bU;};w.Create$1=function(bS){var bT;bT=null;bT=w.New(false,bS,v.New({$:2,$0:bS,$1:[]}),g.Int(),function(){return bT.s;});return bT;};x=c.Updates=bA.Class({set_Value:function(bS){var bT;bT=this.s;!(bT===null)?v.Obsolete(bT):void 0;this.c=bS;}},null,x);x.Create=function(bS){var bT;bT=null;bT=x.New(bS,null,function(){var bU;bU=bT.s;return bU===null?(bU=v.Copy(bT.c()),bT.s=bU,v.WhenObsoleteRun(bU,function(){bT.s=null;}),bU):bU;});return bT;};x.New=function(bS,bT,bU){return new x({c:bS,s:bT,v:bU});};y.get_Do=function(){return z.B;};y.Apply=function(bS,bT){return y.Map2(function(bU,bV){return bU(bV);},bS,bT);};y.AsyncAwait=function(bS,bT){var bU;bU=function(bV){var bW,bX;function bY(){return y.RemovableSink(function(bZ){if(bS(bZ)){(bJ.Force(bW))();bV(bZ);}},bT);}bW=bJ.Create(bY);bX=bJ.Force(bW);};return bD.FromContinuations(function(bV,bW,bX){return bU.apply(null,[bV,bW,bX]);});};y.RemovableSink=function(bS,bT){var bU;function bV(){v.WhenRun(bT(),function(bW){if(bU[0])bS(bW);},function(){if(bU[0])bD.scheduler().Fork(bV);});}bU=[true];bD.scheduler().Fork(bV);return function(){bU[0]=false;};};y.Sink=function(bS,bT){function bU(){v.WhenRun(bT(),bS,function(){bD.scheduler().Fork(bU);});}bD.scheduler().Fork(bU);};y.TryFinally=function(bS,bT){return y.CreateLazy(function(){try{return bT();}finally{bS();}});};y.TryWith=function(bS,bT){return y.CreateLazy(function(){try{return bT();}catch(bU){return(bS(bU))();}});};y.ConstAsync=function(bS){var bT;bT=v.CreateForeverAsync(bS);return function(){return bT;};};y.Const=function(bS){var bT;bT=v.New({$:0,$0:bS});return function(){return bT;};};y.Sequence=function(bS){return y.CreateLazy(function(){return v.Sequence(by.map(function(bT){return bT();},bS));});};y.UpdateWhile=function(bS,bT,bU){var bV;bV=[bS];return y.BindInner(function(bW){return bW?y.Map(function(bX){bV[0]=bX;return bX;},bU):y.Const(bV[0]);},bT);};y.BindInner=function(bS,bT){return y.JoinInner(y.Map(bS,bT));};y.JoinInner=function(bS){return y.CreateLazy(function(){return v.JoinInner(bS());});};y.Bind=function(bS,bT){return y.Join(y.Map(bS,bT));};y.Join=function(bS){return y.CreateLazy(function(){return v.Join(bS());});};y.MapSeqCachedView=function(bS,bT){var bU;bU=function(){return bS;};return y.MapSeqCachedViewBy(window.id,function(bV,bW){return(bU(bV))(bW);},bT);};y.MapSeqCachedViewBy=function(bS,bT,bU){var bV;bV=[new bK.New$5()];return y.Map(function(bW){var bX,bY,bZ;bX=bV[0];bY=new bK.New$5();bZ=d.mapInPlace(function(b0){var b1,b2,b3;b1=bS(b0);b2=bX.ContainsKey(b1)?(b3=bX.get_Item(b1),(w.Set(b3.r,b0),b3)):y.ConvertSeqNode(function(b4){return bT(b1,b4);},b0);bY.set_Item(b1,b2);return b2.e;},bs.ofSeq(bW));bV[0]=bY;return bZ;},bU);};y.ConvertSeqNode=function(bS,bT){var bU,bV;bU=w.Create$1(bT);bV=bU.v;return{e:bS(bV),r:bU,w:bV};};y.MapSeqCached=function(bS,bT){return y.MapSeqCachedBy(window.id,bS,bT);};y.MapSeqCachedBy=function(bS,bT,bU){var bV;bV=[new bK.New$5()];return y.Map(function(bW){var bX,bY,bZ;bX=bV[0];bY=new bK.New$5();bZ=d.mapInPlace(function(b0){var b1,b2;b1=bS(b0);b2=bX.ContainsKey(b1)?bX.get_Item(b1):bT(b0);bY.set_Item(b1,b2);return b2;},bs.ofSeq(bW));bV[0]=bY;return bZ;},bU);};y.SnapshotOn=function(bS,bT,bU){var bV;bV=v.New({$:2,$0:bS,$1:[]});return y.CreateLazy(function(){return bV.s==null&&true?v.SnapshotOn(bT(),bU()):(v.WhenObsolete(bT(),bV),bV);});};y.GetAsync=function(bS){return bD.FromContinuations(function(bT){return y.Get(bT,bS);});};y.Get=function(bS,bT){var bU;function bV(){v.WhenRun(bT(),function(bW){if(!bU[0]){bU[0]=true;bS(bW);}},function(){if(!bU[0])bV();});}bU=[false];bV();};y.MapAsync2=function(bS,bT,bU){return y.MapAsync(window.id,y.Map2(bS,bT,bU));};y.MapAsync=function(bS,bT){return y.CreateLazy(function(){return v.MapAsync(bS,bT());});};y.Map3=function(bS,bT,bU,bV){return y.CreateLazy(function(){return v.Map3(bS,bT(),bU(),bV());});};y.Map2Unit=function(bS,bT){return y.CreateLazy(function(){return v.Map2Unit(bS(),bT());});};y.Map2=function(bS,bT,bU){return y.CreateLazy(function(){return v.Map2(bS,bT(),bU());});};y.MapCached=function(bS,bT){return y.MapCachedBy(bB.Equals,bS,bT);};y.MapCachedBy=function(bS,bT,bU){var bV;bV=[null];return y.CreateLazy(function(){return v.MapCachedBy(bS,bV,bT,bU());});};y.Map=function(bS,bT){return y.CreateLazy(function(){return v.Map(bS,bT());});};y.CreateLazy=function(bS){var bT;bT={c:null,o:bS};return function(){var bU,bV;bU=bT.c;return bU===null?(bU=bT.o(),bT.c=bU,(bV=bU.s,bV!=null&&bV.$==0)&&true?bT.o=null:v.WhenObsoleteRun(bU,function(){bT.c=null;}),bU):bU;};};z.B={$:0};A=c.Submitter=bA.Class({Trigger:function(){w.Set(this["var"],null);}},null,A);A.New=bA.Ctor(function(bS,bT){this.input=bS;this["var"]=w.Create();this.view=y.SnapshotOn(bT,this["var"].v,this.input);},A);A.CreateOption=function(bS){return new A.New(y.Map(function(bT){return{$:1,$0:bT};},bS),null);};B.Fresh=function(){return{$:0,$0:g.Int()};};C=c.Model=bA.Class({},null,C);C.New=bA.Ctor(function(bS,bT){var bU;bU=w.Create$1(bT);C.New$1.call(this,bU,y.Map(bS,bU.v));},C);C.New$1=bA.Ctor(function(bS,bT){this["var"]=bS;this.view=bT;},C);C.Update=function(bS,bT){w.Update(bT["var"],function(bU){bS(bU);return bU;});};C.Create=function(bS,bT){return new C.New(bS,bT);};D.Default=function(){J.$cctor();return J.Default;};F=E.ArrayStorage=bA.Class({SSet:function(bS){return bs.ofSeq(bS);},SSetAt:function(bS,bT,bU){bs.set(bU,bS,bT);return bU;},SRemoveIf:function(bS,bT){return bs.filter(function(bU){return!bS(bU);},bT);},SInit:function(){return this.init;},SPrependMany:function(bS,bT){var bU;bU=d.ofSeqNonCopying(bS);bT.unshift.apply(bT,bU);return bT;},SPrepend:function(bS,bT){bT.unshift(bS);return bT;},SAppendMany:function(bS,bT){var bU;bU=d.ofSeqNonCopying(bS);bT.push.apply(bT,bU);return bT;},SAppend:function(bS,bT){bT.push(bS);return bT;}},null,F);F.New=bA.Ctor(function(bS){this.init=bS;},F);G=E.LocalStorageBackend=bA.Class({clear:function(){this.storage.removeItem(this.id);},set:function(bS){this.storage.setItem(this.id,bL.stringify(bs.map(this.serializer.Encode,bS)));return bS;},SSet:function(bS){return this.set(bs.ofSeq(bS));},SSetAt:function(bS,bT,bU){bs.set(bU,bS,bT);return this.set(bU);},SRemoveIf:function(bS,bT){return this.set(bs.filter(function(bU){return!bS(bU);},bT));},SInit:function(){var bS;bS=this.storage.getItem(this.id);if(bS===null)return[];else try{return bs.map(this.serializer.Decode,bL.parse(bS));}catch(bT){return[];}},SPrependMany:function(bS,bT){var bU;bU=d.ofSeqNonCopying(bS);bT.unshift.apply(bT,bU);return this.set(bT);},SPrepend:function(bS,bT){bT.unshift(bS);return this.set(bT);},SAppendMany:function(bS,bT){var bU;bU=d.ofSeqNonCopying(bS);bT.push.apply(bT,bU);return this.set(bT);},SAppend:function(bS,bT){bT.push(bS);return this.set(bT);}},null,G);G.New=bA.Ctor(function(bS,bT){this.id=bS;this.serializer=bT;this.storage=window.localStorage;},G);E.LocalStorage=function(bS,bT){return new G.New(bS,bT);};E.InMemory=function(bS){return new F.New(bS);};H=c.ListModel=bA.Class({Wrap:function(bS,bT,bU){return H.Wrap(this,bS,bT,bU);},Lens:function(bS){return this.LensInto(window.id,function(bT,bU){return bU;},bS);},LensInto:function(bS,bT,bU){var bV,bW,bX;bV=this;bW=g.Id();bX=y.Map(bS,this.FindByKeyAsView(bU));return{RGet:function(){return bS(bV.FindByKey(bU));},RSet:function(bY){return bV.UpdateBy(function(bZ){return{$:1,$0:bT(bZ,bY)};},bU);},RVal:function(){return this.RGet();},set_RVal:function(bY){return this.RSet(bY);},RUpd:function(bY){return bV.UpdateBy(function(bZ){return{$:1,$0:bT(bZ,bY(bS(bZ)))};},bU);},RUpdM:function(bY){return bV.UpdateBy(function(bZ){var b0;b0=bY(bS(bZ));return b0==null?null:{$:1,$0:bT(bZ,b0.$0)};},bU);},RView:function(){return bX;},RId:function(){return bW;}};},get_LengthAsView:function(){return y.Map(bs.length,this["var"].RView());},get_Length:function(){return bs.length(this["var"].RVal());},Clear:function(){this["var"].set_RVal(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(bS,bT){var bU,bV,bW,bX,bY;bU=this;bV=this["var"].RVal();bW=bs.tryFindIndex(function(bZ){return bB.Equals(bU.key(bZ),bT);},bV);bW!=null&&bW.$==1?(bX=bW.$0,bY=bS(bs.get(bV,bX)),bY!=null&&bY.$==1?(this["var"].set_RVal(this.storage.SSetAt(bX,bY.$0,bV)),this.ObsoleteKey(bT)):void 0):void 0;},UpdateAll:function(bS){var bT;bT=this;this["var"].RUpd(function(bU){bs.iteri(function(bV,bW){var bX;bX=bS(bW);return bX==null?null:bs.set(bU,bV,bX.$0);},bU);return bT.storage.SSet(bU);});this.ObsoleteAll();},FindByKeyAsView:function(bS){return y.Map(function(bT){return bT.$0;},this.TryFindByKeyAsView(bS));},TryFindByKeyAsView:function(bS){var bT;bT=this;return function(){var bU,bV,bW;bU=(bV=null,[bT.it.TryGetValue(bS,{get:function(){return bV;},set:function(bX){bV=bX;}}),bV]);return bU[0]?bU[1]:(bW=v.New({$:2,$0:bT.TryFindByKey(bS),$1:[]}),(bT.it.Add(bS,bW),bW));};},TryFindByKey:function(bS){var bT;bT=this;return bs.tryFind(function(bU){return bB.Equals(bT.key(bU),bS);},this["var"].RVal());},FindByKey:function(bS){var bT;bT=this;return bs.find(function(bU){return bB.Equals(bT.key(bU),bS);},this["var"].RVal());},TryFindAsView:function(bS){return y.Map(function(bT){return bs.tryFind(bS,bT);},this["var"].RView());},FindAsView:function(bS){return y.Map(function(bT){return bs.find(bS,bT);},this["var"].RView());},TryFind:function(bS){return bs.tryFind(bS,this["var"].RVal());},Find:function(bS){return bs.find(bS,this["var"].RVal());},ContainsKeyAsView:function(bS){var bT,bU;bT=this;return y.Map((bU=function(bV){return bB.Equals(bT.key(bV),bS);},function(bV){return bs.exists(bU,bV);}),this["var"].RView());},ContainsKey:function(bS){var bT;bT=this;return bs.exists(function(bU){return bB.Equals(bT.key(bU),bS);},this["var"].RVal());},Set:function(bS){this["var"].set_RVal(this.storage.SSet(bS));this.ObsoleteAll();},Iter:function(bS){bs.iter(bS,this["var"].RVal());},RemoveByKey:function(bS){var bT;bT=this;this["var"].set_RVal(this.storage.SRemoveIf(function(bU){return bB.Equals(bT.key(bU),bS);},this["var"].RVal()));this.ObsoleteKey(bS);},RemoveBy:function(bS){var bT,bU,bV,bW;bT=this["var"].RVal();for(bU=0,bV=bT.length-1;bU<=bV;bU++){bW=bs.get(bT,bU);bS(bW)?this.ObsoleteKey(this.key(bW)):void 0;}this["var"].set_RVal(this.storage.SRemoveIf(bS,this["var"].RVal()));},Remove:function(bS){var bT,bU,bV,bW;bT=this;bU=this["var"].RVal();I.Contains(bT.key,bS,bU)?(bV=bT.key,bW=bV(bS),this["var"].set_RVal(this.storage.SRemoveIf(function(bX){return bB.Equals(bV(bX),bW);},bU)),this.ObsoleteKey(bW)):void 0;},PrependMany:function(bS){var bT,bU,bV;bT=this;bU=new bG.New$2();this["var"].set_RVal(this.storage.SPrependMany(bU,((bV=function(bW,bX){var bY,bZ;bY=bT.key(bX);bT.ObsoleteKey(bY);bZ=bs.tryFindIndex(function(b0){return bB.Equals(bT.key(b0),bY);},bW);return bZ==null?(bU.Add(bX),bW):bT.storage.SSetAt(bZ.$0,bX,bW);},(bA.Curried3(by.fold))(bV))(this["var"].RVal()))(bS)));},Prepend:function(bS){var bT,bU,bV,bW;bT=this;bU=this["var"].RVal();bV=this.key(bS);bW=bs.tryFindIndex(function(bX){return bB.Equals(bT.key(bX),bV);},bU);bW!=null&&bW.$==1?this["var"].set_RVal(this.storage.SSetAt(bW.$0,bS,bU)):this["var"].set_RVal(this.storage.SPrepend(bS,bU));this.ObsoleteKey(bV);},AppendMany:function(bS){var bT,bU,bV;bT=this;bU=new bG.New$2();this["var"].set_RVal(this.storage.SAppendMany(bU,((bV=function(bW,bX){var bY,bZ;bY=bT.key(bX);bT.ObsoleteKey(bY);bZ=bs.tryFindIndex(function(b0){return bB.Equals(bT.key(b0),bY);},bW);return bZ==null?(bU.Add(bX),bW):bT.storage.SSetAt(bZ.$0,bX,bW);},(bA.Curried3(by.fold))(bV))(this["var"].RVal()))(bS)));},Append:function(bS){var bT,bU,bV,bW;bT=this;bU=this["var"].RVal();bV=this.key(bS);bW=bs.tryFindIndex(function(bX){return bB.Equals(bT.key(bX),bV);},bU);bW!=null&&bW.$==1?this["var"].set_RVal(this.storage.SSetAt(bW.$0,bS,bU)):this["var"].set_RVal(this.storage.SAppend(bS,bU));this.ObsoleteKey(bV);},ObsoleteAll:function(){by.iter(function(bS){v.Obsolete(bS.V);},this.it);this.it.Clear();},ObsoleteKey:function(bS){var bT,bU;bT=(bU=null,[this.it.TryGetValue(bS,{get:function(){return bU;},set:function(bV){bU=bV;}}),bU]);bT[0]?(v.Obsolete(bT[1]),this.it.Remove(bS)):void 0;},GetEnumerator0:function(){return bt.Get0(this["var"].RVal());},GetEnumerator:function(){return bt.Get(this["var"].RVal());}},null,H);H.New=bA.Ctor(function(bS,bT){H.New$3.call(this,bS,w.Create$1(bs.ofSeq(by.distinctBy(bS,bT.SInit()))),bT);},H);H.New$1=bA.Ctor(function(bS){H.New$2.call(this,bS,[]);},H);H.New$2=bA.Ctor(function(bS,bT){var bU;bU=bs.ofSeq(bT);H.New$3.call(this,bS,w.Create$1(bU),E.InMemory(bU));},H);H.New$3=bA.Ctor(function(bS,bT,bU){this.key=bS;this["var"]=bT;this.storage=bU;this.v=y.Map(function(bV){return bV.slice();},this["var"].RView());this.it=new bK.New$5();},H);I.Contains=function(bS,bT,bU){var bV;bV=bS(bT);return bs.exists(function(bW){return bB.Equals(bS(bW),bV);},bU);};H.Wrap=function(bS,bT,bU,bV){var bW,bX;bW=[new bK.New$5()];bX=bs.map(function(bY){var bZ;bZ=bU(bY);bW[0].set_Item(bS.key(bY),bZ);return bZ;},bS["var"].RVal());return new H.New$3(function(bY){return bS.key(bT(bY));},w.Lens(bS["var"],function(bY){var bZ,b0;bZ=new bK.New$5();b0=bs.map(function(b1){var b2,b3;b2=bS.key(b1);b3=bW[0].ContainsKey(b2)?bV(bW[0].get_Item(b2),b1):bU(b1);bZ.set_Item(b2,b3);return b3;},bY);bW[0]=bZ;return b0;},function(bY,bZ){var b0,b1;b0=new bK.New$5();b1=bs.map(function(b2){var b3;b3=bT(b2);b0.set_Item(bS.key(b3),b2);return b3;},bZ);bW[0]=b0;return b1;}),E.InMemory(bX));};H.FromSeq=function(bS){return H.Create(window.id,bS);};H.Create=function(bS,bT){return H.CreateWithStorage(bS,E.InMemory(bs.ofSeq(bT)));};H.CreateWithStorage=function(bS,bT){return new H.New(bS,bT);};J.$cctor=bA.Cctor(function(){J.Default={Encode:window.id,Decode:window.id};J.$cctor=window.ignore;});K=c.ReactiveExtensions=bA.Class({},null,K);K.New=bA.Ctor(function(){},K);L=c.DoubleInterpolation=bA.Class({Interpolate:function(bS,bT,bU){return bT+bS*(bU-bT);}},null,L);L.DoubleInterpolation=new L({$:0});M.get_Double=function(){return L.DoubleInterpolation;};N=c.Easing=bA.Class({TransformTime:function(bS){return this.transformTime(bS);}},null,N);N.get_CubicInOut=function(){return O.CubicInOut();};N.Custom=function(bS){return new N.New(bS);};N.New=bA.Ctor(function(bS){this.transformTime=bS;},N);O.CubicInOut=function(){S.$cctor();return S.CubicInOut;};P.get_Empty=function(){return{$:0,$0:o.Empty()};};P.WhenDone=function(bS,bT){return P.Append({$:0,$0:o.Single({$:0,$0:bS})},bT);};P.Run=function(bS,bT){var bU,bV;bU=bT.Duration;return bU===0?bD.Zero():(bV=function(bW){function bX(bY,bZ){var b0;b0=bZ-bY;bT.Compute(b0);bS();return b0<=bU?void window.requestAnimationFrame(function(b1){bX(bY,b1);}):bW();}window.requestAnimationFrame(function(bY){bX(bY,bY);});},bD.FromContinuations(function(bW,bX,bY){return bV.apply(null,[bW,bX,bY]);}));};P.Play=function(bS){var bT;bT=null;return bD.Delay(function(){return bD.Bind(P.Run(function(){},Q.Actions(bS)),function(){Q.Finalize(bS);return bD.Return(null);});});};P.Pack=function(bS){return{$:0,$0:o.Single({$:1,$0:bS})};};P.Map=function(bS,bT){var bU;return Q.Def(bT.Duration,(bU=bT.Compute,function(bV){return bS(bU(bV));}));};P.Delayed=function(bS,bT,bU,bV,bW,bX){return{Compute:function(bY){return bY<=bV?bW:bS.Interpolate(bT.TransformTime((bY-bV)/bU),bW,bX);},Duration:bU+bV};};P.Simple=function(bS,bT,bU,bV,bW){return{Compute:function(bX){return bS.Interpolate(bT.TransformTime(bX/bU),bV,bW);},Duration:bU};};P.Const=function(bS){return Q.Const(bS);};P.Concat=function(bS){return{$:0,$0:o.Concat(by.map(Q.List,bS))};};P.Append=function(bS,bT){return{$:0,$0:o.Append(bS.$0,bT.$0)};};P.set_UseAnimations=function(bS){Q.set_UseAnimations(bS);};P.get_UseAnimations=function(){return Q.UseAnimations();};Q.UseAnimations=function(){S.$cctor();return S.UseAnimations;};Q.set_UseAnimations=function(bS){S.$cctor();S.UseAnimations=bS;};Q.Actions=function(bS){return Q.ConcatActions(bs.choose(function(bT){return bT.$==1?{$:1,$0:bT.$0}:null;},o.ToArray(bS.$0)));};Q.ConcatActions=function(bS){var bT,bU,bV,bW;bT=d.ofSeqNonCopying(bS);bU=bs.length(bT);return bU===0?Q.Const():bU===1?bs.get(bT,0):(bV=by.max(by.map(function(bX){return bX.Duration;},bT)),(bW=bs.map(function(bX){return Q.Prolong(bV,bX);},bT),Q.Def(bV,function(bX){bs.iter(function(bY){bY.Compute(bX);},bW);})));};Q.Prolong=function(bS,bT){var bU,bV,bW;bU=bT.Compute;bV=bT.Duration;bW=bJ.Create(function(){return bT.Compute(bT.Duration);});return{Compute:function(bX){return bX>=bV?bW.f():bU(bX);},Duration:bS};};Q.Const=function(bS){return Q.Def(0,function(){return bS;});};Q.Def=function(bS,bT){return{Compute:bT,Duration:bS};};Q.Finalize=function(bS){bs.iter(function(bT){if(bT.$==0)bT.$0();},o.ToArray(bS.$0));};Q.List=function(bS){return bS.$0;};R=c.Trans=bA.Class({Copy:function(bS,bT,bU,bV){var bW,bX,bY,bZ,b0,b1;bW=this;bX=(bY=function(b2,b3){return bW.TChange(b2,b3);},bS==null?function(b2){return function(b3){return bY(b2,b3);};}:bS.$0);return new R.New$3(function(b2,b3){return(bX(b2))(b3);},(bZ=this.get_TEnter(),bT==null?bZ:bT.$0),(b0=this.get_TExit(),bU==null?b0:bU.$0),(b1=this.get_TFlags(),bV==null?b1:bV.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(bS,bT){return this.change(bS,bT);}},null,R);R.New=bA.Ctor(function(bS,bT,bU){R.New$3.call(this,bS,bB.Equals(bT,null)?P.Const:bT,bB.Equals(bU,null)?P.Const:bU,1|(bB.Equals(bT,null)?0:2)|(bB.Equals(bU,null)?0:4));},R);R.New$1=bA.Ctor(function(bS){R.New$3.call(this,bS,P.Const,P.Const,1);},R);R.New$2=bA.Ctor(function(){R.New$3.call(this,function(bS,bT){return P.Const(bT);},P.Const,P.Const,0);},R);R.New$3=bA.Ctor(function(bS,bT,bU,bV){this.change=bS;this.enter=bT;this.exit=bU;this.flags=bV;},R);R.Exit=function(bS,bT){return bT.Copy(null,null,{$:1,$0:bS},{$:1,$0:bT.get_TFlags()|4});};R.Enter=function(bS,bT){return bT.Copy(null,{$:1,$0:bS},null,{$:1,$0:bT.get_TFlags()|2});};R.Change=function(bS,bT){return bT.Copy({$:1,$0:bS},null,null,{$:1,$0:bT.get_TFlags()|1});};R.Create=function(bS){return new R.New$1(bS);};R.Trivial=function(){return new R.New$2();};R.CanAnimateExit=function(bS){var bT,bU;bT=bS.get_TFlags();bU=4;return(bT&bU)===bU;};R.CanAnimateEnter=function(bS){var bT,bU;bT=bS.get_TFlags();bU=2;return(bT&bU)===bU;};R.CanAnimateChange=function(bS){var bT,bU;bT=bS.get_TFlags();bU=1;return(bT&bU)===bU;};R.AnimateExit=function(bS,bT){return(bS.get_TExit())(bT);};R.AnimateEnter=function(bS,bT){return(bS.get_TEnter())(bT);};R.AnimateChange=function(bS,bT,bU){return bS.TChange(bT,bU);};S.$cctor=bA.Cctor(function(){S.CubicInOut=N.Custom(function(bS){var bT;bT=bS*bS;return 3*bT-2*(bT*bS);});S.UseAnimations=true;S.$cctor=window.ignore;});T=c.AnimatedAttrNode=bA.Class({sync:function(bS){var bT;if(this.dirty){bT=this.logical;bT==null?void 0:(this.push(bS))(bT.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(bS,bT){this.visible={$:1,$0:bT};this.dirty=true;(this.push(bS))(bT);},NChanged:function(){return this.updates;},NSync:function(bS){},NGetExitAnim:function(bS){var bT,bU;bT=this;return P.WhenDone(function(){bT.dirty=true;bT.visible=null;},(bU=this.visible,bU!=null&&bU.$==1?P.Pack(P.Map(function(bV){bT.pushVisible(bS,bV);},R.AnimateExit(this.tr,bU.$0))):P.get_Empty()));},NGetEnterAnim:function(bS){var bT,bU,bV,bW,bX;bT=this;return P.WhenDone(function(){bT.sync(bS);},(bU=this.visible,(bV=this.logical,bU!=null&&bU.$==1&&(bV!=null&&bV.$==1&&(this.dirty&&(bW=[bV.$0,bU.$0],true)))?P.Pack(P.Map(function(bY){bT.pushVisible(bS,bY);},R.AnimateChange(this.tr,bW[1],bW[0]))):bU==null&&(bV!=null&&bV.$==1&&true)?P.Pack(P.Map(function(bY){bT.pushVisible(bS,bY);},R.AnimateEnter(this.tr,bV.$0))):P.get_Empty())));},NGetChangeAnim:function(bS){var bT,bU,bV,bW;bT=this;return P.WhenDone(function(){bT.sync(bS);},(bU=this.visible,(bV=this.logical,bU!=null&&bU.$==1&&(bV!=null&&bV.$==1&&(this.dirty&&(bW=[bV.$0,bU.$0],true)))?P.Pack(P.Map(function(bX){bT.pushVisible(bS,bX);},R.AnimateChange(this.tr,bW[1],bW[0]))):P.get_Empty())));}},null,T);T.New=bA.Ctor(function(bS,bT,bU){var bV;bV=this;this.tr=bS;this.push=bU;this.logical=null;this.visible=null;this.dirty=true;this.updates=y.Map(function(bW){bV.logical={$:1,$0:bW};bV.dirty=true;},bT);},T);U=c.DynamicAttrNode=bA.Class({NChanged:function(){return this.updates;},NSync:function(bS){if(this.dirty){(this.push(bS))(this.value);this.dirty=false;}},NGetExitAnim:function(bS){return P.get_Empty();},NGetEnterAnim:function(bS){return P.get_Empty();},NGetChangeAnim:function(bS){return P.get_Empty();}},null,U);U.New=bA.Ctor(function(bS,bT){var bU;bU=this;this.push=bT;this.value=void 0;this.dirty=false;this.updates=y.Map(function(bV){bU.value=bV;bU.dirty=true;},bS);},U);V=c.AttrProxy=bA.Class({},null,V);V.Handler=function(bS,bT){return Z.Static(function(bU){bU.addEventListener(bS,function(bV){return(bT(bU))(bV);},false);});};V.Concat=function(bS){var bT;bT=d.ofSeqNonCopying(bS);return d.TreeReduce(Z.EmptyAttr(),V.Append,bT);};V.Append=function(bS,bT){return Z.AppendTree(bS,bT);};V.Create=function(bS,bT){return Z.Static(function(bU){q.SetAttr(bU,bS,bT);});};Y.New=function(bS,bT,bU,bV){var bW;bW={DynElem:bS,DynFlags:bT,DynNodes:bU};bA.SetOptional(bW,"OnAfterRender",bV);return bW;};Z.Static=function(bS){return new V({$:3,$0:bS});};Z.Dynamic=function(bS,bT){return new V({$:1,$0:new U.New(bS,bT)});};Z.Animated=function(bS,bT,bU){var bV,bW,bX;bV=new T.New(bS,bT,bU);bW=4;R.CanAnimateEnter(bS)?bW=bW|1:void 0;R.CanAnimateExit(bS)?bW=bW|2:void 0;bX=new V({$:1,$0:bV});Z.SetFlags(bX,bW);return bX;};Z.EmptyAttr=function(){_2.$cctor();return _2.EmptyAttr;};Z.AppendTree=function(bS,bT){var bU;return bS===null?bT:bT===null?bS:(bU=new V({$:2,$0:bS,$1:bT}),(Z.SetFlags(bU,Z.Flags(bS)|Z.Flags(bT)),bU));};Z.GetChangeAnim=function(bS){return Z.GetAnim(bS,function(bT,bU){return bT.NGetChangeAnim(bU);});};Z.GetExitAnim=function(bS){return Z.GetAnim(bS,function(bT,bU){return bT.NGetExitAnim(bU);});};Z.GetEnterAnim=function(bS){return Z.GetAnim(bS,function(bT,bU){return bT.NGetEnterAnim(bU);});};Z.GetAnim=function(bS,bT){return P.Concat(bs.map(function(bU){return bT(bU,bS.DynElem);},bS.DynNodes));};Z.Updates=function(bS){return d.MapTreeReduce(function(bT){return bT.NChanged();},y.Const(),y.Map2Unit,bS.DynNodes);};Z.Empty=function(bS){return Y.New(bS,0,[],null);};Z.Insert=function(bS,bT){var bU,bV,bW;function bX(bY){if(!(bY===null))if(bY!=null&&bY.$==1)bU.push(bY.$0);else if(bY!=null&&bY.$==2){bX(bY.$0);bX(bY.$1);}else if(bY!=null&&bY.$==3)bY.$0(bS);else if(bY!=null&&bY.$==4)bV.push(bY.$0);}bU=[];bV=[];bX(bT);bW=bU.slice(0);return Y.New(bS,Z.Flags(bT),bW,bV.length===0?null:{$:1,$0:function(bY){by.iter(function(bZ){bZ(bY);},bV);}});};Z.Sync=function(bS,bT){bs.iter(function(bU){bU.NSync(bS);},bT.DynNodes);};Z.SetFlags=function(bS,bT){bS.flags=bT;};Z.Flags=function(bS){return bS!==null&&bS.hasOwnProperty("flags")?bS.flags:0;};Z.HasExitAnim=function(bS){var bT;bT=2;return(bS.DynFlags&bT)===bT;};Z.HasEnterAnim=function(bS){var bT;bT=1;return(bS.DynFlags&bT)===bT;};Z.HasChangeAnim=function(bS){var bT;bT=4;return(bS.DynFlags&bT)===bT;};_0=c.CheckedInput=bA.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_0);_0.Make=function(bS){return new _0({$:0,$0:bS,$1:window.String(bS)});};_1.ValidateForm=function(){return _1.OnAfterRender(function(bS){if(window.H5F)window.H5F.setup(bS);});};_1.Checked=function(bS){var bT;bT=function(bU){return!bB.Equals(bS.RVal(),bU.checked)?bS.set_RVal(bU.checked):null;};return V.Concat([_1.DynamicProp("checked",bS.RView()),_1.Handler("change",function(bU){return function(bV){return bT(bU,bV);};}),_1.Handler("click",function(bU){return function(bV){return bT(bU,bV);};})]);};_1.FloatValue=function(bS){return _1.CustomVar(bS,function(bT,bU){var bV;bV=bU.get_Input();return bT.value!==bV?void(bT.value=bV):null;},function(bT){var bU,bV;bU=bT.value;return{$:1,$0:e.isBlank(bU)?(bT.checkValidity?bT.checkValidity():true)?new _0({$:2,$0:bU}):new _0({$:1,$0:bU}):(bV=+bU,window.isNaN(bV)?new _0({$:1,$0:bU}):new _0({$:0,$0:bV,$1:bU}))};});};_1.FloatValueUnchecked=function(bS){return _1.CustomValue(bS,window.String,function(bT){var bU;return e.isBlank(bT)?{$:1,$0:0}:(bU=+bT,window.isNaN(bU)?null:{$:1,$0:bU});});};_1.IntValue=function(bS){return _1.CustomVar(bS,function(bT,bU){var bV;bV=bU.get_Input();return bT.value!==bV?void(bT.value=bV):null;},function(bT){var bU,bV,bW;bU=bT.value;return{$:1,$0:e.isBlank(bU)?(bT.checkValidity?bT.checkValidity():true)?new _0({$:2,$0:bU}):new _0({$:1,$0:bU}):(bV=(bW=0,[bM.TryParseInt32(bU,{get:function(){return bW;},set:function(bX){bW=bX;}}),bW]),bV[0]?new _0({$:0,$0:bV[1],$1:bU}):new _0({$:1,$0:bU}))};});};_1.IntValueUnchecked=function(bS){return _1.CustomValue(bS,window.String,function(bT){var bU;return e.isBlank(bT)?{$:1,$0:0}:(bU=+bT,bU!==bU>>0?null:{$:1,$0:bU});});};_1.Value=function(bS){var bT,bU;return _1.CustomValue(bS,window.id,(bT=window.id,(bU=function(bV){return{$:1,$0:bV};},function(bV){return bU(bT(bV));})));};_1.ContentEditableHtml=function(bS){var bT;bT=_1.CustomVar(bS,function(bU,bV){bU.innerHTML=bV;},function(bU){return{$:1,$0:bU.innerHTML};});return V.Append(V.Create("contenteditable","true"),bT);};_1.ContentEditableText=function(bS){var bT;bT=_1.CustomVar(bS,function(bU,bV){bU.textContent=bV;},function(bU){return{$:1,$0:bU.textContent};});return V.Append(V.Create("contenteditable","true"),bT);};_1.CustomValue=function(bS,bT,bU){return _1.CustomVar(bS,function(bV,bW){bV.value=bT(bW);},function(bV){return bU(bV.value);});};_1.CustomVar=function(bS,bT,bU){var bV,bW;bV=function(bX){return bS.RUpdM(function(bY){var bZ,b0;bZ=bU(bX);return bZ!=null&&bZ.$==1&&(!bB.Equals(bZ.$0,bY)&&(b0=[bZ,bZ.$0],true))?b0[0]:null;});};bW=function(bX,bY){var bZ,b0;bZ=bU(bX);return bZ!=null&&bZ.$==1&&(bB.Equals(bZ.$0,bY)&&(b0=bZ.$0,true))?null:bT(bX,bY);};return V.Concat([_1.Handler("change",function(bX){return function(bY){return bV(bX,bY);};}),_1.Handler("input",function(bX){return function(bY){return bV(bX,bY);};}),_1.Handler("keypress",function(bX){return function(bY){return bV(bX,bY);};}),_1.DynamicCustom(function(bX){return function(bY){return bW(bX,bY);};},bS.RView())]);};_1.DynamicProp=function(bS,bT){return Z.Dynamic(bT,function(bU){return function(bV){bU[bS]=bV;};});};_1.DynamicPred=function(bS,bT,bU){var bV;bV=function(bW,bX){return bX[0]?q.SetAttr(bW,bS,bX[1]):q.RemoveAttr(bW,bS);};return Z.Dynamic(y.Map2(function(bW,bX){return[bW,bX];},bT,bU),function(bW){return function(bX){return bV(bW,bX);};});};_1.DynamicClass=function(bS,bT,bU){return Z.Dynamic(bT,function(bV){return function(bW){return bU(bW)?q.AddClass(bV,bS):q.RemoveClass(bV,bS);};});};_1.OnAfterRenderView=function(bS,bT){var bU;bU=g.Id();return V.Append(_1.OnAfterRender(function(bV){bT(bV,bV[bU]);}),_1.DynamicCustom(function(bV){return function(bW){bV[bU]=bW;};},bS));};_1.OnAfterRender=function(bS){return new V({$:4,$0:bS});};_1.HandlerView=function(bS,bT,bU){return Z.Static(function(bV){var bW;bW=bU(bV);bV.addEventListener(bS,function(bX){return y.Get(bW(bX),bT);},false);});};_1.Handler=function(bS,bT){return Z.Static(function(bU){bU.addEventListener(bS,function(bV){return(bT(bU))(bV);},false);});};_1.DynamicStyle=function(bS,bT){return Z.Dynamic(bT,function(bU){return function(bV){return q.SetStyle(bU,bS,bV);};});};_1.DynamicCustom=function(bS,bT){return Z.Dynamic(bT,bS);};_1.Dynamic=function(bS,bT){return Z.Dynamic(bT,function(bU){return function(bV){return q.SetAttr(bU,bS,bV);};});};_1.AnimatedStyle=function(bS,bT,bU,bV){return Z.Animated(bT,bU,function(bW){return function(bX){return q.SetStyle(bW,bS,bV(bX));};});};_1.Animated=function(bS,bT,bU,bV){return Z.Animated(bT,bU,function(bW){return function(bX){return q.SetAttr(bW,bS,bV(bX));};});};_1.Class=function(bS){return Z.Static(function(bT){q.AddClass(bT,bS);});};_1.Style=function(bS,bT){return Z.Static(function(bU){q.SetStyle(bU,bS,bT);});};_2.$cctor=bA.Cctor(function(){_2.EmptyAttr=null;_2.$cctor=window.ignore;});_3=c.DocElemNode=bA.Class({GetHashCode:function(){return this.ElKey;},Equals:function(bS){return this.ElKey===bS.ElKey;}},null,_3);_3.New=function(bS,bT,bU,bV,bW,bX){var bY;return new _3((bY={Attr:bS,Children:bT,El:bV,ElKey:bW},(bA.SetOptional(bY,"Delimiters",bU),bA.SetOptional(bY,"Render",bX),bY)));};_5.FoldBack=function(bS,bT,bU){return bs.foldBack(bS,bT.$0,bU);};_5.Iter=function(bS,bT){bs.iter(bS,bT.$0);};_5.Except=function(bS,bT){var bU;bU=bS.$0;return{$:0,$0:bs.filter(function(bV){return bs.forall(function(bW){return!(bV===bW);},bU);},bT.$0)};};_5.DocChildren=function(bS){var bT;function bU(bV){if(bV!=null&&bV.$==2)bU(bV.$0.Current);else if(bV!=null&&bV.$==1)bT.push(bV.$0.El);else if(bV==null);else if(bV!=null&&bV.$==5)bT.push(bV.$0);else if(bV!=null&&bV.$==4)bT.push(bV.$0.Text);else if(bV!=null&&bV.$==6)bs.iter(function(bW){if(bW.constructor===window.Object)bU(bW);else bT.push(bW);},bV.$0.Els);else{bU(bV.$0);bU(bV.$1);}}bT=[];bU(bS.Children);return{$:0,$0:d.ofSeqNonCopying(bT)};};_5.Children=function(bS,bT){var bU,bV,bW;if(bT!=null&&bT.$==1){bW=[];bU=bT.$0[0].nextSibling;while(bU!==bT.$0[1]){bW.push(bU);bU=bU.nextSibling;}return{$:0,$0:bW};}else return{$:0,$0:bs.init(bS.childNodes.length,(bV=bS.childNodes,function(bX){return bV[bX];}))};};_6.ToArray=function(bS){return h.ToArray(bS.$0);};_6.get_Empty=function(){return{$:0,$0:new bx.New$3()};};_6.IsEmpty=function(bS){return bS.$0.get_Count()===0;};_6.Intersect=function(bS,bT){return{$:0,$0:h.Intersect(bS.$0,bT.$0)};};_6.Except=function(bS,bT){return{$:0,$0:h.Except(bS.$0,bT.$0)};};_6.FindAll=function(bS){var bT;function bU(bW){if(bW!=null&&bW.$==0){bU(bW.$0);bU(bW.$1);}else if(bW!=null&&bW.$==1)bV(bW.$0);else if(bW!=null&&bW.$==2)bU(bW.$0.Current);else if(bW!=null&&bW.$==6)bs.iter(bV,bW.$0.Holes);}function bV(bW){bT.push(bW);bU(bW.Children);}bT=[];bU(bS);return{$:0,$0:new bx.New$2(bT)};};_6.Filter=function(bS,bT){return{$:0,$0:h.Filter(bS,bT.$0)};};_7.New=function(bS,bT){return{PreviousNodes:bS,Top:bT};};_8.TextHoleRE=function(){ba.$cctor();return ba.TextHoleRE;};_8.LoadedTemplates=function(){ba.$cctor();return ba.LoadedTemplates;};_8.UpdateTextNode=function(bS,bT){bS.Value=bT;bS.Dirty=true;};_8.CreateTextNode=function(){return{Text:q.CreateText(""),Dirty:false,Value:""};};_8.UpdateEmbedNode=function(bS,bT){bS.Current=bT;bS.Dirty=true;};_8.CreateEmbedNode=function(){return{Current:null,Dirty:false};};_8.PerformAnimatedUpdate=function(bS,bT){var bU;return P.get_UseAnimations()?(bU=null,bD.Delay(function(){var bV,bW,bX;bV=_6.FindAll(bT);bW=_8.ComputeChangeAnim(bS,bV);bX=_8.ComputeEnterAnim(bS,bV);return bD.Bind(P.Play(P.Append(bW,_8.ComputeExitAnim(bS,bV))),function(){return bD.Bind(_8.SyncElemNodesNextFrame(bS),function(){return bD.Bind(P.Play(bX),function(){bS.PreviousNodes=bV;return bD.Return(null);});});});})):_8.SyncElemNodesNextFrame(bS);};_8.SyncElemNodesNextFrame=function(bS){var bT;bT=function(bU){window.requestAnimationFrame(function(){_8.SyncElemNode(bS.Top);bU();});};return bD.FromContinuations(function(bU,bV,bW){return bT.apply(null,[bU,bV,bW]);});};_8.ComputeEnterAnim=function(bS,bT){return P.Concat(bs.map(function(bU){return Z.GetEnterAnim(bU.Attr);},_6.ToArray(_6.Except(bS.PreviousNodes,_6.Filter(function(bU){return Z.HasEnterAnim(bU.Attr);},bT)))));};_8.ComputeChangeAnim=function(bS,bT){var bU,bV;bU=(bV=function(bW){return Z.HasChangeAnim(bW.Attr);},function(bW){return _6.Filter(bV,bW);});return P.Concat(bs.map(function(bW){return Z.GetChangeAnim(bW.Attr);},_6.ToArray(_6.Intersect(bU(bS.PreviousNodes),bU(bT)))));};_8.ComputeExitAnim=function(bS,bT){return P.Concat(bs.map(function(bU){return Z.GetExitAnim(bU.Attr);},_6.ToArray(_6.Except(bT,_6.Filter(function(bU){return Z.HasExitAnim(bU.Attr);},bS.PreviousNodes)))));};_8.CreateDelimitedRunState=function(bS,bT,bU){return _7.New(_6.get_Empty(),_8.CreateDelimitedElemNode(bS,bT,Z.EmptyAttr(),bU));};_8.CreateRunState=function(bS,bT){return _7.New(_6.get_Empty(),_8.CreateElemNode(bS,Z.EmptyAttr(),bT));};_8.CreateDelimitedElemNode=function(bS,bT,bU,bV){var bW,bX;bW=bS.parentNode;_8.LinkPrevElement(bT,bV);bX=Z.Insert(bW,bU);return _3.New(bX,bV,{$:1,$0:[bS,bT]},bW,g.Int(),bA.GetOptional(bX.OnAfterRender));};_8.CreateElemNode=function(bS,bT,bU){var bV;_8.LinkElement(bS,bU);bV=Z.Insert(bS,bT);return _3.New(bV,bU,null,bS,g.Int(),bA.GetOptional(bV.OnAfterRender));};_8.SyncElemNode=function(bS){_8.SyncElement(bS);_8.Sync(bS.Children);_8.AfterRender(bS);};_8.Sync=function(bS){var bT,bU;if(bS!=null&&bS.$==1)_8.SyncElemNode(bS.$0);else if(bS!=null&&bS.$==2)_8.Sync(bS.$0.Current);else if(bS==null);else if(bS!=null&&bS.$==5);else if(bS!=null&&bS.$==4){bT=bS.$0;bT.Dirty?(bT.Text.nodeValue=bT.Value,bT.Dirty=false):void 0;}else if(bS!=null&&bS.$==6){bU=bS.$0;bs.iter(function(bV){_8.SyncElemNode(bV);},bU.Holes);bs.iter(function(bV){Z.Sync(bV[0],bV[1]);},bU.Attrs);_8.AfterRender(bU);}else{_8.Sync(bS.$0);_8.Sync(bS.$1);}};_8.AfterRender=function(bS){var bT;bT=bA.GetOptional(bS.Render);bT!=null&&bT.$==1?(bT.$0(bS.El),bA.SetOptional(bS,"Render",null)):void 0;};_8.InsertBeforeDelim=function(bS,bT){var bU,bV;bU=bS.parentNode;bV=window.document.createTextNode("");bU.insertBefore(bV,bS);_8.LinkPrevElement(bS,bT);return bV;};_8.LinkPrevElement=function(bS,bT){_8.InsertDoc(bS.parentNode,bT,bS);};_8.LinkElement=function(bS,bT){_8.InsertDoc(bS,bT,null);};_8.SyncElement=function(bS){function bT(bU){function bV(bW){var bX,bY;return bW!=null&&bW.$==0?bV(bW.$0)||bV(bW.$1):bW!=null&&bW.$==2?(bX=bW.$0,bX.Dirty||bV(bX.Current)):bW!=null&&bW.$==6&&(bY=bW.$0,bY.Dirty||bs.exists(bT,bY.Holes));}return bV(bU.Children);}Z.Sync(bS.El,bS.Attr);bT(bS)?_8.DoSyncElement(bS):void 0;};_8.DoSyncElement=function(bS){var bT,bU,bV;function bW(bX,bY){var bZ,b0;return bX!=null&&bX.$==1?bX.$0.El:bX!=null&&bX.$==2?(bZ=bX.$0,bZ.Dirty?(bZ.Dirty=false,_8.InsertDoc(bT,bZ.Current,bY)):bW(bZ.Current,bY)):bX==null?bY:bX!=null&&bX.$==4?bX.$0.Text:bX!=null&&bX.$==5?bX.$0:bX!=null&&bX.$==6?(b0=bX.$0,(b0.Dirty?b0.Dirty=false:void 0,bs.foldBack(function(b1,b2){return b1.constructor===window.Object?bW(b1,b2):b1;},b0.Els,bY))):bW(bX.$0,bW(bX.$1,bY));}bT=bS.El;_5.Iter((bU=bS.El,function(bX){q.RemoveNode(bU,bX);}),_5.Except(_5.DocChildren(bS),_5.Children(bS.El,bA.GetOptional(bS.Delimiters))));bW(bS.Children,(bV=bA.GetOptional(bS.Delimiters),bV!=null&&bV.$==1?bV.$0[1]:null));};_8.InsertDoc=function(bS,bT,bU){var bV;return bT!=null&&bT.$==1?_8.InsertNode(bS,bT.$0.El,bU):bT!=null&&bT.$==2?(bV=bT.$0,(bV.Dirty=false,_8.InsertDoc(bS,bV.Current,bU))):bT==null?bU:bT!=null&&bT.$==4?_8.InsertNode(bS,bT.$0.Text,bU):bT!=null&&bT.$==5?_8.InsertNode(bS,bT.$0,bU):bT!=null&&bT.$==6?bs.foldBack(function(bW,bX){return bW.constructor===window.Object?_8.InsertDoc(bS,bW,bX):_8.InsertNode(bS,bW,bX);},bT.$0.Els,bU):_8.InsertDoc(bS,bT.$0,_8.InsertDoc(bS,bT.$1,bU));};_8.InsertNode=function(bS,bT,bU){q.InsertAt(bS,bU,bT);return bT;};_9=c.Doc=bA.Class({ReplaceInDom:function(bS){var bT;bT=window.document.createTextNode("");bS.parentNode.replaceChild(bT,bS);_9.RunBefore(bT,this);}},null,_9);_9.Append=function(bS,bT){return _9.Mk({$:0,$0:bS.docNode,$1:bT.docNode},y.Map2Unit(bS.updates,bT.updates));};_9.Concat=function(bS){var bT;bT=d.ofSeqNonCopying(bS);return d.TreeReduce(_9.Empty(),_9.Append,bT);};_9.Empty=function(){return _9.Mk(null,y.Const());};_9.TextNode=function(bS){return _9.Mk({$:5,$0:q.CreateText(bS)},y.Const());};_9.Verbatim=function(bS){var bT;return _9.Mk(d.MapTreeReduce(function(bU){return bB.Equals(bU.nodeType,bN.TEXT_NODE)?{$:5,$0:bU}:{$:1,$0:_8.CreateElemNode(bU,Z.EmptyAttr(),null)};},null,function(bU,bV){return{$:0,$0:bU,$1:bV};},(bT=bO.parseHTML(bS),bB.Equals(bT,null)?[]:bT)),y.Const());};_9.SvgElementMixed=function(bS,bT){var bU;bU=_9.MixedNodes(bT);return _9.SvgElement(bS,bU[0],bU[1]);};_9.SvgElement=function(bS,bT,bU){var bV,bW;bV=V.Concat(bT);bW=_9.Concat(bU);return _.New(q.CreateSvgElement(bS),bV,bW);};_9.ElementMixed=function(bS,bT){var bU;bU=_9.MixedNodes(bT);return _9.Element(bS,bU[0],bU[1]);};_9.ConcatMixed=function(bS){return _9.Concat(by.map(_9.ToMixedDoc,bS));};_9.MixedNodes=function(bS){var bT,bU,bV,bW;bT=new bG.New$2();bU=new bG.New$2();bV=bt.Get(bS);try{while(bV.MoveNext()){bW=bV.Current();bW instanceof V?bT.Add(bW):bU.Add(_9.ToMixedDoc(bW));}}finally{if("Dispose"in bV)bV.Dispose();}return[bT,bU];};_9.ToMixedDoc=function(bS){return bS instanceof _9?bS:typeof bS=="string"?_9.TextNode(bS):bS instanceof window.Element?_9.Static(bS):typeof bS=="function"?_9.EmbedView(y.Map(_9.ToMixedDoc,bS)):bS instanceof w?_9.EmbedView(y.Map(_9.ToMixedDoc,bS.v)):bB.Equals(bS,null)?_9.Empty():_9.TextNode(window.String(bS));};_9.Element=function(bS,bT,bU){var bV,bW;bV=V.Concat(bT);bW=_9.Concat(bU);return _.New(q.CreateElement(bS),bV,bW);};_9.Radio=function(bS,bT,bU){var bV,bW;bV=q.CreateElement("input");bV.addEventListener("click",function(){return bU.RSet(bT);},false);bW=_1.DynamicProp("checked",y.Map(function(bX){return bB.Equals(bX,bT);},bU.RView()));return _.New(bV,V.Concat(br.append(br.ofArray([V.Create("type","radio"),V.Create("name",bU.RId()),bW]),br.ofSeq(bS))),_9.Empty());};_9.LinkView=function(bS,bT,bU,bV){var bW;bW=V.Concat(by.append([_1.HandlerView("click",bU,function(){return function(){return bV;};}),V.Create("href","#")],bT));return _.New(q.CreateElement("a"),bW,_9.TextNode(bS));};_9.Link=function(bS,bT,bU){var bV,bW;bV=(bW=V.Concat(bT),V.Append(V.Create("href","#"),bW));return _.New(_9.Clickable("a",bU),bV,_9.TextNode(bS));};_9.ButtonView=function(bS,bT,bU,bV){var bW;bW=V.Concat(by.append([_1.HandlerView("click",bU,function(){return function(){return bV;};})],bT));return _.New(q.CreateElement("button"),bW,_9.TextNode(bS));};_9.Button=function(bS,bT,bU){var bV;bV=V.Concat(bT);return _.New(_9.Clickable("button",bU),bV,_9.TextNode(bS));};_9.Clickable=function(bS,bT){var bU;bU=q.CreateElement(bS);bU.addEventListener("click",function(bV){bV.preventDefault();return bT();},false);return bU;};_9.CheckBoxGroup=function(bS,bT,bU){var bV;return _9.CheckBox(bS,w.Lens(bU,(bV=function(bW){return bB.Equals(bT,bW);},function(bW){return br.exists(bV,bW);}),function(bW,bX){return bX?br.exists(function(bY){return bB.Equals(bT,bY);},bW)?bW:new br.T({$:1,$0:bT,$1:bW}):br.filter(function(bY){return!bB.Equals(bT,bY);},bW);}));};_9.CheckBox=function(bS,bT){return _9.InputInternal("input",function(){return by.append(bS,[V.Create("type","checkbox"),_1.Checked(bT)]);});};_9.SelectDynOptional=function(bS,bT,bU,bV,bW){return _9.SelectDyn(bS,function(bX){return bX!=null&&bX.$==1?bU(bX.$0):bT;},y.Map(function(bX){return new br.T({$:1,$0:null,$1:br.map(function(bY){return{$:1,$0:bY};},bX)});},bV),bW);};_9.SelectOptional=function(bS,bT,bU,bV,bW){return _9.Select(bS,function(bX){return bX!=null&&bX.$==1?bU(bX.$0):bT;},new br.T({$:1,$0:null,$1:br.map(function(bX){return{$:1,$0:bX};},bV)}),bW);};_9.Select=function(bS,bT,bU,bV){return _9.SelectImpl(bS,bT,function(bW){bW[0]=bU;return _9.Concat(br.mapi(function(bX,bY){return _9.Element("option",br.ofArray([V.Create("value",window.String(bX))]),br.ofArray([_9.TextNode(bT(bY))]));},bU));},bV);};_9.SelectDyn=function(bS,bT,bU,bV){return _9.SelectImpl(bS,bT,function(bW){var bX;bX=function(bY,bZ){return _9.Element("option",br.ofArray([V.Create("value",window.String(bY))]),br.ofArray([_9.TextNode(bT(bZ))]));};return _9.Convert(function(bY){return bX(bY[0],bY[1]);},y.Map(function(bY){bW[0]=bY;return by.mapi(function(bZ,b0){return[bZ,b0];},bY);},bU));},bV);};_9.SelectImpl=function(bS,bT,bU,bV){var bW,bX,bY,bZ,b0,b1,b2,b3,b4;bW=[br.T.Empty];bX=function(b5){return b5.selectedIndex;};bY=function(b5,b6){b5.selectedIndex=b6;};bZ=function(b5){var b6;b6=bX(b5);return bW[0].get_Item(b6);};b0=function(b5){return by.findIndex(function(b6){return bB.Equals(b5,b6);},bW[0]);};b1=function(b5,b6){return bY(b5,b0(b6));};b2=q.CreateElement("select");b3=_1.DynamicCustom(function(b5){return function(b6){return b1(b5,b6);};},bV.RView());b2.addEventListener("change",function(){bV.RUpdM(function(b5){var b6;b6=bZ(b2);return bB.Equals(b5,b6)?null:{$:1,$0:b6};});},false);return _.New(b2,(b4=V.Append(b3,V.Concat(bS)),V.Append(_1.OnAfterRender(function(b5){b1(b5,bV.RGet());}),b4)),bU(bW));};_9.InputArea=function(bS,bT){return _9.InputInternal("textarea",function(){return by.append(bS,[_1.Value(bT)]);});};_9.FloatInput=function(bS,bT){return _9.InputInternal("input",function(){return by.append(bS,[_1.FloatValue(bT),V.Create("type","number")]);});};_9.FloatInputUnchecked=function(bS,bT){return _9.InputInternal("input",function(){return by.append(bS,[bT.RGet()===0?V.Create("value","0"):Z.EmptyAttr(),_1.FloatValueUnchecked(bT),V.Create("type","number")]);});};_9.IntInput=function(bS,bT){return _9.InputInternal("input",function(){return by.append(bS,[_1.IntValue(bT),V.Create("type","number")]);});};_9.IntInputUnchecked=function(bS,bT){return _9.InputInternal("input",function(){return by.append(bS,[bT.RGet()===0?V.Create("value","0"):Z.EmptyAttr(),_1.IntValueUnchecked(bT),V.Create("type","number")]);});};_9.PasswordBox=function(bS,bT){return _9.InputInternal("input",function(){return by.append(bS,[_1.Value(bT),V.Create("type","password")]);});};_9.Input=function(bS,bT){return _9.InputInternal("input",function(){return by.append(bS,[_1.Value(bT)]);});};_9.InputInternal=function(bS,bT){var bU;bU=q.CreateElement(bS);return _.New(bU,V.Concat(bT(bU)),_9.Empty());};_9.ConvertSeqBy=function(bS,bT,bU){return _9.Flatten(y.MapSeqCachedViewBy(bS,function(bV,bW){return(bT(bV))(bW);},bU));};_9.ConvertSeq=function(bS,bT){return _9.Flatten(y.MapSeqCachedView(bS,bT));};_9.ConvertBy=function(bS,bT,bU){return _9.Flatten(y.MapSeqCachedBy(bS,bT,bU));};_9.Convert=function(bS,bT){return _9.Flatten(y.MapSeqCached(bS,bT));};_9.Flatten=function(bS){return _9.EmbedView(y.Map(_9.Concat,bS));};_9.GetOrLoadTemplate=function(bS,bT,bU,bV){_9.PrepareTemplate(bS,bT,bU);return _9.NamedTemplate(bS,bT,bV);};_9.NamedTemplate=function(bS,bT,bU){var bV,bW,bX;bV=_9.ComposeName(bS,bT);bW=(bX=null,[_8.LoadedTemplates().TryGetValue(bV,{get:function(){return bX;},set:function(bY){bX=bY;}}),bX]);return bW[0]?_9.ChildrenTemplate(bW[1].cloneNode(true),bU):(bC.warn("Local template doesn't exist",bV),_9.Empty());};_9.LoadLocalTemplates=function(bS){(function(){var bT,bU,bV,bW;while(true){bT=window.document.querySelector("[ws-template]");if(bB.Equals(bT,null)){bU=window.document.querySelector("[ws-children-template]");if(bB.Equals(bU,null))return null;else{bV=bU.getAttribute("ws-children-template");bU.removeAttribute("ws-children-template");_9.PrepareTemplate(bS,{$:1,$0:bV},function(bX){return function(){return q.ChildrenArray(bX);};}(bU));}}else{bW=bT.getAttribute("ws-template");_9.PrepareSingleTemplate(bS,{$:1,$0:bW},bT);}}}());};_9.PrepareTemplate=function(bS,bT,bU){var bV,bW,bX,bY,bZ;if(!_8.LoadedTemplates().ContainsKey(_9.ComposeName(bS,bT))){bV=bU();for(bW=0,bX=bV.length-1;bW<=bX;bW++){bY=bs.get(bV,bW);bZ=bY.parentNode;bB.Equals(bZ,null)?void 0:bZ.removeChild(bY);}_9.PrepareTemplateStrict(bS,bT,bV);}};_9.PrepareTemplateStrict=function(bS,bT,bU){var bV,bW,bX,bY,bZ,b0,b1,b2;function b3(b8,b9,b_){var b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv;while(true)switch(b8){case 0:cd=bP.string(b9.nodeName,{$:1,$0:3},null).toLowerCase();ce=cd.indexOf(bQ.fromCharCode(46))===-1?bS+"/"+cd:bu.Replace(cd,".","/");if(!_8.LoadedTemplates().ContainsKey(ce))return bC.warn("Instantiating non-loaded template",ce);else{cf=_8.LoadedTemplates().get_Item(ce);cg=cf.cloneNode(true);ch=new bx.New$3();ci=new bK.New$5();cj=b9.attributes;for(ck=0,cl=cj.length-1;ck<=cl;ck++){cm=cj.item(ck).name.toLowerCase();ci.set_Item(cm,(cn=cj.item(ck).nodeValue,cn===""?cm:cn.toLowerCase()));!ch.Add(cm)?bC.warn("Hole mapped twice",cm):void 0;}for(co=0,cp=b9.childNodes.length-1;co<=cp;co++){cq=b9.childNodes[co];bB.Equals(cq.nodeType,bN.ELEMENT_NODE)?!ch.Add(cq.nodeName.toLowerCase())?bC.warn("Hole filled twice",ce):void 0:void 0;}cr=b9.childNodes.length===1&&bB.Equals(b9.firstChild.nodeType,bN.TEXT_NODE);if(cr){ca=b0(cg,b9.firstChild.textContent);((function(cw){return function(cx){if(cx!=null)cw(cx.$0);};}((cb=function(cw){return function(cx){return cw.Add(cx);};}(ch),cc=function(){},function(cw){return cc(cb(cw));})))(ca));}bZ(cg,ch);if(!cr){for(cs=0,ct=b9.childNodes.length-1;cs<=ct;cs++){cu=b9.childNodes[cs];bB.Equals(cu.nodeType,bN.ELEMENT_NODE)?cu.hasAttributes()?bY(cg,cu):b4(cg,cu):void 0;}}bX(cg,ci);(((function(cw){var cx;cx=function(cy,cz){return b1(cw,cy,cz);};return function(cy){return function(cz){return cx(cy,cz);};};}(cg))(b9.parentNode))(b9));b9.parentNode.removeChild(b9);}case 1:if(b_!==null){cv=b_.nextSibling;if(bB.Equals(b_.nodeType,bN.TEXT_NODE))bW(b_);else if(bB.Equals(b_.nodeType,bN.ELEMENT_NODE))b6(b_);b8=1;b9=b9;b_=cv;}else return null;}}function b4(b8,b9){var b_,ca,cb;function b$(cc,cd){var ce,cf,cg;if(ca==="title"&&b9.hasChildNodes()){ce=bO.parseHTML(b9.textContent);b9.removeChild(b9.firstChild);for(cf=0,cg=ce.length-1;cf<=cg;cf++)b9.appendChild(bs.get(ce,cf));}else null;b6(b9);return b1(b9,cc,cd);}ca=b9.nodeName.toLowerCase();q.IterSelector(b8,"[ws-attr-holes]",function(cc){var cd,ce,cf,cg;cd=bu.SplitChars(cc.getAttribute("ws-attr-holes"),[32],1);for(ce=0,cf=cd.length-1;ce<=cf;ce++){cg=bs.get(cd,ce);cc.setAttribute(cg,new window.RegExp("\\${"+ca+"}","ig")[bR.replace](cc.getAttribute(cg),b9.textContent));}});cb=b8.querySelector("[ws-hole="+ca+"]");if(bB.Equals(cb,null)){b_=b8.querySelector("[ws-replace="+ca+"]");return bB.Equals(b_,null)?null:(b$(b_.parentNode,b_),void b_.parentNode.removeChild(b_));}else{while(cb.hasChildNodes())cb.removeChild(cb.lastChild);cb.removeAttribute("ws-hole");return b$(cb,null);}}function b5(b8){return b3(0,b8);}function b6(b8){var b9,b_;if(bu.StartsWith(b8.nodeName.toLowerCase(),"ws-")&&!b8.hasAttribute("ws-template"))b5(b8);else{bV(b8);b9=b8.getAttribute("ws-template");if(b9===null){b_=b8.getAttribute("ws-children-template");if(b_===null)b7(b8,b8.firstChild);else{b8.removeAttribute("ws-children-template");_9.PrepareTemplate(bS,{$:1,$0:b_},function(){return q.ChildrenArray(b8);});while(b8.hasChildNodes())b8.removeChild(b8.lastChild);}}else _9.PrepareSingleTemplate(bS,{$:1,$0:b9},b8);}}function b7(b8,b9){return b3(1,b8,b9);}bV=function(b8){var b_,b$,ca,cb,cc,cd,ce;function b9(cf){var cg;cg=b8.getAttribute(cf);cg===null?void 0:b8.setAttribute(cf,cg.toLowerCase());}b_=b8.attributes;b$=[];ca=[];cb=[];for(cc=0,cd=b_.length-1;cc<=cd;cc++){ce=b_.item(cc);bu.StartsWith(ce.nodeName,"ws-on")&&ce.nodeName!=="ws-onafterrender"&&ce.nodeName!=="ws-on"?(b$.push(ce.nodeName),ca.push(bP.string(ce.nodeName,{$:1,$0:"ws-on".length},null)+":"+ce.nodeValue.toLowerCase())):!bu.StartsWith(ce.nodeName,"ws-")&&(new window.RegExp(_8.TextHoleRE())).test(ce.nodeValue)?(ce.nodeValue=new window.RegExp(_8.TextHoleRE(),"g")[bR.replace](ce.nodeValue,function(cf,cg){return"${"+cg.toLowerCase()+"}";}),cb.push(ce.nodeName)):void 0;}!(ca.length==0)?b8.setAttribute("ws-on",bu.concat(" ",ca)):void 0;!(cb.length==0)?b8.setAttribute("ws-attr-holes",bu.concat(" ",cb)):void 0;b9("ws-hole");b9("ws-replace");b9("ws-attr");b9("ws-onafterrender");b9("ws-var");bs.iter(function(cf){b8.removeAttribute(cf);},b$);};bW=function(b8){var b9,b_,b$,ca,cb,cc;b9=null;b_=0;ca=b8.textContent;cb=new window.RegExp(_8.TextHoleRE(),"g");while(b9=cb.exec(ca),b9!==null){b8.parentNode.insertBefore(window.document.createTextNode(bP.string(ca,{$:1,$0:b_},{$:1,$0:cb.lastIndex-bs.get(b9,0).length-1})),b8);b_=cb.lastIndex;cc=window.document.createElement("span");cc.setAttribute("ws-replace",bs.get(b9,1).toLowerCase());b8.parentNode.insertBefore(cc,b8);}cb.lastIndex=0;b8.textContent=bP.string(ca,{$:1,$0:b_},null);};bX=function(b8,b9){function b_(b$){q.IterSelector(b8,"["+b$+"]",function(ca){var cb,cc;cb=(cc=null,[b9.TryGetValue(ca.getAttribute(b$).toLowerCase(),{get:function(){return cc;},set:function(cd){cc=cd;}}),cc]);cb[0]?ca.setAttribute(b$,cb[1]):void 0;});}b_("ws-hole");b_("ws-replace");b_("ws-attr");b_("ws-onafterrender");b_("ws-var");q.IterSelector(b8,"[ws-on]",function(b$){b$.setAttribute("ws-on",bu.concat(" ",bs.map(function(ca){var cb,cc,cd;cb=bu.SplitChars(ca,[58],1);cc=(cd=null,[b9.TryGetValue(bs.get(cb,1),{get:function(){return cd;},set:function(ce){cd=ce;}}),cd]);return cc[0]?bs.get(cb,0)+":"+cc[1]:ca;},bu.SplitChars(b$.getAttribute("ws-on"),[32],1))));});return q.IterSelector(b8,"[ws-attr-holes]",function(b$){var ca,cb,cc;ca=bu.SplitChars(b$.getAttribute("ws-attr-holes"),[32],1);for(cb=0,cc=ca.length-1;cb<=cc;cb++)(function(){var cd,ce;cd=bs.get(ca,cb);return b$.setAttribute(cd,((ce=function(cf,cg){var ch;ch=bH.KeyValue(cg);return new window.RegExp("\\${"+ch[0]+"}","ig")[bR.replace](cf,"${"+ch[1]+"}");},(bA.Curried3(by.fold))(ce))(b$.getAttribute(cd)))(b9));}());});};bY=function(b8,b9){var b_,b$,ca,cb,cc;bV(b9);b_=b9.nodeName.toLowerCase();b$=b8.querySelector("[ws-attr="+b_+"]");if(bB.Equals(b$,null))return bC.warn("Filling non-existent attr hole",b_);else{b$.removeAttribute("ws-attr");for(ca=0,cb=b9.attributes.length-1;ca<=cb;ca++){cc=b9.attributes.item(ca);cc.name==="class"&&b$.hasAttribute("class")?b$.setAttribute("class",b$.getAttribute("class")+" "+cc.nodeValue):b$.setAttribute(cc.name,cc.nodeValue);}return;}};bZ=function(b8,b9){function b_(b$){q.IterSelector(b8,"["+b$+"]",function(ca){if(!b9.Contains(ca.getAttribute(b$)))ca.removeAttribute(b$);});}b_("ws-attr");b_("ws-onafterrender");b_("ws-var");q.IterSelector(b8,"[ws-hole]",function(b$){if(!b9.Contains(b$.getAttribute("ws-hole"))){b$.removeAttribute("ws-hole");while(b$.hasChildNodes())b$.removeChild(b$.lastChild);}});q.IterSelector(b8,"[ws-replace]",function(b$){if(!b9.Contains(b$.getAttribute("ws-replace")))b$.parentNode.removeChild(b$);});q.IterSelector(b8,"[ws-on]",function(b$){b$.setAttribute("ws-on",bu.concat(" ",bs.filter(function(ca){return b9.Contains(bs.get(bu.SplitChars(ca,[58],1),1));},bu.SplitChars(b$.getAttribute("ws-on"),[32],1))));});return q.IterSelector(b8,"[ws-attr-holes]",function(b$){var ca,cb,cc,cd;ca=bu.SplitChars(b$.getAttribute("ws-attr-holes"),[32],1);for(cb=0,cc=ca.length-1;cb<=cc;cb++){cd=bs.get(ca,cb);b$.setAttribute(cd,new window.RegExp(_8.TextHoleRE(),"g")[bR.replace](b$.getAttribute(cd),function(ce,cf){return b9.Contains(cf)?ce:"";}));}});};b0=function(b8,b9){var b_;b_=b8.querySelector("[ws-replace]");return bB.Equals(b_,null)?(bC.warn("Filling non-existent text hole",bT),null):(b_.parentNode.replaceChild(new window.Text(b9),b_),{$:1,$0:b_.getAttribute("ws-replace")});};b1=function(b8,b9,b_){while(true)if(b8.hasChildNodes())b_=b9.insertBefore(b8.lastChild,b_);else return null;};b2=_9.FakeRoot(bU);_8.LoadedTemplates().set_Item(_9.ComposeName(bS,bT),b2);bs.length(bU)>0?b7(b2,bs.get(bU,0)):void 0;};_9.ComposeName=function(bS,bT){return(bS+"/"+(bT==null?"":bT.$0)).toLowerCase();};_9.PrepareSingleTemplate=function(bS,bT,bU){var bV,bW,bX;bU.removeAttribute("ws-template");bV=bU.getAttribute("ws-replace");bV===null?void 0:(bU.removeAttribute("ws-replace"),bW=bU.parentNode,bB.Equals(bW,null)?void 0:(bX=window.document.createElement(bU.tagName),bX.setAttribute("ws-replace",bV),bW.replaceChild(bX,bU)));_9.PrepareTemplateStrict(bS,bT,[bU]);};_9.FakeRoot=function(bS){var bT,bU,bV;bT=window.document.createElement("div");for(bU=0,bV=bS.length-1;bU<=bV;bU++)bT.appendChild(bs.get(bS,bU));return bT;};_9.ChildrenTemplate=function(bS,bT){var bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7;b1=[];b2=[];b3=[];b4=[];b5=new bK.New$5();b6=bt.Get(bT);try{while(b6.MoveNext()){b7=b6.Current();b5.set_Item(b7.$0,b7);}}finally{if("Dispose"in b6)b6.Dispose();}bU=q.ChildrenArray(bS);bV=function(b8,b9){var b_,b$,ca;b_=Z.Insert(b8,b9);b2.push(Z.Updates(b_));b3.push([b8,b_]);b$=bA.GetOptional(b_.OnAfterRender);return b$==null?null:(ca=b$.$0,void b4.push(function(){ca(b8);}));};bW=function(b8){var b9,b_;b9=(b_=null,[b5.TryGetValue(b8,{get:function(){return b_;},set:function(b$){b_=b$;}}),b_]);return b9[0]?b9[1].$==0?{$:1,$0:b9[1].$1}:b9[1].$==1?{$:1,$0:_9.TextNode(b9[1].$1)}:b9[1].$==2?{$:1,$0:_9.TextView(b9[1].$1)}:b9[1].$==6?{$:1,$0:_9.TextView(b9[1].$1.RView())}:b9[1].$==7?{$:1,$0:_9.TextView(y.Map(bQ,b9[1].$1.RView()))}:b9[1].$==8?{$:1,$0:_9.TextView(y.Map(function(b$){return b$.get_Input();},b9[1].$1.RView()))}:b9[1].$==9?{$:1,$0:_9.TextView(y.Map(bQ,b9[1].$1.RView()))}:b9[1].$==10?{$:1,$0:_9.TextView(y.Map(function(b$){return b$.get_Input();},b9[1].$1.RView()))}:b9[1].$==11?{$:1,$0:_9.TextView(y.Map(bQ,b9[1].$1.RView()))}:(bC.warn("Content hole filled with attribute data",b8),null):null;};q.IterSelector(bS,"[ws-hole]",function(b8){var b9,b_,b$;b$=b8.getAttribute("ws-hole");b8.removeAttribute("ws-hole");while(b8.hasChildNodes())b8.removeChild(b8.lastChild);b9=bW(b$);b9!=null&&b9.$==1?(b_=b9.$0,_8.LinkElement(b8,b_.docNode),b1.push(_3.New(Z.Empty(b8),b_.docNode,null,b8,g.Int(),null)),b2.push(b_.updates)):void 0;});q.IterSelector(bS,"[ws-replace]",function(b8){var b9,b_,b$,ca,cb,cc;b9=bW(b8.getAttribute("ws-replace"));b9!=null&&b9.$==1?(b_=b9.$0,b$=b8.parentNode,ca=window.document.createTextNode(""),b$.replaceChild(ca,b8),cb=_8.InsertBeforeDelim(ca,b_.docNode),cc=bs.tryFindIndex(function(cd){return b8===cd;},bU),cc==null?void 0:bs.set(bU,cc.$0,b_.docNode),b1.push(_3.New(Z.Empty(b$),b_.docNode,{$:1,$0:[cb,ca]},b$,g.Int(),null)),b2.push(b_.updates)):void 0;});q.IterSelector(bS,"[ws-attr]",function(b8){var b9,b_,b$;b9=b8.getAttribute("ws-attr");b8.removeAttribute("ws-attr");b_=(b$=null,[b5.TryGetValue(b9,{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);b_[0]?b_[1].$==3?bV(b8,b_[1].$1):bC.warn("Attribute hole filled with non-attribute data",b9):void 0;});q.IterSelector(bS,"[ws-on]",function(b8){bV(b8,V.Concat(bs.choose(function(b9){var b_,b$,ca;b_=bu.SplitChars(b9,[58],1);b$=(ca=null,[b5.TryGetValue(bs.get(b_,1),{get:function(){return ca;},set:function(cb){ca=cb;}}),ca]);return b$[0]?b$[1].$==4?{$:1,$0:_1.Handler(bs.get(b_,0),b$[1].$1)}:(bC.warn("Event hole on"+bs.get(b_,0)+" filled with non-event data",bs.get(b_,1)),null):null;},bu.SplitChars(b8.getAttribute("ws-on"),[32],1))));b8.removeAttribute("ws-on");});q.IterSelector(bS,"[ws-onafterrender]",function(b8){var b9,b_,b$;b9=b8.getAttribute("ws-onafterrender");b_=(b$=null,[b5.TryGetValue(b9,{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);b_[0]?b_[1].$==5?(b8.removeAttribute("ws-onafterrender"),bV(b8,_1.OnAfterRender(b_[1].$1))):bC.warn("onafterrender hole filled with non-onafterrender data",b9):void 0;});q.IterSelector(bS,"[ws-var]",function(b8){var b9,b_,b$;b9=b8.getAttribute("ws-var");b8.removeAttribute("ws-var");b_=(b$=null,[b5.TryGetValue(b9,{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);b_[0]?b_[1].$==6?bV(b8,_1.Value(b_[1].$1)):b_[1].$==7?bV(b8,_1.Checked(b_[1].$1)):b_[1].$==8?bV(b8,_1.IntValue(b_[1].$1)):b_[1].$==9?bV(b8,_1.IntValueUnchecked(b_[1].$1)):b_[1].$==10?bV(b8,_1.FloatValue(b_[1].$1)):b_[1].$==11?bV(b8,_1.FloatValueUnchecked(b_[1].$1)):bC.warn("Var hole filled with non-Var data",b9):void 0;});q.IterSelector(bS,"[ws-attr-holes]",function(b8){var b9,b_,b$,ca;b9=new window.RegExp(_8.TextHoleRE(),"g");b_=bu.SplitChars(b8.getAttribute("ws-attr-holes"),[32],1);b8.removeAttribute("ws-attr-holes");for(b$=0,ca=b_.length-1;b$<=ca;b$++)(function(){var cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn;ck=bs.get(b_,b$);cl=b8.getAttribute(ck);cb=null;cc=0;cm=[];while(cb=b9.exec(cl),cb!==null){cn=bP.string(cl,{$:1,$0:cc},{$:1,$0:b9.lastIndex-bs.get(cb,0).length-1});cc=b9.lastIndex;cm.push([cn,bs.get(cb,1)]);}ce=bP.string(cl,{$:1,$0:cc},null);b9.lastIndex=0;cf=bs.foldBack(function(co,cp){return(function(cq){var cr,cs;cr=cq[0];cs=cq[1];return function(ct){var cu,cv,cw,cx,cy;cu=ct[0];cv=ct[1];cw=(cx=(cy=null,[b5.TryGetValue(cs,{get:function(){return cy;},set:function(cz){cy=cz;}}),cy]),cx[0]?cx[1].$==1?{$:0,$0:cx[1].$1}:cx[1].$==2?{$:1,$0:cx[1].$1}:cx[1].$==6?{$:1,$0:cx[1].$1.RView()}:cx[1].$==7?{$:1,$0:y.Map(bQ,cx[1].$1.RView())}:cx[1].$==8?{$:1,$0:y.Map(function(cz){return cz.get_Input();},cx[1].$1.RView())}:cx[1].$==9?{$:1,$0:y.Map(bQ,cx[1].$1.RView())}:cx[1].$==10?{$:1,$0:y.Map(function(cz){return cz.get_Input();},cx[1].$1.RView())}:cx[1].$==11?{$:1,$0:y.Map(bQ,cx[1].$1.RView())}:(bC.warn("Attribute value hole filled with non-text data",cs),{$:0,$0:""}):{$:0,$0:""});return cw.$==1?[cr,new br.T({$:1,$0:cu===""?cw.$0:y.Map(function(cz){return cz+cu;},cw.$0),$1:cv})]:[cr+cw.$0+cu,cv];};}(co))(cp);},cm,[ce,br.T.Empty]);return bV(b8,cf[1].$==1?cf[1].$1.$==1?cf[1].$1.$1.$==1?cf[1].$1.$1.$1.$==0?(cg=cf[0],_1.Dynamic(ck,y.Map3(function(co,cp,cq){return cg+co+cp+cq;},cf[1].$0,cf[1].$1.$0,cf[1].$1.$1.$0))):(ch=cf[0],_1.Dynamic(ck,y.Map(function(co){return ch+bu.concat("",co);},y.Sequence(cf[1])))):(ci=cf[0],_1.Dynamic(ck,y.Map2(function(co,cp){return ci+co+cp;},cf[1].$0,cf[1].$1.$0))):cf[0]===""?_1.Dynamic(ck,cf[1].$0):(cj=cf[0],_1.Dynamic(ck,y.Map(function(co){return cj+co;},cf[1].$0))):V.Create(ck,cf[0]));}());});bX=bA.DeleteEmptyFields({Els:bU,Dirty:true,Holes:b1,Attrs:b3,Render:(bY=b4.length==0?null:{$:1,$0:function(b8){bs.iter(function(b9){b9(b8);},b4);}},bY?bY.$0:void 0)},["Render"]);bZ=d.TreeReduce(y.Const(),y.Map2Unit,b2);return bU&&bs.length(bU)===1&&(bs.get(bU,0)instanceof bN&&(bB.Equals(bs.get(bU,0).nodeType,bN.ELEMENT_NODE)&&(b0=bs.get(bU,0),true)))?_.TreeNode(bX,bZ):_9.Mk({$:6,$0:bX},bZ);};_9.Template=function(bS,bT){return _9.ChildrenTemplate(_9.FakeRoot(bS),bT);};_9.TextView=function(bS){var bT;bT=_8.CreateTextNode();return _9.Mk({$:4,$0:bT},y.Map(function(bU){_8.UpdateTextNode(bT,bU);},bS));};_9.RunReplaceById=function(bS,bT){var bU;bU=q.Doc().getElementById(bS);bB.Equals(bU,null)?bH.FailWith("invalid id: "+bS):bT.ReplaceInDom(bU);};_9.RunById=function(bS,bT){var bU;bU=q.Doc().getElementById(bS);bB.Equals(bU,null)?bH.FailWith("invalid id: "+bS):_9.Run(bU,bT);};_9.Run=function(bS,bT){var bU;bU=bT.docNode;_8.LinkElement(bS,bU);y.Sink(l.StartProcessor(_8.PerformAnimatedUpdate(_8.CreateRunState(bS,bU),bU)),bT.updates);};_9.RunPrependById=function(bS,bT){var bU;bU=q.Doc().getElementById(bS);bB.Equals(bU,null)?bH.FailWith("invalid id: "+bS):_9.RunPrepend(bU,bT);};_9.RunPrepend=function(bS,bT){var bU;bU=window.document.createTextNode("");bS.insertBefore(bU,bS.firstChild);_9.RunBefore(bU,bT);};_9.RunAppendById=function(bS,bT){var bU;bU=q.Doc().getElementById(bS);bB.Equals(bU,null)?bH.FailWith("invalid id: "+bS):_9.RunAppend(bU,bT);};_9.RunAppend=function(bS,bT){var bU;bU=window.document.createTextNode("");bS.appendChild(bU);_9.RunBefore(bU,bT);};_9.RunAfterById=function(bS,bT){var bU;bU=q.Doc().getElementById(bS);bB.Equals(bU,null)?bH.FailWith("invalid id: "+bS):_9.RunAfter(bU,bT);};_9.RunAfter=function(bS,bT){var bU;bU=window.document.createTextNode("");bS.parentNode.insertBefore(bU,bS.nextSibling);_9.RunBetween(bS,bU,bT);};_9.RunBeforeById=function(bS,bT){var bU;bU=q.Doc().getElementById(bS);bB.Equals(bU,null)?bH.FailWith("invalid id: "+bS):_9.RunBefore(bU,bT);};_9.RunBefore=function(bS,bT){var bU;bU=window.document.createTextNode("");bS.parentNode.insertBefore(bU,bS);_9.RunBetween(bU,bS,bT);};_9.RunBetween=function(bS,bT,bU){_8.LinkPrevElement(bT,bU.docNode);y.Sink(l.StartProcessor(_8.PerformAnimatedUpdate(_8.CreateDelimitedRunState(bS,bT,bU.docNode),bU.docNode)),bU.updates);};_9.Async=function(bS){return _9.EmbedView(y.MapAsync(window.id,y.Const(bS)));};_9.BindView=function(bS,bT){return _9.EmbedView(y.Map(bS,bT));};_9.EmbedView=function(bS){var bT;bT=_8.CreateEmbedNode();return _9.Mk({$:2,$0:bT},y.Map(function(){},y.Bind(function(bU){_8.UpdateEmbedNode(bT,bU.docNode);return bU.updates;},bS)));};_9.Static=function(bS){return _.New(bS,Z.EmptyAttr(),_9.Empty());};_9.Mk=function(bS,bT){return new _9.New(bS,bT);};_9.New=bA.Ctor(function(bS,bT){this.docNode=bS;this.updates=bT;},_9);_=c.Elt=bA.Class({AddClass:function(bS){return this.elt.className+=" "+bS;},ClearHoles:function(){var bS;bS=this.docNode$1;bS!=null&&bS.$==6?bS.$0.Holes=[]:void 0;},AddHole:function(bS){var bT;bT=this.docNode$1;bT!=null&&bT.$==6?bT.$0.Holes.push(bS):void 0;},SetStyle:function(bS,bT){this.elt.style[bS]=bT;},HasClass:function(bS){return(new window.RegExp("(\\s|^)"+bS+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(bS){this.elt.className=this.elt.className.replace(new window.RegExp("(?:(\\s|^)"+bS+")+(\\s|$)","g"),"$1");},GetProperty:function(bS){return this.elt[bS];},SetProperty:function(bS,bT){this.elt[bS]=bT;},RemoveAttribute:function(bS){this.elt.removeAttribute(bS);},HasAttribute:function(bS){return this.elt.hasAttribute(bS);},GetAttribute:function(bS){return this.elt.getAttribute(bS);},SetAttribute:function(bS,bT){this.elt.setAttribute(bS,bT);},SetText:function(bS){var bT;bT=this.docNode$1;bT!=null&&bT.$==1?bT.$0.Children=null:bT!=null&&bT.$==6?(bT.$0.Els=[],this.ClearHoles()):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());this.elt.textContent=bS;},GetText:function(){return this.elt.textContent;},SetValue:function(bS){this.elt.value=bS;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var bS;bS=this.docNode$1;bS!=null&&bS.$==1?bS.$0.Children=null:bS!=null&&bS.$==6?(bS.$0.Els=[],this.ClearHoles()):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(bS){var bT,bU,bV,bW,bX;bT=this.docNode$1;bT!=null&&bT.$==1?(bU=bT.$0,bU.Children={$:0,$0:bS.docNode,$1:bU.Children},_8.InsertDoc(this.elt,bS.docNode,(bV=this.elt.firstChild,bB.Equals(bV,null)?null:bV))):bT!=null&&bT.$==6?(bW=this.elt.insertBefore(window.document.createTextNode(""),this.elt.firstChild),bX=_8.InsertBeforeDelim(bW,bS.docNode),this.AddHole(_3.New(Z.Empty(this.elt),bS.docNode,{$:1,$0:[bX,bW]},this.elt,g.Int(),null))):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,bS.updates));},Append:function(bS){var bT,bU,bV,bW;bT=this.docNode$1;bT!=null&&bT.$==1?(bU=bT.$0,bU.Children={$:0,$0:bU.Children,$1:bS.docNode},_8.InsertDoc(this.elt,bS.docNode,null)):bT!=null&&bT.$==6?(bV=this.elt.appendChild(window.document.createTextNode("")),bW=_8.InsertBeforeDelim(bV,bS.docNode),this.AddHole(_3.New(Z.Empty(this.elt),bS.docNode,{$:1,$0:[bW,bV]},this.elt,g.Int(),null))):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,bS.updates));},ToUpdater:function(){var bS,bT;return new $.New((bS=this.docNode$1,bS!=null&&bS.$==1?bA.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,bS.$0.Attr]],Render:(bT=null,bT?bT.$0:void 0)},["Render"]):bS!=null&&bS.$==6?bS.$0:bH.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,w.Create$1([]));},OnAfterRenderView:function(bS,bT){var bU,bV;bU=this;bV=g.Id();this.Append(_9.BindView(function(bW){bU.elt[bV]=bW;return _9.Empty();},bS));return this.OnAfterRender(function(bW){bT(bW,bW[bV]);});},OnAfterRender:function(bS){var bT,bU,bV,bW,bX,bY,bZ;bT=this.docNode$1;bT!=null&&bT.$==1?(bU=bT.$0,bA.SetOptional(bU,"Render",(bV=bA.GetOptional(bU.Render),bV!=null&&bV.$==1?(bW=bV.$0,{$:1,$0:function(b0){bW(b0);bS(b0);}}):{$:1,$0:bS}))):bT!=null&&bT.$==6?(bX=bT.$0,bA.SetOptional(bX,"Render",(bY=bA.GetOptional(bX.Render),bY!=null&&bY.$==1?(bZ=bY.$0,{$:1,$0:function(b0){bZ(b0);bS(b0);}}):{$:1,$0:bS}))):bH.FailWith("Invalid docNode in Elt");return this;},onView:function(bS,bT,bU){var bV;bV=bU(this.elt);this.elt.addEventListener(bS,function(bW){return y.Get(bV(bW),bT);},false);return this;},on:function(bS,bT){this.elt.addEventListener(bS,function(bU){return bT(bU.target,bU);},false);return this;}},_9,_);_.TreeNode=function(bS,bT){var bU,bV,bW;bU=x.Create(bT);return new _.New$1({$:6,$0:bS},y.Map2Unit((bV=bs.map((bW=function(bX){return bX[1];},function(bX){return Z.Updates(bW(bX));}),bS.Attrs),d.TreeReduce(y.Const(),y.Map2Unit,bV)),bU.v),bs.get(bS.Els,0),bU);};_.New=function(bS,bT,bU){var bV,bW;bV=_8.CreateElemNode(bS,bT,bU.docNode);bW=x.Create(bU.updates);return new _.New$1({$:1,$0:bV},y.Map2Unit(Z.Updates(bV.Attr),bW.v),bS,bW);};_.New$1=bA.Ctor(function(bS,bT,bU,bV){_9.New.call(this,bS,bT);this.docNode$1=bS;this.updates$1=bT;this.elt=bU;this.rvUpdates=bV;},_);$=W.EltUpdater=bA.Class({RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;w.Set(this.holeUpdates,[]);},RemoveUpdated:function(bS){var bT,bU,bV;bT=bS.docNode;bT!=null&&bT.$==1?(bU=bT.$0.ElKey,this.treeNode.Holes=bs.filter(function(bW){return bW.ElKey!==bU;},this.treeNode.Holes),w.Set(this.holeUpdates,(bV=function(bW){return bW===bU?false:true;},bs.filter(function(bW){return bV(bW[0]);},this.holeUpdates.c)))):bH.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(bS){var bT,bU,bV;bT=bS.docNode;bT!=null&&bT.$==1?(bU=bT.$0,this.treeNode.Holes=this.treeNode.Holes.concat([bU]),bV=this.holeUpdates.c,bV.push([bU.ElKey,bS.updates]),w.Set(this.holeUpdates,bV)):bH.FailWith("DocUpdater.AddUpdated expects a single element node");},ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];w.Set(this.holeUpdates,[]);},AddHole:function(bS){this.origHoles.push(bS);this.treeNode.Holes=this.treeNode.Holes.concat([bS]);}},_,$);$.New=bA.Ctor(function(bS,bT,bU,bV,bW){var bX,bY,bZ,b0;_.New$1.call(this,{$:6,$0:bS},y.Map2Unit(bT,y.BindInner((bX=(bY=function(b1){return b1[1];},function(b1){return bs.map(bY,b1);}),(bZ=(b0=y.Const(),function(b1){return d.TreeReduce(b0,y.Map2Unit,b1);}),function(b1){return bZ(bX(b1));})),bW.v)),bU,bV);this.treeNode=bS;this.holeUpdates=bW;this.origHoles=this.treeNode.Holes;},$);ba.$cctor=bA.Cctor(function(){ba.LoadedTemplates=new bK.New$5();ba.TextHoleRE="\\${([^}]+)}";ba.$cctor=window.ignore;});bb=c.Flow=bA.Class({get_Render:function(){return this.render;}},null,bb);bb.New=bA.Ctor(function(bS){bb.New$1.call(this,function(bT){return function(bU){return w.Set(bT,bS(bU));};});},bb);bb.New$1=bA.Ctor(function(bS){this.render=bS;},bb);bb.get_Do=function(){return new bc.New();};bb.Static=function(bS){return new bb.New$1(function(bT){return function(bU){w.Set(bT,bS);return bU();};});};bb.Define=function(bS){return new bb.New(function(bT){return bS(function(bU){bT(bU);});});};bb.Embed=function(bS){var bT;bT=w.Create$1(_9.Empty());((bS.get_Render())(bT))(function(bU){});return _9.EmbedView(bT.v);};bb.Return=function(bS){return new bb.New$1(function(){return function(bT){return bT(bS);};});};bb.Bind=function(bS,bT){return new bb.New$1(function(bU){return function(bV){return((bS.get_Render())(bU))(function(bW){((bT(bW).get_Render())(bU))(bV);});};});};bb.Map=function(bS,bT){return new bb.New$1(function(bU){return function(bV){return((bT.get_Render())(bU))(function(bW){bV(bS(bW));});};});};bc=c.FlowBuilder=bA.Class({ReturnFrom:window.id,Return:function(bS){return bb.Return(bS);},Bind:function(bS,bT){return bb.Bind(bS,bT);}},null,bc);bc.New=bA.Ctor(function(){},bc);be=bd.attr=bA.Class({},null,be);be.New=bA.Ctor(function(){},be);bf.Append=function(bS,bT){return{$:0,$0:o.Append(bS.$0,bT.$0),$1:bE.FoldBack(function(bU,bV,bW){return bW.Add(bU,bV);},bS.$1,bT.$1)};};bf.FromList=function(bS,bT){return{$:0,$0:o.FromArray(bs.ofList(bS)),$1:bT};};bf.ToList=function(bS){return[br.ofArray(o.ToArray(bS.$0)),bS.$1];};bf.SameHash=function(bS,bT){return bf.NoHash(bS)===bf.NoHash(bT);};bf.MakeHash=function(bS){var bT,bU;bT=bS.$1;bU=bu.concat("/",bs.map(function(bV){return window.encodeURIComponent(bV);},o.ToArray(bS.$0)));return bT.get_IsEmpty()?bU:bU+"?"+bu.concat("&",by.map(function(bV){var bW;bW=bH.KeyValue(bV);return window.encodeURIComponent(bW[0])+"="+window.encodeURIComponent(bW[1]);},bT));};bf.ParseHash=function(bS){var bT,bU,bV,bW;bT=bf.NoHash(bS);bU=(bV=bT.indexOf(bQ.fromCharCode(63)),bV===-1?[bT,""]:[bP.string(bT,null,{$:1,$0:bV-1}),bP.string(bT,{$:1,$0:bV+1},null)]);bW=bU[0];return{$:0,$0:o.FromArray(bW===""?[]:bs.map(function(bX){return window.decodeURIComponent(bX);},bu.SplitChars(bW,[47],0))),$1:bE.OfArray(bs.map(function(bX){var bY;bY=bX.indexOf(bQ.fromCharCode(61));return bY===-1?[window.decodeURIComponent(bX),""]:[window.decodeURIComponent(bP.string(bX,null,{$:1,$0:bY-1})),window.decodeURIComponent(bP.string(bX,{$:1,$0:bY+1},null))];},bu.SplitChars(bU[1],[38],0)))};};bf.NoHash=function(bS){return bu.StartsWith(bS,"#")?bS.substring(1):bS;};bh.New=function(bS,bT,bU,bV){return{Bodies:bS,CurrentRoute:bT,CurrentSite:bU,Selection:bV};};bg.Install=function(bS,bT){var bU,bV,bW,bX,bY,bZ,b0,b1,b2;function b3(b4){var b5;b5=bZ(b4);b5.$==1?void 0:bg.OnGlobalRouteChange(bW,b5.$0,bf.FromList(b5.$1,new bF.New([])));}bU=bT.$0;bV=bg.InstallMap({Des:function(b4){return bf.FromList(b4[0],b4[1]);},Ser:bf.ToList});bW=bh.New(void 0,bV,0,void 0);bX=(bY=function(b4,b5){var b6;b6=b5.$0;return b5.$1({UpdateRoute:function(b7){bg.OnInternalSiteUpdate(bW,b6,b4,b7);}});},s.Map(function(b4){return function(b5){return bY(b4,b5);};},bT.$1));bW.Bodies=bg.ComputeBodies(bX);bZ=function(b4){return s.Lookup(bX,(bf.ToList(b4))[0]);};b0=(b1=bZ(bV.c),b1.$==0?(b2=b1.$0,(bW.CurrentSite=b2.RouteId,w.Create$1(b2.RouteValue))):w.Create$1(bU!=null&&bU.$==1?bU.$0:bH.FailWith("Site.Install fails on empty site")));bW.Selection=b0;y.Sink(function(b4){bg.OnSelectSite(bW,bS(b4));},b0.v);b3(bV.c);y.Sink(b3,bV.v);return b0;};bg.OnSelectSite=function(bS,bT){var bU;bU=bT.$0;bS.CurrentSite!==bU?(bS.CurrentSite=bU,bS.Bodies.get_Item(bU).OnSelect()):void 0;};bg.OnInternalSiteUpdate=function(bS,bT,bU,bV){if(bS.CurrentSite===bT)bg.SetCurrentRoute(bS,bf.Append(bf.FromList(bU,new bF.New([])),bV));};bg.OnGlobalRouteChange=function(bS,bT,bU){bS.CurrentSite!==bT.RouteId?(bS.CurrentSite=bT.RouteId,w.Set(bS.Selection,bT.RouteValue)):void 0;bT.OnRouteChanged(bU);};bg.SetCurrentRoute=function(bS,bT){if(!bB.Equals(bS.CurrentRoute.c,bT))w.Set(bS.CurrentRoute,bT);};bg.ComputeBodies=function(bS){var bT;bT=new bK.New$5();bs.iter(function(bU){bT.set_Item(bU.RouteId,bU);},s.ToArray(bS));return bT;};bg.MergeRouters=function(bS){var bT,bU,bV;bT=d.ofSeqNonCopying(bS);bU=s.Merge(by.map(function(bW){return bW.$1;},bT));bV=by.tryPick(function(bW){return bW.$0;},bT);return bU!=null&&bU.$==1?{$:0,$0:bV,$1:bU.$0}:bH.FailWith("Invalid Site.Merge: need more prefix disambiguation");};bg.DefineRoute=function(bS,bT,bU){var bV,bW,bX;bV=w.Create$1(bT);bW=g.Int();bX=bU({$:0,$0:bW},bV);return{$:0,$0:{$:1,$0:bX},$1:s.Leaf({$:0,$0:bW,$1:function(bY){y.Sink(function(bZ){bY.UpdateRoute(bg.DoLink(bS,bZ));},bV.v);return{OnRouteChanged:function(bZ){w.Set(bV,bg.DoRoute(bS,bZ));},OnSelect:function(){bY.UpdateRoute(bg.DoLink(bS,bV.c));},RouteId:bW,RouteValue:bX};}})};};bg.DoLink=function(bS,bT){var bU;bU=bS.Ser(bT);return bf.FromList(bU[0],bU[1]);};bg.DoRoute=function(bS,bT){return bS.Des(bf.ToList(bT));};bg.InstallMap=function(bS){var bT,bU,bV,bW;function bX(bY){return bW(bU());}bT=function(bY,bZ){return bB.Equals(bS.Ser(bY),bS.Ser(bZ));};bU=function(){return bS.Des(bf.ToList(bf.ParseHash(window.location.hash)));};bV=w.Create$1(bU());bW=function(bY){if(!bT(bV.c,bY))w.Set(bV,bY);};window.onpopstate=bX;window.onhashchange=bX;y.Sink(function(bY){var bZ,b0;bZ=bf.MakeHash((b0=bS.Ser(bY),bf.FromList(b0[0],b0[1])));!bf.SameHash(window.location.hash,bZ)?window.location.replace("#"+bZ):void 0;},bV.v);return bV;};bi.Install=function(bS){return bg.InstallMap(bS);};bi.Create=function(bS,bT){var bU;return{Des:(bU=function(bV){return bV[0];},function(bV){return bT(bU(bV));}),Ser:function(bV){return[bS(bV),new bF.New([])];}};};bi.CreateWithQuery=function(bS,bT){return{Des:bT,Ser:bS};};bj.Route=function(bS,bT,bU){return bg.DefineRoute(bS,bT,bU);};bj.Prefix=function(bS,bT){return{$:0,$0:bT.$0,$1:s.Prefix(bS,bT.$1)};};bj.Merge=function(bS){return bg.MergeRouters(bS);};bj.Install=function(bS,bT){return bg.Install(bS,bT);};bj.Dir=function(bS,bT){return bj.Prefix(bS,bj.Merge(bT));};bl.New=function(bS,bT){return{Active:bS,PosV:bT};};bm.New=function(bS,bT,bU,bV){return{Active:bS,Left:bT,Middle:bU,Right:bV};};bn.get_MousePressed=function(){bk.ActivateButtonListener();return y.Apply(y.Apply(y.Apply(y.Const(bA.Curried3(function(bS,bT,bU){return bS||bT||bU;})),bk.MouseBtnSt$1().Left.v),bk.MouseBtnSt$1().Middle.v),bk.MouseBtnSt$1().Right.v);};bn.get_RightPressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Right.v;};bn.get_MiddlePressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Middle.v;};bn.get_LeftPressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Left.v;};bn.get_Position=function(){!bk.MousePosSt$1().Active?(window.document.addEventListener("mousemove",function(bS){w.Set(bk.MousePosSt$1().PosV,[bS.clientX,bS.clientY]);},false),bk.MousePosSt$1().Active=true):void 0;return bk.MousePosSt$1().PosV.v;};bo.New=function(bS,bT,bU){return{KeysPressed:bS,KeyListenerActive:bT,LastPressed:bU};};bp.IsPressed=function(bS){var bT;bk.ActivateKeyListener();return y.Map((bT=function(bU){return bU===bS;},function(bU){return br.exists(bT,bU);}),bk.KeyListenerState().KeysPressed.v);};bp.get_LastPressed=function(){bk.ActivateKeyListener();return bk.KeyListenerState().LastPressed.v;};bp.get_KeysPressed=function(){bk.ActivateKeyListener();return bk.KeyListenerState().KeysPressed.v;};bk.ActivateKeyListener=function(){bq.$cctor();return bq.ActivateKeyListener;};bk.KeyListenerState=function(){bq.$cctor();return bq.KeyListenerState;};bk.ActivateButtonListener=function(){bq.$cctor();return bq.ActivateButtonListener;};bk.MouseBtnSt$1=function(){bq.$cctor();return bq.MouseBtnSt;};bk.MousePosSt$1=function(){bq.$cctor();return bq.MousePosSt;};bq.$cctor=bA.Cctor(function(){var bS;bq.MousePosSt=bl.New(false,w.Create$1([0,0]));bq.MouseBtnSt=bm.New(false,w.Create$1(false),w.Create$1(false),w.Create$1(false));bq.ActivateButtonListener=(bS=function(bT,bU){var bV;bV=bT.button;return bV===0?w.Set(bk.MouseBtnSt$1().Left,bU):bV===1?w.Set(bk.MouseBtnSt$1().Middle,bU):bV===2?w.Set(bk.MouseBtnSt$1().Right,bU):null;},!bk.MouseBtnSt$1().Active?(bk.MouseBtnSt$1().Active=true,window.document.addEventListener("mousedown",function(bT){return bS(bT,true);},false),window.document.addEventListener("mouseup",function(bT){return bS(bT,false);},false)):null);bq.KeyListenerState=bo.New(w.Create$1(br.T.Empty),false,w.Create$1(-1));bq.ActivateKeyListener=!bk.KeyListenerState().KeyListenerActive?(bO(window.document).keydown(function(bT){var bU,bV;bU=bT.which;w.Set(bk.KeyListenerState().LastPressed,bU);bV=bk.KeyListenerState().KeysPressed.c;return!br.exists(function(bW){return bW===bU;},bV)?w.Set(bk.KeyListenerState().KeysPressed,br.append(bV,br.ofArray([bU]))):null;}),void bO(window.document).keyup(function(bT){var bU,bV;bU=bT.which;return w.Update(bk.KeyListenerState().KeysPressed,(bV=function(bW){return bW!==bU;},function(bW){return br.filter(bV,bW);}));})):null;bq.$cctor=window.ignore;});}());
