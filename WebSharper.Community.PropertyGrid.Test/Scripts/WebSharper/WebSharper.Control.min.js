(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Control=b.Control||{};d=c.Observer=c.Observer||{};e=d.Message=d.Message||{};f=c.HotStream=c.HotStream||{};g=f.HotStream=f.HotStream||{};h=c.Observable=c.Observable||{};i=a.Microsoft=a.Microsoft||{};j=i.FSharp=i.FSharp||{};k=j.Control=j.Control||{};l=k.ObservableModule=k.ObservableModule||{};m=c.Event=c.Event||{};n=m.Event=m.Event||{};o=c.DelegateEvent=c.DelegateEvent||{};p=o.DelegateEvent=o.DelegateEvent||{};q=c.FSharpEvent=c.FSharpEvent||{};r=c.FSharpDelegateEvent=c.FSharpDelegateEvent||{};s=k.EventModule=k.EventModule||{};t=c.MailboxProcessor=c.MailboxProcessor||{};u=a.IntelliFactory;v=u&&u.Runtime;w=b&&b.Util;x=b&&b.List;y=b&&b.Ref;z=b&&b.Unchecked;A=b&&b.Seq;B=b&&b.Arrays;C=b&&b.Collections;D=C&&C.List;E=b&&b.Concurrency;F=b&&b.TimeoutException;G=b&&b.Operators;H=C&&C.LinkedList;e.Completed={$:2};d.New=function(I,J,K){return{OnCompleted:function(){return K();},OnError:J,OnNext:I};};d.Of=function(I){return{OnCompleted:function(){return null;},OnError:function(J){throw J;},OnNext:I};};g=f.HotStream=v.Class({Trigger:function(I){this.Latest[0]={$:1,$0:I};this.Event.event.Trigger(I);},Subscribe:function(I){this.Latest[0]!=null?I.OnNext(this.Latest[0].$0):void 0;return w.subscribeTo(this.Event.event,function(J){I.OnNext(J);});}},null,g);g.New$1=function(){return g.New([null],new q.New());};g.New=function(I,J){return new g({Latest:I,Event:J});};h.Sequence=function(I){function J(K){var L,M,N;return K.$==1?(L=K.$1,(M=K.$0,(N=J(L),h.CombineLatest(M,N,function(O,P){return new x.T({$:1,$0:O,$1:P});})))):h.Return(x.T.Empty);}return J(x.ofSeq(I));};h.Aggregate=function(I,J,K){return{Subscribe:function(L){var M;M=[J];return I.Subscribe(d.New(function(N){h.Protect(function(){return K(M[0],N);},function(O){M[0]=O;L.OnNext(O);},function(O){L.OnError(O);});},function(N){L.OnError(N);},function(){L.OnCompleted();}));}};};h.SelectMany=function(I){return{Subscribe:function(J){var K,L,M;K=[function(){}];L=w.subscribeTo(I,function(N){var O;O=w.subscribeTo(N,function(P){J.OnNext(P);});K[0]=function(){K[0]();O.Dispose();};});M=function(){K[0]();L.Dispose();};return{Dispose:function(){return M();}};}};};h.Switch=function(I){return{Subscribe:function(J){var K,L;K=[0];L=[null];return w.subscribeTo(I,function(M){var N;y.incr(K);L[0]!=null?L[0].$0.Dispose():void 0;N=K[0];L[0]={$:1,$0:w.subscribeTo(M,function(O){if(N===K[0])J.OnNext(O);})};});}};};h.CombineLatest=function(I,J,K){return{Subscribe:function(L){var M,N,O,P,Q,R;M=[null];N=[null];O=function(){var S,T,U,V;S=M[0];T=N[0];(S!=null?S.$==1:false)?(T!=null?T.$==1:false)?(U=S.$0,V=T.$0,h.Protect(function(){return K(U,V);},function(W){L.OnNext(W);},function(W){L.OnError(W);})):void 0:void 0;};P=I.Subscribe(d.New(function(S){M[0]={$:1,$0:S};O();},function(S){},function(){}));Q=J.Subscribe(d.New(function(S){N[0]={$:1,$0:S};O();},function(S){},function(){}));R=function(){P.Dispose();Q.Dispose();};return{Dispose:function(){return R();}};}};};h.Range=function(I,J){return{Subscribe:function(K){var L,M,N;for(M=I,N=I+J;M<=N;M++)K.OnNext(M);L=function(){};return{Dispose:function(){return L();}};}};};h.Concat=function(I,J){return{Subscribe:function(K){var L,M,N;L=[null];M=I.Subscribe(d.New(function(O){K.OnNext(O);},function(O){},function(){L[0]={$:1,$0:J.Subscribe(K)};}));N=function(){L[0]!=null?L[0].$0.Dispose():void 0;M.Dispose();};return{Dispose:function(){return N();}};}};};h.Merge=function(I,J){return{Subscribe:function(K){var L,M,N,O,P;L=[false];M=[false];N=I.Subscribe(d.New(function(Q){K.OnNext(Q);},function(Q){},function(){L[0]=true;(L[0]?M[0]:false)?K.OnCompleted():void 0;}));O=J.Subscribe(d.New(function(Q){K.OnNext(Q);},function(Q){},function(){M[0]=true;(L[0]?M[0]:false)?K.OnCompleted():void 0;}));P=function(){N.Dispose();O.Dispose();};return{Dispose:function(){return P();}};}};};h.Drop=function(I,J){return{Subscribe:function(K){var L;L=[0];return J.Subscribe(d.New(function(M){y.incr(L);L[0]>I?K.OnNext(M):void 0;},function(M){K.OnError(M);},function(){K.OnCompleted();}));}};};h.Choose=function(I,J){return{Subscribe:function(K){return J.Subscribe(d.New(function(L){var M;h.Protect(function(){return I(L);},(M=function(N){K.OnNext(N);},function(N){if(N==null);else M(N.$0);}),function(N){K.OnError(N);});},function(L){K.OnError(L);},function(){K.OnCompleted();}));}};};h.Filter=function(I,J){return{Subscribe:function(K){return J.Subscribe(d.New(function(L){var M;h.Protect(function(){return I(L)?{$:1,$0:L}:null;},(M=function(N){K.OnNext(N);},function(N){if(N==null);else M(N.$0);}),function(N){K.OnError(N);});},function(L){K.OnError(L);},function(){K.OnCompleted();}));}};};h.Map=function(I,J){return{Subscribe:function(K){return J.Subscribe(d.New(function(L){h.Protect(function(){return I(L);},function(M){K.OnNext(M);},function(M){K.OnError(M);});},function(L){K.OnError(L);},function(){K.OnCompleted();}));}};};h.Protect=function(I,J,K){var L;try{L={$:0,$0:I()};}catch(M){L={$:1,$0:M};}return L.$==1?K(L.$0):J(L.$0);};h.Never=function(){return{Subscribe:function(){var I;I=function(){};return{Dispose:function(){return I();}};}};};h.Return=function(I){return{Subscribe:function(J){var K;J.OnNext(I);J.OnCompleted();K=function(){};return{Dispose:function(){return K();}};}};};h.Of=function(I){return{Subscribe:function(J){var K;K=I(function(L){J.OnNext(L);});return{Dispose:function(){return K();}};}};};l.Split=function(I,J){var K,L,M;K=(L=function(N){var O;O=I(N);return O.$==0?{$:1,$0:O.$0}:null;},function(N){return h.Choose(L,N);}(J));return[K,(M=function(N){var O;O=I(N);return O.$==1?{$:1,$0:O.$0}:null;},function(N){return h.Choose(M,N);}(J))];};l.Scan=function(I,J,K){return{Subscribe:function(L){var M;M=[J];return K.Subscribe(d.New(function(N){h.Protect(function(){return I(M[0],N);},function(O){M[0]=O;L.OnNext(O);},function(O){L.OnError(O);});},function(N){L.OnError(N);},function(){L.OnCompleted();}));}};};l.Partition=function(I,J){var K;return[h.Filter(I,J),h.Filter((K=function(L){return!L;},function(L){return K(I(L));}),J)];};l.Pairwise=function(I){return{Subscribe:function(J){var K;K=[null];return I.Subscribe(d.New(function(L){var M;M=K[0];(M!=null?M.$==1:false)?J.OnNext([M.$0,L]):void 0;K[0]={$:1,$0:L};},function(L){J.OnError(L);},function(){J.OnCompleted();}));}};};n=m.Event=v.Class({Subscribe$1:function(I){var J,K,L;J=this;K=function(M,N){return I.OnNext(N);};this.AddHandler$1(K);L=function(){J.RemoveHandler$1(K);};return{Dispose:function(){return L();}};},RemoveHandler$1:function(I){var J,K,L,M;J=(K=function(N){return z.Equals(I,N);},function(N){return A.tryFindIndex(K,N);}(this.Handlers));L=(M=this.Handlers,function(N){M.RemoveAt(N);});J==null?void 0:L(J.$0);},AddHandler$1:function(I){this.Handlers.Add(I);},Trigger:function(I){var J,K,L;J=this.Handlers.ToArray();for(K=0,L=J.length-1;K<=L;K++)(B.get(J,K))(null,I);},RemoveHandler:function(I){this.RemoveHandler$1(I);},AddHandler:function(I){this.AddHandler$1(I);},Subscribe:function(I){return this.Subscribe$1(I);},Dispose:function(){}},null,n);n.New=function(I){return new n({Handlers:I});};p=o.DelegateEvent=v.Class({RemoveHandler$1:function(I){var J,K,L,M;J=(K=function(N){return z.Equals(I,N);},function(N){return A.tryFindIndex(K,N);}(this.Handlers));L=(M=this.Handlers,function(N){M.RemoveAt(N);});J==null?void 0:L(J.$0);},AddHandler$1:function(I){this.Handlers.Add(I);},Trigger:function(I){var J,K,L,M;J=this.Handlers.ToArray();for(K=0,L=J.length-1;K<=L;K++){M=B.get(J,K).apply(null,I);}},RemoveHandler:function(I){this.RemoveHandler$1(I);},AddHandler:function(I){this.AddHandler$1(I);},Dispose:function(){}},null,p);p.New=function(I){return new p({Handlers:I});};q=c.FSharpEvent=v.Class({},null,q);q.New=v.Ctor(function(){this.event=n.New(new D.New$2());},q);r=c.FSharpDelegateEvent=v.Class({},null,r);r.New=v.Ctor(function(){this.event=p.New(new D.New$2());},r);s.Split=function(I,J){var K,L;return[(K=function(M){var N;N=I(M);return N.$==0?{$:1,$0:N.$0}:null;},function(M){return s.Choose(K,M);}(J)),(L=function(M){var N;N=I(M);return N.$==1?{$:1,$0:N.$0}:null;},function(M){return s.Choose(L,M);}(J))];};s.Scan=function(I,J,K){var L;L=[J];return s.Map(function(M){L[0]=I(L[0],M);return L[0];},K);};s.Partition=function(I,J){var K;return[s.Filter(I,J),s.Filter((K=function(L){return!L;},function(L){return K(I(L));}),J)];};s.Pairwise=function(I){var J,K;J=[null];K=n.New(new D.New$2());w.addListener(I,function(L){var M,N;M=J[0];(M!=null?M.$==1:false)?(N=M.$0,J[0]={$:1,$0:L},K.Trigger([N,L])):J[0]={$:1,$0:L};});return K;};s.Merge=function(I,J){var K;K=n.New(new D.New$2());w.addListener(I,function(L){K.Trigger(L);});w.addListener(J,function(L){K.Trigger(L);});return K;};s.Map=function(I,J){var K;K=n.New(new D.New$2());w.addListener(J,function(L){K.Trigger(I(L));});return K;};s.Filter=function(I,J){var K;K=n.New(new D.New$2());w.addListener(J,function(L){if(I(L))K.Trigger(L);});return K;};s.Choose=function(I,J){var K;K=new q.New();w.addListener(J,function(L){var M;M=I(L);M==null?void 0:K.event.Trigger(M.$0);});return K.event;};t=c.MailboxProcessor=v.Class({dequeue:function(){var I;I=this.mailbox.n.v;this.mailbox.RemoveFirst();return I;},resume:function(){var I,J;I=this.savedCont;(I!=null?I.$==1:false)?(J=I.$0,this.savedCont=null,this.startAsync(J)):void 0;},startAsync:function(I){var J;J=this.token;E.Start(I,J);},Scan:function(I,J){var K;K=this;return E.Delay(function(){var L;L=K.TryScan(I,J);return E.Bind(L,function(M){var N;if(M!=null?M.$==1:false)N=M.$0;else throw new F.New();return E.Return(N);});});},TryScan:function(I,J){var K,L;K=this;L=G.DefaultArg(J,this.get_DefaultTimeout());return E.Delay(function(){var M,N,O,P,Q,R;N=K.mailbox.n;O=null;while(!z.Equals(N,null)){R=I(N.v);R==null?N=N.n:(K.mailbox.Remove$1(N),N=null,O=R);}M=O;return(M!=null?M.$==1:false)?(P=M.$0,E.Bind(P,function(S){return E.Return({$:1,$0:S});})):(Q=function(S){var U,V;if(L<0){function T(){K.savedCont={$:1,$0:E.Delay(function(){var X,Y;X=I(K.mailbox.n.v);return(X!=null?X.$==1:false)?(Y=X.$0,(K.mailbox.RemoveFirst(),E.Bind(Y,function(Z){S({$:1,$0:Z});return E.Return(null);}))):(T(),E.Return(null));})};}T();}else{function W(){K.savedCont={$:1,$0:E.Delay(function(){var X,Y;X=I(K.mailbox.n.v);return(X!=null?X.$==1:false)?(Y=X.$0,(K.mailbox.RemoveFirst(),E.Bind(Y,function(Z){return U[0]?(U[0]=false,a.clearTimeout(V),S({$:1,$0:Z}),E.Return(null)):E.Return(null);}))):(W(),E.Return(null));})};}U=[true];V=a.setTimeout(function(){if(U[0]){U[0]=false;K.savedCont=null;S(null);}},L);W();}},E.FromContinuations(function(S,T,U){return Q.apply(null,[S,T,U]);}));});},PostAndAsyncReply:function(I,J){var K;K=this;return E.Delay(function(){var L;L=K.PostAndTryAsyncReply(I,J);return E.Bind(L,function(M){var N;if(M!=null?M.$==1:false)N=M.$0;else throw new F.New();return E.Return(N);});});},PostAndTryAsyncReply:function(I,J){var K,L,M;K=this;L=G.DefaultArg(J,this.get_DefaultTimeout());M=function(N){var O,P,Q,R,S;if(L<0){P=K.mailbox.AddLast(I((O=function(T){return{$:1,$0:T};},function(T){return N(O(T));})));K.resume();}else{Q=[true];R=K.mailbox.AddLast(I(function(T){if(Q[0]){Q[0]=false;N({$:1,$0:T});}}));K.resume();S=a.setTimeout(function(){if(Q[0]){Q[0]=false;N(null);}},L);}};return E.FromContinuations(function(N,O,P){return M.apply(null,[N,O,P]);});},get_CurrentQueueLength:function(){return this.mailbox.c;},Receive:function(I){var J;J=this;return E.Delay(function(){var K;K=J.TryReceive(I);return E.Bind(K,function(L){var M;if(L!=null?L.$==1:false)M=L.$0;else throw new F.New();return E.Return(M);});});},TryReceive:function(I){var J,K,L;J=this;K=G.DefaultArg(I,this.get_DefaultTimeout());L=function(M){var N,O;if(z.Equals(J.mailbox.n,null)){if(K<0)J.savedCont={$:1,$0:E.Delay(function(){M({$:1,$0:J.dequeue()});return E.Return(null);})};else{N=[true];O=a.setTimeout(function(){if(N[0]){N[0]=false;J.savedCont=null;M(null);}},K);J.savedCont={$:1,$0:E.Delay(function(){return N[0]?(N[0]=false,a.clearTimeout(O),M({$:1,$0:J.dequeue()}),E.Return(null)):E.Return(null);})};}}else M({$:1,$0:J.dequeue()});};return E.FromContinuations(function(M,N,O){return L.apply(null,[M,N,O]);});},Start:function(){var I;I=this;this.started?G.FailWith("The MailboxProcessor has already been started."):(this.started=true,I.startAsync(E.Delay(function(){return E.TryWith(E.Delay(function(){var J;J=I.initial(I);return E.Bind(J,function(){return E.Return(null);});}),function(J){I.errorEvent.event.Trigger(J);return E.Return(null);});})));},set_DefaultTimeout:function(I){this.DefaultTimeout=I;},get_DefaultTimeout:function(){return this.DefaultTimeout;},remove_Error:function(I){this.errorEvent.event.RemoveHandler(I);},add_Error:function(I){this.errorEvent.event.AddHandler(I);},get_Error:function(){return this.errorEvent.event;}},null,t);t.Start=function(I,J){var K;K=new t.New(I,J);K.Start();return K;};t.New=v.Ctor(function(I,J){var K,L,M,N,O;K=this;this.initial=I;this.token=J;this.started=false;this.errorEvent=new q.New();this.mailbox=new H.New();this.savedCont=null;L=this.token;L==null?void 0:(M=L.$0,N=(O=function(){return K.resume();},E.Register(M,function(){O();})));this.DefaultTimeout=-1;},t);}());
