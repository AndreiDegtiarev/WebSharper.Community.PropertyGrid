(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;a=window.WebSharper=window.WebSharper||{};b=a.Control=a.Control||{};c=b.Observer=b.Observer||{};d=c.Message=c.Message||{};e=b.HotStream=b.HotStream||{};f=e.HotStream=e.HotStream||{};g=b.Observable=b.Observable||{};h=window.Microsoft=window.Microsoft||{};i=h.FSharp=h.FSharp||{};j=i.Control=i.Control||{};k=j.ObservableModule=j.ObservableModule||{};l=b.Event=b.Event||{};m=l.Event=l.Event||{};n=b.DelegateEvent=b.DelegateEvent||{};o=n.DelegateEvent=n.DelegateEvent||{};p=b.FSharpEvent=b.FSharpEvent||{};q=b.FSharpDelegateEvent=b.FSharpDelegateEvent||{};r=j.EventModule=j.EventModule||{};s=b.MailboxProcessor=b.MailboxProcessor||{};t=window.IntelliFactory;u=t&&t.Runtime;v=a&&a.Util;w=a&&a.List;x=a&&a.Seq;y=a&&a.Unchecked;z=a&&a.Arrays;A=a&&a.Collections;B=A&&A.List;C=a&&a.Concurrency;D=a&&a.TimeoutException;E=a&&a.Operators;F=A&&A.LinkedList;d.Completed={$:2};c.New=function(G,H,I){return{OnNext:G,OnError:H,OnCompleted:function(){return I();}};};c.Of=function(G){return{OnNext:G,OnError:function(H){throw H;},OnCompleted:function(){return null;}};};f=e.HotStream=u.Class({Trigger:function(G){this.Latest[0]={$:1,$0:G};this.Event.event.Trigger(G);},Subscribe:function(G){this.Latest[0]!=null?G.OnNext(this.Latest[0].$0):void 0;return this.Event.event.Subscribe(v.observer(function(H){G.OnNext(H);}));}},null,f);f.New$1=function(){return f.New([null],new p.New());};f.New=function(G,H){return new f({Latest:G,Event:H});};g.Sequence=function(G){function H(I){return I.$==1?g.CombineLatest(I.$0,H(I.$1),function(J,K){return new w.T({$:1,$0:J,$1:K});}):g.Return(w.T.Empty);}return H(w.ofSeq(G));};g.Aggregate=function(G,H,I){return{Subscribe:function(J){var K;K=[H];return G.Subscribe(c.New(function(L){g.Protect(function(){return I(K[0],L);},function(M){K[0]=M;J.OnNext(M);},function(M){J.OnError(M);});},function(L){J.OnError(L);},function(){J.OnCompleted();}));}};};g.SelectMany=function(G){return{Subscribe:function(H){var I,J,K;I=[function(){}];J=G.Subscribe(v.observer(function(L){var M;M=L.Subscribe(v.observer(function(N){H.OnNext(N);}));I[0]=function(){I[0]();M.Dispose();};}));K=function(){I[0]();J.Dispose();};return{Dispose:function(){return K();}};}};};g.Switch=function(G){return{Subscribe:function(H){var I,J;I=[0];J=[null];return G.Subscribe(v.observer(function(K){var L;I[0]++;J[0]!=null?J[0].$0.Dispose():void 0;L=I[0];J[0]={$:1,$0:K.Subscribe(v.observer(function(M){if(L===I[0])H.OnNext(M);}))};}));}};};g.CombineLatest=function(G,H,I){return{Subscribe:function(J){var K,L,M,N,O,P;K=[null];L=[null];M=function(){var Q,R,S,T;Q=K[0];R=L[0];Q!=null&&Q.$==1?R!=null&&R.$==1?(S=Q.$0,T=R.$0,g.Protect(function(){return I(S,T);},function(U){J.OnNext(U);},function(U){J.OnError(U);})):void 0:void 0;};N=G.Subscribe(c.New(function(Q){K[0]={$:1,$0:Q};M();},function(Q){},function(){}));O=H.Subscribe(c.New(function(Q){L[0]={$:1,$0:Q};M();},function(Q){},function(){}));P=function(){N.Dispose();O.Dispose();};return{Dispose:function(){return P();}};}};};g.Range=function(G,H){return{Subscribe:function(I){var J,K,L;for(K=G,L=G+H;K<=L;K++)I.OnNext(K);J=function(){};return{Dispose:function(){return J();}};}};};g.Concat=function(G,H){return{Subscribe:function(I){var J,K,L;J=[null];K=G.Subscribe(c.New(function(M){I.OnNext(M);},function(M){},function(){J[0]={$:1,$0:H.Subscribe(I)};}));L=function(){J[0]!=null?J[0].$0.Dispose():void 0;K.Dispose();};return{Dispose:function(){return L();}};}};};g.Merge=function(G,H){return{Subscribe:function(I){var J,K,L,M,N;J=[false];K=[false];L=G.Subscribe(c.New(function(O){I.OnNext(O);},function(O){},function(){J[0]=true;J[0]&&K[0]?I.OnCompleted():void 0;}));M=H.Subscribe(c.New(function(O){I.OnNext(O);},function(O){},function(){K[0]=true;J[0]&&K[0]?I.OnCompleted():void 0;}));N=function(){L.Dispose();M.Dispose();};return{Dispose:function(){return N();}};}};};g.Drop=function(G,H){return{Subscribe:function(I){var J;J=[0];return H.Subscribe(c.New(function(K){J[0]++;J[0]>G?I.OnNext(K):void 0;},function(K){I.OnError(K);},function(){I.OnCompleted();}));}};};g.Choose=function(G,H){return{Subscribe:function(I){return H.Subscribe(c.New(function(J){var K;g.Protect(function(){return G(J);},(K=function(L){I.OnNext(L);},function(L){if(L==null);else K(L.$0);}),function(L){I.OnError(L);});},function(J){I.OnError(J);},function(){I.OnCompleted();}));}};};g.Filter=function(G,H){return{Subscribe:function(I){return H.Subscribe(c.New(function(J){var K;g.Protect(function(){return G(J)?{$:1,$0:J}:null;},(K=function(L){I.OnNext(L);},function(L){if(L==null);else K(L.$0);}),function(L){I.OnError(L);});},function(J){I.OnError(J);},function(){I.OnCompleted();}));}};};g.Map=function(G,H){return{Subscribe:function(I){return H.Subscribe(c.New(function(J){g.Protect(function(){return G(J);},function(K){I.OnNext(K);},function(K){I.OnError(K);});},function(J){I.OnError(J);},function(){I.OnCompleted();}));}};};g.Protect=function(G,H,I){var J;try{J={$:0,$0:G()};}catch(K){J={$:1,$0:K};}return J.$==1?I(J.$0):H(J.$0);};g.Never=function(){return{Subscribe:function(){var G;G=function(){};return{Dispose:function(){return G();}};}};};g.Return=function(G){return{Subscribe:function(H){var I;H.OnNext(G);H.OnCompleted();I=function(){};return{Dispose:function(){return I();}};}};};g.Of=function(G){return{Subscribe:function(H){var I;I=G(function(J){H.OnNext(J);});return{Dispose:function(){return I();}};}};};k.Split=function(G,H){return[g.Choose(function(I){var J;J=G(I);return J.$==0?{$:1,$0:J.$0}:null;},H),g.Choose(function(I){var J;J=G(I);return J.$==1?{$:1,$0:J.$0}:null;},H)];};k.Scan=function(G,H,I){return{Subscribe:function(J){var K;K=[H];return I.Subscribe(c.New(function(L){g.Protect(function(){return G(K[0],L);},function(M){K[0]=M;J.OnNext(M);},function(M){J.OnError(M);});},function(L){J.OnError(L);},function(){J.OnCompleted();}));}};};k.Partition=function(G,H){var I;return[g.Filter(G,H),g.Filter((I=function(J){return!J;},function(J){return I(G(J));}),H)];};k.Pairwise=function(G){return{Subscribe:function(H){var I;I=[null];return G.Subscribe(c.New(function(J){var K;K=I[0];K!=null&&K.$==1?H.OnNext([K.$0,J]):void 0;I[0]={$:1,$0:J};},function(J){H.OnError(J);},function(){H.OnCompleted();}));}};};m=l.Event=u.Class({Subscribe$1:function(G){var H,I,J;H=this;I=function(K,L){return G.OnNext(L);};this.AddHandler$1(I);J=function(){H.RemoveHandler$1(I);};return{Dispose:function(){return J();}};},RemoveHandler$1:function(G){var H;H=x.tryFindIndex(function(I){return y.Equals(G,I);},this.Handlers);H==null?void 0:this.Handlers.RemoveAt(H.$0);},AddHandler$1:function(G){this.Handlers.Add(G);},Trigger:function(G){var H,I,J;H=this.Handlers.ToArray();for(I=0,J=H.length-1;I<=J;I++)(z.get(H,I))(null,G);},RemoveHandler:function(G){this.RemoveHandler$1(G);},AddHandler:function(G){this.AddHandler$1(G);},Subscribe:function(G){return this.Subscribe$1(G);},Dispose:function(){}},null,m);m.New=function(G){return new m({Handlers:G});};o=n.DelegateEvent=u.Class({RemoveHandler$1:function(G){var H;H=x.tryFindIndex(function(I){return y.Equals(G,I);},this.Handlers);H==null?void 0:this.Handlers.RemoveAt(H.$0);},AddHandler$1:function(G){this.Handlers.Add(G);},Trigger:function(G){var H,I,J;H=this.Handlers.ToArray();for(I=0,J=H.length-1;I<=J;I++)z.get(H,I).apply(null,G);},RemoveHandler:function(G){this.RemoveHandler$1(G);},AddHandler:function(G){this.AddHandler$1(G);},Dispose:function(){}},null,o);o.New=function(G){return new o({Handlers:G});};p=b.FSharpEvent=u.Class({},null,p);p.New=u.Ctor(function(){this.event=m.New(new B.New$2());},p);q=b.FSharpDelegateEvent=u.Class({},null,q);q.New=u.Ctor(function(){this.event=o.New(new B.New$2());},q);r.Split=function(G,H){return[r.Choose(function(I){var J;J=G(I);return J.$==0?{$:1,$0:J.$0}:null;},H),r.Choose(function(I){var J;J=G(I);return J.$==1?{$:1,$0:J.$0}:null;},H)];};r.Scan=function(G,H,I){var J;J=[H];return r.Map(function(K){J[0]=G(J[0],K);return J[0];},I);};r.Partition=function(G,H){var I;return[r.Filter(G,H),r.Filter((I=function(J){return!J;},function(J){return I(G(J));}),H)];};r.Pairwise=function(G){var H,I;H=[null];I=m.New(new B.New$2());G.Subscribe(v.observer(function(J){var K;K=H[0];K!=null&&K.$==1?(H[0]={$:1,$0:J},I.Trigger([K.$0,J])):H[0]={$:1,$0:J};}));return I;};r.Merge=function(G,H){var I;I=m.New(new B.New$2());G.Subscribe(v.observer(function(J){I.Trigger(J);}));H.Subscribe(v.observer(function(J){I.Trigger(J);}));return I;};r.Map=function(G,H){var I;I=m.New(new B.New$2());H.Subscribe(v.observer(function(J){I.Trigger(G(J));}));return I;};r.Filter=function(G,H){var I;I=m.New(new B.New$2());H.Subscribe(v.observer(function(J){if(G(J))I.Trigger(J);}));return I;};r.Choose=function(G,H){var I;I=new p.New();H.Subscribe(v.observer(function(J){var K;K=G(J);K==null?void 0:I.event.Trigger(K.$0);}));return I.event;};s=b.MailboxProcessor=u.Class({dequeue:function(){var G;G=this.mailbox.n.v;this.mailbox.RemoveFirst();return G;},resume:function(){var G;G=this.savedCont;G!=null&&G.$==1?(this.savedCont=null,this.startAsync(G.$0)):void 0;},startAsync:function(G){C.Start(G,this.token);},Scan:function(G,H){var I,J;I=this;J=null;return C.Delay(function(){return C.Bind(I.TryScan(G,H),function(K){var L,M;if(K!=null&&K.$==1)M=K.$0;else throw new D.New();return C.Return(M);});});},TryScan:function(G,H){var I,J,K,L;I=this;J=(K=this.get_DefaultTimeout(),H==null?K:H.$0);L=null;return C.Delay(function(){var M,N,O,P,Q;N=I.mailbox.n;O=null;while(!y.Equals(N,null)){Q=G(N.v);Q==null?N=N.n:(I.mailbox.Remove$1(N),N=null,O=Q);}M=O;return M!=null&&M.$==1?C.Bind(M.$0,function(R){return C.Return({$:1,$0:R});}):(P=function(R){var T,U;if(J<0){function S(){var W;I.savedCont={$:1,$0:(W=null,C.Delay(function(){var X;X=G(I.mailbox.n.v);return X!=null&&X.$==1?(I.mailbox.RemoveFirst(),C.Bind(X.$0,function(Y){R({$:1,$0:Y});return C.Zero();})):(S(),C.Zero());}))};}S();}else{function V(){var W;I.savedCont={$:1,$0:(W=null,C.Delay(function(){var X;X=G(I.mailbox.n.v);return X!=null&&X.$==1?(I.mailbox.RemoveFirst(),C.Bind(X.$0,function(Y){return T[0]?(T[0]=false,window.clearTimeout(U),R({$:1,$0:Y}),C.Zero()):C.Zero();})):(V(),C.Zero());}))};}T=[true];U=window.setTimeout(function(){if(T[0]){T[0]=false;I.savedCont=null;R(null);}},J);V();}},C.FromContinuations(function(R,S,T){return P.apply(null,[R,S,T]);}));});},PostAndAsyncReply:function(G,H){var I,J;I=this;J=null;return C.Delay(function(){return C.Bind(I.PostAndTryAsyncReply(G,H),function(K){var L,M;if(K!=null&&K.$==1)M=K.$0;else throw new D.New();return C.Return(M);});});},PostAndTryAsyncReply:function(G,H){var I,J,K,L;I=this;J=(K=this.get_DefaultTimeout(),H==null?K:H.$0);L=function(M){var N,O;if(J<0){I.mailbox.AddLast(G((N=function(P){return{$:1,$0:P};},function(P){return M(N(P));})));I.resume();}else{O=[true];I.mailbox.AddLast(G(function(P){if(O[0]){O[0]=false;M({$:1,$0:P});}}));I.resume();window.setTimeout(function(){if(O[0]){O[0]=false;M(null);}},J);}};return C.FromContinuations(function(M,N,O){return L.apply(null,[M,N,O]);});},get_CurrentQueueLength:function(){return this.mailbox.c;},Receive:function(G){var H,I;H=this;I=null;return C.Delay(function(){return C.Bind(H.TryReceive(G),function(J){var K,L;if(J!=null&&J.$==1)L=J.$0;else throw new D.New();return C.Return(L);});});},TryReceive:function(G){var H,I,J,K;H=this;I=(J=this.get_DefaultTimeout(),G==null?J:G.$0);K=function(L){var M,N,O,P;if(y.Equals(H.mailbox.n,null)){if(I<0){H.savedCont={$:1,$0:(M=null,C.Delay(function(){L({$:1,$0:H.dequeue()});return C.Zero();}))};}else{N=[true];O=window.setTimeout(function(){if(N[0]){N[0]=false;H.savedCont=null;L(null);}},I);H.savedCont={$:1,$0:(P=null,C.Delay(function(){return N[0]?(N[0]=false,window.clearTimeout(O),L({$:1,$0:H.dequeue()}),C.Zero()):C.Zero();}))};}}else L({$:1,$0:H.dequeue()});};return C.FromContinuations(function(L,M,N){return K.apply(null,[L,M,N]);});},Start:function(){var G,H;G=this;this.started?E.FailWith("The MailboxProcessor has already been started."):(this.started=true,G.startAsync((H=null,C.Delay(function(){return C.TryWith(C.Delay(function(){return C.Bind(G.initial(G),function(){return C.Return(null);});}),function(I){G.errorEvent.event.Trigger(I);return C.Zero();});}))));},set_DefaultTimeout:function(G){this.DefaultTimeout=G;},get_DefaultTimeout:function(){return this.DefaultTimeout;},remove_Error:function(G){this.errorEvent.event.RemoveHandler(G);},add_Error:function(G){this.errorEvent.event.AddHandler(G);},get_Error:function(){return this.errorEvent.event;}},null,s);s.Start=function(G,H){var I;I=new s.New(G,H);I.Start();return I;};s.New=u.Ctor(function(G,H){var I,J,K;I=this;this.initial=G;this.token=H;this.started=false;this.errorEvent=new p.New();this.mailbox=new F.New();this.savedCont=null;J=this.token;J==null?void 0:(K=function(){return I.resume();},C.Register(J.$0,function(){K();}));this.DefaultTimeout=-1;},s);}());
